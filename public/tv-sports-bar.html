<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GridTV Sports - Sports Bar Mode</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link rel="stylesheet" href="/styles/fullscreen-cards.css">
    <link rel="stylesheet" href="/styles/play-animations.css">
    <link rel="stylesheet" href="/styles/mlb-livecast.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/scripts/game-socket.js"></script>
    <script src="/scripts/play-animations.js"></script>
    <script src="/scripts/field-visualizer-svg.js"></script>
    <script src="/scripts/mlb-strike-zone.js"></script>
    <script src="/scripts/mlb-livecast.js"></script>
    <style>
        /* ================================ */
        /* TV SPORTS BAR MODE - BASE        */
        /* ================================ */
        :root {
            --tv-bg-primary: #0a0e1a;
            --tv-accent: #6366f1;
            --tv-success: #22c55e;
            --tv-text-primary: #ffffff;
            --tv-text-secondary: #94a3b8;
            --tv-border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--tv-bg-primary);
            font-family: Roboto, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--tv-text-primary);
        }

        /* Container Overrides for TV */
        .fullscreen-container {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        .fullscreen-grid {
            height: 100vh;
            padding: 20px;
            width: 100%;
        }

        /* ================================ */
        /* TV RESPONSIVE GRID LAYOUTS       */
        /* ================================ */

        /* TV Default - Optimized for 1080p/4K displays */
        .fullscreen-grid.grid-1 {
            padding: 30px;
        }

        .fullscreen-grid.grid-2 {
            gap: 20px;
            padding: 25px;
        }

        .fullscreen-grid.grid-3,
        .fullscreen-grid.grid-4 {
            gap: 16px;
            padding: 22px;
        }

        /* Grid 3 - Make bottom card same width as top cards, centered */
        .fullscreen-grid.grid-3 {
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(1) {
            grid-column: 1 / 3;
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(2) {
            grid-column: 3 / 5;
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(3) {
            grid-column: 2 / 4;
        }

        .fullscreen-grid.grid-5,
        .fullscreen-grid.grid-6 {
            gap: 14px;
            padding: 20px;
        }

        /* Grid 5 - 2 big cards on top, 3 smaller cards on bottom */
        .fullscreen-grid.grid-5 {
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: 1.2fr 1fr;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(1) {
            grid-column: 1 / 4;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(2) {
            grid-column: 4 / 7;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(3) {
            grid-column: 1 / 3;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(4) {
            grid-column: 3 / 5;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(5) {
            grid-column: 5 / 7;
        }

        /* Grid 5 bottom row card adjustments */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-scoreboard {
            width: 95%;
            height: clamp(45px, 7vmin, 60px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-score-box {
            width: clamp(55px, 8vmin, 70px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-score {
            font-size: clamp(1.2rem, 3vmin, 1.8rem);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-logo-spacer {
            width: clamp(45px, 7vmin, 60px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-time-box {
            padding: 2px 6px;
            min-width: 40px;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-time {
            font-size: clamp(0.5rem, 1.2vmin, 0.7rem);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-time-label {
            font-size: clamp(0.35rem, 0.8vmin, 0.5rem);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-name {
            font-size: clamp(0.7rem, 1.8vmin, 1rem);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-record {
            font-size: clamp(0.5rem, 1.2vmin, 0.75rem);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section {
            padding-left: clamp(35px, 6vmin, 55px);
            padding-right: clamp(35px, 6vmin, 55px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.away {
            padding-right: clamp(0px, 0vmin, 55px);
            padding-left: 50px;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.home {
            padding-left: clamp(0px, 0vmin, 55px);
            padding-right: 46px;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-card-team-logo {
            width: clamp(55px, 7vmin, 85px);
            height: clamp(55px, 7vmin, 85px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-scoreboard-top {
            width: 95%;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-logo-center-spacer {
            width: clamp(50px, 8vmin, 70px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeout-bar {
            width: clamp(4px, 0.7vmin, 6px);
            height: clamp(4px, 0.7vmin, 6px);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts {
            gap: 2px;
        }

        .fullscreen-grid.grid-7,
        .fullscreen-grid.grid-8 {
            gap: 12px;
            padding: 18px;
        }

        /* TV 720p (1280x720) - Webview typical resolution */
        @media screen and (min-width: 900px) and (max-width: 1400px) and (min-height: 480px) and (max-height: 800px) {
            .fullscreen-grid {
                padding: 16px;
            }

            .fullscreen-grid.grid-1 {
                padding: 20px;
            }

            .fullscreen-grid.grid-2 {
                gap: 14px;
                padding: 16px;
            }

            .fullscreen-grid.grid-3,
            .fullscreen-grid.grid-4 {
                gap: 12px;
                padding: 14px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                gap: 10px;
                padding: 12px;
            }

            .fullscreen-grid.grid-7,
            .fullscreen-grid.grid-8 {
                gap: 8px;
                padding: 10px;
            }
        }

        /* TV 540p (960x540) - Low resolution TV webview */
        @media screen and (min-width: 800px) and (max-width: 1100px) and (min-height: 400px) and (max-height: 600px) {
            .fullscreen-grid {
                padding: 12px;
            }

            .fullscreen-grid.grid-1 {
                padding: 14px;
            }

            .fullscreen-grid.grid-2 {
                gap: 10px;
                padding: 12px;
            }

            .fullscreen-grid.grid-3,
            .fullscreen-grid.grid-4 {
                gap: 8px;
                padding: 10px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                gap: 6px;
                padding: 8px;
            }

            .fullscreen-grid.grid-7,
            .fullscreen-grid.grid-8 {
                gap: 5px;
                padding: 6px;
            }

            .back-btn {
                top: 6px;
                left: 6px;
                padding: 4px 10px;
                font-size: 10px;
            }
        }

        /* TV 4K/UHD (3840x2160) - Large TV displays */
        @media screen and (min-width: 2500px) {
            .fullscreen-grid {
                padding: 40px;
            }

            .fullscreen-grid.grid-1 {
                padding: 50px;
            }

            .fullscreen-grid.grid-2 {
                gap: 30px;
                padding: 40px;
            }

            .fullscreen-grid.grid-3,
            .fullscreen-grid.grid-4 {
                gap: 24px;
                padding: 35px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                gap: 20px;
                padding: 30px;
            }

            .fullscreen-grid.grid-7,
            .fullscreen-grid.grid-8 {
                gap: 16px;
                padding: 25px;
            }

            .back-btn {
                padding: 12px 24px;
                font-size: 16px;
                border-radius: 10px;
            }
        }

        /* TV Overscan Safe Area - 5% margins for older TVs */
        @media tv {
            .fullscreen-grid {
                padding: 5vh 5vw;
            }
        }

        /* ================================ */
        /* BACK BUTTON                      */
        /* ================================ */
        .back-btn {
            position: fixed;
            top: 8px;
            left: 8px;
            z-index: 100000;
            padding: 6px 12px;
            background: rgba(51, 65, 85, 0.85);
            border: 2px solid transparent;
            border-radius: 6px;
            color: white;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .back-btn::before {
            content: '\2190';
            font-size: 12px;
        }

        .back-btn.focused {
            border-color: var(--tv-accent);
            background: rgba(99, 102, 241, 0.3);
            transform: scale(1.02);
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
        }

        /* ================================ */
        /* EXIT CONFIRMATION MODAL          */
        /* ================================ */
        .exit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            z-index: 100001;
            align-items: center;
            justify-content: center;
        }

        .exit-modal.visible {
            display: flex;
        }

        .exit-modal-content {
            background: linear-gradient(135deg, #1a1f2e 0%, #252b3d 100%);
            border-radius: 20px;
            padding: 40px 60px;
            text-align: center;
            border: 3px solid var(--tv-border);
            max-width: 500px;
        }

        .exit-modal-content h2 {
            font-size: 28px;
            margin-bottom: 16px;
        }

        .exit-modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .exit-modal-btn {
            padding: 14px 36px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 10px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .exit-modal-btn.confirm {
            background: linear-gradient(135deg, var(--tv-success) 0%, #16a34a 100%);
            color: white;
        }

        .exit-modal-btn.cancel {
            background: #334155;
            color: white;
        }

        .exit-modal-btn.focused {
            border-color: white;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* ================================ */
        /* EMPTY STATE                      */
        /* ================================ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: var(--tv-text-secondary);
        }

        .empty-state h2 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 24px;
        }

        /* ================================ */
        /* TV WEBVIEW RESPONSIVE            */
        /* ================================ */
        @media screen and (min-width: 900px) and (max-width: 1100px) and (min-height: 480px) and (max-height: 600px) {
            .back-btn {
                top: 6px;
                left: 6px;
                padding: 4px 10px;
                font-size: 10px;
            }

            .fullscreen-grid {
                padding: 12px;
            }

            .exit-modal-content {
                padding: 30px 40px;
            }

            .exit-modal-content h2 {
                font-size: 22px;
            }

            .exit-modal-content p {
                font-size: 14px;
                margin-bottom: 24px;
            }

            .exit-modal-btn {
                padding: 10px 24px;
                font-size: 14px;
            }
        }

        /* ============================================
           SCOREBOARD COMPONENT STYLES (Fullscreen Cards)
           ============================================ */

        /* Wrapper for entire fullscreen card content with scoreboard */
        .fs-card-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3px;
            gap: 8px;
        }

        /* Scoreboard top section - mirrors scoreboard layout below */
        .fs-scoreboard-top {
            width: 90%;
            display: flex;
            align-items: flex-end;
            padding: 0;
            margin-bottom: 0;
        }

        /* Spacer to match score box width */
        .fs-sb-logo-spacer {
            width: clamp(50px, 8vmin, 70px);
            flex-shrink: 0;
        }

        /* Logo box - matches team section width */
        .fs-sb-logo-box {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(8px, 2vmin, 16px);
        }

        /* Center spacer - matches time box width */
        .fs-sb-logo-center-spacer {
            width: clamp(60px, 10vmin, 100px);
            flex-shrink: 0;
        }

        .fs-card-team-logo-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fs-card-team-logo {
            width: clamp(50px, 8vmin, 90px);
            height: clamp(50px, 8vmin, 90px);
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6));
        }

        /* Possession indicator - football emoji near team logo */
        .fs-possession-indicator {
            position: absolute;
            font-size: clamp(14px, 2.0vmin, 24px);
            line-height: 1;
            animation: possessionBlink 1.5s infinite;
            filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.9));
            z-index: 5;
        }

        /* Away team: top-right */
        .fs-possession-indicator.away {
            top: -8px;
            right: -8px;
        }

        /* Home team: top-left */
        .fs-possession-indicator.home {
            top: -8px;
            left: -8px;
        }

        @keyframes possessionBlink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        /* Grid-specific possession indicator sizing */
        .fullscreen-grid.grid-1 .fs-possession-indicator {
            font-size: clamp(20px, 3.5vmin, 32px);
        }

        .fullscreen-grid.grid-1 .fs-possession-indicator.away {
            top: -12px;
            right: -12px;
        }

        .fullscreen-grid.grid-1 .fs-possession-indicator.home {
            top: -12px;
            left: -12px;
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator {
            font-size: clamp(18px, 3vmin, 28px);
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator.away {
            top: -10px;
            right: -10px;
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator.home {
            top: -10px;
            left: -10px;
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator,
        .fullscreen-grid.grid-6 .fs-possession-indicator {
            font-size: clamp(12px, 2vmin, 18px);
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator.away,
        .fullscreen-grid.grid-6 .fs-possession-indicator.away {
            top: -6px;
            right: -6px;
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator.home,
        .fullscreen-grid.grid-6 .fs-possession-indicator.home {
            top: -6px;
            left: -6px;
        }

        .fullscreen-grid.grid-7 .fs-possession-indicator,
        .fullscreen-grid.grid-8 .fs-possession-indicator {
            font-size: clamp(10px, 1.5vmin, 14px);
        }

        .fullscreen-grid.grid-7 .fs-possession-indicator.away,
        .fullscreen-grid.grid-8 .fs-possession-indicator.away {
            top: -4px;
            right: -4px;
        }

        .fullscreen-grid.grid-7 .fs-possession-indicator.home,
        .fullscreen-grid.grid-8 .fs-possession-indicator.home {
            top: -4px;
            left: -4px;
        }

        /* The scoreboard itself */
        .fs-scoreboard {
            /* Default fallback colors */
            --sb-away-primary: #4b5563;
            --sb-away-secondary: #374151;
            --sb-home-primary: #6b7280;
            --sb-home-secondary: #4b5563;
            --sb-center-bg: #1f2937;
            --sb-text-color: #ffffff;
            --sb-subtext-color: rgba(255, 255, 255, 0.7);

            position: relative;
            width: 90%;
            height: clamp(50px, 8vmin, 70px);
            display: flex;
            align-items: stretch;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.6));
            border-radius: 6px;
            overflow: visible;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.5),
                0 2px 6px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Score boxes on sides - dark background with skew */
        .fs-sb-score-box {
            width: clamp(52px, 8vmin, 72px);
            height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            background: linear-gradient(180deg,
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.85) 100%);
            transform: skewX(var(--sb-skew-angle, -4deg));
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .fs-sb-score-box.away {
            border-radius: 4px 0 0 4px;
            border-left: 3px solid var(--sb-away-primary);
        }

        .fs-sb-score-box.home {
            border-radius: 0 4px 4px 0;
            border-right: 3px solid var(--sb-home-primary);
        }

        .fs-sb-score {
            font-size: clamp(1.5rem, 4vmin, 2.5rem);
            font-weight: 900;
            color: var(--sb-text-color);
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 2px 2px rgba(0, 0, 0, 0.3),
                0 3px 4px rgba(0, 0, 0, 0.2),
                0 0 12px rgba(255, 255, 255, 0.1);
            letter-spacing: 1px;
        }

        /* ============================================
           SCORE INCREMENT ANIMATION
           ============================================ */
        .fs-sb-score-box {
            position: relative;
        }

        .fs-sb-score {
            transition: opacity 0.3s ease;
        }

        .fs-sb-score.score-fading-out {
            opacity: 0;
        }

        .fs-sb-score.score-fading-in {
            animation: scoreFadeIn 0.3s ease forwards;
        }

        @keyframes scoreFadeIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .score-increment {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) skewX(4deg);
            font-size: clamp(1.2rem, 3.5vmin, 2rem);
            font-weight: 900;
            color: #22c55e;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            text-shadow:
                0 0 10px #22c55e,
                0 0 20px #22c55e,
                0 0 30px #22c55e,
                0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .score-increment.active {
            animation: scoreIncrementSequence 2.8s ease forwards;
        }

        @keyframes scoreIncrementSequence {
            /* Fade in with scale bounce (0-10%) */
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) skewX(4deg) scale(0.5);
            }
            10% {
                opacity: 1;
                transform: translate(-50%, -50%) skewX(4deg) scale(1.3);
            }
            15% {
                transform: translate(-50%, -50%) skewX(4deg) scale(1);
            }
            /* Pulse glow during hold (15-85%) */
            25% {
                text-shadow:
                    0 0 15px #22c55e,
                    0 0 30px #22c55e,
                    0 0 45px #22c55e,
                    0 0 60px rgba(34, 197, 94, 0.5),
                    0 2px 4px rgba(0, 0, 0, 0.5);
                transform: translate(-50%, -50%) skewX(4deg) scale(1.1);
            }
            35% {
                text-shadow:
                    0 0 10px #22c55e,
                    0 0 20px #22c55e,
                    0 0 30px #22c55e,
                    0 2px 4px rgba(0, 0, 0, 0.5);
                transform: translate(-50%, -50%) skewX(4deg) scale(1);
            }
            50% {
                text-shadow:
                    0 0 15px #22c55e,
                    0 0 30px #22c55e,
                    0 0 45px #22c55e,
                    0 0 60px rgba(34, 197, 94, 0.5),
                    0 2px 4px rgba(0, 0, 0, 0.5);
                transform: translate(-50%, -50%) skewX(4deg) scale(1.1);
            }
            65% {
                text-shadow:
                    0 0 10px #22c55e,
                    0 0 20px #22c55e,
                    0 0 30px #22c55e,
                    0 2px 4px rgba(0, 0, 0, 0.5);
                transform: translate(-50%, -50%) skewX(4deg) scale(1);
            }
            75% {
                opacity: 1;
                text-shadow:
                    0 0 15px #22c55e,
                    0 0 30px #22c55e,
                    0 0 45px #22c55e,
                    0 0 60px rgba(34, 197, 94, 0.5),
                    0 2px 4px rgba(0, 0, 0, 0.5);
                transform: translate(-50%, -50%) skewX(4deg) scale(1.1);
            }
            /* Fade out (85-100%) */
            85% {
                opacity: 1;
                transform: translate(-50%, -50%) skewX(4deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) skewX(4deg) scale(0.8);
            }
        }

        /* Score box glow effect during animation */
        .fs-sb-score-box.score-animating {
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(34, 197, 94, 0.6),
                inset 0 0 10px rgba(34, 197, 94, 0.3);
        }

        /* Team info sections inside scoreboard - team color backgrounds */
        .fs-sb-team-section {
            flex: 1;
            align-self: stretch;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px 10px;
            position: relative;
            transition: background 0.25s ease;
        }

        /* Away team - uses team color gradient */
        .fs-sb-team-section.away {
            padding-left: clamp(58px, 7vmin, 90px);
            padding-right: clamp(36px, 3vmin, 60px);
            background: linear-gradient(135deg,
                    var(--sb-away-primary) 0%,
                    color-mix(in srgb, var(--sb-away-primary) 85%, var(--sb-away-secondary)) 60%,
                    color-mix(in srgb, var(--sb-away-primary) 70%, #000) 100%);
        }

        /* Away score box - far left */
        .fs-sb-team-section.away .fs-sb-score-box {
            position: absolute;
            left: 7px;
            top: 50%;
            transform: translateY(-50%) skewX(var(--sb-skew-angle, -4deg));
        }

        /* Home team - uses team color gradient */
        .fs-sb-team-section.home {
            padding-left: clamp(23px, 2vmin, 60px);
            padding-right: clamp(60px, 10vmin, 90px);
            background: linear-gradient(135deg,
                    color-mix(in srgb, var(--sb-home-primary) 70%, #000) 0%,
                    color-mix(in srgb, var(--sb-home-primary) 85%, var(--sb-home-secondary)) 40%,
                    var(--sb-home-primary) 100%);
        }

        /* Home score box - far right */
        .fs-sb-team-section.home .fs-sb-score-box {
            position: absolute;
            right: 7px;
            top: 50%;
            transform: translateY(-50%) skewX(var(--sb-skew-angle, -4deg));
        }

        .fs-sb-team-info {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            z-index: 2;
        }

        /* Team logo inside team-info - positioned above the scoreboard */
        .fs-sb-team-logo {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: clamp(6px, 1vmin, 12px);
            width: clamp(50px, 8vmin, 90px);
            height: clamp(50px, 8vmin, 90px);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .fs-sb-team-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6));
            transition: transform 0.2s ease;
        }

        /* Winner highlight on logo */
        .fs-sb-team-section.winner .fs-sb-team-logo-img {
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6)) drop-shadow(0 0 12px rgba(255, 255, 255, 0.3));
        }

        .fs-sb-team-name {
            font-size: clamp(0.8rem, 2vmin, 1.1rem);
            font-weight: 700;
            color: var(--sb-text-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fs-sb-team-record {
            font-size: clamp(0.6rem, 1.5vmin, 0.85rem);
            color: var(--sb-subtext-color);
            font-weight: 500;
        }

        /* Timeout bars container - flex item next to team info */
        .fs-sb-timeouts {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 3px;
            z-index: 5;
        }

        .fs-sb-timeout-bar {
            width: clamp(6px, 1vmin, 10px);
            height: clamp(6px, 1vmin, 10px);
            background: linear-gradient(135deg, #f5e3c4 0%, #d4c4a8 100%);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.5);
            transition: opacity 0.3s ease;
        }

        .fs-sb-timeout-bar.used {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            opacity: 0.3;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Center time/status section */
        .fs-sb-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fs-sb-time-box {
            background: linear-gradient(180deg,
                    #252a31 0%,
                    #000000 10%,
                    #393c47 40%,
                    #000000 60%,
                    #000000 90%,
                    #000000 100%);
            padding: 3px 10px;
            clip-path: polygon(10% 0, 90% 0, 100% 50%, 90% 100%, 10% 100%, 0 50%);
            min-width: 60px;
            text-align: center;
            border: 1px solid #5a6577;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.5),
                0 1px 2px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                inset 0 -1px 2px rgba(0, 0, 0, 0.3);
        }

        .fs-sb-time-label {
            font-size: clamp(0.5rem, 1.2vmin, 0.7rem);
            color: var(--sb-subtext-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fs-sb-time {
            font-size: clamp(0.65rem, 1.8vmin, 0.9rem);
            font-weight: 900;
            color: var(--sb-text-color);
            font-variant-numeric: tabular-nums;
        }

        /* ============================================
           GAME SITUATION BOX (NFL/NCAA Football)
           ============================================ */
        .fs-sb-situation {
            --sb-possession-primary: #4b5563;
            --sb-possession-secondary: #374151;

            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(50%);
            background: linear-gradient(135deg,
                    var(--sb-possession-primary) 0%,
                    color-mix(in srgb, var(--sb-possession-primary) 70%, #000) 100%);
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 5;
            transition: all 0.3s ease;
            font-family: var(--sb-font-display, 'Oswald', sans-serif);
        }

        .fs-sb-situation.possession-away {
            --sb-possession-primary: var(--sb-away-primary);
            --sb-possession-secondary: var(--sb-away-secondary);
            left: 22%;
            transform: translateX(-50%) translateY(50%);
        }

        .fs-sb-situation.possession-home {
            --sb-possession-primary: var(--sb-home-primary);
            --sb-possession-secondary: var(--sb-home-secondary);
            left: 78%;
            transform: translateX(-50%) translateY(50%);
        }

        .fs-sb-down-distance {
            font-size: clamp(0.65rem, 1.8vmin, 0.85rem);
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .fs-sb-situation-divider {
            width: 1px;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
        }

        .fs-sb-ball-position {
            font-size: clamp(0.6rem, 1.5vmin, 0.75rem);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .fs-sb-situation.redzone {
            border-color: #ef4444;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(239, 68, 68, 0.5);
        }

        /* Special play situations (kickoff, punt, return, etc.) */
        .fs-sb-situation.special-play {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(15, 35, 60, 0.95) 100%);
            border-color: #3b82f6;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .fs-sb-situation.special-play .fs-sb-down-distance {
            text-align: center;
            letter-spacing: 0.5px;
        }

        .fs-sb-situation.special-play-kickoff {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(60, 50, 20, 0.95) 0%, rgba(40, 30, 10, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(245, 158, 11, 0.3);
        }

        .fs-sb-situation.special-play-punt {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(50, 30, 70, 0.95) 0%, rgba(30, 20, 50, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(139, 92, 246, 0.3);
        }

        .fs-sb-situation.special-play-return {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(20, 60, 50, 0.95) 0%, rgba(10, 40, 30, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(16, 185, 129, 0.3);
        }

        .fs-sb-situation.special-play-touchback,
        .fs-sb-situation.special-play-faircatch {
            border-color: #6b7280;
            background: linear-gradient(135deg, rgba(40, 45, 55, 0.95) 0%, rgba(25, 30, 40, 0.95) 100%);
        }

        .fs-sb-situation.special-play-xp,
        .fs-sb-situation.special-play-fg {
            border-color: #22c55e;
            background: linear-gradient(135deg, rgba(20, 60, 40, 0.95) 0%, rgba(10, 40, 25, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(34, 197, 94, 0.3);
        }

        .fs-sb-situation.special-play-2pt {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(60, 30, 30, 0.95) 0%, rgba(40, 20, 20, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(239, 68, 68, 0.3);
        }

        .fs-sb-situation:empty,
        .fs-sb-situation.hidden {
            display: none;
        }

        /* ================================ */
        /* MLB SITUATION & DIAMOND STYLES   */
        /* ================================ */

        /* MLB scoreboard: reduce team section paddings so scores + team name fit at compact widths */
        .fullscreen-grid.grid-3 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-4 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(48px, 5vmin, 72px);
            padding-right: clamp(8px, 1vmin, 20px);
        }

        .fullscreen-grid.grid-3 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-4 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(8px, 1vmin, 20px);
            padding-right: clamp(48px, 5vmin, 72px);
        }

        .fullscreen-grid.grid-5 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-6 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(44px, 4.5vmin, 64px);
            padding-right: clamp(6px, 0.8vmin, 16px);
        }

        .fullscreen-grid.grid-5 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-6 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(6px, 0.8vmin, 16px);
            padding-right: clamp(44px, 4.5vmin, 64px);
        }

        .fullscreen-grid.grid-7 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-8 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(40px, 4vmin, 58px);
            padding-right: clamp(4px, 0.5vmin, 12px);
        }

        .fullscreen-grid.grid-7 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-8 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(4px, 0.5vmin, 12px);
            padding-right: clamp(40px, 4vmin, 58px);
        }

        /* MLB Diamond Visualizer */
        .mlb-diamond-visualizer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: clamp(16px, 3vmin, 28px);
            padding: clamp(8px, 1.5vmin, 16px);
        }

        .mlb-diamond {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(2px, 0.5vmin, 4px);
        }

        .mlb-base-row {
            display: flex;
            gap: clamp(20px, 4vmin, 40px);
        }

        .mlb-base {
            width: clamp(16px, 3vmin, 28px);
            height: clamp(16px, 3vmin, 28px);
            background: rgba(100, 116, 139, 0.3);
            border: 2px solid rgba(148, 163, 184, 0.5);
            transform: rotate(45deg);
            transition: all 0.3s ease;
        }

        .mlb-base.home {
            width: clamp(14px, 2.5vmin, 22px);
            height: clamp(14px, 2.5vmin, 22px);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
            clip-path: polygon(0% 0%, 100% 0%, 100% 70%, 50% 100%, 0% 70%);
            transform: none;
        }

        .mlb-base.occupied {
            background: #fbbf24;
            border-color: #f59e0b;
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* ============================================
           MLB LIVE CAST CONTAINER
           ============================================ */
        .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            /* Base margin — matches field-visualizer clearance for BSO badge overhang */
            margin: clamp(24px, 4vmin, 40px) auto 0;
            display: flex;
            justify-content: center;
        }

        /* Grid 1 — generous clearance */
        .fullscreen-grid.grid-1 .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            margin-top: clamp(32px, 5vmin, 50px);
        }

        /* Grid 2 */
        .fullscreen-grid.grid-2 .mlb-livecast-container {
            width: 85%;
            max-width: 85%;
            margin-top: clamp(28px, 4.5vmin, 45px);
        }

        /* Grid 3-4 — badge now translateY(100%) so needs ~badge-height clearance */
        .fullscreen-grid.grid-3 .mlb-livecast-container,
        .fullscreen-grid.grid-4 .mlb-livecast-container {
            width: 90%;
            max-width: 90%;
            margin-top: clamp(34px, 5vmin, 48px);
        }

        /* Grid 5-6 */
        .fullscreen-grid.grid-5 .mlb-livecast-container,
        .fullscreen-grid.grid-6 .mlb-livecast-container {
            width: 92%;
            max-width: 92%;
            margin-top: clamp(28px, 4vmin, 40px);
        }

        /* Grid 7-8 Featured Card */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .mlb-livecast-container,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:first-child .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            margin-top: clamp(18px, 2.8vmin, 30px);
        }

        /* Grid 7-8 Smaller Cards */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:not(:first-child) .mlb-livecast-container,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:not(:first-child) .mlb-livecast-container {
            width: 92%;
            max-width: 92%;
            margin-top: clamp(16px, 2.5vmin, 26px);
        }

        /* ============================================
           NBA SCORER NOTIFICATION (Floating Box)
           ============================================ */
        .nba-scorer-notification {
            position: absolute;
            bottom: 5%;
            padding: clamp(8px, 1.5vmin, 14px) clamp(14px, 2.5vmin, 24px);
            background: linear-gradient(135deg, rgba(20, 20, 35, 0.95) 0%, rgba(35, 35, 55, 0.95) 100%);
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-radius: 6px;
            font-family: var(--sb-font-display, 'Oswald', sans-serif);
            font-size: clamp(0.9rem, 2vmin, 1.3rem);
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            z-index: 50;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 255, 255, 0.05);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.5px;
        }

        .nba-scorer-notification.away {
            left: 18%;
            transform: translateX(-50%) translateY(20px);
            border-color: var(--sb-away-primary, rgba(255, 255, 255, 0.25));
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 15px color-mix(in srgb, var(--sb-away-primary) 30%, transparent);
        }

        .nba-scorer-notification.home {
            right: 18%;
            left: auto;
            transform: translateX(50%) translateY(20px);
            border-color: var(--sb-home-primary, rgba(255, 255, 255, 0.25));
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 15px color-mix(in srgb, var(--sb-home-primary) 30%, transparent);
        }

        /* Animation for away team scorer */
        @keyframes scorerSlideUpAway {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            12% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            80% {
                opacity: 1;
                transform: translateX(-50%) translateY(-40px);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
        }

        /* Animation for home team scorer */
        @keyframes scorerSlideUpHome {
            0% {
                opacity: 0;
                transform: translateX(50%) translateY(20px);
            }
            12% {
                opacity: 1;
                transform: translateX(50%) translateY(0);
            }
            80% {
                opacity: 1;
                transform: translateX(50%) translateY(-40px);
            }
            100% {
                opacity: 0;
                transform: translateX(50%) translateY(-50px);
            }
        }

        .nba-scorer-notification.away.animate {
            animation: scorerSlideUpAway 3s ease-out forwards;
        }

        .nba-scorer-notification.home.animate {
            animation: scorerSlideUpHome 3s ease-out forwards;
        }

        /* Status text above scoreboard */
        .fs-status-container {
            margin-bottom: 4px;
        }

        .fs-status-text {
            font-size: clamp(0.7rem, 1.8vmin, 1rem);
            font-weight: 600;
            color: var(--tv-text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fs-status-text.upcoming {
            color: #60a5fa;
        }

        .fs-status-text.final {
            color: #9ca3af;
        }

        /* League logo position adjustment for scoreboard layout */
        .fullscreen-game-card.has-scoreboard .sport-logo-indicator {
            top: 15px;
            right: 15px;
            width: clamp(50px, 8vmin, 70px);
            height: clamp(50px, 8vmin, 70px);
        }

        /* League-specific background images */
        .fullscreen-game-card.fs-nfl {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NFL-Field.jpg') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-ncaa {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NCAAF-Field.jpg') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-nba {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NBACourt.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-ncaab {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NCAABCourt.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-nhl {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NHLIceRink.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-mlb {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/MLBFiled.png') center center / cover no-repeat;
        }

        /* Hide default content when using scoreboard */
        .fullscreen-game-card.has-scoreboard .fullscreen-card-content {
            display: none;
        }

        /* Grid-specific scoreboard adjustments */
        /* Grid 1 - largest cards */
        .fullscreen-grid.grid-1 .fs-sb-logo-spacer {
            width: clamp(70px, 10vmin, 100px);
        }

        .fullscreen-grid.grid-1 .fs-sb-logo-center-spacer {
            width: clamp(80px, 12vmin, 120px);
        }

        .fullscreen-grid.grid-1 .fs-card-team-logo {
            width: clamp(80px, 12vmin, 140px);
            height: clamp(80px, 12vmin, 140px);
        }

        .fullscreen-grid.grid-1 .fs-scoreboard {
            height: clamp(70px, 10vmin, 100px);
        }

        .fullscreen-grid.grid-1 .fs-sb-score-box {
            width: clamp(70px, 10vmin, 100px);
        }

        /* Grid 1 timeout bars - largest */
        .fullscreen-grid.grid-1 .fs-sb-timeout-bar {
            width: clamp(8px, 1.2vmin, 12px);
            height: clamp(8px, 1.2vmin, 12px);
        }

        .fullscreen-grid.grid-1 .fs-sb-timeouts {
            gap: 4px;
        }

        /* Grid 2 */
        .fullscreen-grid.grid-2 .fs-sb-logo-spacer {
            width: clamp(50px, 8vmin, 70px);
        }

        .fullscreen-grid.grid-2 .fs-sb-logo-center-spacer {
            width: clamp(70px, 10vmin, 100px);
        }

        .fullscreen-grid.grid-2 .fs-card-team-logo {
            width: clamp(60px, 10vmin, 100px);
            height: clamp(60px, 10vmin, 100px);
        }

        /* Grid 2 timeout bars */
        .fullscreen-grid.grid-2 .fs-sb-timeout-bar {
            width: clamp(7px, 1.1vmin, 10px);
            height: clamp(7px, 1.1vmin, 10px);
        }

        .fullscreen-grid.grid-2 .fs-sb-timeouts {
            gap: 4px;
        }

        /* Grid 3-4 timeout bars */
        .fullscreen-grid.grid-3 .fs-sb-timeout-bar,
        .fullscreen-grid.grid-4 .fs-sb-timeout-bar {
            width: clamp(5px, 0.9vmin, 8px);
            height: clamp(5px, 0.9vmin, 8px);
        }

        /* Grid 3-4 timeout bars - use flex gap inherited from parent */

        /* Grid 5-6 */
        .fullscreen-grid.grid-5 .fs-sb-logo-spacer,
        .fullscreen-grid.grid-6 .fs-sb-logo-spacer {
            width: clamp(45px, 7vmin, 60px);
        }

        .fullscreen-grid.grid-5 .fs-sb-logo-center-spacer,
        .fullscreen-grid.grid-6 .fs-sb-logo-center-spacer {
            width: clamp(50px, 8vmin, 80px);
        }

        .fullscreen-grid.grid-5 .fs-card-team-logo,
        .fullscreen-grid.grid-6 .fs-card-team-logo {
            width: clamp(35px, 9vmin, 80px);
            height: clamp(35px, 9vmin, 80px);
        }

        .fullscreen-grid.grid-5 .fs-sb-score-box,
        .fullscreen-grid.grid-6 .fs-sb-score-box {
            width: clamp(45px, 7vmin, 60px);
        }

        /* Grid 5-6 timeout bars */
        .fullscreen-grid.grid-5 .fs-sb-timeout-bar,
        .fullscreen-grid.grid-6 .fs-sb-timeout-bar {
            width: clamp(5px, 0.8vmin, 8px);
            height: clamp(5px, 0.8vmin, 8px);
        }

        /* Grid 5-6 timeout bars - use flex gap inherited from parent */

        /* Grid 7-8 - smallest cards */
        .fullscreen-grid.grid-7 .fs-sb-logo-spacer,
        .fullscreen-grid.grid-8 .fs-sb-logo-spacer {
            width: clamp(40px, 6vmin, 55px);
        }

        .fullscreen-grid.grid-7 .fs-sb-logo-center-spacer,
        .fullscreen-grid.grid-8 .fs-sb-logo-center-spacer {
            width: clamp(40px, 6vmin, 60px);
        }

        .fullscreen-grid.grid-7 .fs-card-team-logo,
        .fullscreen-grid.grid-8 .fs-card-team-logo {
            width: clamp(30px, 5vmin, 50px);
            height: clamp(30px, 5vmin, 50px);
        }

        .fullscreen-grid.grid-7 .fs-scoreboard,
        .fullscreen-grid.grid-8 .fs-scoreboard {
            height: clamp(40px, 6vmin, 55px);
        }

        .fullscreen-grid.grid-7 .fs-sb-score-box,
        .fullscreen-grid.grid-8 .fs-sb-score-box {
            width: clamp(40px, 6vmin, 55px);
        }

        .fullscreen-grid.grid-7 .fs-sb-timeout-bar,
        .fullscreen-grid.grid-8 .fs-sb-timeout-bar {
            width: clamp(4px, 0.6vmin, 6px);
            height: clamp(4px, 0.6vmin, 6px);
        }

        .fullscreen-grid.grid-7 .fs-sb-timeouts,
        .fullscreen-grid.grid-8 .fs-sb-timeouts {
            gap: 1px;
        }

        /* Grid 7-8 timeout bars - use flex gap inherited from parent */

        .fullscreen-grid.grid-7 .fs-sb-situation,
        .fullscreen-grid.grid-8 .fs-sb-situation {
            bottom: -9px;
            min-width: 100px;
            padding: 2px 8px;
        }

        /* Field visualizer spacing - push down from scoreboard */
        .fs-card-wrapper .field-visualizer {
            margin-top: clamp(24px, 4vmin, 40px);
        }

        .fullscreen-grid.grid-1 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(32px, 5vmin, 50px);
        }

        .fullscreen-grid.grid-2 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(28px, 4.5vmin, 45px);
        }

        .fullscreen-grid.grid-5 .fs-card-wrapper .field-visualizer,
        .fullscreen-grid.grid-6 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(20px, 3vmin, 32px);
        }

        .fullscreen-grid.grid-7 .fs-card-wrapper .field-visualizer,
        .fullscreen-grid.grid-8 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(16px, 2.5vmin, 26px);
        }

        /* SVG Field Container */
        .svg-field-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .svg-field-container .field-svg {
            width: 100%;
            max-width: 100%;
            height: auto;
        }

        /* ================================ */
        /* NFL STATS MODAL (Between Plays)  */
        /* ================================ */
        .nfl-stats-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(10, 14, 26, 0.95) 0%, rgba(20, 30, 50, 0.95) 100%);
            display: flex;
            flex-direction: column;
            padding: clamp(8px, 2vmin, 16px);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            overflow: hidden;
        }

        .nfl-stats-modal.visible {
            opacity: 1;
            visibility: visible;
        }

        .nfl-stats-modal-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: clamp(8px, 2vmin, 16px);
            margin-bottom: clamp(6px, 1.5vmin, 12px);
            padding-bottom: clamp(4px, 1vmin, 8px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nfl-stats-modal-title {
            font-size: clamp(1.2rem, 3vmin, 2rem);
            font-weight: 700;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-content {
            display: flex;
            flex: 1;
            gap: clamp(12px, 3vmin, 24px);
            overflow: hidden;
        }

        .nfl-stats-team {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: clamp(10px, 2.5vmin, 20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .nfl-stats-team-header {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2.5vmin, 16px);
            margin-bottom: clamp(10px, 2.5vmin, 16px);
            padding-bottom: clamp(8px, 2vmin, 12px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.15);
        }

        .nfl-stats-team-score {
            font-size: clamp(2rem, 5vmin, 4rem);
            font-weight: 900;
            color: #4ade80;
            text-shadow: 0 2px 8px rgba(74, 222, 128, 0.4), 0 2px 4px rgba(0, 0, 0, 0.5);
            min-width: clamp(50px, 8vmin, 90px);
            text-align: center;
        }

        .nfl-stats-team-logo {
            width: clamp(40px, 7vmin, 70px);
            height: clamp(40px, 7vmin, 70px);
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .nfl-stats-team-name {
            font-size: clamp(1rem, 2.5vmin, 1.6rem);
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            flex: 1;
        }

        .nfl-stats-category {
            margin-bottom: clamp(8px, 2vmin, 14px);
        }

        .nfl-stats-category-title {
            font-size: clamp(0.9rem, 2.2vmin, 1.3rem);
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: clamp(4px, 1vmin, 8px);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(4px, 1vmin, 8px) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .nfl-stats-player:last-child {
            border-bottom: none;
        }

        .nfl-stats-player-name {
            font-size: clamp(0.85rem, 2vmin, 1.2rem);
            color: white;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 45%;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-player-value {
            font-size: clamp(0.8rem, 1.8vmin, 1.1rem);
            color: #4ade80;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            color: #94a3b8;
            font-size: clamp(1rem, 2.5vmin, 1.5rem);
        }

        .nfl-stats-loading::after {
            content: '';
            width: 16px;
            height: 16px;
            margin-left: 8px;
            border: 2px solid #4ade80;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Grid 3-4 - slightly smaller */
        .fullscreen-grid.grid-3 .nfl-stats-modal-title,
        .fullscreen-grid.grid-4 .nfl-stats-modal-title {
            font-size: clamp(1rem, 2.5vmin, 1.6rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-team-score,
        .fullscreen-grid.grid-4 .nfl-stats-team-score {
            font-size: clamp(1.6rem, 4vmin, 3rem);
            min-width: clamp(40px, 6vmin, 70px);
        }

        .fullscreen-grid.grid-3 .nfl-stats-team-name,
        .fullscreen-grid.grid-4 .nfl-stats-team-name {
            font-size: clamp(0.85rem, 2vmin, 1.3rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-category-title,
        .fullscreen-grid.grid-4 .nfl-stats-category-title {
            font-size: clamp(0.75rem, 1.8vmin, 1.1rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-player-name,
        .fullscreen-grid.grid-4 .nfl-stats-player-name {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-player-value,
        .fullscreen-grid.grid-4 .nfl-stats-player-value {
            font-size: clamp(0.65rem, 1.5vmin, 0.95rem);
        }

        /* Grid 5-6 - compact but readable */
        .fullscreen-grid.grid-5 .nfl-stats-modal-title,
        .fullscreen-grid.grid-6 .nfl-stats-modal-title {
            font-size: clamp(0.85rem, 2vmin, 1.3rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-score,
        .fullscreen-grid.grid-6 .nfl-stats-team-score {
            font-size: clamp(1.3rem, 3.5vmin, 2.5rem);
            min-width: clamp(35px, 5vmin, 60px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-logo,
        .fullscreen-grid.grid-6 .nfl-stats-team-logo {
            width: clamp(30px, 5vmin, 50px);
            height: clamp(30px, 5vmin, 50px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-name,
        .fullscreen-grid.grid-6 .nfl-stats-team-name {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-category-title,
        .fullscreen-grid.grid-6 .nfl-stats-category-title {
            font-size: clamp(0.65rem, 1.5vmin, 0.9rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-player-name,
        .fullscreen-grid.grid-6 .nfl-stats-player-name {
            font-size: clamp(0.6rem, 1.3vmin, 0.85rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-player-value,
        .fullscreen-grid.grid-6 .nfl-stats-player-value {
            font-size: clamp(0.55rem, 1.2vmin, 0.8rem);
        }

        /* Grid 7-8 - smallest but still readable */
        .fullscreen-grid.grid-7 .nfl-stats-modal-title,
        .fullscreen-grid.grid-8 .nfl-stats-modal-title {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-7 .nfl-stats-team-score,
        .fullscreen-grid.grid-8 .nfl-stats-team-score {
            font-size: clamp(1rem, 2.8vmin, 2rem);
            min-width: clamp(28px, 4vmin, 50px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-team,
        .fullscreen-grid.grid-8 .nfl-stats-team {
            padding: clamp(6px, 1.5vmin, 12px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-team-logo,
        .fullscreen-grid.grid-8 .nfl-stats-team-logo {
            width: clamp(24px, 4vmin, 40px);
            height: clamp(24px, 4vmin, 40px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-team-name,
        .fullscreen-grid.grid-8 .nfl-stats-team-name {
            font-size: clamp(0.6rem, 1.4vmin, 0.85rem);
        }

        .fullscreen-grid.grid-7 .nfl-stats-category-title,
        .fullscreen-grid.grid-8 .nfl-stats-category-title {
            font-size: clamp(0.55rem, 1.2vmin, 0.75rem);
        }

        .fullscreen-grid.grid-7 .nfl-stats-player-name,
        .fullscreen-grid.grid-8 .nfl-stats-player-name {
            font-size: clamp(0.5rem, 1.1vmin, 0.7rem);
        }

        .fullscreen-grid.grid-7 .nfl-stats-player-value,
        .fullscreen-grid.grid-8 .nfl-stats-player-value {
            font-size: clamp(0.45rem, 1vmin, 0.65rem);
        }

        /* Grid 5-6: Hide receiving category and show only 1 player per category */
        .fullscreen-grid.grid-5 .nfl-stats-category:nth-child(3),
        .fullscreen-grid.grid-6 .nfl-stats-category:nth-child(3) {
            display: none;
        }

        .fullscreen-grid.grid-5 .nfl-stats-player:nth-child(n+2),
        .fullscreen-grid.grid-6 .nfl-stats-player:nth-child(n+2) {
            display: none;
        }

        .fullscreen-grid.grid-5 .nfl-stats-category,
        .fullscreen-grid.grid-6 .nfl-stats-category {
            margin-bottom: clamp(4px, 1vmin, 8px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-header,
        .fullscreen-grid.grid-6 .nfl-stats-team-header {
            margin-bottom: clamp(6px, 1.5vmin, 10px);
            padding-bottom: clamp(4px, 1vmin, 6px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-modal-header,
        .fullscreen-grid.grid-6 .nfl-stats-modal-header {
            margin-bottom: clamp(4px, 1vmin, 8px);
            padding-bottom: clamp(2px, 0.5vmin, 4px);
        }

        /* Grid 7-8: Hide receiving category, show only 1 player, minimal spacing */
        .fullscreen-grid.grid-7 .nfl-stats-category:nth-child(3),
        .fullscreen-grid.grid-8 .nfl-stats-category:nth-child(3) {
            display: none;
        }

        .fullscreen-grid.grid-7 .nfl-stats-player:nth-child(n+2),
        .fullscreen-grid.grid-8 .nfl-stats-player:nth-child(n+2) {
            display: none;
        }

        .fullscreen-grid.grid-7 .nfl-stats-category,
        .fullscreen-grid.grid-8 .nfl-stats-category {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-category-title,
        .fullscreen-grid.grid-8 .nfl-stats-category-title {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-team-header,
        .fullscreen-grid.grid-8 .nfl-stats-team-header {
            margin-bottom: clamp(4px, 1vmin, 8px);
            padding-bottom: clamp(2px, 0.5vmin, 4px);
            gap: clamp(6px, 1.5vmin, 10px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-modal-header,
        .fullscreen-grid.grid-8 .nfl-stats-modal-header {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
            padding-bottom: clamp(1px, 0.3vmin, 2px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-modal,
        .fullscreen-grid.grid-8 .nfl-stats-modal {
            padding: clamp(4px, 1vmin, 8px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-content,
        .fullscreen-grid.grid-8 .nfl-stats-content {
            gap: clamp(6px, 1.5vmin, 12px);
        }

        .fullscreen-grid.grid-7 .nfl-stats-player,
        .fullscreen-grid.grid-8 .nfl-stats-player {
            padding: clamp(2px, 0.5vmin, 4px) 0;
        }

        /* ============================================
           TV SPORTS BAR - PER-GRID ELEMENT CUSTOMIZATION
           Edit these variables to adjust element sizes and positions
           for each grid layout (1-8 games)
           ============================================ */

        /* ============================================
           GRID 1 - Single Game (Fullscreen)
           ============================================ */
        .fullscreen-grid.grid-1 {
            /* Sport Logo (top-right corner) */
            --g1-sport-logo-width: 80px;
            --g1-sport-logo-height: 80px;
            --g1-sport-logo-top: 20px;
            --g1-sport-logo-right: 20px;

            /* Team Logos */
            --g1-team-logo-size: 110px;
            --g1-team-logo-margin: 0;

            /* Score Box */
            --g1-score-box-width: 110px;
            --g1-score-box-height: 85%;

            /* Score Text */
            --g1-score-font-size: 4rem;

            /* Team Name */
            --g1-team-name-font-size: 1.5rem;
            --g1-team-name-margin: 0;

            /* Team Record */
            --g1-team-record-font-size: 1rem;
            --g1-team-record-margin: 0;

            /* Timeouts */
            --g1-timeout-size: 12px;
            --g1-timeout-gap: 4px;

            /* Center Time Box */
            --g1-time-box-min-width: 90px;
            --g1-time-box-padding: 6px 16px;
            --g1-time-label-font-size: 0.8rem;
            --g1-time-font-size: 1.2rem;

            /* Situation Box */
            --g1-situation-padding: 8px 16px;
            --g1-situation-font-size: 1rem;
            --g1-situation-min-width: 180px;
            --g1-situation-gap: 10px;

            /* Field Visualizer */
            --g1-field-margin-top: 50px;
            --g1-field-max-height: 280px;

            /* Scoreboard Container */
            --g1-scoreboard-width: 90%;
            --g1-scoreboard-height: 90px;

            /* Possession Indicator */
            --g1-possession-font-size: 28px;
            --g1-possession-offset: -12px;

            /* Logo Spacers */
            --g1-logo-spacer-width: 90px;
            --g1-logo-center-spacer-width: 120px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) */
            --g1-team-logo-width: clamp(50px, 8vmin, 90px);
            --g1-team-logo-height: clamp(50px, 8vmin, 90px);
            --g1-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) */
            --g1-team-info-gap: 2px;
            --g1-team-info-padding-top: 0;
            --g1-team-info-padding-bottom: 0;
            --g1-team-info-margin-left: 0;
            /* For away team */
            --g1-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) */
            --g1-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g1-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g1-timeout-gap-spacing: 3px;
            --g1-timeout-margin-left: 15px;
            /* For away team */
            --g1-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) */
            --g1-situation-padding-bottom: 6px;
            --g1-situation-margin-bottom: -11px;
            --g1-situation-bottom-offset: 0;
            /* Adjusts translateY offset */

            /* Scoreboard & Field Vertical Position */
            --g1-scoreboard-offset-y: 0;
            /* Positive = down, Negative = up */
            --g1-field-offset-y: 0;
            /* Positive = down, Negative = up */
        }

        /* Grid 1 Element Rules */
        .fullscreen-grid.grid-1 .sport-logo-indicator {
            width: var(--g1-sport-logo-width);
            height: var(--g1-sport-logo-height);
            top: var(--g1-sport-logo-top);
            right: var(--g1-sport-logo-right);
        }

        .fullscreen-grid.grid-1 .fs-card-team-logo {
            width: var(--g1-team-logo-size);
            height: var(--g1-team-logo-size);
            margin: var(--g1-team-logo-margin);
        }

        .fullscreen-grid.grid-1 .fs-sb-score-box {
            width: var(--g1-score-box-width);
            height: var(--g1-score-box-height);
        }

        .fullscreen-grid.grid-1 .fs-sb-score {
            font-size: var(--g1-score-font-size);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-name {
            font-size: var(--g1-team-name-font-size);
            margin: var(--g1-team-name-margin);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-record {
            font-size: var(--g1-team-record-font-size);
            margin: var(--g1-team-record-margin);
        }

        .fullscreen-grid.grid-1 .fs-sb-timeout-bar {
            width: var(--g1-timeout-size);
            height: var(--g1-timeout-size);
        }

        .fullscreen-grid.grid-1 .fs-sb-timeouts {
            gap: var(--g1-timeout-gap);
        }

        .fullscreen-grid.grid-1 .fs-sb-time-box {
            min-width: var(--g1-time-box-min-width);
            padding: var(--g1-time-box-padding);
        }

        .fullscreen-grid.grid-1 .fs-sb-time-label {
            font-size: var(--g1-time-label-font-size);
        }

        .fullscreen-grid.grid-1 .fs-sb-time {
            font-size: var(--g1-time-font-size);
        }

        .fullscreen-grid.grid-1 .fs-sb-situation {
            padding: var(--g1-situation-padding);
            min-width: var(--g1-situation-min-width);
            gap: var(--g1-situation-gap);
        }

        .fullscreen-grid.grid-1 .fs-sb-down-distance,
        .fullscreen-grid.grid-1 .fs-sb-ball-position {
            font-size: var(--g1-situation-font-size);
        }

        .fullscreen-grid.grid-1 .field-visualizer {
            margin-top: var(--g1-field-margin-top);
            max-height: var(--g1-field-max-height);
            transform: translateY(var(--g1-field-offset-y));
        }

        .fullscreen-grid.grid-1 .fs-scoreboard {
            width: var(--g1-scoreboard-width);
            height: var(--g1-scoreboard-height);
            transform: translateY(var(--g1-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-1 .fs-scoreboard-top {
            width: var(--g1-scoreboard-width);
        }

        .fullscreen-grid.grid-1 .fs-sb-logo-spacer {
            width: var(--g1-logo-spacer-width);
        }

        .fullscreen-grid.grid-1 .fs-sb-logo-center-spacer {
            width: var(--g1-logo-center-spacer-width);
        }

        /* Grid 1 - Individual Element Control Rules */
        .fullscreen-grid.grid-1 .fs-sb-team-logo {
            width: var(--g1-team-logo-width);
            height: var(--g1-team-logo-height);
            margin-bottom: var(--g1-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-info {
            gap: var(--g1-team-info-gap);
            padding-top: var(--g1-team-info-padding-top);
            padding-bottom: var(--g1-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g1-team-info-margin-left);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g1-team-info-margin-right);
        }

        .fullscreen-grid.grid-1 .fs-sb-timeout-bar {
            width: var(--g1-timeout-bar-width);
            height: var(--g1-timeout-bar-height);
        }

        .fullscreen-grid.grid-1 .fs-sb-timeouts {
            gap: var(--g1-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-1 .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g1-timeout-margin-left));
        }

        .fullscreen-grid.grid-1 .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g1-timeout-margin-right)));
        }

        .fullscreen-grid.grid-1 .fs-sb-situation {
            padding-bottom: var(--g1-situation-padding-bottom);
            margin-bottom: var(--g1-situation-margin-bottom);
        }

        /* ============================================
           GRID 2 - Two Games (Side by Side)
           ============================================ */
        .fullscreen-grid.grid-2 {
            /* Sport Logo */
            --g2-sport-logo-width: 60px;
            --g2-sport-logo-height: 60px;
            --g2-sport-logo-top: 15px;
            --g2-sport-logo-right: 15px;

            /* Team Logos */
            --g2-team-logo-size: 85px;
            --g2-team-logo-margin: 0;

            /* Score Box */
            --g2-score-box-width: 80px;
            --g2-score-box-height: 82%;

            /* Score Text */
            --g2-score-font-size: 3rem;

            /* Team Name */
            --g2-team-name-font-size: 1.2rem;
            --g2-team-name-margin: 0;

            /* Team Record */
            --g2-team-record-font-size: 0.85rem;
            --g2-team-record-margin: 0;

            /* Timeouts */
            --g2-timeout-size: 10px;
            --g2-timeout-gap: 3px;

            /* Center Time Box */
            --g2-time-box-min-width: 75px;
            --g2-time-box-padding: 4px 12px;
            --g2-time-label-font-size: 0.65rem;
            --g2-time-font-size: 1rem;

            /* Situation Box */
            --g2-situation-padding: 6px 14px;
            --g2-situation-font-size: 0.9rem;
            --g2-situation-min-width: 160px;
            --g2-situation-gap: 8px;

            /* Field Visualizer */
            --g2-field-margin-top: 40px;
            --g2-field-max-height: 220px;

            /* Scoreboard Container */
            --g2-scoreboard-width: 90%;
            --g2-scoreboard-height: 75px;

            /* Possession Indicator */
            --g2-possession-font-size: 24px;
            --g2-possession-offset: -10px;

            /* Logo Spacers */
            --g2-logo-spacer-width: 75px;
            --g2-logo-center-spacer-width: 100px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) */
            --g2-team-logo-width: clamp(50px, 8vmin, 90px);
            --g2-team-logo-height: clamp(50px, 8vmin, 90px);
            --g2-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) */
            --g2-team-info-gap: 2px;
            --g2-team-info-padding-top: 0;
            --g2-team-info-padding-bottom: 0;
            --g2-team-info-margin-left: 0;
            /* For away team */
            --g2-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) */
            --g2-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g2-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g2-timeout-gap-spacing: 3px;
            --g2-timeout-margin-left: 15px;
            /* For away team */
            --g2-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) */
            --g2-situation-padding-bottom: 6px;
            --g2-situation-margin-bottom: -11px;
            --g2-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position */
            --g2-scoreboard-offset-y: 0;
            /* Positive = down, Negative = up */
            --g2-field-offset-y: 0;
            /* Positive = down, Negative = up */
        }

        /* Grid 2 Element Rules */
        .fullscreen-grid.grid-2 .sport-logo-indicator {
            width: var(--g2-sport-logo-width);
            height: var(--g2-sport-logo-height);
            top: var(--g2-sport-logo-top);
            right: var(--g2-sport-logo-right);
        }

        .fullscreen-grid.grid-2 .fs-card-team-logo {
            width: var(--g2-team-logo-size);
            height: var(--g2-team-logo-size);
            margin: var(--g2-team-logo-margin);
        }

        .fullscreen-grid.grid-2 .fs-sb-score-box {
            width: var(--g2-score-box-width);
            height: var(--g2-score-box-height);
        }

        .fullscreen-grid.grid-2 .fs-sb-score {
            font-size: var(--g2-score-font-size);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-name {
            font-size: var(--g2-team-name-font-size);
            margin: var(--g2-team-name-margin);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-record {
            font-size: var(--g2-team-record-font-size);
            margin: var(--g2-team-record-margin);
        }

        .fullscreen-grid.grid-2 .fs-sb-timeout-bar {
            width: var(--g2-timeout-size);
            height: var(--g2-timeout-size);
        }

        .fullscreen-grid.grid-2 .fs-sb-timeouts {
            gap: var(--g2-timeout-gap);
        }

        .fullscreen-grid.grid-2 .fs-sb-time-box {
            min-width: var(--g2-time-box-min-width);
            padding: var(--g2-time-box-padding);
        }

        .fullscreen-grid.grid-2 .fs-sb-time-label {
            font-size: var(--g2-time-label-font-size);
        }

        .fullscreen-grid.grid-2 .fs-sb-time {
            font-size: var(--g2-time-font-size);
        }

        .fullscreen-grid.grid-2 .fs-sb-situation {
            padding: var(--g2-situation-padding);
            min-width: var(--g2-situation-min-width);
            gap: var(--g2-situation-gap);
        }

        .fullscreen-grid.grid-2 .fs-sb-down-distance,
        .fullscreen-grid.grid-2 .fs-sb-ball-position {
            font-size: var(--g2-situation-font-size);
        }

        .fullscreen-grid.grid-2 .field-visualizer {
            margin-top: var(--g2-field-margin-top);
            max-height: var(--g2-field-max-height);
            transform: translateY(var(--g2-field-offset-y));
        }

        .fullscreen-grid.grid-2 .fs-scoreboard {
            width: var(--g2-scoreboard-width);
            height: var(--g2-scoreboard-height);
            transform: translateY(var(--g2-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-2 .fs-scoreboard-top {
            width: var(--g2-scoreboard-width);
        }

        .fullscreen-grid.grid-2 .fs-sb-logo-spacer {
            width: var(--g2-logo-spacer-width);
        }

        .fullscreen-grid.grid-2 .fs-sb-logo-center-spacer {
            width: var(--g2-logo-center-spacer-width);
        }

        /* Grid 2 - Individual Element Control Rules */
        .fullscreen-grid.grid-2 .fs-sb-team-logo {
            width: var(--g2-team-logo-width);
            height: var(--g2-team-logo-height);
            margin-bottom: var(--g2-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-info {
            gap: var(--g2-team-info-gap);
            padding-top: var(--g2-team-info-padding-top);
            padding-bottom: var(--g2-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g2-team-info-margin-left);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g2-team-info-margin-right);
        }

        .fullscreen-grid.grid-2 .fs-sb-timeout-bar {
            width: var(--g2-timeout-bar-width);
            height: var(--g2-timeout-bar-height);
        }

        .fullscreen-grid.grid-2 .fs-sb-timeouts {
            gap: var(--g2-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-2 .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g2-timeout-margin-left));
        }

        .fullscreen-grid.grid-2 .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g2-timeout-margin-right)));
        }

        .fullscreen-grid.grid-2 .fs-sb-situation {
            padding-bottom: var(--g2-situation-padding-bottom);
            margin-bottom: var(--g2-situation-margin-bottom);
        }

        /* ============================================
           GRID 3 - Three Games (2 top, 1 bottom centered)
           ============================================ */
        .fullscreen-grid.grid-3 {
            /* Sport Logo */
            --g3-sport-logo-width: 50px;
            --g3-sport-logo-height: 50px;
            --g3-sport-logo-top: 12px;
            --g3-sport-logo-right: 12px;

            /* Team Logos */
            --g3-team-logo-size: 70px;
            --g3-team-logo-margin: 0;

            /* Score Box */
            --g3-score-box-width: 80px;
            --g3-score-box-height: 80%;

            /* Score Text */
            --g3-score-font-size: 2.2rem;

            /* Team Name */
            --g3-team-name-font-size: 1rem;
            --g3-team-name-margin: 0;

            /* Team Record */
            --g3-team-record-font-size: 0.75rem;
            --g3-team-record-margin: 0;

            /* Timeouts */
            --g3-timeout-size: 8px;
            --g3-timeout-gap: 2px;

            /* Center Time Box */
            --g3-time-box-min-width: 65px;
            --g3-time-box-padding: 3px 10px;
            --g3-time-label-font-size: 0.55rem;
            --g3-time-font-size: 0.85rem;

            /* Situation Box */
            --g3-situation-padding: 5px 12px;
            --g3-situation-font-size: 0.8rem;
            --g3-situation-min-width: 140px;
            --g3-situation-gap: 6px;

            /* Field Visualizer */
            --g3-field-margin-top: 30px;
            --g3-field-max-height: 160px;

            /* Scoreboard Container */
            --g3-scoreboard-width: 92%;
            --g3-scoreboard-height: 65px;

            /* Possession Indicator */
            --g3-possession-font-size: 18px;
            --g3-possession-offset: -8px;

            /* Logo Spacers */
            --g3-logo-spacer-width: 65px;
            --g3-logo-center-spacer-width: 85px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) */
            --g3-team-logo-width: clamp(50px, 8vmin, 90px);
            --g3-team-logo-height: clamp(50px, 8vmin, 90px);
            --g3-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) */
            --g3-team-info-gap: 2px;
            --g3-team-info-padding-top: 0;
            --g3-team-info-padding-bottom: 0;
            --g3-team-info-margin-left: 0;
            /* For away team */
            --g3-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) */
            --g3-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g3-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g3-timeout-gap-spacing: 3px;
            --g3-timeout-margin-left: 15px;
            /* For away team */
            --g3-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) */
            --g3-situation-padding-bottom: 6px;
            --g3-situation-margin-bottom: -11px;
            --g3-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position */
            --g3-scoreboard-offset-y: 20px;
            /* Positive = down, Negative = up */
            --g3-field-offset-y: 20px;
            /* Positive = down, Negative = up */
        }

        /* Grid 3 Element Rules */
        .fullscreen-grid.grid-3 .sport-logo-indicator {
            width: var(--g3-sport-logo-width);
            height: var(--g3-sport-logo-height);
            top: var(--g3-sport-logo-top);
            right: var(--g3-sport-logo-right);
        }

        .fullscreen-grid.grid-3 .fs-card-team-logo {
            width: var(--g3-team-logo-size);
            height: var(--g3-team-logo-size);
            margin: var(--g3-team-logo-margin);
        }

        .fullscreen-grid.grid-3 .fs-sb-score-box {
            width: var(--g3-score-box-width);
            height: var(--g3-score-box-height);
        }

        .fullscreen-grid.grid-3 .fs-sb-score {
            font-size: var(--g3-score-font-size);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-name {
            font-size: var(--g3-team-name-font-size);
            margin: var(--g3-team-name-margin);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-record {
            font-size: var(--g3-team-record-font-size);
            margin: var(--g3-team-record-margin);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeout-bar {
            width: var(--g3-timeout-size);
            height: var(--g3-timeout-size);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeouts {
            gap: var(--g3-timeout-gap);
        }

        .fullscreen-grid.grid-3 .fs-sb-time-box {
            min-width: var(--g3-time-box-min-width);
            padding: var(--g3-time-box-padding);
        }

        .fullscreen-grid.grid-3 .fs-sb-time-label {
            font-size: var(--g3-time-label-font-size);
        }

        .fullscreen-grid.grid-3 .fs-sb-time {
            font-size: var(--g3-time-font-size);
        }

        .fullscreen-grid.grid-3 .fs-sb-situation {
            padding: var(--g3-situation-padding);
            min-width: var(--g3-situation-min-width);
            gap: var(--g3-situation-gap);
        }

        .fullscreen-grid.grid-3 .fs-sb-down-distance,
        .fullscreen-grid.grid-3 .fs-sb-ball-position {
            font-size: var(--g3-situation-font-size);
        }

        .fullscreen-grid.grid-3 .field-visualizer {
            margin-top: var(--g3-field-margin-top);
            max-height: var(--g3-field-max-height);
            transform: translateY(var(--g3-field-offset-y));
        }

        .fullscreen-grid.grid-3 .fs-scoreboard {
            width: var(--g3-scoreboard-width);
            height: var(--g3-scoreboard-height);
            transform: translateY(var(--g3-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-3 .fs-scoreboard-top {
            width: var(--g3-scoreboard-width);
        }

        .fullscreen-grid.grid-3 .fs-sb-logo-spacer {
            width: var(--g3-logo-spacer-width);
        }

        .fullscreen-grid.grid-3 .fs-sb-logo-center-spacer {
            width: var(--g3-logo-center-spacer-width);
        }

        /* Grid 3 - Individual Element Control Rules */
        .fullscreen-grid.grid-3 .fs-sb-team-logo {
            width: var(--g3-team-logo-width);
            height: var(--g3-team-logo-height);
            margin-bottom: var(--g3-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-info {
            gap: var(--g3-team-info-gap);
            padding-top: var(--g3-team-info-padding-top);
            padding-bottom: var(--g3-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g3-team-info-margin-left);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g3-team-info-margin-right);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeout-bar {
            width: var(--g3-timeout-bar-width);
            height: var(--g3-timeout-bar-height);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeouts {
            gap: var(--g3-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-3 .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g3-timeout-margin-left));
        }

        .fullscreen-grid.grid-3 .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g3-timeout-margin-right)));
        }

        .fullscreen-grid.grid-3 .fs-sb-situation {
            padding-bottom: var(--g3-situation-padding-bottom);
            margin-bottom: var(--g3-situation-margin-bottom);
        }

        /* ============================================
           GRID 4 - Four Games (2x2)
           ============================================ */
        .fullscreen-grid.grid-4 {
            /* Sport Logo */
            --g4-sport-logo-width: 45px;
            --g4-sport-logo-height: 45px;
            --g4-sport-logo-top: 10px;
            --g4-sport-logo-right: 10px;

            /* Team Logos */
            --g4-team-logo-size: 65px;
            --g4-team-logo-margin: 0;

            /* Score Box */
            --g4-score-box-width: 80px;
            --g4-score-box-height: 80%;

            /* Score Text */
            --g4-score-font-size: 2rem;

            /* Team Name */
            --g4-team-name-font-size: 0.95rem;
            --g4-team-name-margin: 0;

            /* Team Record */
            --g4-team-record-font-size: 0.7rem;
            --g4-team-record-margin: 0;

            /* Timeouts */
            --g4-timeout-size: 7px;
            --g4-timeout-gap: 2px;

            /* Center Time Box */
            --g4-time-box-min-width: 60px;
            --g4-time-box-padding: 3px 8px;
            --g4-time-label-font-size: 0.5rem;
            --g4-time-font-size: 0.8rem;

            /* Situation Box */
            --g4-situation-padding: 4px 10px;
            --g4-situation-font-size: 0.75rem;
            --g4-situation-min-width: 130px;
            --g4-situation-gap: 5px;

            /* Field Visualizer */
            --g4-field-margin-top: 26px;
            --g4-field-max-height: 140px;

            /* Scoreboard Container */
            --g4-scoreboard-width: 94%;
            --g4-scoreboard-height: 60px;

            /* Possession Indicator */
            --g4-possession-font-size: 16px;
            --g4-possession-offset: -6px;

            /* Logo Spacers */
            --g4-logo-spacer-width: 60px;
            --g4-logo-center-spacer-width: 80px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) */
            --g4-team-logo-width: clamp(50px, 8vmin, 90px);
            --g4-team-logo-height: clamp(50px, 8vmin, 90px);
            --g4-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) */
            --g4-team-info-gap: 2px;
            --g4-team-info-padding-top: 0;
            --g4-team-info-padding-bottom: 0;
            --g4-team-info-margin-left: 0;
            /* For away team */
            --g4-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) */
            --g4-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g4-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g4-timeout-gap-spacing: 3px;
            --g4-timeout-margin-left: 15px;
            /* For away team */
            --g4-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) */
            --g4-situation-padding-bottom: 6px;
            --g4-situation-margin-bottom: -11px;
            --g4-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position */
            --g4-scoreboard-offset-y: 20px;
            /* Positive = down, Negative = up */
            --g4-field-offset-y: 20px;
            /* Positive = down, Negative = up */
        }

        /* Grid 4 Element Rules */
        .fullscreen-grid.grid-4 .sport-logo-indicator {
            width: var(--g4-sport-logo-width);
            height: var(--g4-sport-logo-height);
            top: var(--g4-sport-logo-top);
            right: var(--g4-sport-logo-right);
        }

        .fullscreen-grid.grid-4 .fs-card-team-logo {
            width: var(--g4-team-logo-size);
            height: var(--g4-team-logo-size);
            margin: var(--g4-team-logo-margin);
        }

        .fullscreen-grid.grid-4 .fs-sb-score-box {
            width: var(--g4-score-box-width);
            height: var(--g4-score-box-height);
        }

        .fullscreen-grid.grid-4 .fs-sb-score {
            font-size: var(--g4-score-font-size);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-name {
            font-size: var(--g4-team-name-font-size);
            margin: var(--g4-team-name-margin);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-record {
            font-size: var(--g4-team-record-font-size);
            margin: var(--g4-team-record-margin);
        }

        .fullscreen-grid.grid-4 .fs-sb-timeout-bar {
            width: var(--g4-timeout-size);
            height: var(--g4-timeout-size);
        }

        .fullscreen-grid.grid-4 .fs-sb-timeouts {
            gap: var(--g4-timeout-gap);
        }

        .fullscreen-grid.grid-4 .fs-sb-time-box {
            min-width: var(--g4-time-box-min-width);
            padding: var(--g4-time-box-padding);
        }

        .fullscreen-grid.grid-4 .fs-sb-time-label {
            font-size: var(--g4-time-label-font-size);
        }

        .fullscreen-grid.grid-4 .fs-sb-time {
            font-size: var(--g4-time-font-size);
        }

        .fullscreen-grid.grid-4 .fs-sb-situation {
            padding: var(--g4-situation-padding);
            min-width: var(--g4-situation-min-width);
            gap: var(--g4-situation-gap);
        }

        .fullscreen-grid.grid-4 .fs-sb-down-distance,
        .fullscreen-grid.grid-4 .fs-sb-ball-position {
            font-size: var(--g4-situation-font-size);
        }

        .fullscreen-grid.grid-4 .field-visualizer {
            margin-top: var(--g4-field-margin-top);
            max-height: var(--g4-field-max-height);
            transform: translateY(var(--g4-field-offset-y));
        }

        .fullscreen-grid.grid-4 .fs-scoreboard {
            width: var(--g4-scoreboard-width);
            height: var(--g4-scoreboard-height);
            transform: translateY(var(--g4-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-4 .fs-scoreboard-top {
            width: var(--g4-scoreboard-width);
        }

        .fullscreen-grid.grid-4 .fs-sb-logo-spacer {
            width: var(--g4-logo-spacer-width);
        }

        .fullscreen-grid.grid-4 .fs-sb-logo-center-spacer {
            width: var(--g4-logo-center-spacer-width);
        }

        /* Grid 4 - Individual Element Control Rules */
        .fullscreen-grid.grid-4 .fs-sb-team-logo {
            width: var(--g4-team-logo-width);
            height: var(--g4-team-logo-height);
            margin-bottom: var(--g4-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-info {
            gap: var(--g4-team-info-gap);
            padding-top: var(--g4-team-info-padding-top);
            padding-bottom: var(--g4-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g4-team-info-margin-left);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g4-team-info-margin-right);
        }

        .fullscreen-grid.grid-4 .fs-sb-timeout-bar {
            width: var(--g4-timeout-bar-width);
            height: var(--g4-timeout-bar-height);
        }

        .fullscreen-grid.grid-4 .fs-sb-timeouts {
            gap: var(--g4-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-4 .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g4-timeout-margin-left));
        }

        .fullscreen-grid.grid-4 .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g4-timeout-margin-right)));
        }

        .fullscreen-grid.grid-4 .fs-sb-situation {
            padding-bottom: var(--g4-situation-padding-bottom);
            margin-bottom: var(--g4-situation-margin-bottom);
        }

        /* ============================================
           GRID 5 - Five Games (2 big top, 3 small bottom)
           ============================================ */
        .fullscreen-grid.grid-5 {
            /* Sport Logo */
            --g5-sport-logo-width: 45px;
            --g5-sport-logo-height: 45px;
            --g5-sport-logo-top: 10px;
            --g5-sport-logo-right: 10px;

            /* Team Logos */
            --g5-team-logo-size: 60px;
            --g5-team-logo-margin: 0;

            /* Score Box */
            --g5-score-box-width: 75px;
            --g5-score-box-height: 80%;

            /* Score Text */
            --g5-score-font-size: 1.8rem;

            /* Team Name */
            --g5-team-name-font-size: 0.9rem;
            --g5-team-name-margin: 0;

            /* Team Record */
            --g5-team-record-font-size: 0.65rem;
            --g5-team-record-margin: 0;

            /* Timeouts */
            --g5-timeout-size: 6px;
            --g5-timeout-gap: 2px;

            /* Center Time Box */
            --g5-time-box-min-width: 55px;
            --g5-time-box-padding: 2px 8px;
            --g5-time-label-font-size: 0.45rem;
            --g5-time-font-size: 0.75rem;

            /* Situation Box */
            --g5-situation-padding: 4px 8px;
            --g5-situation-font-size: 0.7rem;
            --g5-situation-min-width: 120px;
            --g5-situation-gap: 4px;

            /* Field Visualizer */
            --g5-field-margin-top: 24px;
            --g5-field-max-height: 120px;

            /* Scoreboard Container */
            --g5-scoreboard-width: 95%;
            --g5-scoreboard-height: 55px;

            /* Possession Indicator */
            --g5-possession-font-size: 14px;
            --g5-possession-offset: -5px;

            /* Logo Spacers */
            --g5-logo-spacer-width: 58px;
            --g5-logo-center-spacer-width: 70px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - BIG CARDS (1-2)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - BIG CARDS */
            --g5-big-team-logo-width: clamp(50px, 8vmin, 90px);
            --g5-big-team-logo-height: clamp(50px, 8vmin, 90px);
            --g5-big-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) - BIG CARDS */
            --g5-big-team-info-gap: 2px;
            --g5-big-team-info-padding-top: 0;
            --g5-big-team-info-padding-bottom: 0;
            --g5-big-team-info-margin-left: 0;
            /* For away team */
            --g5-big-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - BIG CARDS */
            --g5-big-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g5-big-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g5-big-timeout-gap-spacing: 3px;
            --g5-big-timeout-margin-left: 20px;
            /* For away team */
            --g5-big-timeout-margin-right: 20px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - BIG CARDS */
            --g5-big-situation-padding-bottom: 6px;
            --g5-big-situation-margin-bottom: -12px;
            --g5-big-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position - BIG CARDS */
            --g5-big-scoreboard-offset-y: 25px;
            /* Positive = down, Negative = up */
            --g5-big-field-offset-y: 25px;
            /* Positive = down, Negative = up */

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - SMALL CARDS (3-5)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - SMALL CARDS */
            --g5-small-team-logo-width: clamp(40px, 6vmin, 70px);
            --g5-small-team-logo-height: clamp(40px, 6vmin, 70px);
            --g5-small-team-logo-margin-bottom: clamp(4px, 0.8vmin, 8px);

            /* Team Info Container Position (fs-sb-team-info) - SMALL CARDS */
            --g5-small-team-info-gap: 1px;
            --g5-small-team-info-padding-top: 0;
            --g5-small-team-info-padding-bottom: 0;
            --g5-small-team-info-margin-left: 0;
            /* For away team */
            --g5-small-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - SMALL CARDS */
            --g5-small-timeout-bar-width: clamp(4px, 0.7vmin, 7px);
            --g5-small-timeout-bar-height: clamp(4px, 0.7vmin, 7px);
            --g5-small-timeout-gap-spacing: 2px;
            --g5-small-timeout-margin-left: 10px;
            /* For away team */
            --g5-small-timeout-margin-right: 10px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - SMALL CARDS */
            --g5-small-situation-padding-bottom: 4px;
            --g5-small-situation-margin-bottom: -12px;
            --g5-small-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position - SMALL CARDS */
            --g5-small-scoreboard-offset-y: 28px;
            /* Positive = down, Negative = up */
            --g5-small-field-offset-y: 28px;
            /* Positive = down, Negative = up */
        }

        /* Grid 5 Element Rules */
        .fullscreen-grid.grid-5 .sport-logo-indicator {
            width: var(--g5-sport-logo-width);
            height: var(--g5-sport-logo-height);
            top: var(--g5-sport-logo-top);
            right: var(--g5-sport-logo-right);
        }

        .fullscreen-grid.grid-5 .fs-card-team-logo {
            width: var(--g5-team-logo-size);
            height: var(--g5-team-logo-size);
            margin: var(--g5-team-logo-margin);
        }

        .fullscreen-grid.grid-5 .fs-sb-score-box {
            width: var(--g5-score-box-width);
            height: var(--g5-score-box-height);
        }

        .fullscreen-grid.grid-5 .fs-sb-score {
            font-size: var(--g5-score-font-size);
        }

        .fullscreen-grid.grid-5 .fs-sb-team-name {
            font-size: var(--g5-team-name-font-size);
            margin: var(--g5-team-name-margin);
        }

        .fullscreen-grid.grid-5 .fs-sb-team-record {
            font-size: var(--g5-team-record-font-size);
            margin: var(--g5-team-record-margin);
        }

        .fullscreen-grid.grid-5 .fs-sb-timeout-bar {
            width: var(--g5-timeout-size);
            height: var(--g5-timeout-size);
        }

        .fullscreen-grid.grid-5 .fs-sb-timeouts {
            gap: var(--g5-timeout-gap);
        }

        .fullscreen-grid.grid-5 .fs-sb-time-box {
            min-width: var(--g5-time-box-min-width);
            padding: var(--g5-time-box-padding);
        }

        .fullscreen-grid.grid-5 .fs-sb-time-label {
            font-size: var(--g5-time-label-font-size);
        }

        .fullscreen-grid.grid-5 .fs-sb-time {
            font-size: var(--g5-time-font-size);
        }

        .fullscreen-grid.grid-5 .fs-sb-situation {
            padding: var(--g5-situation-padding);
            min-width: var(--g5-situation-min-width);
            gap: var(--g5-situation-gap);
        }

        .fullscreen-grid.grid-5 .fs-sb-down-distance,
        .fullscreen-grid.grid-5 .fs-sb-ball-position {
            font-size: var(--g5-situation-font-size);
        }

        .fullscreen-grid.grid-5 .field-visualizer {
            margin-top: var(--g5-field-margin-top);
            max-height: var(--g5-field-max-height);
        }

        .fullscreen-grid.grid-5 .fs-scoreboard {
            width: var(--g5-scoreboard-width);
            height: var(--g5-scoreboard-height);
        }

        .fullscreen-grid.grid-5 .fs-scoreboard-top {
            width: var(--g5-scoreboard-width);
        }

        .fullscreen-grid.grid-5 .fs-sb-logo-spacer {
            width: var(--g5-logo-spacer-width);
        }

        .fullscreen-grid.grid-5 .fs-sb-logo-center-spacer {
            width: var(--g5-logo-center-spacer-width);
        }

        /* Grid 5 - Individual Element Control Rules - BIG CARDS (1-2) */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-logo {
            width: var(--g5-big-team-logo-width);
            height: var(--g5-big-team-logo-height);
            margin-bottom: var(--g5-big-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-info {
            gap: var(--g5-big-team-info-gap);
            padding-top: var(--g5-big-team-info-padding-top);
            padding-bottom: var(--g5-big-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g5-big-team-info-margin-left);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g5-big-team-info-margin-right);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeout-bar {
            width: var(--g5-big-timeout-bar-width);
            height: var(--g5-big-timeout-bar-height);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeouts {
            gap: var(--g5-big-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g5-big-timeout-margin-left));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g5-big-timeout-margin-right)));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation {
            padding-bottom: var(--g5-big-situation-padding-bottom);
            margin-bottom: var(--g5-big-situation-margin-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-scoreboard {
            transform: translateY(var(--g5-big-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .field-visualizer {
            transform: translateY(var(--g5-big-field-offset-y));
        }

        /* Grid 5 - Individual Element Control Rules - SMALL CARDS (3-5) */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-logo {
            width: var(--g5-small-team-logo-width);
            height: var(--g5-small-team-logo-height);
            margin-bottom: var(--g5-small-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-info {
            gap: var(--g5-small-team-info-gap);
            padding-top: var(--g5-small-team-info-padding-top);
            padding-bottom: var(--g5-small-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g5-small-team-info-margin-left);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g5-small-team-info-margin-right);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeout-bar {
            width: var(--g5-small-timeout-bar-width);
            height: var(--g5-small-timeout-bar-height);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts {
            gap: var(--g5-small-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g5-small-timeout-margin-left));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g5-small-timeout-margin-right)));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-situation {
            padding-bottom: var(--g5-small-situation-padding-bottom);
            margin-bottom: var(--g5-small-situation-margin-bottom);
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-scoreboard {
            transform: translateY(var(--g5-small-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .field-visualizer {
            transform: translateY(var(--g5-small-field-offset-y));
        }

        /* ============================================
           GRID 6 - Six Games (3x2)
           ============================================ */
        .fullscreen-grid.grid-6 {
            /* Sport Logo */
            --g6-sport-logo-width: 40px;
            --g6-sport-logo-height: 40px;
            --g6-sport-logo-top: 8px;
            --g6-sport-logo-right: 8px;

            /* Team Logos */
            --g6-team-logo-size: 55px;
            --g6-team-logo-margin: 0;

            /* Score Box */
            --g6-score-box-width: 58px;
            --g6-score-box-height: 80%;

            /* Score Text */
            --g6-score-font-size: 1.6rem;

            /* Team Name */
            --g6-team-name-font-size: 0.85rem;
            --g6-team-name-margin: 0;

            /* Team Record */
            --g6-team-record-font-size: 0.6rem;
            --g6-team-record-margin: 0;

            /* Timeouts */
            --g6-timeout-size: 5px;
            --g6-timeout-gap: 2px;

            /* Center Time Box */
            --g6-time-box-min-width: 50px;
            --g6-time-box-padding: 2px 6px;
            --g6-time-label-font-size: 0.4rem;
            --g6-time-font-size: 0.7rem;

            /* Situation Box */
            --g6-situation-padding: 3px 7px;
            --g6-situation-font-size: 0.65rem;
            --g6-situation-min-width: 110px;
            --g6-situation-gap: 4px;

            /* Field Visualizer */
            --g6-field-margin-top: 30px;
            --g6-field-max-height: 100px;

            /* Scoreboard Container */
            --g6-scoreboard-width: 96%;
            --g6-scoreboard-height: 50px;

            /* Possession Indicator */
            --g6-possession-font-size: 12px;
            --g6-possession-offset: -5px;

            /* Logo Spacers */
            --g6-logo-spacer-width: 52px;
            --g6-logo-center-spacer-width: 65px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) */
            --g6-team-logo-width: clamp(50px, 8vmin, 90px);
            --g6-team-logo-height: clamp(50px, 8vmin, 90px);
            --g6-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) */
            --g6-team-info-gap: 2px;
            --g6-team-info-padding-top: 0;
            --g6-team-info-padding-bottom: 0;
            --g6-team-info-margin-left: 0;
            /* For away team */
            --g6-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) */
            --g6-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g6-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g6-timeout-gap-spacing: 3px;
            --g6-timeout-margin-left: 15px;
            /* For away team */
            --g6-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) */
            --g6-situation-padding-bottom: 6px;
            --g6-situation-margin-bottom: -11px;
            --g6-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position */
            --g6-scoreboard-offset-y: 40px;
            /* Positive = down, Negative = up */
            --g6-field-offset-y: 40px;
            /* Positive = down, Negative = up */
        }

        /* Grid 6 Element Rules */
        .fullscreen-grid.grid-6 .sport-logo-indicator {
            width: var(--g6-sport-logo-width);
            height: var(--g6-sport-logo-height);
            top: var(--g6-sport-logo-top);
            right: var(--g6-sport-logo-right);
        }

        .fullscreen-grid.grid-6 .fs-card-team-logo {
            width: var(--g6-team-logo-size);
            height: var(--g6-team-logo-size);
            margin: var(--g6-team-logo-margin);
        }

        .fullscreen-grid.grid-6 .fs-sb-score-box {
            width: var(--g6-score-box-width);
            height: var(--g6-score-box-height);
        }

        .fullscreen-grid.grid-6 .fs-sb-score {
            font-size: var(--g6-score-font-size);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-name {
            font-size: var(--g6-team-name-font-size);
            margin: var(--g6-team-name-margin);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-record {
            font-size: var(--g6-team-record-font-size);
            margin: var(--g6-team-record-margin);
        }

        .fullscreen-grid.grid-6 .fs-sb-timeout-bar {
            width: var(--g6-timeout-size);
            height: var(--g6-timeout-size);
        }

        .fullscreen-grid.grid-6 .fs-sb-timeouts {
            gap: var(--g6-timeout-gap);
        }

        .fullscreen-grid.grid-6 .fs-sb-time-box {
            min-width: var(--g6-time-box-min-width);
            padding: var(--g6-time-box-padding);
        }

        .fullscreen-grid.grid-6 .fs-sb-time-label {
            font-size: var(--g6-time-label-font-size);
        }

        .fullscreen-grid.grid-6 .fs-sb-time {
            font-size: var(--g6-time-font-size);
        }

        .fullscreen-grid.grid-6 .fs-sb-situation {
            padding: var(--g6-situation-padding);
            min-width: var(--g6-situation-min-width);
            gap: var(--g6-situation-gap);
        }

        .fullscreen-grid.grid-6 .fs-sb-down-distance,
        .fullscreen-grid.grid-6 .fs-sb-ball-position {
            font-size: var(--g6-situation-font-size);
        }

        .fullscreen-grid.grid-6 .field-visualizer {
            margin-top: var(--g6-field-margin-top);
            max-height: var(--g6-field-max-height);
            transform: translateY(var(--g6-field-offset-y));
        }

        .fullscreen-grid.grid-6 .fs-scoreboard {
            width: var(--g6-scoreboard-width);
            height: var(--g6-scoreboard-height);
            transform: translateY(var(--g6-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-6 .fs-scoreboard-top {
            width: var(--g6-scoreboard-width);
        }

        .fullscreen-grid.grid-6 .fs-sb-logo-spacer {
            width: var(--g6-logo-spacer-width);
        }

        .fullscreen-grid.grid-6 .fs-sb-logo-center-spacer {
            width: var(--g6-logo-center-spacer-width);
        }

        /* Grid 6 - Individual Element Control Rules */
        .fullscreen-grid.grid-6 .fs-sb-team-logo {
            width: var(--g6-team-logo-width);
            height: var(--g6-team-logo-height);
            margin-bottom: var(--g6-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-info {
            gap: var(--g6-team-info-gap);
            padding-top: var(--g6-team-info-padding-top);
            padding-bottom: var(--g6-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g6-team-info-margin-left);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g6-team-info-margin-right);
        }

        .fullscreen-grid.grid-6 .fs-sb-timeout-bar {
            width: var(--g6-timeout-bar-width);
            height: var(--g6-timeout-bar-height);
        }

        .fullscreen-grid.grid-6 .fs-sb-timeouts {
            gap: var(--g6-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-6 .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g6-timeout-margin-left));
        }

        .fullscreen-grid.grid-6 .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g6-timeout-margin-right)));
        }

        .fullscreen-grid.grid-6 .fs-sb-situation {
            padding-bottom: var(--g6-situation-padding-bottom);
            margin-bottom: var(--g6-situation-margin-bottom);
        }

        /* ============================================
           GRID 7 - Seven Games (Mixed layout)
           ============================================ */
        .fullscreen-grid.grid-7 {
            /* Sport Logo */
            --g7-sport-logo-width: 35px;
            --g7-sport-logo-height: 35px;
            --g7-sport-logo-top: 6px;
            --g7-sport-logo-right: 6px;

            /* Team Logos */
            --g7-team-logo-size: 48px;
            --g7-team-logo-margin: 0;

            /* Score Box */
            --g7-score-box-width: 55px;
            --g7-score-box-height: 78%;

            /* Score Text */
            --g7-score-font-size: 1.4rem;

            /* Team Name */
            --g7-team-name-font-size: 0.75rem;
            --g7-team-name-margin: 0;

            /* Team Record */
            --g7-team-record-font-size: 0.55rem;
            --g7-team-record-margin: 0;

            /* Timeouts */
            --g7-timeout-size: 4px;
            --g7-timeout-gap: 1px;

            /* Center Time Box */
            --g7-time-box-min-width: 45px;
            --g7-time-box-padding: 2px 5px;
            --g7-time-label-font-size: 0.35rem;
            --g7-time-font-size: 0.6rem;

            /* Situation Box */
            --g7-situation-padding: 3px 6px;
            --g7-situation-font-size: 0.55rem;
            --g7-situation-min-width: 95px;
            --g7-situation-gap: 3px;

            /* Field Visualizer */
            --g7-field-margin-top: 16px;
            --g7-field-max-height: 85px;

            /* Scoreboard Container */
            --g7-scoreboard-width: 97%;
            --g7-scoreboard-height: 45px;

            /* Possession Indicator */
            --g7-possession-font-size: 10px;
            --g7-possession-offset: -4px;

            /* Logo Spacers */
            --g7-logo-spacer-width: 45px;
            --g7-logo-center-spacer-width: 55px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - BIG CARD (1)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - BIG CARD */
            --g7-big-team-logo-width: clamp(50px, 8vmin, 90px);
            --g7-big-team-logo-height: clamp(50px, 8vmin, 90px);
            --g7-big-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) - BIG CARD */
            --g7-big-team-info-gap: 2px;
            --g7-big-team-info-padding-top: 0;
            --g7-big-team-info-padding-bottom: 0;
            --g7-big-team-info-margin-left: 0;
            /* For away team */
            --g7-big-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - BIG CARD */
            --g7-big-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g7-big-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g7-big-timeout-gap-spacing: 3px;
            --g7-big-timeout-margin-left: 10px;
            /* For away team */
            --g7-big-timeout-margin-right: 10px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - BIG CARD */
            --g7-big-situation-padding-bottom: 6px;
            --g7-big-situation-margin-bottom: 0;
            --g7-big-situation-bottom-offset: 0;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - SMALL CARDS (2-7)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - SMALL CARDS */
            --g7-small-team-logo-width: clamp(35px, 5vmin, 60px);
            --g7-small-team-logo-height: clamp(35px, 5vmin, 60px);
            --g7-small-team-logo-margin-bottom: clamp(3px, 0.6vmin, 6px);

            /* Team Info Container Position (fs-sb-team-info) - SMALL CARDS */
            --g7-small-team-info-gap: 1px;
            --g7-small-team-info-padding-top: 0;
            --g7-small-team-info-padding-bottom: 0;
            --g7-small-team-info-margin-left: 0;
            /* For away team */
            --g7-small-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - SMALL CARDS */
            --g7-small-timeout-bar-width: clamp(3px, 0.5vmin, 5px);
            --g7-small-timeout-bar-height: clamp(3px, 0.5vmin, 5px);
            --g7-small-timeout-gap-spacing: 1px;
            --g7-small-timeout-margin-left: 15px;
            /* For away team */
            --g7-small-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - SMALL CARDS */
            --g7-small-situation-padding-bottom: 3px;
            --g7-small-situation-margin-bottom: 0;
            --g7-small-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position - SMALL CARDS */
            --g7-small-scoreboard-offset-y: 30px;
            /* Positive = down, Negative = up */
            --g7-small-field-offset-y: 35px;
            /* Positive = down, Negative = up */
        }

        /* Grid 7 Element Rules */
        .fullscreen-grid.grid-7 .sport-logo-indicator {
            width: var(--g7-sport-logo-width);
            height: var(--g7-sport-logo-height);
            top: var(--g7-sport-logo-top);
            right: var(--g7-sport-logo-right);
        }

        .fullscreen-grid.grid-7 .fs-card-team-logo {
            width: var(--g7-team-logo-size);
            height: var(--g7-team-logo-size);
            margin: var(--g7-team-logo-margin);
        }

        .fullscreen-grid.grid-7 .fs-sb-score-box {
            width: var(--g7-score-box-width);
            height: var(--g7-score-box-height);
        }

        .fullscreen-grid.grid-7 .fs-sb-score {
            font-size: var(--g7-score-font-size);
        }

        .fullscreen-grid.grid-7 .fs-sb-team-name {
            font-size: var(--g7-team-name-font-size);
            margin: var(--g7-team-name-margin);
        }

        .fullscreen-grid.grid-7 .fs-sb-team-record {
            font-size: var(--g7-team-record-font-size);
            margin: var(--g7-team-record-margin);
        }

        .fullscreen-grid.grid-7 .fs-sb-timeout-bar {
            width: var(--g7-timeout-size);
            height: var(--g7-timeout-size);
        }

        .fullscreen-grid.grid-7 .fs-sb-timeouts {
            gap: var(--g7-timeout-gap);
        }

        .fullscreen-grid.grid-7 .fs-sb-time-box {
            min-width: var(--g7-time-box-min-width);
            padding: var(--g7-time-box-padding);
        }

        .fullscreen-grid.grid-7 .fs-sb-time-label {
            font-size: var(--g7-time-label-font-size);
        }

        .fullscreen-grid.grid-7 .fs-sb-time {
            font-size: var(--g7-time-font-size);
        }

        .fullscreen-grid.grid-7 .fs-sb-situation {
            padding: var(--g7-situation-padding);
            min-width: var(--g7-situation-min-width);
            gap: var(--g7-situation-gap);
        }

        .fullscreen-grid.grid-7 .fs-sb-down-distance,
        .fullscreen-grid.grid-7 .fs-sb-ball-position {
            font-size: var(--g7-situation-font-size);
        }

        .fullscreen-grid.grid-7 .field-visualizer {
            margin-top: var(--g7-field-margin-top);
            max-height: var(--g7-field-max-height);
        }

        .fullscreen-grid.grid-7 .fs-scoreboard {
            width: var(--g7-scoreboard-width);
            height: var(--g7-scoreboard-height);
        }

        .fullscreen-grid.grid-7 .fs-scoreboard-top {
            width: var(--g7-scoreboard-width);
        }

        .fullscreen-grid.grid-7 .fs-sb-logo-spacer {
            width: var(--g7-logo-spacer-width);
        }

        .fullscreen-grid.grid-7 .fs-sb-logo-center-spacer {
            width: var(--g7-logo-center-spacer-width);
        }

        /* Grid 7 - Individual Element Control Rules - BIG CARD (1) */
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-logo {
            width: var(--g7-big-team-logo-width);
            height: var(--g7-big-team-logo-height);
            margin-bottom: var(--g7-big-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-info {
            gap: var(--g7-big-team-info-gap);
            padding-top: var(--g7-big-team-info-padding-top);
            padding-bottom: var(--g7-big-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g7-big-team-info-margin-left);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g7-big-team-info-margin-right);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-timeout-bar {
            width: var(--g7-big-timeout-bar-width);
            height: var(--g7-big-timeout-bar-height);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-timeouts {
            gap: var(--g7-big-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g7-big-timeout-margin-left));
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g7-big-timeout-margin-right)));
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(1) .fs-sb-situation {
            padding-bottom: var(--g7-big-situation-padding-bottom);
            margin-bottom: var(--g7-big-situation-margin-bottom);
        }

        /* Grid 7 - Individual Element Control Rules - SMALL CARDS (2-7) */
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-logo {
            width: var(--g7-small-team-logo-width);
            height: var(--g7-small-team-logo-height);
            margin-bottom: var(--g7-small-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-info {
            gap: var(--g7-small-team-info-gap);
            padding-top: var(--g7-small-team-info-padding-top);
            padding-bottom: var(--g7-small-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g7-small-team-info-margin-left);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g7-small-team-info-margin-right);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-timeout-bar {
            width: var(--g7-small-timeout-bar-width);
            height: var(--g7-small-timeout-bar-height);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-timeouts {
            gap: var(--g7-small-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g7-small-timeout-margin-left));
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g7-small-timeout-margin-right)));
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-situation {
            padding-bottom: var(--g7-small-situation-padding-bottom);
            margin-bottom: var(--g7-small-situation-margin-bottom);
        }

        /* Grid 7 Small Cards - Scoreboard & Field Vertical Position */
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-scoreboard {
            transform: translateY(var(--g7-small-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .field-visualizer {
            transform: translateY(var(--g7-small-field-offset-y));
        }

        /* ============================================
           GRID 8 - Eight Games (4x2 or mixed)
           Card 1 is larger, Cards 2-8 are smaller
           ============================================ */
        .fullscreen-grid.grid-8 {
            /* Sport Logo */
            --g8-sport-logo-width: 32px;
            --g8-sport-logo-height: 32px;
            --g8-sport-logo-top: 5px;
            --g8-sport-logo-right: 5px;

            /* Team Logos */
            --g8-team-logo-size: 42px;
            --g8-team-logo-margin: 0;

            /* Score Box */
            --g8-score-box-width: 50px;
            --g8-score-box-height: 76%;

            /* Score Text */
            --g8-score-font-size: 1.2rem;

            /* Team Name */
            --g8-team-name-font-size: 0.7rem;
            --g8-team-name-margin: 0;

            /* Team Record */
            --g8-team-record-font-size: 0.5rem;
            --g8-team-record-margin: 0;

            /* Timeouts */
            --g8-timeout-size: 4px;
            --g8-timeout-gap: 1px;

            /* Center Time Box */
            --g8-time-box-min-width: 40px;
            --g8-time-box-padding: 1px 4px;
            --g8-time-label-font-size: 0.3rem;
            --g8-time-font-size: 0.55rem;

            /* Situation Box */
            --g8-situation-padding: 2px 5px;
            --g8-situation-font-size: 0.5rem;
            --g8-situation-min-width: 85px;
            --g8-situation-gap: 3px;

            /* Field Visualizer */
            --g8-field-margin-top: 14px;
            --g8-field-max-height: 75px;

            /* Scoreboard Container */
            --g8-scoreboard-width: 98%;
            --g8-scoreboard-height: 40px;

            /* Possession Indicator */
            --g8-possession-font-size: 9px;
            --g8-possession-offset: -3px;

            /* Logo Spacers */
            --g8-logo-spacer-width: 40px;
            --g8-logo-center-spacer-width: 50px;

            /* Team Section Padding (for smaller cards) */
            --g8-team-section-padding-outer: 32px;
            --g8-team-section-padding-inner: 6px;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - BIG CARD (1)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - BIG CARD */
            --g8-big-team-logo-width: clamp(50px, 8vmin, 90px);
            --g8-big-team-logo-height: clamp(50px, 8vmin, 90px);
            --g8-big-team-logo-margin-bottom: clamp(6px, 1vmin, 12px);

            /* Team Info Container Position (fs-sb-team-info) - BIG CARD */
            --g8-big-team-info-gap: 2px;
            --g8-big-team-info-padding-top: 0;
            --g8-big-team-info-padding-bottom: 0;
            --g8-big-team-info-margin-left: 0;
            /* For away team */
            --g8-big-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - BIG CARD */
            --g8-big-timeout-bar-width: clamp(6px, 1vmin, 10px);
            --g8-big-timeout-bar-height: clamp(6px, 1vmin, 10px);
            --g8-big-timeout-gap-spacing: 3px;
            --g8-big-timeout-margin-left: 15px;
            /* For away team */
            --g8-big-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - BIG CARD */
            --g8-big-situation-padding-bottom: 6px;
            --g8-big-situation-margin-bottom: 0;
            --g8-big-situation-bottom-offset: 0;

            /* ========================================
               INDIVIDUAL ELEMENT CONTROL VARIABLES - SMALL CARDS (2-8)
               ======================================== */

            /* Team Logo Size & Spacing (fs-sb-team-logo) - SMALL CARDS */
            --g8-small-team-logo-width: clamp(30px, 4vmin, 50px);
            --g8-small-team-logo-height: clamp(30px, 4vmin, 50px);
            --g8-small-team-logo-margin-bottom: clamp(2px, 0.5vmin, 5px);

            /* Team Info Container Position (fs-sb-team-info) - SMALL CARDS */
            --g8-small-team-info-gap: 0;
            --g8-small-team-info-padding-top: 0;
            --g8-small-team-info-padding-bottom: 0;
            --g8-small-team-info-margin-left: 0;
            /* For away team */
            --g8-small-team-info-margin-right: 0;
            /* For home team */

            /* Timeout Bars Position & Size (fs-sb-timeouts) - SMALL CARDS */
            --g8-small-timeout-bar-width: clamp(3px, 0.4vmin, 4px);
            --g8-small-timeout-bar-height: clamp(3px, 0.4vmin, 4px);
            --g8-small-timeout-gap-spacing: 1px;
            --g8-small-timeout-margin-left: 15px;
            /* For away team */
            --g8-small-timeout-margin-right: 15px;
            /* For home team */

            /* Situation Box Bottom Spacing (fs-sb-situation) - SMALL CARDS */
            --g8-small-situation-padding-bottom: 2px;
            --g8-small-situation-margin-bottom: 0;
            --g8-small-situation-bottom-offset: 0;

            /* Scoreboard & Field Vertical Position - SMALL CARDS */
            --g8-small-scoreboard-offset-y: 17px;
            /* Positive = down, Negative = up */
            --g8-small-field-offset-y: 20px;
            /* Positive = down, Negative = up */

            /* ========================================
               CARD 2 SPECIFIC OVERRIDES
               ======================================== */

            /* Scoreboard & Field Vertical Position - CARD 2 ONLY */
            --g8-card2-scoreboard-offset-y: 12px;
            /* Positive = down, Negative = up */
            --g8-card2-field-offset-y: 5px;
            /* Positive = down, Negative = up */
        }

        /* Grid 8 Element Rules */
        .fullscreen-grid.grid-8 .sport-logo-indicator {
            width: var(--g8-sport-logo-width);
            height: var(--g8-sport-logo-height);
            top: var(--g8-sport-logo-top);
            right: var(--g8-sport-logo-right);
        }

        .fullscreen-grid.grid-8 .fs-card-team-logo {
            width: var(--g8-team-logo-size);
            height: var(--g8-team-logo-size);
            margin: var(--g8-team-logo-margin);
        }

        .fullscreen-grid.grid-8 .fs-sb-score-box {
            width: var(--g8-score-box-width);
            height: var(--g8-score-box-height);
        }

        .fullscreen-grid.grid-8 .fs-sb-score {
            font-size: var(--g8-score-font-size);
        }

        .fullscreen-grid.grid-8 .fs-sb-team-name {
            font-size: var(--g8-team-name-font-size);
            margin: var(--g8-team-name-margin);
        }

        .fullscreen-grid.grid-8 .fs-sb-team-record {
            font-size: var(--g8-team-record-font-size);
            margin: var(--g8-team-record-margin);
        }

        .fullscreen-grid.grid-8 .fs-sb-timeout-bar {
            width: var(--g8-timeout-size);
            height: var(--g8-timeout-size);
        }

        .fullscreen-grid.grid-8 .fs-sb-timeouts {
            gap: var(--g8-timeout-gap);
        }

        .fullscreen-grid.grid-8 .fs-sb-time-box {
            min-width: var(--g8-time-box-min-width);
            padding: var(--g8-time-box-padding);
        }

        .fullscreen-grid.grid-8 .fs-sb-time-label {
            font-size: var(--g8-time-label-font-size);
        }

        .fullscreen-grid.grid-8 .fs-sb-time {
            font-size: var(--g8-time-font-size);
        }

        .fullscreen-grid.grid-8 .fs-sb-situation {
            padding: var(--g8-situation-padding);
            min-width: var(--g8-situation-min-width);
            gap: var(--g8-situation-gap);
        }

        .fullscreen-grid.grid-8 .fs-sb-down-distance,
        .fullscreen-grid.grid-8 .fs-sb-ball-position {
            font-size: var(--g8-situation-font-size);
        }

        .fullscreen-grid.grid-8 .field-visualizer {
            margin-top: var(--g8-field-margin-top);
            max-height: var(--g8-field-max-height);
        }

        .fullscreen-grid.grid-8 .fs-scoreboard {
            width: var(--g8-scoreboard-width);
            height: var(--g8-scoreboard-height);
        }

        .fullscreen-grid.grid-8 .fs-scoreboard-top {
            width: var(--g8-scoreboard-width);
        }

        .fullscreen-grid.grid-8 .fs-sb-logo-spacer {
            width: var(--g8-logo-spacer-width);
        }

        .fullscreen-grid.grid-8 .fs-sb-logo-center-spacer {
            width: var(--g8-logo-center-spacer-width);
        }

        /* ============================================
           GRID 8 - Smaller Cards (2-8) Overrides
           These cards need reduced padding and tighter spacing
           ============================================ */

        /* Team section padding - reduced for smaller cards */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away {
            padding-left: var(--g8-team-section-padding-outer);
            padding-right: var(--g8-team-section-padding-inner);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home {
            padding-left: var(--g8-team-section-padding-inner);
            padding-right: var(--g8-team-section-padding-outer);
        }

        /* Smaller logos for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-card-team-logo {
            width: 36px;
            height: 36px;
        }

        /* Smaller scoreboard for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-scoreboard {
            height: 36px;
        }

        /* Smaller score box for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-score-box {
            width: 42px;
        }

        /* Smaller score for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-score {
            font-size: 1rem;
        }

        /* Smaller logo spacers for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-logo-spacer {
            width: 34px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-logo-center-spacer {
            width: 42px;
        }

        /* Tighter team info for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-info {
            gap: 0;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-name {
            font-size: 0.6rem;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-record {
            font-size: 0.4rem;
        }

        /* Smaller time box for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-time-box {
            min-width: 36px;
            padding: 1px 3px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-time-label {
            font-size: 0.25rem;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-time {
            font-size: 0.45rem;
        }

        /* Smaller situation box for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-situation {
            padding: 2px 4px;
            min-width: 70px;
            gap: 2px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-down-distance,
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-ball-position {
            font-size: 0.4rem;
        }

        /* Smaller timeouts for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-timeout-bar {
            width: 3px;
            height: 3px;
        }

        /* Smaller field for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .field-visualizer {
            margin-top: 10px;
            max-height: 60px;
        }

        /* Smaller sport logo for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .sport-logo-indicator {
            width: 24px;
            height: 24px;
            top: 4px;
            right: 4px;
        }

        /* Smaller possession indicator for cards 2-8 */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-possession-indicator {
            font-size: 8px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-possession-indicator.away {
            top: -3px;
            right: -3px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-possession-indicator.home {
            top: -3px;
            left: -3px;
        }

        /* ============================================
           GRID-8 CARDS 2-8: COMPACT TIME BOX IN SCOREBOARD
           ============================================ */

        /* Make time box more compact - keep it in scoreboard center */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-center {
            min-width: 50px;
            max-width: 70px;
            padding: 2px 4px;
            gap: 0;
        }

        /* Compact time display - show quarter and time on same line */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-center .fs-sb-time-label {
            font-size: 0.65rem;
            margin-bottom: 0;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-center .fs-sb-time {
            font-size: 0.7rem;
            line-height: 1;
        }

        /* Reduce center spacer width to give more room to team sections */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-logo-center-spacer {
            width: 50px;
            min-width: 50px;
            flex-shrink: 1;
        }



        /* Align home logo box to match team name vertical positioning */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home .fs-sb-logo-box {
            align-items: center;
            justify-content: flex-end;
        }

        /* Away team section alignment */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away .fs-sb-logo-box {
            align-items: center;
            justify-content: flex-start;
        }

        /* Adjust scoreboard for better space distribution */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-scoreboard {
            justify-content: space-between;
            padding: 0 4px;
        }

        /* Scoreboard-top alignment */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-scoreboard-top {
            align-items: center;
            margin-bottom: -20px;
        }

        /* Grid 8 - Individual Element Control Rules - BIG CARD (1) */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-logo {
            width: var(--g8-big-team-logo-width);
            height: var(--g8-big-team-logo-height);
            margin-bottom: var(--g8-big-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-info {
            gap: var(--g8-big-team-info-gap);
            padding-top: var(--g8-big-team-info-padding-top);
            padding-bottom: var(--g8-big-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g8-big-team-info-margin-left);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g8-big-team-info-margin-right);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-timeout-bar {
            width: var(--g8-big-timeout-bar-width);
            height: var(--g8-big-timeout-bar-height);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-timeouts {
            gap: var(--g8-big-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g8-big-timeout-margin-left));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g8-big-timeout-margin-right)));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(1) .fs-sb-situation {
            padding-bottom: var(--g8-big-situation-padding-bottom);
            margin-bottom: var(--g8-big-situation-margin-bottom);
        }

        /* Grid 8 - Individual Element Control Rules - SMALL CARDS (2-8) */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-logo {
            width: var(--g8-small-team-logo-width);
            height: var(--g8-small-team-logo-height);
            margin-bottom: var(--g8-small-team-logo-margin-bottom);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-info {
            gap: var(--g8-small-team-info-gap);
            padding-top: var(--g8-small-team-info-padding-top);
            padding-bottom: var(--g8-small-team-info-padding-bottom);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away .fs-sb-team-info {
            margin-left: var(--g8-small-team-info-margin-left);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home .fs-sb-team-info {
            margin-right: var(--g8-small-team-info-margin-right);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-timeout-bar {
            width: var(--g8-small-timeout-bar-width);
            height: var(--g8-small-timeout-bar-height);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-timeouts {
            gap: var(--g8-small-timeout-gap-spacing);
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.away .fs-sb-timeouts {
            transform: translateX(var(--g8-small-timeout-margin-left));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-team-section.home .fs-sb-timeouts {
            transform: translateX(calc(-1 * var(--g8-small-timeout-margin-right)));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-situation {
            padding-bottom: var(--g8-small-situation-padding-bottom);
            margin-bottom: var(--g8-small-situation-margin-bottom);
        }

        /* Grid 8 Small Cards - Scoreboard & Field Vertical Position */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-scoreboard {
            transform: translateY(var(--g8-small-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .field-visualizer {
            transform: translateY(var(--g8-small-field-offset-y));
        }

        /* Grid 8 Card 2 - Individual Overrides */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(2) .fs-scoreboard {
            transform: translateY(var(--g8-card2-scoreboard-offset-y));
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(2) .field-visualizer {
            transform: translateY(var(--g8-card2-field-offset-y));
        }

        /* ============================================
           TOP CLOCK FOR GRID-5, 6, 7 & 8 SMALLER CARDS
           Hide scoreboard center clock and show top clock
           ============================================ */

        /* Hide the scoreboard center clock for smaller cards (grid-6 all cards) */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-center,
        .fullscreen-grid.grid-6 .fullscreen-game-card .fs-sb-center,
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-sb-center,
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-sb-center {
            display: none;
        }

        /* MLB cards at grid-3/4: hide center clock to avoid crowding the BSO badge */
        .fullscreen-grid.grid-3 .fs-mlb .fs-sb-center,
        .fullscreen-grid.grid-4 .fs-mlb .fs-sb-center {
            display: none;
        }

        /* MLB cards at grid-3/4: show top clock (replaces hidden center clock) */
        .fullscreen-grid.grid-3 .fs-mlb .fs-top-clock,
        .fullscreen-grid.grid-4 .fs-mlb .fs-top-clock {
            display: block;
        }

        /* Top clock element - appears above scoreboard */
        .fs-top-clock {
            display: none;
            /* Hidden by default for all grids */
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            background: linear-gradient(180deg,
                    #252a31 0%,
                    #000000 10%,
                    #393c47 40%,
                    #000000 60%,
                    #000000 90%,
                    #000000 100%);
            padding: 4px 12px;
            border-radius: 4px;
            border: 1px solid #5a6577;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.5),
                0 1px 2px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                inset 0 -1px 2px rgba(0, 0, 0, 0.3);
            font-family: var(--sb-font-display, 'Oswald', sans-serif);
            text-align: center;
            white-space: nowrap;
        }

        /* Show top clock for grid-5 cards 3+, grid-6 all cards, grid-7/8 cards 2+ */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-top-clock,
        .fullscreen-grid.grid-6 .fullscreen-game-card .fs-top-clock,
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-top-clock,
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-top-clock {
            display: block;
        }

        /* Top clock text styling */
        .fs-top-clock-text {
            font-size: 0.7rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            font-variant-numeric: tabular-nums;
        }

        /* Size variations per grid - larger grids have smaller clocks */

        /* Grid-5: Cards 3+ (smaller cards), larger top clock */
        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-top-clock {
            padding: 4px 14px;
        }

        .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-top-clock-text {
            font-size: 0.8rem;
        }

        /* Grid-6: All cards have top clock */
        .fullscreen-grid.grid-6 .fullscreen-game-card .fs-top-clock {
            padding: 3px 12px;
        }

        .fullscreen-grid.grid-6 .fullscreen-game-card .fs-top-clock-text {
            font-size: 0.7rem;
        }

        /* Grid-7: Medium cards */
        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-top-clock {
            padding: 3px 10px;
        }

        .fullscreen-grid.grid-7 .fullscreen-game-card:nth-child(n+2) .fs-top-clock-text {
            font-size: 0.65rem;
        }

        /* Grid-8: Smallest cards, smallest top clock */
        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-top-clock {
            padding: 2px 8px;
        }

        .fullscreen-grid.grid-8 .fullscreen-game-card:nth-child(n+2) .fs-top-clock-text {
            font-size: 0.55rem;
        }
    </style>
</head>

<body>
    <!-- Back Button -->
    <button class="back-btn focused" id="back-btn">Back to TV Home</button>

    <!-- Fullscreen Grid Container -->
    <div class="fullscreen-container" id="fullscreen-container">
        <div class="fullscreen-grid" id="fullscreen-grid">
            <!-- Game cards rendered dynamically -->
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div class="exit-modal" id="exit-modal">
        <div class="exit-modal-content">
            <h2>Exit Sports Bar Mode?</h2>
            <div class="exit-modal-buttons">
                <button class="exit-modal-btn confirm focused" id="confirm-exit">Yes, Exit</button>
                <button class="exit-modal-btn cancel" id="cancel-exit">Stay</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // RECEIVER MODE DETECTION
        // ============================================
        const urlParams = new URLSearchParams(window.location.search);
        const isReceiverMode = urlParams.get('mode') === 'receiver';
        const receiverSessionId = urlParams.get('sessionId');

        // ============================================
        // STATE
        // ============================================
        let games = [];
        let refreshInterval = null;
        let isModalOpen = false;
        let modalFocusIndex = 0; // 0 = confirm, 1 = cancel

        // Receiver mode state
        let receiverSocket = null;
        let receiverConnected = false;

        // SVG Field Visualizers map (gameId -> SVGFieldVisualizer instance)
        // Exposed globally so play-animations.js can access visualizers
        window.fieldVisualizers = new Map();

        // MLB LiveCast instances map (gameId -> MLBLiveCast instance)
        window.mlbLiveCasts = new Map();

        // Stats modal timing state per game
        // Each game tracks: { noPlayStartTime, isShowingStats, showStartTime, currentPhase, cachedStats }
        // currentPhase: 0 = away team, 1 = home team
        const statsModalState = new Map();

        // NBA Scorer Notification State
        const nbaScoreTracker = new Map(); // gameId -> { away: score, home: score }
        const nbaAnimationQueue = new Map(); // gameId -> { queue: [], isPlaying: boolean }
        const nbaFetchLock = new Map(); // gameId -> boolean (prevents concurrent API fetches)

        // League logos
        const leagueLogos = {
            'nfl': '/assets/nfl-logo.png',
            'nba': '/assets/nba-logo.png',
            'mlb': '/assets/mlb-logo.png',
            'nhl': '/assets/nhl-logo.png',
            'ncaa': '/assets/ncaa-logo.png',
            'ncaab': '/assets/ncaa-basketball.png'
        };

        // NFL/NCAA Team Colors (primary)
        const teamColors = {
            // NFL Teams
            'ARI': '#97233F', 'ATL': '#A71930', 'BAL': '#241773', 'BUF': '#00338D',
            'CAR': '#0085CA', 'CHI': '#C83803', 'CIN': '#FB4F14', 'CLE': '#311D00',
            'DAL': '#003594', 'DEN': '#FB4F14', 'DET': '#0076B6', 'GB': '#203731',
            'HOU': '#03202F', 'IND': '#002C5F', 'JAX': '#006778', 'KC': '#E31837',
            'LAC': '#0080C6', 'LAR': '#003594', 'LV': '#000000', 'MIA': '#008E97',
            'MIN': '#4F2683', 'NE': '#002244', 'NO': '#D3BC8D', 'NYG': '#0B2265',
            'NYJ': '#125740', 'PHI': '#004C54', 'PIT': '#FFB612', 'SF': '#AA0000',
            'SEA': '#002244', 'TB': '#D50A0A', 'TEN': '#0C2340', 'WSH': '#5A1414',
            // NBA Teams
            'ATL': '#E03A3E', 'BOS': '#007A33', 'BKN': '#000000', 'CHA': '#1D1160',
            'CHI': '#CE1141', 'CLE': '#6F263D', 'DAL': '#00538C', 'DEN': '#0E2240',
            'DET': '#C8102E', 'GSW': '#1D428A', 'HOU': '#CE1141', 'IND': '#002D62',
            'LAC': '#C8102E', 'LAL': '#552583', 'MEM': '#5D76A9', 'MIA': '#98002E',
            'MIL': '#00471B', 'MIN': '#0C2340', 'NOP': '#0C2340', 'NYK': '#006BB6',
            'OKC': '#007AC1', 'ORL': '#0077C0', 'PHI': '#006BB6', 'PHX': '#1D1160',
            'POR': '#E03A3E', 'SAC': '#5A2D81', 'SAS': '#C4CED4', 'TOR': '#CE1141',
            'UTA': '#002B5C', 'WAS': '#002B5C'
        };

        function getTeamColor(abbr, league) {
            // Use league-specific colors for accurate team matching
            if (league === 'ncaa') {
                const ncaaColor = NCAA_TEAM_COLORS[abbr];
                if (ncaaColor) return ncaaColor.primary;
            } else if (league === 'nfl') {
                const nflColor = NFL_TEAM_COLORS[abbr];
                if (nflColor) return nflColor.primary;
            }
            // Fallback to generic teamColors object
            return teamColors[abbr] || '#fbbf24';
        }

        // Team colors with primary and secondary for scoreboard
        const NFL_TEAM_COLORS = {
            'ARI': { primary: '#97233F', secondary: '#000000' },
            'ATL': { primary: '#A71930', secondary: '#000000' },
            'BAL': { primary: '#241773', secondary: '#000000' },
            'BUF': { primary: '#00338D', secondary: '#C60C30' },
            'CAR': { primary: '#0085CA', secondary: '#101820' },
            'CHI': { primary: '#C83803', secondary: '#0B162A' },
            'CIN': { primary: '#FB4F14', secondary: '#000000' },
            'CLE': { primary: '#311D00', secondary: '#FF3C00' },
            'DAL': { primary: '#003594', secondary: '#041E42' },
            'DEN': { primary: '#FB4F14', secondary: '#002244' },
            'DET': { primary: '#0076B6', secondary: '#B0B7BC' },
            'GB': { primary: '#203731', secondary: '#FFB612' },
            'HOU': { primary: '#03202F', secondary: '#A71930' },
            'IND': { primary: '#002C5F', secondary: '#A2AAAD' },
            'JAX': { primary: '#006778', secondary: '#9F792C' },
            'KC': { primary: '#E31837', secondary: '#FFB81C' },
            'LAC': { primary: '#0080C6', secondary: '#FFC20E' },
            'LAR': { primary: '#003594', secondary: '#FFA300' },
            'LA': { primary: '#003594', secondary: '#FFA300' }, // ESPN uses LA for Rams
            'LV': { primary: '#000000', secondary: '#A5ACAF' },
            'MIA': { primary: '#008E97', secondary: '#FC4C02' },
            'MIN': { primary: '#4F2683', secondary: '#FFC62F' },
            'NE': { primary: '#002244', secondary: '#C60C30' },
            'NO': { primary: '#D3BC8D', secondary: '#101820' },
            'NYG': { primary: '#0B2265', secondary: '#A71930' },
            'NYJ': { primary: '#125740', secondary: '#000000' },
            'PHI': { primary: '#004C54', secondary: '#A5ACAF' },
            'PIT': { primary: '#FFB612', secondary: '#101820' },
            'SF': { primary: '#AA0000', secondary: '#B3995D' },
            'SEA': { primary: '#002244', secondary: '#69BE28' },
            'TB': { primary: '#D50A0A', secondary: '#FF7900' },
            'TEN': { primary: '#0C2340', secondary: '#4B92DB' },
            'WSH': { primary: '#5A1414', secondary: '#FFB612' },
            'WAS': { primary: '#5A1414', secondary: '#FFB612' }, // ESPN uses WAS for Washington
            'JAC': { primary: '#006778', secondary: '#9F792C' } // ESPN alias for JAX
        };

        // NCAA Football Team Colors (College)
        const NCAA_TEAM_COLORS = {
            'ALA': { primary: '#9E1B32', secondary: '#828A8F' },
            'ARIZ': { primary: '#CC0033', secondary: '#003366' },
            'ASU': { primary: '#8C1D40', secondary: '#FFC627' },
            'ARK': { primary: '#9D2235', secondary: '#000000' },
            'AUB': { primary: '#0C2340', secondary: '#E87722' },
            'BAY': { primary: '#154734', secondary: '#FFB81C' },
            'BGSU': { primary: '#FE5000', secondary: '#4F2C1D' },
            'BSU': { primary: '#0033A0', secondary: '#D64309' },
            'BC': { primary: '#98002E', secondary: '#BC9B6A' },
            'CAL': { primary: '#003262', secondary: '#FDB515' },
            'CLEM': { primary: '#F56600', secondary: '#522D80' },
            'COLO': { primary: '#CFB87C', secondary: '#000000' },
            'CONN': { primary: '#000E2F', secondary: '#E4002B' },
            'DUKE': { primary: '#003087', secondary: '#FFFFFF' },
            'FLA': { primary: '#0021A5', secondary: '#FA4616' },
            'FSU': { primary: '#782F40', secondary: '#CEB888' },
            'UGA': { primary: '#BA0C2F', secondary: '#000000' },
            'GT': { primary: '#B3A369', secondary: '#003057' },
            'HAW': { primary: '#024731', secondary: '#000000' },
            'HOU': { primary: '#C8102E', secondary: '#FFFFFF' },
            'ILL': { primary: '#E84A27', secondary: '#13294B' },
            'IND': { primary: '#990000', secondary: '#EEEDEB' },
            'IOWA': { primary: '#FFCD00', secondary: '#000000' },
            'ISU': { primary: '#C8102E', secondary: '#F1BE48' },
            'KU': { primary: '#0051BA', secondary: '#E8000D' },
            'UK': { primary: '#0033A0', secondary: '#FFFFFF' },
            'LSU': { primary: '#461D7C', secondary: '#FDD023' },
            'LOU': { primary: '#AD0000', secondary: '#000000' },
            'MD': { primary: '#E03A3E', secondary: '#FFD520' },
            'MICH': { primary: '#00274C', secondary: '#FFCB05' },
            'MSU': { primary: '#18453B', secondary: '#FFFFFF' },
            'MINN': { primary: '#7A0019', secondary: '#FFCC33' },
            'MISS': { primary: '#CE1126', secondary: '#14213D' },
            'MSST': { primary: '#660000', secondary: '#FFFFFF' },
            'MIZ': { primary: '#F1B82D', secondary: '#000000' },
            'NEB': { primary: '#E41C38', secondary: '#F5F1E7' },
            'NEV': { primary: '#003366', secondary: '#807F84' },
            'UNM': { primary: '#BA0C2F', secondary: '#63666A' },
            'NC': { primary: '#7BAFD4', secondary: '#13294B' },
            'NCST': { primary: '#CC0000', secondary: '#000000' },
            'NW': { primary: '#4E2A84', secondary: '#000000' },
            'ND': { primary: '#0C2340', secondary: '#C99700' },
            'OHIO': { primary: '#00694E', secondary: '#FFFFFF' },
            'OSU': { primary: '#BB0000', secondary: '#666666' },
            'OKLA': { primary: '#841617', secondary: '#FDF9D8' },
            'OKST': { primary: '#FF7300', secondary: '#000000' },
            'ORE': { primary: '#154733', secondary: '#FEE123' },
            'ORST': { primary: '#DC4405', secondary: '#000000' },
            'PSU': { primary: '#041E42', secondary: '#FFFFFF' },
            'PITT': { primary: '#003594', secondary: '#FFB81C' },
            'PUR': { primary: '#CEB888', secondary: '#000000' },
            'RICE': { primary: '#002469', secondary: '#5E6A71' },
            'RUTG': { primary: '#CC0033', secondary: '#5F6A72' },
            'SC': { primary: '#73000A', secondary: '#000000' },
            'SDSU': { primary: '#A6192E', secondary: '#000000' },
            'SMU': { primary: '#0033A0', secondary: '#C8102E' },
            'STAN': { primary: '#8C1515', secondary: '#FFFFFF' },
            'SYR': { primary: '#F76900', secondary: '#000E54' },
            'TCU': { primary: '#4D1979', secondary: '#A3A9AC' },
            'TEM': { primary: '#9D2235', secondary: '#000000' },
            'TENN': { primary: '#FF8200', secondary: '#FFFFFF' },
            'TEX': { primary: '#BF5700', secondary: '#FFFFFF' },
            'TXAM': { primary: '#500000', secondary: '#FFFFFF' },
            'TTU': { primary: '#CC0000', secondary: '#000000' },
            'TLSA': { primary: '#002D62', secondary: '#C8A875' },
            'UCLA': { primary: '#2D68C4', secondary: '#F2A900' },
            'USC': { primary: '#990000', secondary: '#FFC72C' },
            'UTAH': { primary: '#CC0000', secondary: '#000000' },
            'UVA': { primary: '#232D4B', secondary: '#F84C1E' },
            'VT': { primary: '#630031', secondary: '#CF4420' },
            'WAKE': { primary: '#9E7E38', secondary: '#000000' },
            'UW': { primary: '#4B2E83', secondary: '#B7A57A' },
            'WSU': { primary: '#981E32', secondary: '#5E6A71' },
            'WVU': { primary: '#002855', secondary: '#EAAA00' },
            'WIS': { primary: '#C5050C', secondary: '#FFFFFF' },
            'WYO': { primary: '#492F24', secondary: '#FFC425' },
            'ARMY': { primary: '#000000', secondary: '#D3BC8D' },
            'NAVY': { primary: '#00205B', secondary: '#C5B783' },
            'AFAL': { primary: '#003087', secondary: '#8A8D8F' },
            'MIA': { primary: '#F47321', secondary: '#005030' },
            'MIAMI': { primary: '#F47321', secondary: '#005030' },
            'UCF': { primary: '#BA9B37', secondary: '#000000' },
            'USF': { primary: '#006747', secondary: '#CFC493' },
            'FAU': { primary: '#003366', secondary: '#CC0000' },
            'FIU': { primary: '#081E3F', secondary: '#B6862C' },
            'CIN': { primary: '#E00122', secondary: '#000000' },
            'MEM': { primary: '#003087', secondary: '#898D8D' },
            'TUL': { primary: '#002D62', secondary: '#418FDE' },
            'TULN': { primary: '#006747', secondary: '#87CEEB' },
            'ECU': { primary: '#592A8A', secondary: '#FFC72C' },
            'APP': { primary: '#FFCC00', secondary: '#000000' },
            'CHAR': { primary: '#046A38', secondary: '#B9975B' },
            'JMU': { primary: '#450084', secondary: '#CBB677' },
            'MRSH': { primary: '#00B140', secondary: '#000000' },
            'ODU': { primary: '#003057', secondary: '#7C878E' },
            'GASO': { primary: '#011E41', secondary: '#87714D' },
            'GAST': { primary: '#002649', secondary: '#C60C30' },
            'CCU': { primary: '#006F71', secondary: '#A27752' },
            'ARST': { primary: '#CC092F', secondary: '#000000' },
            'SJSU': { primary: '#0055A2', secondary: '#E5A823' },
            'FRES': { primary: '#DB0032', secondary: '#13284C' },
            'UNLV': { primary: '#CF0A2C', secondary: '#666666' },
            'CSU': { primary: '#1E4D2B', secondary: '#C8C372' },
            'AFA': { primary: '#003087', secondary: '#8A8D8F' },
            'NMSU': { primary: '#8B0000', secondary: '#000000' },
            'UTEP': { primary: '#FF8200', secondary: '#041E42' },
            'UTSA': { primary: '#0C2340', secondary: '#F15A22' },
            'UNT': { primary: '#00853E', secondary: '#000000' },
            'MTSU': { primary: '#0066CC', secondary: '#000000' },
            'WKU': { primary: '#B01E24', secondary: '#000000' },
            'LT': { primary: '#003087', secondary: '#C8102E' },
            'BUFF': { primary: '#005BBB', secondary: '#000000' },
            'KENT': { primary: '#002664', secondary: '#EAAB00' },
            'AKRN': { primary: '#041E42', secondary: '#A89968' },
            'BALL': { primary: '#BA0C2F', secondary: '#000000' },
            'CMU': { primary: '#6A0032', secondary: '#FFC82E' },
            'EMU': { primary: '#006633', secondary: '#000000' },
            'MAC': { primary: '#6A0032', secondary: '#FFC82E' },
            'NIU': { primary: '#BA0C2F', secondary: '#000000' },
            'TOL': { primary: '#003E7E', secondary: '#FFCE00' },
            'WMU': { primary: '#6C4023', secondary: '#B5A167' }
        };

        const NBA_TEAM_COLORS = {
            'ATL': { primary: '#E03A3E', secondary: '#C1D32F' },
            'BOS': { primary: '#007A33', secondary: '#BA9653' },
            'BKN': { primary: '#000000', secondary: '#FFFFFF' },
            'CHA': { primary: '#1D1160', secondary: '#00788C' },
            'CHI': { primary: '#CE1141', secondary: '#000000' },
            'CLE': { primary: '#6F263D', secondary: '#FFB81C' },
            'DAL': { primary: '#00538C', secondary: '#002B5E' },
            'DEN': { primary: '#0E2240', secondary: '#FEC524' },
            'DET': { primary: '#C8102E', secondary: '#1D42BA' },
            'GSW': { primary: '#1D428A', secondary: '#FFC72C' },
            'HOU': { primary: '#CE1141', secondary: '#000000' },
            'IND': { primary: '#002D62', secondary: '#FDBB30' },
            'LAC': { primary: '#C8102E', secondary: '#1D428A' },
            'LAL': { primary: '#552583', secondary: '#FDB927' },
            'MEM': { primary: '#5D76A9', secondary: '#12173F' },
            'MIA': { primary: '#98002E', secondary: '#F9A01B' },
            'MIL': { primary: '#00471B', secondary: '#EEE1C6' },
            'MIN': { primary: '#0C2340', secondary: '#236192' },
            'NOP': { primary: '#0C2340', secondary: '#C8102E' },
            'NYK': { primary: '#006BB6', secondary: '#F58426' },
            'OKC': { primary: '#007AC1', secondary: '#EF3B24' },
            'ORL': { primary: '#0077C0', secondary: '#C4CED4' },
            'PHI': { primary: '#006BB6', secondary: '#ED174C' },
            'PHX': { primary: '#1D1160', secondary: '#E56020' },
            'POR': { primary: '#E03A3E', secondary: '#000000' },
            'SAC': { primary: '#5A2D81', secondary: '#63727A' },
            'SAS': { primary: '#C4CED4', secondary: '#000000' },
            'TOR': { primary: '#CE1141', secondary: '#000000' },
            'UTA': { primary: '#002B5C', secondary: '#00471B' },
            'WAS': { primary: '#002B5C', secondary: '#E31837' },
            // ESPN abbreviation aliases
            'BRK': { primary: '#000000', secondary: '#FFFFFF' },
            'NO': { primary: '#0C2340', secondary: '#C8102E' },
            'PHO': { primary: '#1D1160', secondary: '#E56020' },
            'GS': { primary: '#1D428A', secondary: '#FFC72C' },
            'SA': { primary: '#C4CED4', secondary: '#000000' },
            'NY': { primary: '#006BB6', secondary: '#F58426' },
            'UTAH': { primary: '#002B5C', secondary: '#00471B' },
            'WSH': { primary: '#002B5C', secondary: '#E31837' }
        };

        const NHL_TEAM_COLORS = {
            'ANA': { primary: '#F47A38', secondary: '#B9975B' },
            'ARI': { primary: '#8C2633', secondary: '#E2D6B5' },
            'BOS': { primary: '#FFB81C', secondary: '#000000' },
            'BUF': { primary: '#002654', secondary: '#FCB514' },
            'CGY': { primary: '#C8102E', secondary: '#F1BE48' },
            'CAR': { primary: '#CC0000', secondary: '#000000' },
            'CHI': { primary: '#CF0A2C', secondary: '#000000' },
            'COL': { primary: '#6F263D', secondary: '#236192' },
            'CBJ': { primary: '#002654', secondary: '#CE1141' },
            'DAL': { primary: '#006847', secondary: '#8F8F8C' },
            'DET': { primary: '#CE1126', secondary: '#FFFFFF' },
            'EDM': { primary: '#041E42', secondary: '#FF4C00' },
            'FLA': { primary: '#041E42', secondary: '#C8102E' },
            'LAK': { primary: '#111111', secondary: '#A2AAAD' },
            'MIN': { primary: '#154734', secondary: '#A6192E' },
            'MTL': { primary: '#AF1E2D', secondary: '#192168' },
            'NSH': { primary: '#FFB81C', secondary: '#041E42' },
            'NJD': { primary: '#CE1126', secondary: '#000000' },
            'NYI': { primary: '#00539B', secondary: '#F47D30' },
            'NYR': { primary: '#0038A8', secondary: '#CE1126' },
            'OTT': { primary: '#C52032', secondary: '#C2912C' },
            'PHI': { primary: '#F74902', secondary: '#000000' },
            'PIT': { primary: '#FCB514', secondary: '#000000' },
            'SJS': { primary: '#006D75', secondary: '#EA7200' },
            'SEA': { primary: '#001628', secondary: '#99D9D9' },
            'STL': { primary: '#002F87', secondary: '#FCB514' },
            'TBL': { primary: '#002868', secondary: '#FFFFFF' },
            'TOR': { primary: '#00205B', secondary: '#FFFFFF' },
            'UTA': { primary: '#71AFE5', secondary: '#010101' },
            'VAN': { primary: '#00205B', secondary: '#00843D' },
            'VGK': { primary: '#B4975A', secondary: '#333F42' },
            'WSH': { primary: '#C8102E', secondary: '#041E42' },
            'WPG': { primary: '#041E42', secondary: '#004C97' },
            // ESPN abbreviation aliases
            'LA': { primary: '#111111', secondary: '#A2AAAD' },   // Los Angeles Kings
            'NJ': { primary: '#CE1126', secondary: '#000000' },   // New Jersey Devils
            'TB': { primary: '#002868', secondary: '#FFFFFF' },   // Tampa Bay Lightning
            'SJ': { primary: '#006D75', secondary: '#EA7200' },   // San Jose Sharks
            'VEG': { primary: '#B4975A', secondary: '#333F42' },  // Vegas Golden Knights
            'WAS': { primary: '#C8102E', secondary: '#041E42' }   // Washington Capitals
        };

        const MLB_TEAM_COLORS = {
            'ARI': { primary: '#A71930', secondary: '#E3D4AD' },
            'ATL': { primary: '#CE1141', secondary: '#13274F' },
            'BAL': { primary: '#DF4601', secondary: '#000000' },
            'BOS': { primary: '#BD3039', secondary: '#0C2340' },
            'CHC': { primary: '#0E3386', secondary: '#CC3433' },
            'CWS': { primary: '#27251F', secondary: '#C4CED4' },
            'CIN': { primary: '#C6011F', secondary: '#000000' },
            'CLE': { primary: '#00385D', secondary: '#E50022' },
            'COL': { primary: '#33006F', secondary: '#C4CED4' },
            'DET': { primary: '#0C2340', secondary: '#FA4616' },
            'HOU': { primary: '#002D62', secondary: '#EB6E1F' },
            'KC': { primary: '#004687', secondary: '#BD9B60' },
            'LAA': { primary: '#BA0021', secondary: '#003263' },
            'LAD': { primary: '#005A9C', secondary: '#EF3E42' },
            'MIA': { primary: '#00A3E0', secondary: '#EF3340' },
            'MIL': { primary: '#12284B', secondary: '#B6922E' },
            'MIN': { primary: '#002B5C', secondary: '#D31145' },
            'NYM': { primary: '#002D72', secondary: '#FF5910' },
            'NYY': { primary: '#003087', secondary: '#E4002C' },
            'OAK': { primary: '#003831', secondary: '#EFB21E' },
            'PHI': { primary: '#E81828', secondary: '#002D72' },
            'PIT': { primary: '#27251F', secondary: '#FDB827' },
            'SD': { primary: '#2F241D', secondary: '#FFC425' },
            'SF': { primary: '#FD5A1E', secondary: '#27251F' },
            'SEA': { primary: '#0C2C56', secondary: '#005C5C' },
            'STL': { primary: '#C41E3A', secondary: '#0C2340' },
            'TB': { primary: '#092C5C', secondary: '#8FBCE6' },
            'TEX': { primary: '#003278', secondary: '#C0111F' },
            'TOR': { primary: '#134A8E', secondary: '#E8291C' },
            'WSH': { primary: '#AB0003', secondary: '#14225A' },
            // ESPN abbreviation aliases
            'CHW': { primary: '#27251F', secondary: '#C4CED4' },  // Chicago White Sox
            'WAS': { primary: '#AB0003', secondary: '#14225A' },  // Washington Nationals
            'TBR': { primary: '#092C5C', secondary: '#8FBCE6' },  // Tampa Bay Rays
            'AZ': { primary: '#A71930', secondary: '#E3D4AD' }    // Arizona Diamondbacks
        };

        // Get team colors for scoreboard
        function getScoreboardColors(league, abbr) {
            const defaultColors = { primary: '#4b5563', secondary: '#374151' };

            if (league === 'nfl') {
                return NFL_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'ncaa') {
                return NCAA_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'nba' || league === 'ncaab') {
                return NBA_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'nhl') {
                return NHL_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'mlb') {
                return MLB_TEAM_COLORS[abbr] || defaultColors;
            }
            return defaultColors;
        }

        // Parse game status for period/quarter and time
        function parseGameStatus(status, league) {
            if (!status) return { period: '', time: '' };

            // Handle common status formats
            const parts = status.split(' - ');
            if (parts.length === 2) {
                return { period: parts[0], time: parts[1] };
            }

            // Try to extract period and time
            const match = status.match(/^(\d+(?:st|nd|rd|th)|OT\d*|[A-Z]+)\s+(.+)$/i);
            if (match) {
                return { period: match[1], time: match[2] };
            }

            // NFL/NCAA format: "3rd 5:42"
            const nflMatch = status.match(/^(\d+(?:st|nd|rd|th))\s+(\d+:\d+)$/i);
            if (nflMatch) {
                return { period: nflMatch[1], time: nflMatch[2] };
            }

            // Just return the full status as time if can't parse
            return { period: '', time: status };
        }

        // ============================================
        // RECEIVER MODE FUNCTIONS
        // ============================================
        function initReceiverMode() {
            console.log('📺 Initializing TV Receiver Mode with session:', receiverSessionId);

            // Connect to Socket.IO
            console.log('🔌 Creating Socket.IO connection...');
            receiverSocket = io();

            console.log('📡 Socket object created:', receiverSocket);

            receiverSocket.on('connect', () => {
                console.log('✅ Receiver Socket.IO connected, socket ID:', receiverSocket.id);
                receiverConnected = true;

                // Reconnect to the existing casting session
                if (receiverSessionId) {
                    console.log('📺 Reconnecting to session:', receiverSessionId);

                    let callbackReceived = false;

                    receiverSocket.emit('cast:receiver-reconnect', {
                        sessionId: receiverSessionId
                    }, (response) => {
                        callbackReceived = true;
                        console.log('📥 Reconnect callback received:', response);
                        if (response && response.success) {
                            console.log('✅ Reconnected successfully, state:', response.state);
                            // If there's already state, load it
                            if (response.state && response.state.games && Object.keys(response.state.games).length > 0) {
                                console.log('📥 Loading initial state with games:', response.state.games);
                                handleReceiverStateUpdate(response.state);
                            } else {
                                console.log('⏳ No games in initial state, waiting for sync...');
                                showEmptyState();
                            }
                        } else {
                            console.error('❌ Failed to reconnect:', response ? response.error : 'No response');
                            showEmptyState();
                        }
                    });

                    // Timeout after 5 seconds
                    setTimeout(() => {
                        if (!callbackReceived) {
                            console.error('⏱️ Reconnect timeout - no response from server after 5s');
                            console.error('Session ID:', receiverSessionId);
                            showEmptyState();
                        }
                    }, 5000);
                }
            });

            receiverSocket.on('connect_error', (error) => {
                console.error('❌ Socket connect_error:', error);
            });

            receiverSocket.on('error', (error) => {
                console.error('❌ Socket error:', error);
            });

            // Listen for game state updates from controller
            receiverSocket.on('cast:state-updated', ({ state }) => {
                console.log('📥 Received state update:', state);
                handleReceiverStateUpdate(state);
            });

            receiverSocket.on('cast:session-ended', () => {
                console.log('⚠️ Casting session ended');
                // Keep showing games, just log it
            });

            receiverSocket.on('disconnect', () => {
                console.log('⚠️ Receiver socket disconnected');
                receiverConnected = false;
            });

            // Set up back button to end cast and return to TV home
            document.getElementById('back-btn').addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('End casting session and return to TV Home?')) {
                    window.location.href = '/tv-home';
                }
            });
        }

        function handleReceiverStateUpdate(state) {
            // Convert the state.games object to our games array format
            // state.games is like { slot1: "nfl:401547643", slot2: "nfl:401547644" }

            const slotCount = state.layout || 2;
            const gameIds = [];

            for (let i = 1; i <= slotCount; i++) {
                const gameId = state.games[`slot${i}`];
                if (gameId) {
                    gameIds.push(gameId);
                }
            }

            console.log('📋 Processing game IDs:', gameIds);

            // Fetch game data for each ID and update display
            Promise.all(gameIds.map(fetchGameData)).then(fetchedGames => {
                // Filter out null/failed fetches
                games = fetchedGames.filter(g => g !== null);

                console.log('✅ Loaded games:', games);

                if (games.length > 0) {
                    renderGrid();

                    // Start auto-refresh
                    if (!refreshInterval) {
                        refreshGameData();
                        startAutoRefresh();
                    }
                } else {
                    showEmptyState();
                }
            });
        }

        async function fetchGameData(gameId) {
            try {
                // gameId format: "sport:actualGameId" (e.g., "nfl:401547643")
                const [sport, actualGameId] = gameId.split(':');

                console.log(`🔍 Fetching ${sport} game ${actualGameId}`);

                const response = await fetch(`/api/${sport}/summary/${actualGameId}`);
                if (!response.ok) throw new Error(`API returned ${response.status}`);

                const data = await response.json();

                // Transform ESPN API data to our internal format
                return transformGameData(data, sport);
            } catch (error) {
                console.error(`❌ Failed to fetch game ${gameId}:`, error);
                return null;
            }
        }

        function transformGameData(apiData, league) {
            // The summary endpoint returns data in header.competitions
            const comp = apiData.header?.competitions?.[0];
            if (!comp) {
                console.error('❌ No competition data found in API response');
                return null;
            }

            const awayTeam = comp.competitors?.[1];
            const homeTeam = comp.competitors?.[0];
            if (!awayTeam || !homeTeam) {
                console.error('❌ Missing team data in competition');
                return null;
            }

            const statusState = comp.status?.type?.state || 'pre';
            const situation = comp.situation;

            const gameData = {
                id: `${league}:${apiData.header?.id || apiData.id}`,
                league: league,
                state: statusState === 'post' ? 'post' : (statusState === 'in' ? 'in' : 'pre'),
                status: comp.status?.type?.shortDetail || 'Scheduled',
                away: {
                    abbr: awayTeam.team?.abbreviation || '',
                    logo: awayTeam.team?.logos?.[0]?.href || awayTeam.team?.logo || '',
                    score: parseInt(awayTeam.score || 0),
                    record: awayTeam.record?.[0]?.displayValue || '',
                    timeouts: awayTeam.timeoutsRemaining
                },
                home: {
                    abbr: homeTeam.team?.abbreviation || '',
                    logo: homeTeam.team?.logos?.[0]?.href || homeTeam.team?.logo || '',
                    score: parseInt(homeTeam.score || 0),
                    record: homeTeam.record?.[0]?.displayValue || '',
                    timeouts: homeTeam.timeoutsRemaining
                },
                possession: situation?.possession || null,
                downDistance: situation?.shortDownDistanceText || '',
                fieldPosition: situation?.possessionText || '',
                yardLine: situation?.yardLine || 0,
                yardsToGo: situation?.distance || 0,
                possessionOnOwn: false
            };

            console.log('✅ Transformed game data:', gameData);
            return gameData;
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Check if in receiver mode
            if (isReceiverMode) {
                console.log('📺 Starting in receiver mode');

                // Update back button text for receiver mode
                const backBtn = document.getElementById('back-btn');
                if (backBtn) {
                    backBtn.textContent = 'Return to TV Home';
                }

                initReceiverMode();
                setupKeyboardNavigation();
                // Show loading state while connecting to session
                document.getElementById('fullscreen-grid').innerHTML = `
                    <div class="empty-state">
                        <h2>Loading Games...</h2>
                        <p style="color: #94a3b8;">Connecting to your casting session...</p>
                    </div>
                `;
                return;
            }

            // Normal mode (direct access from tv-home)
            loadGames();

            if (games.length === 0) {
                showEmptyState();
                return;
            }

            renderGrid();
            setupKeyboardNavigation();

            // Only start auto-refresh if NOT using mock data
            if (!usingMockData) {
                // Immediately fetch fresh data to avoid stale localStorage data
                refreshGameData();
                startAutoRefresh();
            } else {
                console.log('📺 Mock data mode - auto-refresh disabled');
            }

            // Update stats modals for NFL games - check every 2 seconds for phase transitions
            updateStatsModals();
            setInterval(updateStatsModals, 2000);

            // Focus back button
            document.getElementById('back-btn').focus();
        });

        // Track if mock data is being used (to disable auto-refresh)
        let usingMockData = false;

        function loadGames() {
            // First try to load from localStorage (user-selected games)
            const saved = localStorage.getItem('gridtv_sports_bar_games');
            if (saved) {
                try {
                    games = JSON.parse(saved);
                    if (games.length > 0) {
                        usingMockData = false;
                        return; // User has selected games, use those
                    }
                } catch (e) {
                    games = [];
                }
            }

            // FALLBACK: Use mock live NFL games when no games are selected
            // This allows testing layouts directly without selecting games
            const USE_MOCK_DATA = false; // Set to false to disable mock fallback

            if (USE_MOCK_DATA && games.length === 0) {
                usingMockData = true;
                games = [
                    {
                        id: 'mock1',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '3rd 8:42',
                        away: { abbr: 'GB', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png', score: 21, record: '9-7-1', timeouts: 2 },
                        home: { abbr: 'CHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png', score: 17, record: '11-6', timeouts: 1 },
                        possession: 'away',
                        downDistance: '2nd & 7',
                        fieldPosition: 'CHI 35',
                        yardLine: 35,
                        yardsToGo: 7,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock2',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '4th 2:00',
                        away: { abbr: 'BUF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png', score: 28, record: '12-5', timeouts: 0 },
                        home: { abbr: 'JAX', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png', score: 24, record: '13-4', timeouts: 3 },
                        possession: 'home',
                        downDistance: '1st & 10',
                        fieldPosition: 'BUF 15',
                        yardLine: 15,
                        yardsToGo: 10,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock3',
                        league: 'nfl',
                        state: 'in', // LIVE - Red Zone!
                        status: '2nd 5:30',
                        away: { abbr: 'KC', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/kc.png', score: 14, record: '10-7', timeouts: 3 },
                        home: { abbr: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/mia.png', score: 10, record: '8-9', timeouts: 2 },
                        possession: 'away',
                        downDistance: '3rd & Goal',
                        fieldPosition: 'MIA 5',
                        yardLine: 5,
                        yardsToGo: 5,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock4',
                        league: 'nfl',
                        state: 'pre', // Upcoming
                        status: '1/12 4:30 PM EST',
                        away: { abbr: 'DAL', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/dal.png', score: '-', record: '7-10' },
                        home: { abbr: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png', score: '-', record: '11-6' }
                    },
                    {
                        id: 'mock5',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '1st 12:00',
                        away: { abbr: 'SF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png', score: 7, record: '11-6', timeouts: 3 },
                        home: { abbr: 'SEA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png', score: 0, record: '9-8', timeouts: 3 },
                        possession: 'home',
                        downDistance: '2nd & 5',
                        fieldPosition: 'SEA 40',
                        yardLine: 40,
                        yardsToGo: 5,
                        possessionOnOwn: true
                    },
                    {
                        id: 'mock6',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '2nd 3:15',
                        away: { abbr: 'LA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png', score: 10, record: '12-5', timeouts: 2 },
                        home: { abbr: 'CAR', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png', score: 7, record: '8-9', timeouts: 3 },
                        possession: 'away',
                        downDistance: '3rd & 3',
                        fieldPosition: 'CAR 42',
                        yardLine: 42,
                        yardsToGo: 3,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock7',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: 'Half',
                        away: { abbr: 'DEN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png', score: 14, record: '10-7', timeouts: 3 },
                        home: { abbr: 'LV', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lv.png', score: 14, record: '9-8', timeouts: 3 }
                    },
                    {
                        id: 'mock8',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '4th 0:30',
                        away: { abbr: 'NYG', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png', score: 20, record: '6-11', timeouts: 0 },
                        home: { abbr: 'WAS', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png', score: 24, record: '11-6', timeouts: 1 },
                        possession: 'away',
                        downDistance: '4th & 15',
                        fieldPosition: 'NYG 25',
                        yardLine: 25,
                        yardsToGo: 15,
                        possessionOnOwn: true
                    }
                ];

                // Limit to selected mock game count from index page
                const mockGameCount = parseInt(localStorage.getItem('gridtv_mock_game_count')) || 8;
                games = games.slice(0, mockGameCount);
            }
        }

        function showEmptyState() {
            document.getElementById('fullscreen-grid').innerHTML = `
                <div class="empty-state">
                    <h2>No Games Selected</h2>
                    <p>${isReceiverMode ? 'Waiting for controller to select games...' : 'Return to TV Home and select games to watch.'}</p>
                </div>
            `;

            // Only auto-redirect in normal mode (not receiver mode)
            if (!isReceiverMode) {
                setTimeout(() => {
                    window.location.href = '/tv-home';
                }, 3000);
            }
        }

        // ============================================
        // SCORE INCREMENT ANIMATION
        // ============================================
        /**
         * Animate a score change with increment display
         * @param {Element} scoreBox - The .fs-sb-score-box element
         * @param {number} oldScore - Previous score value
         * @param {number} newScore - New score value
         */
        function animateScoreIncrement(scoreBox, oldScore, newScore) {
            if (!scoreBox || oldScore === newScore) return;

            const increment = newScore - oldScore;
            if (increment <= 0) return; // Only animate score increases

            const scoreEl = scoreBox.querySelector('.fs-sb-score');
            if (!scoreEl) return;

            // Check if animation is already running
            if (scoreBox.classList.contains('score-animating')) return;

            // Create or get increment element
            let incrementEl = scoreBox.querySelector('.score-increment');
            if (!incrementEl) {
                incrementEl = document.createElement('span');
                incrementEl.className = 'score-increment';
                scoreBox.appendChild(incrementEl);
            }

            // Set increment text
            incrementEl.textContent = `+${increment}`;
            incrementEl.classList.remove('active');

            // Start animation sequence
            scoreBox.classList.add('score-animating');

            // Phase 1: Fade out current score (0-300ms)
            scoreEl.classList.add('score-fading-out');

            // Phase 2: Show increment after score fades (300ms)
            setTimeout(() => {
                incrementEl.classList.add('active');
            }, 300);

            // Phase 3: Update score and fade it in (after increment animation ends at 2.8s)
            // Increment animation is 2.8s, we update score at 2.5s (85% of animation)
            setTimeout(() => {
                scoreEl.textContent = newScore;
                scoreEl.classList.remove('score-fading-out');
                scoreEl.classList.add('score-fading-in');
            }, 2700);

            // Phase 4: Clean up (3.1s total)
            setTimeout(() => {
                scoreEl.classList.remove('score-fading-in');
                scoreBox.classList.remove('score-animating');
                incrementEl.classList.remove('active');
            }, 3100);
        }

        // ============================================
        // NBA SCORER NOTIFICATION SYSTEM
        // ============================================

        /**
         * Check for NBA score changes and trigger scorer notification
         * Handles both teams scoring simultaneously by queuing notifications
         */
        function checkNbaScoreChange(gameId, awayScore, homeScore) {
            const prev = nbaScoreTracker.get(gameId);

            if (!prev) {
                // First time seeing this game, just store the score
                nbaScoreTracker.set(gameId, { away: awayScore, home: homeScore });
                return;
            }

            // Check if score changed
            const awayScored = awayScore > prev.away;
            const homeScored = homeScore > prev.home;

            // Update stored score
            nbaScoreTracker.set(gameId, { away: awayScore, home: homeScore });

            // Queue notifications for each team that scored
            const scoringEvents = [];
            if (awayScored) {
                scoringEvents.push({ team: 'away', points: awayScore - prev.away });
            }
            if (homeScored) {
                scoringEvents.push({ team: 'home', points: homeScore - prev.home });
            }

            if (scoringEvents.length > 0) {
                fetchScoringPlays(gameId, scoringEvents);
            }
        }

        /**
         * Fetch scoring plays from NBA summary API and queue notifications
         */
        async function fetchScoringPlays(gameId, scoringEvents) {
            // Prevent concurrent fetches for the same game
            if (nbaFetchLock.get(gameId)) {
                // Queue the events and let the current fetch handle them
                return;
            }

            nbaFetchLock.set(gameId, true);

            try {
                const response = await fetch(`/api/nba/summary/${gameId}`);
                const data = await response.json();

                if (data._cache && data._cache.retryAfter) {
                    // Cache miss, retry after delay
                    nbaFetchLock.set(gameId, false);
                    setTimeout(() => {
                        fetchScoringPlays(gameId, scoringEvents);
                    }, data._cache.retryAfter * 1000);
                    return;
                }

                // Get all recent scoring plays
                const plays = data.plays || [];
                const recentScoringPlays = [];

                // Collect the last few scoring plays (up to scoringEvents.length + 1)
                const maxPlays = scoringEvents.length + 1;
                for (let i = plays.length - 1; i >= 0 && recentScoringPlays.length < maxPlays; i--) {
                    if (plays[i].scoringPlay && plays[i].scoreValue > 0) {
                        recentScoringPlays.push(plays[i]);
                    }
                }

                // Match scoring events to plays (best effort)
                scoringEvents.forEach((event, index) => {
                    const play = recentScoringPlays[index];
                    const playerName = play ? extractPlayerName(play.text) : 'Score';
                    queueScorerNotification(gameId, event.team, playerName);
                });

            } catch (error) {
                console.error('Error fetching NBA scoring play:', error);
                // Still show generic notifications on error
                scoringEvents.forEach(event => {
                    queueScorerNotification(gameId, event.team, 'Score');
                });
            } finally {
                nbaFetchLock.set(gameId, false);
            }
        }

        /**
         * Queue a scorer notification to play after any current animations
         */
        function queueScorerNotification(gameId, team, playerName) {
            if (!nbaAnimationQueue.has(gameId)) {
                nbaAnimationQueue.set(gameId, { queue: [], isPlaying: false });
            }

            const gameQueue = nbaAnimationQueue.get(gameId);
            gameQueue.queue.push({ team, playerName });

            // Start processing if not already playing
            if (!gameQueue.isPlaying) {
                processAnimationQueue(gameId);
            }
        }

        /**
         * Process the animation queue for a game
         */
        function processAnimationQueue(gameId) {
            const gameQueue = nbaAnimationQueue.get(gameId);
            if (!gameQueue || gameQueue.queue.length === 0) {
                if (gameQueue) gameQueue.isPlaying = false;
                return;
            }

            gameQueue.isPlaying = true;
            const notification = gameQueue.queue.shift();

            // Show the notification (with delay for score animation)
            showScorerNotification(gameId, notification.team, notification.playerName, () => {
                // Process next notification after this one finishes
                processAnimationQueue(gameId);
            });
        }

        /**
         * Extract player name from ESPN play description
         * Example: "Stephen Curry makes 26-foot three point jumper" -> "S. Curry"
         */
        function extractPlayerName(playText) {
            if (!playText) return 'Score';

            // Common patterns: "FirstName LastName makes/misses..."
            const match = playText.match(/^([A-Z][a-z]+(?:\s+[A-Z][a-z'-]+)+)\s+(?:makes|hits|dunks|scores)/i);
            if (match) {
                const fullName = match[1];
                const parts = fullName.split(' ');
                if (parts.length >= 2) {
                    // Return "F. LastName" format
                    return `${parts[0][0]}. ${parts[parts.length - 1]}`;
                }
                return fullName;
            }

            // Try to extract any name at start
            const nameMatch = playText.match(/^([A-Z][a-z]+\s+[A-Z][a-z'-]+)/);
            if (nameMatch) {
                const parts = nameMatch[1].split(' ');
                return `${parts[0][0]}. ${parts[1]}`;
            }

            return 'Score';
        }

        /**
         * Show the scorer notification animation (delayed to appear after score animation)
         * @param {string} gameId - Game ID
         * @param {string} team - 'home' or 'away'
         * @param {string} playerName - Player name to display
         * @param {function} onComplete - Callback when animation finishes
         */
        function showScorerNotification(gameId, team, playerName, onComplete) {
            // Delay notification to appear after score animation finishes (3.1s)
            setTimeout(() => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (!card) {
                    if (onComplete) onComplete();
                    return;
                }

                const notification = card.querySelector(`.nba-scorer-notification.${team}`);
                if (!notification) {
                    if (onComplete) onComplete();
                    return;
                }

                // Only show player name
                notification.textContent = playerName || 'Score';

                notification.classList.remove('animate');
                void notification.offsetWidth;
                notification.classList.add('animate');

                setTimeout(() => {
                    notification.classList.remove('animate');
                    notification.textContent = '';
                    if (onComplete) onComplete();
                }, 3100);
            }, 3100);
        }

        // ============================================
        // RENDER GRID
        // ============================================
        // Update all game cards in place without destroying/recreating DOM
        function updateCardsInPlace() {
            // Check if number of cards matches number of games
            const grid = document.getElementById('fullscreen-grid');
            const existingCards = grid.querySelectorAll('.fullscreen-game-card');

            // If count doesn't match, we need a full re-render
            if (existingCards.length !== games.length) {
                console.log('📺 Game count changed, doing full re-render');
                renderGrid();
                return;
            }

            games.forEach((game, index) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${game.id}"]`);
                if (!card) return;

                const isFootball = game.league === 'nfl' || game.league === 'ncaa';
                const isLive = game.state === 'in';
                const isFinal = game.state === 'post';
                const isUpcoming = game.state === 'pre';

                // Update scores with animation for score increases
                const awayScoreBox = card.querySelector('.fs-sb-score-box.away');
                const homeScoreBox = card.querySelector('.fs-sb-score-box.home');
                const awayScoreEl = awayScoreBox?.querySelector('.fs-sb-score');
                const homeScoreEl = homeScoreBox?.querySelector('.fs-sb-score');

                if (awayScoreEl) {
                    const oldAwayScore = parseInt(awayScoreEl.textContent) || 0;
                    const newAwayScore = isUpcoming ? 0 : (parseInt(game.away.score) || 0);
                    if (!isUpcoming && newAwayScore > oldAwayScore && awayScoreEl.textContent !== '-') {
                        animateScoreIncrement(awayScoreBox, oldAwayScore, newAwayScore);
                    } else {
                        awayScoreEl.textContent = isUpcoming ? '-' : game.away.score;
                    }
                }

                if (homeScoreEl) {
                    const oldHomeScore = parseInt(homeScoreEl.textContent) || 0;
                    const newHomeScore = isUpcoming ? 0 : (parseInt(game.home.score) || 0);
                    if (!isUpcoming && newHomeScore > oldHomeScore && homeScoreEl.textContent !== '-') {
                        animateScoreIncrement(homeScoreBox, oldHomeScore, newHomeScore);
                    } else {
                        homeScoreEl.textContent = isUpcoming ? '-' : game.home.score;
                    }
                }

                // Check for NBA score changes (for scorer notifications)
                if (game.league === 'nba' && isLive) {
                    checkNbaScoreChange(
                        game.id,
                        parseInt(game.away.score) || 0,
                        parseInt(game.home.score) || 0
                    );
                }

                // Update time/period (update ALL clock elements)
                if (game.status) {
                    const parts = parseGameStatus(game.status, game.league);
                    card.querySelectorAll('.fs-sb-time').forEach(timeEl => {
                        timeEl.textContent = parts.time || game.status;
                    });
                    card.querySelectorAll('.fs-sb-time-label').forEach(timeLabelEl => {
                        timeLabelEl.textContent = parts.period || '';
                    });

                    // Update top clock text (for grid-5/6/7/8 smaller cards)
                    const topClockEl = card.querySelector('.fs-top-clock-text');
                    if (topClockEl) {
                        let topClockText = '';
                        if (isFinal) {
                            topClockText = 'FINAL';
                        } else if (isUpcoming) {
                            topClockText = game.status;
                        } else if (parts.period && parts.time) {
                            topClockText = `${parts.period} ${parts.time}`;
                        } else {
                            topClockText = parts.time || game.status;
                        }
                        topClockEl.textContent = topClockText;
                    }
                }

                // Update status text element
                const statusTextEl = card.querySelector('.fs-status-text');
                if (statusTextEl) {
                    statusTextEl.textContent = game.status || '';
                    statusTextEl.className = 'fs-status-text';
                    if (isUpcoming) statusTextEl.classList.add('upcoming');
                    else if (isFinal) statusTextEl.classList.add('final');
                }

                // Update card classes for win/loss state
                card.classList.remove('winning-away', 'winning-home', 'tied', 'upcoming-game', 'final-game');
                if (isUpcoming) {
                    card.classList.add('upcoming-game');
                } else if (isFinal) {
                    card.classList.add('final-game');
                    if (game.away.score > game.home.score) card.classList.add('winning-away');
                    else if (game.home.score > game.away.score) card.classList.add('winning-home');
                    else card.classList.add('tied');
                } else if (isLive) {
                    if (game.away.score > game.home.score) card.classList.add('winning-away');
                    else if (game.home.score > game.away.score) card.classList.add('winning-home');
                    else card.classList.add('tied');
                }

                // Update football-specific elements
                if (isFootball && isLive) {
                    const downDistEl = card.querySelector('.fs-sb-down-distance');
                    const fieldPosEl = card.querySelector('.fs-sb-ball-position');
                    if (downDistEl) downDistEl.textContent = game.downDistance || '';
                    if (fieldPosEl) fieldPosEl.textContent = game.fieldPosition || '';

                    // Update possession indicator
                    const situationBox = card.querySelector('.fs-sb-situation');
                    if (situationBox) {
                        situationBox.classList.remove('possession-away', 'possession-home', 'redzone');
                        if (game.possession === 'away') situationBox.classList.add('possession-away');
                        else if (game.possession === 'home') situationBox.classList.add('possession-home');

                        const isRedZone = game.yardLine && game.yardLine <= 20 && !game.possessionOnOwn;
                        if (isRedZone) situationBox.classList.add('redzone');
                    }

                    // Update ball position on field visualizer
                    if (game.fieldPosition) {
                        updateBallPosition(card, game.fieldPosition, game.yardsToGo || 0, game.possession, game.away, game.home, game.league);
                    }
                }

                // Update MLB-specific elements
                if (game.league === 'mlb') {
                    // Tear down livecast if game is no longer live
                    if (!isLive) {
                        const lcContainer = card.querySelector('.mlb-livecast-container');
                        if (lcContainer) {
                            const livecast = window.mlbLiveCasts.get(game.id);
                            if (livecast && livecast.destroy) livecast.destroy();
                            window.mlbLiveCasts.delete(game.id);
                            lcContainer.remove();
                        }
                    }
                }

                if (game.league === 'mlb' && isLive) {
                    // Update base runners
                    const basesEl = card.querySelector('.mlb-bases');
                    if (basesEl) {
                        basesEl.querySelector('.base.first')?.classList.toggle('occupied', game.onFirst);
                        basesEl.querySelector('.base.second')?.classList.toggle('occupied', game.onSecond);
                        basesEl.querySelector('.base.third')?.classList.toggle('occupied', game.onThird);
                    }

                    // Update hits and errors
                    const awayHitsEl = card.querySelector('.fs-sb-score-box.away .fs-sb-hits');
                    const homeHitsEl = card.querySelector('.fs-sb-score-box.home .fs-sb-hits');
                    if (awayHitsEl) awayHitsEl.textContent = game.away.hits || 0;
                    if (homeHitsEl) homeHitsEl.textContent = game.home.hits || 0;

                    const awayErrorsEl = card.querySelector('.fs-sb-score-box.away .fs-sb-errors');
                    const homeErrorsEl = card.querySelector('.fs-sb-score-box.home .fs-sb-errors');
                    if (awayErrorsEl) awayErrorsEl.textContent = game.away.errors || 0;
                    if (homeErrorsEl) homeErrorsEl.textContent = game.home.errors || 0;
                }
            });
        }

        function renderGrid() {
            const grid = document.getElementById('fullscreen-grid');
            const count = games.length;

            // Set grid class based on count
            grid.className = `fullscreen-grid grid-${count}`;

            // Render cards
            grid.innerHTML = games.map((game, index) => createGameCard(game, index)).join('');

            // Initialize SVG field visualizers for football games
            initFieldVisualizers();

            // Initialize MLB LiveCast for baseball games
            initMLBLiveCasts();

            // Update ball positions for football games
            games.forEach((game, index) => {
                if ((game.league === 'nfl' || game.league === 'ncaa') && game.state === 'in' && game.fieldPosition) {
                    const card = grid.children[index];
                    if (card) {
                        updateBallPosition(card, game.fieldPosition, game.yardsToGo || 0, game.possession, game.away, game.home, game.league);
                    }
                }
            });
        }

        // Initialize SVG field visualizers for all football game cards
        function initFieldVisualizers() {
            // Clear old visualizers
            window.fieldVisualizers.forEach(visualizer => visualizer.destroy());
            window.fieldVisualizers.clear();

            // Find all SVG field containers and initialize visualizers
            document.querySelectorAll('.svg-field-container').forEach(container => {
                const gameId = container.dataset.gameId;
                const isCompressed = container.dataset.compressed === 'true';
                const awayColor = container.dataset.awayColor;
                const homeColor = container.dataset.homeColor;
                const awayAbbr = container.dataset.awayAbbr;
                const homeAbbr = container.dataset.homeAbbr;
                const showEndZoneLogos = container.dataset.showLogos !== 'false';

                const visualizer = new SVGFieldVisualizer(container, {
                    compressed: isCompressed,
                    showGoalPosts: true,
                    showYardNumbers: !isCompressed,
                    showOneYardLines: !isCompressed,
                    showEndZoneLogos: showEndZoneLogos,
                    awayColor: awayColor,
                    homeColor: homeColor,
                    awayAbbr: awayAbbr,
                    homeAbbr: homeAbbr
                });

                window.fieldVisualizers.set(gameId, visualizer);
            });
        }

        // Initialize MLB LiveCast for all baseball game cards
        function initMLBLiveCasts() {
            // Clear old instances
            window.mlbLiveCasts.forEach(livecast => {
                if (livecast.destroy) livecast.destroy();
            });
            window.mlbLiveCasts.clear();

            // Determine current grid count from the fullscreen-grid element
            const gridEl = document.querySelector('.fullscreen-grid');
            let gridCount = 1;
            if (gridEl) {
                const match = [...gridEl.classList].find(c => /^grid-\d+$/.test(c));
                if (match) gridCount = parseInt(match.replace('grid-', ''), 10);
            }

            // Find all MLB livecast containers and initialize
            document.querySelectorAll('.mlb-livecast-container').forEach(container => {
                const gameId = container.dataset.gameId;
                if (gameId && typeof MLBLiveCast !== 'undefined') {
                    try {
                        const livecast = new MLBLiveCast(gameId, container);
                        window.mlbLiveCasts.set(gameId, livecast);

                        // Apply compact class based on grid count
                        const lcEl = container.querySelector('.mlb-livecast');
                        if (lcEl) {
                            lcEl.classList.remove('lc-compact-md', 'lc-compact-sm', 'lc-compact-xs');
                            if (gridCount >= 7) {
                                // For grid-7/8, featured card (first child) gets sm, others get xs
                                const card = container.closest('.fullscreen-game-card');
                                const isFirst = card && card === card.parentElement.firstElementChild;
                                lcEl.classList.add(isFirst ? 'lc-compact-sm' : 'lc-compact-xs');
                            } else if (gridCount >= 5) {
                                lcEl.classList.add('lc-compact-sm');
                            } else if (gridCount >= 3) {
                                lcEl.classList.add('lc-compact-md');
                            }
                        }
                    } catch (error) {
                        console.error(`[MLB LiveCast] Error initializing for game ${gameId}:`, error);
                    }
                }
            });
        }

        function createGameCard(game, index) {
            const isFootball = game.league === 'nfl' || game.league === 'ncaa';
            const isMLB = game.league === 'mlb';
            const isLive = game.state === 'in';
            const isFinal = game.state === 'post';
            const isUpcoming = game.state === 'pre';

            // Determine card state class
            let cardClass = `fullscreen-game-card has-scoreboard fs-${game.league}`;
            if (isUpcoming) {
                cardClass += ' upcoming-game';
            } else if (isFinal) {
                cardClass += ' final-game';
                if (game.away.score > game.home.score) cardClass += ' winning-away';
                else if (game.home.score > game.away.score) cardClass += ' winning-home';
                else cardClass += ' tied';
            } else if (isLive) {
                if (game.away.score > game.home.score) cardClass += ' winning-away';
                else if (game.home.score > game.away.score) cardClass += ' winning-home';
                else cardClass += ' tied';
            }

            // Get league logo
            const leagueLogo = leagueLogos[game.league] || '/assets/logo.png';

            // Get team colors for scoreboard
            const awayColors = getScoreboardColors(game.league, game.away.abbr);
            const homeColors = getScoreboardColors(game.league, game.home.abbr);

            // Parse game status for period and time
            const statusParts = parseGameStatus(game.status, game.league);

            // Determine display values
            const awayScore = isUpcoming ? '-' : game.away.score;
            const homeScore = isUpcoming ? '-' : game.home.score;

            // Format status for display
            let displayStatus = game.status;
            if (isUpcoming && game.startTime) {
                const formatted = formatStartTime(game.startTime);
                if (formatted) displayStatus = formatted;
            }

            // Check if game is in intermission (halftime, end of quarter, etc.)
            const statusLower = (game.status || '').toLowerCase();
            const isIntermission = statusLower.includes('halftime') ||
                statusLower.includes('half') ||
                statusLower.includes('end of') ||
                statusLower.includes('intermission') ||
                statusLower.includes('2nd') && statusLower.includes('0:00') ||
                statusLower.includes('4th') && statusLower.includes('0:00');

            // Build game situation box for NFL/NCAA (hide during intermissions)
            let situationHTML = '';
            if (isFootball && isLive && game.downDistance && !isIntermission) {
                const possession = game.possession === 'away' ? 'possession-away' :
                    game.possession === 'home' ? 'possession-home' : '';
                const isRedZone = game.yardLine && game.yardLine <= 20 && !game.possessionOnOwn;
                const redzone = isRedZone ? 'redzone' : '';
                situationHTML = `
                    <div class="fs-sb-situation ${possession} ${redzone}">
                        <span class="fs-sb-down-distance">${game.downDistance || ''}</span>
                        <div class="fs-sb-situation-divider"></div>
                        <span class="fs-sb-ball-position">${game.fieldPosition || ''}</span>
                    </div>
                `;
            } else if (isFootball && isLive && game.specialPlay && game.specialPlayText && !isIntermission) {
                // Show special play (kickoff, punt, return, etc.) when no down/distance
                const specialClass = `special-play-${game.specialPlay}`;
                situationHTML = `
                    <div class="fs-sb-situation special-play ${specialClass}">
                        <span class="fs-sb-down-distance">${game.specialPlayText}</span>
                    </div>
                `;
            }

            // Build field visualizer for NFL/NCAA (only show when situation box is showing, hide during intermissions)
            let fieldVisualizerHTML = '';

            // MLB diamond visualizer
            if (isMLB && isLive) {
                fieldVisualizerHTML = `
                    <div class="mlb-livecast-container" id="mlb-livecast-${game.id}" data-game-id="${game.id}">
                        <!-- MLB Live Cast will be initialized here -->
                    </div>
                `;
            } else if (isFootball && isLive && game.downDistance && game.fieldPosition && !isIntermission) {
                // Get team primary colors for endzones
                const awayEndzoneColor = awayColors.primary;
                const homeEndzoneColor = homeColors.primary;

                // Always use compressed field for all grids
                const gridCount = games.length;
                const isCompressed = true;
                const fieldClass = isCompressed ? 'field-visualizer field-compressed' : 'field-visualizer';
                // NCAA football games only show team colors in end zones (no logos)
                const showEndZoneLogos = game.league !== 'ncaa';

                // SVG field container - SVGFieldVisualizer will populate this
                fieldVisualizerHTML = `
                    <div class="${fieldClass}">
                        <div class="svg-field-container"
                             style="--away-color: ${awayEndzoneColor}; --home-color: ${homeEndzoneColor};"
                             data-game-id="${game.id}"
                             data-compressed="${isCompressed}"
                             data-away-color="${awayEndzoneColor}"
                             data-home-color="${homeEndzoneColor}"
                             data-away-abbr="${game.away.abbr}"
                             data-home-abbr="${game.home.abbr}"
                             data-show-logos="${showEndZoneLogos}">
                        </div>
                    </div>
                `;
            }

            // Status class
            const statusClass = isUpcoming ? 'upcoming' : isFinal ? 'final' : '';

            // Possession indicator for NFL/NCAA (show football emoji next to team with ball)
            const awayHasPossession = isFootball && isLive && game.possession === 'away';
            const homeHasPossession = isFootball && isLive && game.possession === 'home';

            // Top clock text for grid-7 and grid-8 smaller cards
            let topClockText = '';
            if (isFinal) {
                topClockText = 'FINAL';
            } else if (isUpcoming) {
                topClockText = displayStatus;
            } else {
                // Live game - show period and time on one line
                if (statusParts.period && statusParts.time) {
                    topClockText = `${statusParts.period} ${statusParts.time}`;
                } else {
                    topClockText = statusParts.time || displayStatus;
                }
            }

            return `
                <div class="${cardClass}" data-game-id="${game.id}" data-league="${game.league}">
                    <img class="sport-logo-indicator" src="${leagueLogo}" alt="${game.league.toUpperCase()}">
                    <div class="fullscreen-refresh-indicator"></div>

                    <div class="fs-card-wrapper">
                        <!-- Top Clock (only visible for grid-7/8 smaller cards) -->
                        <div class="fs-top-clock">
                            <span class="fs-top-clock-text">${topClockText}</span>
                        </div>

                        <!-- Scoreboard with logos inside team sections -->
                        <div class="fs-scoreboard" style="--sb-away-primary: ${awayColors.primary}; --sb-away-secondary: ${awayColors.secondary}; --sb-home-primary: ${homeColors.primary}; --sb-home-secondary: ${homeColors.secondary};">
                            <div class="fs-sb-team-section away">
                                <div class="fs-sb-score-box away">
                                    <span class="fs-sb-score">${awayScore}</span>
                                </div>
                                <div class="fs-sb-team-info">
                                    <div class="fs-sb-team-logo">
                                        <img class="fs-sb-team-logo-img" src="${game.away.logo}" alt="${game.away.abbr}" onerror="this.style.display='none'">
                                    </div>
                                    <span class="fs-sb-team-name">${game.away.abbr}</span>
                                    ${game.away.record ? `<span class="fs-sb-team-record">${game.away.record}</span>` : ''}
                                </div>
                                ${isFootball ? `<div class="fs-sb-timeouts away">${createTimeoutBars(game.away.timeouts ?? 3)}</div>` : ''}
                            </div>
                            <div class="fs-sb-center">
                                <div class="fs-sb-time-box">
                                    ${isFinal ? `
                                        <div class="fs-sb-time" style="font-size: clamp(0.8rem, 2.2vmin, 1.1rem);">FINAL</div>
                                    ` : `
                                        <div class="fs-sb-time-label">${statusParts.period || (isUpcoming ? 'STARTS' : '')}</div>
                                        <div class="fs-sb-time">${statusParts.time || displayStatus}</div>
                                    `}
                                </div>
                            </div>
                            <div class="fs-sb-team-section home">
                                ${isFootball ? `<div class="fs-sb-timeouts home">${createTimeoutBars(game.home.timeouts ?? 3)}</div>` : ''}
                                <div class="fs-sb-team-info">
                                    <div class="fs-sb-team-logo">
                                        <img class="fs-sb-team-logo-img" src="${game.home.logo}" alt="${game.home.abbr}" onerror="this.style.display='none'">
                                    </div>
                                    <span class="fs-sb-team-name">${game.home.abbr}</span>
                                    ${game.home.record ? `<span class="fs-sb-team-record">${game.home.record}</span>` : ''}
                                </div>
                                <div class="fs-sb-score-box home">
                                    <span class="fs-sb-score">${homeScore}</span>
                                </div>
                            </div>
                            ${situationHTML}
                        </div>

                        ${fieldVisualizerHTML}

                        ${(game.league === 'nba' && isLive) ? `
                        <!-- NBA Scorer Notifications -->
                        <div class="nba-scorer-notification away" data-team="away"></div>
                        <div class="nba-scorer-notification home" data-team="home"></div>
                        ` : ''}
                    </div>

                    ${(game.league === 'nfl' && isLive) ? `
                    <!-- NFL Stats Modal (shows between plays) -->
                    <div class="nfl-stats-modal" data-game-stats-id="${game.id}">
                        <div class="nfl-stats-modal-header">
                            <span class="nfl-stats-modal-title">Game Stats</span>
                        </div>
                        <div class="nfl-stats-content">
                            <div class="nfl-stats-loading">Loading stats...</div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function createTimeoutBars(timeouts) {
            if (timeouts === undefined) return '';
            const remaining = Math.max(0, Math.min(3, timeouts));
            let bars = '';
            for (let i = 0; i < 3; i++) {
                const usedClass = i >= remaining ? 'used' : '';
                bars += `<div class="fs-sb-timeout-bar ${usedClass}"></div>`;
            }
            return bars;
        }

        function formatStartTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return '';

            const now = new Date();
            const diffMs = date - now;
            const diffMins = Math.round(diffMs / 60000);

            if (diffMins <= 0) return 'Starting';
            if (diffMins < 60) return `${diffMins}m`;

            // Format time in user's local timezone
            const timeStr = date.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });

            // If game is today, just show time
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                return timeStr;
            }

            // Otherwise show day and time
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        // ============================================
        // BALL POSITION CALCULATION (from NFL/NCAA pages)
        // ============================================
        function calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam) {
            if (!fieldPosition) return 50;

            const parts = fieldPosition.trim().split(' ');
            let yardLine;
            let fieldSideAbbr;

            if (parts.length === 1) {
                yardLine = 50;
                fieldSideAbbr = null;
            } else {
                fieldSideAbbr = parts[0];
                yardLine = parseInt(parts[1]);
            }

            const awayAbbr = awayTeam?.abbr || awayTeam?.team?.abbreviation;
            const homeAbbr = homeTeam?.abbr || homeTeam?.team?.abbreviation;

            let absolutePosition;

            if (yardLine === 50 || !fieldSideAbbr) {
                absolutePosition = 50;
            } else if (fieldSideAbbr === awayAbbr) {
                absolutePosition = yardLine;
            } else if (fieldSideAbbr === homeAbbr) {
                absolutePosition = 100 - yardLine;
            } else {
                absolutePosition = 50;
            }

            return Math.max(0, Math.min(100, absolutePosition));
        }

        function updateBallPosition(cardEl, fieldPosition, yardsToGo, possession, awayTeam, homeTeam, league) {
            // Get game ID from card
            const gameId = cardEl.dataset.gameId;
            if (!gameId || !fieldPosition) return;

            // Get SVG visualizer for this game
            const visualizer = window.fieldVisualizers.get(gameId);
            if (!visualizer) return;

            // Get team color for styling
            const possessionTeam = possession === 'away' ? awayTeam : homeTeam;
            const teamColor = possessionTeam?.abbr ? getTeamColor(possessionTeam.abbr, league) : '#3b82f6'; // Blue default

            // Apply team color to situation info (outside the SVG)
            const situationInfo = cardEl.querySelector('.fullscreen-situation-info');
            if (situationInfo) {
                situationInfo.style.color = teamColor;
                situationInfo.style.textShadow = `-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000, 0 0 3px rgba(0, 0, 0, 0.5)`;
            }

            // Calculate ball position (0-100 represents the playable field)
            const ballPosition = calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam);

            // Update SVG visualizer
            visualizer.setBallPosition(ballPosition, teamColor);

            // Calculate and set first down line (hide on Goal situations)
            if (yardsToGo > 0) {
                const possessionIsAway = possession === 'away';
                let firstDownPosition;

                if (possessionIsAway) {
                    firstDownPosition = ballPosition + yardsToGo;
                } else {
                    firstDownPosition = ballPosition - yardsToGo;
                }

                // Clamp to playable field (0-100%)
                firstDownPosition = Math.max(0, Math.min(100, firstDownPosition));
                visualizer.setFirstDownPosition(firstDownPosition, true);
            } else {
                visualizer.setFirstDownPosition(50, false); // Hide first down line
            }
        }

        function getScoreClass(game, team) {
            if (game.state === 'pre') return '';
            const teamData = game[team];
            const opponent = team === 'home' ? game.away : game.home;
            if (teamData.score > opponent.score) return 'winning';
            if (teamData.score < opponent.score) return 'losing';
            return '';
        }

        // ============================================
        // PLAY ANIMATIONS - Using centralized module
        // All animation functions are now loaded from /scripts/play-animations.js
        // ============================================

        // Initialize the centralized animation module's skip timer
        setFullscreenEnteredAt(Date.now());

        // Wrapper for NFL/NCAA play detection that uses centralized analyzeAndAnimatePlay
        function detectPlayEvents(card, game, comp, prevData) {
            if (game.league !== 'nfl' && game.league !== 'ncaa') return;

            const lastPlay = comp?.situation?.lastPlay?.text || '';

            // Debug: Log every call to detectPlayEvents
            console.log('🏈 detectPlayEvents:', {
                gameId: game.id,
                lastPlayPreview: lastPlay.substring(0, 50) + '...',
                prevLastPlay: (prevData.lastPlay || '').substring(0, 50) + '...',
                isDuplicate: prevData.lastPlay === lastPlay
            });

            if (!lastPlay || prevData.lastPlay === lastPlay) return;

            // Skip administrative events that aren't actual football plays
            // These can appear in the API but aren't shown on ESPN's gamecast
            const lowerPlay = lastPlay.toLowerCase();
            const isAdministrativeEvent =
                (lowerPlay.includes('timeout') && !lowerPlay.includes('return')) ||
                lowerPlay.includes('coin toss') ||
                lowerPlay.includes('won the toss') ||
                lowerPlay.includes('delay of game') ||
                lowerPlay.includes('injury') ||
                lowerPlay.includes('review') ||
                lowerPlay.includes('challenge') ||
                lowerPlay.includes('measurement') ||
                lowerPlay.includes('two-minute warning') ||
                lowerPlay.includes('2-minute warning') ||
                lowerPlay.match(/^(official|officials?)\s+(timeout|review)/i);

            if (isAdministrativeEvent) {
                console.log('🏈 Skipping administrative event:', lastPlay.substring(0, 50));
                return;
            }

            const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');
            const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
            const awayAbbr = awayTeam?.team?.abbreviation || '';
            const homeAbbr = homeTeam?.team?.abbreviation || '';

            // Check for special teams plays (kickoff/punt) and animate on field
            const parsedSpecialTeams = parseSpecialTeamsPlay(
                lastPlay,
                prevData.fieldPosition,
                { awayAbbr, homeAbbr }
            );

            if (parsedSpecialTeams) {
                console.log('🏈 Special teams play detected:', parsedSpecialTeams.playType);
                animateSpecialTeamsPlay(card, parsedSpecialTeams, {
                    awayTeam: { team: awayTeam?.team },
                    homeTeam: { team: homeTeam?.team },
                    awayAbbr,
                    homeAbbr
                });
                // Continue to analyzeAndAnimatePlay for other animations (TD on return, etc.)
            }

            // Use centralized analyzeAndAnimatePlay function
            analyzeAndAnimatePlay(card, lastPlay, {
                awayTeam: { team: awayTeam?.team },
                homeTeam: { team: homeTeam?.team },
                awayScoreChange: game.away.score - (prevData.awayScore || 0),
                homeScoreChange: game.home.score - (prevData.homeScore || 0),
                prevDown: prevData.down || 0,
                currentDown: comp?.situation?.down || 0,
                downDistanceText: comp?.situation?.downDistanceText || '',
                prevDownDistance: prevData.downDistanceText || '',
                prevPossession: prevData.possession || null,
                currentPossession: game.possession || null,
                fieldPosition: prevData.fieldPosition || '',  // Field position at START of play for animation
                awayAbbr,
                homeAbbr
            });
        }

        /**
         * Detect NHL play events (goals, penalties, etc.)
         * Placeholder for NHL-specific animations
         */
        function detectNHLPlayEvents(card, game, comp, prevData) {
            if (game.league !== 'nhl') return;

            // For now, just log NHL events - can add animations later
            const situation = comp?.situation;
            const lastPlay = situation?.lastPlay?.text || '';

            if (lastPlay && prevData.lastPlay !== lastPlay) {
                console.log('🏒 NHL Play Event:', {
                    gameId: game.id,
                    lastPlay: lastPlay.substring(0, 80),
                    homeScore: game.home.score,
                    awayScore: game.away.score
                });

                // Update prevData to track this play
                prevData.lastPlay = lastPlay;
            }
        }

        // ============================================
        // NFL STATS MODAL (Between Plays)
        // ============================================
        const gameStatsCache = new Map(); // gameId -> { stats, lastFetch }
        const STATS_CACHE_TTL = 20000; // 20 seconds cache

        async function fetchGameStats(gameId, retryCount = 0) {
            const cached = gameStatsCache.get(gameId);
            const now = Date.now();

            // Return cached stats if still valid
            if (cached && (now - cached.lastFetch) < STATS_CACHE_TTL) {
                return cached.stats;
            }

            try {
                const response = await fetch(`/api/nfl/summary/${gameId}`);
                if (!response.ok) throw new Error('Failed to fetch stats');

                const data = await response.json();

                // Handle server cache miss - retry after delay
                if (data._cache && !data._cache.hit && data._cache.retryAfter && retryCount < 3) {
                    console.log(`[Stats] Cache miss for ${gameId}, retrying in ${data._cache.retryAfter}s...`);
                    await new Promise(resolve => setTimeout(resolve, data._cache.retryAfter * 1000));
                    return fetchGameStats(gameId, retryCount + 1);
                }

                const stats = parseGameStats(data);

                // Only cache if we got valid stats
                if (stats) {
                    gameStatsCache.set(gameId, { stats, lastFetch: now });
                }

                return stats;
            } catch (err) {
                console.error(`Failed to fetch stats for game ${gameId}:`, err);
                return null;
            }
        }

        function parseGameStats(data) {
            const boxscore = data.boxscore;
            if (!boxscore || !boxscore.players) return null;

            const stats = { away: null, home: null };

            // Get home/away team IDs from header
            const competitors = data.header?.competitions?.[0]?.competitors || [];
            const homeTeamId = competitors.find(c => c.homeAway === 'home')?.id;
            const awayTeamId = competitors.find(c => c.homeAway === 'away')?.id;

            boxscore.players.forEach(teamData => {
                // Determine home/away by matching team ID
                const teamId = teamData.team?.id;
                let homeAway = 'away'; // default
                if (teamId === homeTeamId) {
                    homeAway = 'home';
                } else if (teamId === awayTeamId) {
                    homeAway = 'away';
                }

                const teamInfo = {
                    name: teamData.team?.displayName || teamData.team?.abbreviation || '',
                    abbreviation: teamData.team?.abbreviation || '',
                    logo: teamData.team?.logo || '',
                    categories: {}
                };

                // Parse statistics by category
                if (teamData.statistics) {
                    teamData.statistics.forEach(stat => {
                        const category = stat.name?.toLowerCase();
                        if (!category) return;

                        const leaders = [];
                        if (stat.athletes) {
                            stat.athletes.slice(0, 2).forEach(athlete => {
                                if (athlete.athlete && athlete.stats && athlete.stats.length > 0) {
                                    // Build short name: "L. Jackson" format
                                    let name = athlete.athlete.displayName || '';
                                    if (athlete.athlete.firstName && athlete.athlete.lastName) {
                                        name = `${athlete.athlete.firstName.charAt(0)}. ${athlete.athlete.lastName}`;
                                    }
                                    leaders.push({
                                        name: name,
                                        value: formatStatValue(category, athlete.stats)
                                    });
                                }
                            });
                        }

                        if (leaders.length > 0) {
                            teamInfo.categories[category] = leaders;
                        }
                    });
                }

                stats[homeAway] = teamInfo;
            });

            return stats;
        }

        function formatStatValue(category, statsArray) {
            if (!statsArray || statsArray.length === 0) return '';

            // For different categories, format the display value
            switch (category) {
                case 'passing':
                    // C/ATT, YDS, TD-INT format: e.g., "18/25, 245 YDS, 2 TD"
                    if (statsArray.length >= 4) {
                        const cmp = statsArray[0], att = statsArray[1], yds = statsArray[2], td = statsArray[4] || 0;
                        return `${cmp}/${att}, ${yds} YDS, ${td} TD`;
                    }
                    return statsArray[0] || '';
                case 'rushing':
                    // CAR, YDS, TD format: e.g., "15 CAR, 87 YDS, 1 TD"
                    if (statsArray.length >= 3) {
                        return `${statsArray[0]} CAR, ${statsArray[1]} YDS, ${statsArray[3] || 0} TD`;
                    }
                    return statsArray[0] || '';
                case 'receiving':
                    // REC, YDS, TD format: e.g., "5 REC, 78 YDS, 1 TD"
                    if (statsArray.length >= 3) {
                        return `${statsArray[0]} REC, ${statsArray[1]} YDS, ${statsArray[3] || 0} TD`;
                    }
                    return statsArray[0] || '';
                case 'defensive':
                    // TCKL, SACK, INT format
                    if (statsArray.length >= 2) {
                        return `${statsArray[0]} TCKL, ${statsArray[1]} SACK`;
                    }
                    return statsArray[0] || '';
                default:
                    return statsArray[0] || '';
            }
        }

        function renderStatsModal(modal, stats, game, phase = 0) {
            if (!stats || !stats.away || !stats.home) {
                modal.querySelector('.nfl-stats-content').innerHTML = `
                    <div class="nfl-stats-loading">Stats unavailable</div>
                `;
                return;
            }

            const priorityCategories = ['passing', 'rushing', 'receiving'];

            const renderTeamStats = (teamStats, teamData, score) => {
                const categoriesHTML = priorityCategories.map(cat => {
                    const players = teamStats.categories[cat];
                    if (!players || players.length === 0) return '';

                    const categoryTitle = cat.charAt(0).toUpperCase() + cat.slice(1);
                    const playersHTML = players.map(p => `
                        <div class="nfl-stats-player">
                            <span class="nfl-stats-player-name">${p.name}</span>
                            <span class="nfl-stats-player-value">${p.value}</span>
                        </div>
                    `).join('');

                    return `
                        <div class="nfl-stats-category">
                            <div class="nfl-stats-category-title">${categoryTitle}</div>
                            ${playersHTML}
                        </div>
                    `;
                }).join('');

                // Use full team name from stats data, fallback to teamData
                const fullName = teamStats.name || teamData.name || teamData.abbr;

                return `
                    <div class="nfl-stats-team" style="max-width: 100%;">
                        <div class="nfl-stats-team-header">
                            <span class="nfl-stats-team-score">${score}</span>
                            <img class="nfl-stats-team-logo" src="${teamData.logo}" alt="${teamData.abbr}" onerror="this.style.display='none'">
                            <span class="nfl-stats-team-name">${fullName}</span>
                        </div>
                        ${categoriesHTML || '<div class="nfl-stats-loading">No stats yet</div>'}
                    </div>
                `;
            };

            // Phase 0 = away team, Phase 1 = home team
            if (phase === 0) {
                modal.querySelector('.nfl-stats-content').innerHTML = renderTeamStats(stats.away, game.away, game.away.score);
            } else {
                modal.querySelector('.nfl-stats-content').innerHTML = renderTeamStats(stats.home, game.home, game.home.score);
            }
        }

        let statsModalUpdateInProgress = false;

        async function updateStatsModals() {
            // Prevent concurrent updates
            if (statsModalUpdateInProgress) return;
            statsModalUpdateInProgress = true;

            try {
                const now = Date.now();
                const WAIT_BEFORE_SHOW = 30000; // 30 seconds of no play before showing stats
                const PHASE_DURATION = 15000;   // Show each team for 15 seconds (normal play)

                // Halftime-specific timing
                const HALFTIME_PHASE_DURATION = 60000;  // 1 minute per team during halftime
                const HALFTIME_OFF_DURATION = 120000;   // 2 minutes off between cycles during halftime

                for (const game of games) {
                    if (game.league !== 'nfl' || game.state !== 'in') continue;

                    const modal = document.querySelector(`.nfl-stats-modal[data-game-stats-id="${game.id}"]`);
                    if (!modal) continue;

                    // Initialize state for this game if not exists
                    if (!statsModalState.has(game.id)) {
                        statsModalState.set(game.id, {
                            noPlayStartTime: null,
                            isShowingStats: false,
                            showStartTime: null,
                            currentPhase: 0,       // 0 = away team, 1 = home team
                            phaseStartTime: null,
                            cachedStats: null,
                            lastRenderedPhase: -1, // Track what phase was last rendered
                            halftimeCooldownStart: null // Track halftime cooldown period
                        });
                    }

                    const state = statsModalState.get(game.id);

                    // Check if game is specifically at halftime (not just any intermission)
                    const statusLower = (game.status || '').toLowerCase();
                    const isHalftime = statusLower.includes('halftime') ||
                        statusLower === 'half' ||
                        (statusLower.includes('2nd') && statusLower.includes('0:00'));

                    // Check for other intermissions (end of quarters, etc.)
                    const isIntermission = isHalftime ||
                        statusLower.includes('end of') ||
                        statusLower.includes('intermission') ||
                        (statusLower.includes('4th') && statusLower.includes('0:00'));

                    const hasActivePlays = !!game.downDistance && !isIntermission;

                    // Check if there's an active animation playing - hide stats during animations
                    const card = modal.closest('.fullscreen-card');
                    const hasActiveAnimation = card && card.querySelector('.play-animation');
                    if (hasActiveAnimation) {
                        modal.classList.remove('visible');
                        // Continue to manage state timing, but don't show modal during animation
                    }

                    // Use halftime-specific timing if at halftime
                    const phaseDuration = isHalftime ? HALFTIME_PHASE_DURATION : PHASE_DURATION;

                    // If in halftime cooldown period, check if it's over
                    if (state.halftimeCooldownStart && isHalftime) {
                        const cooldownElapsed = now - state.halftimeCooldownStart;
                        if (cooldownElapsed < HALFTIME_OFF_DURATION) {
                            // Still in cooldown - keep modal hidden
                            modal.classList.remove('visible');
                            continue;
                        } else {
                            // Cooldown complete - reset and start new cycle
                            state.halftimeCooldownStart = null;
                            state.noPlayStartTime = now - WAIT_BEFORE_SHOW; // Immediately trigger stats display
                        }
                    }

                    // Reset halftime cooldown if no longer at halftime
                    if (!isHalftime && state.halftimeCooldownStart) {
                        state.halftimeCooldownStart = null;
                    }

                    // If stats are currently showing, manage phase transitions
                    if (state.isShowingStats) {
                        // If a new play started, immediately hide stats
                        if (hasActivePlays) {
                            modal.classList.remove('visible');
                            state.isShowingStats = false;
                            state.showStartTime = null;
                            state.phaseStartTime = null;
                            state.currentPhase = 0;
                            state.cachedStats = null;
                            state.lastRenderedPhase = -1;
                            state.noPlayStartTime = null;
                            continue;
                        }

                        // Re-add visible class if no active play and no animation
                        // (needed because renderGrid recreates the modal element without the class)
                        if (!hasActiveAnimation) {
                            modal.classList.add('visible');
                        }

                        const elapsedPhaseTime = now - state.phaseStartTime;

                        if (elapsedPhaseTime >= phaseDuration) {
                            // Current phase complete
                            if (state.currentPhase === 0) {
                                // Switch to phase 1 (home team)
                                state.currentPhase = 1;
                                state.phaseStartTime = now;
                                state.lastRenderedPhase = 1;
                                if (state.cachedStats) {
                                    renderStatsModal(modal, state.cachedStats, game, 1);
                                }
                            } else {
                                // Both phases complete - hide and reset
                                modal.classList.remove('visible');
                                state.isShowingStats = false;
                                state.showStartTime = null;
                                state.phaseStartTime = null;
                                state.currentPhase = 0;
                                state.cachedStats = null;
                                state.lastRenderedPhase = -1;

                                if (isHalftime) {
                                    // Start halftime cooldown period
                                    state.halftimeCooldownStart = now;
                                    state.noPlayStartTime = null;
                                } else {
                                    state.noPlayStartTime = hasActivePlays ? null : now; // Reset wait timer
                                }
                            }
                        }
                        // Keep showing current phase
                        continue;
                    }

                    // Stats are not currently showing
                    if (hasActivePlays) {
                        // Play is active - reset the no-play timer
                        state.noPlayStartTime = null;
                        modal.classList.remove('visible');
                    } else {
                        // No active play - start or continue the wait timer
                        if (!state.noPlayStartTime) {
                            state.noPlayStartTime = now;
                        }

                        const waitedTime = now - state.noPlayStartTime;
                        // At halftime, start showing immediately (no wait period needed)
                        const waitTime = isHalftime ? 0 : WAIT_BEFORE_SHOW;

                        if (waitedTime >= waitTime) {
                            // Show the stats modal
                            state.isShowingStats = true;
                            state.showStartTime = now;
                            state.phaseStartTime = now;
                            state.currentPhase = 0; // Start with away team
                            state.lastRenderedPhase = 0;
                            modal.classList.add('visible');

                            // Fetch and cache stats
                            const stats = await fetchGameStats(game.id);
                            if (stats) {
                                state.cachedStats = stats;
                                renderStatsModal(modal, stats, game, 0); // Phase 0 = away team
                            }
                        }
                        // Otherwise keep waiting (modal stays hidden)
                    }
                }
            } finally {
                statsModalUpdateInProgress = false;
            }
        }

        // ============================================
        // AUTO-REFRESH
        // ============================================
        let prevGameData = new Map(); // Store previous game state for animation detection
        let isFirstRefresh = true; // Skip animations on first refresh (data baseline)

        // ============================================
        // TV PERFORMANCE OPTIMIZATIONS
        // ============================================

        // Debounced localStorage writes - prevents synchronous I/O blocking main thread
        let localStorageWriteTimeout = null;
        const LOCALSTORAGE_DEBOUNCE_MS = 5000; // Write at most every 5 seconds

        function debouncedLocalStorageSave() {
            if (localStorageWriteTimeout) {
                clearTimeout(localStorageWriteTimeout);
            }
            localStorageWriteTimeout = setTimeout(() => {
                try {
                    localStorage.setItem('gridtv_sports_bar_games', JSON.stringify(games));
                } catch (e) {
                    console.warn('[SportsBar] localStorage write failed:', e);
                }
                localStorageWriteTimeout = null;
            }, LOCALSTORAGE_DEBOUNCE_MS);
        }

        // Clean up finished games from prevGameData to prevent memory leak
        function cleanupFinishedGameData() {
            const activeGameIds = new Set(games.map(g => g.id));
            let cleanedCount = 0;

            for (const [gameId] of prevGameData) {
                if (!activeGameIds.has(gameId)) {
                    prevGameData.delete(gameId);
                    // Also clean up animation queues if they exist
                    if (typeof animationQueues !== 'undefined' && animationQueues.has(gameId)) {
                        animationQueues.delete(gameId);
                    }
                    cleanedCount++;
                }
            }

            if (cleanedCount > 0) {
                console.log(`[SportsBar] Cleaned up ${cleanedCount} finished game(s) from memory`);
            }
        }

        function startAutoRefresh() {
            // Initialize Socket.io for real-time updates
            initGameSocketForSportsBar();

            // Keep a slow polling fallback (every 60 seconds) as safety net
            refreshInterval = setInterval(() => {
                if (!gameSocket.isConnected()) {
                    refreshGameData();
                }
            }, 60000);
        }

        // Track if GameSocket is initialized for Sports Bar
        let sportsBarGameSocketInitialized = false;

        /**
         * Initialize GameSocket for real-time game updates on Sports Bar
         */
        async function initGameSocketForSportsBar() {
            if (sportsBarGameSocketInitialized) return;
            sportsBarGameSocketInitialized = true;

            try {
                await gameSocket.connect();

                // Get unique leagues from displayed games
                const displayedLeagues = [...new Set(games.map(g => g.league))];
                await gameSocket.subscribe(displayedLeagues);

                // Handle updates
                gameSocket.onUpdate('all', (sport, data, cacheKey, timestamp) => {
                    console.log(`[SportsBar] Received ${sport} update`);
                    handlePushedGameUpdate(sport, data);
                });

                // Fallback handler
                window.addEventListener('gamesocket:fallback-poll', () => {
                    console.log('[SportsBar] Fallback polling triggered');
                    refreshGameData();
                });

                console.log('[SportsBar] GameSocket initialized for real-time updates');

            } catch (error) {
                console.error('[SportsBar] GameSocket failed, using polling:', error);
                refreshInterval = setInterval(refreshGameData, 10000);
            }
        }

        /**
         * Handle pushed game updates for a specific sport
         */
        function handlePushedGameUpdate(sport, data) {
            const events = data.events || [];

            // Queue for animations to apply after render
            const pendingAnimations = [];

            // Filter to only games we're displaying for this sport
            const displayedGamesOfSport = games.filter(g => g.league === sport && g.state !== 'post');

            if (displayedGamesOfSport.length === 0) {
                return; // No active games of this sport to update
            }

            displayedGamesOfSport.forEach(game => {
                const gameNumericId = game.id.includes(':') ? game.id.split(':')[1] : game.id;
                const updated = events.find(e => e.id === gameNumericId);

                if (updated) {
                    // Store previous data for animation detection
                    const prevData = prevGameData.get(game.id) || {};

                    // Update game from event
                    updateGameFromEvent(game, updated);

                    // Store current state for next comparison
                    const comp = updated.competitions?.[0];
                    prevGameData.set(game.id, {
                        awayScore: game.away.score,
                        homeScore: game.home.score,
                        lastPlay: comp?.situation?.lastPlay?.text || '',
                        down: comp?.situation?.down || 0,
                        possession: game.possession || null,
                        downDistanceText: comp?.situation?.downDistanceText || '',
                        fieldPosition: game.fieldPosition || null
                    });

                    // Queue animation detection for after render (NFL, NCAA football, and NHL)
                    if (!isFirstRefresh && (sport === 'nfl' || sport === 'ncaa' || sport === 'nhl')) {
                        pendingAnimations.push({ gameId: game.id, game, comp, prevData, league: sport });
                    }
                }
            });

            // After first update, enable animations
            if (isFirstRefresh) {
                isFirstRefresh = false;
                console.log('[SportsBar] First update complete - animations now enabled');
            }

            // Preserve any active play text modals before re-render
            const activePlayTextModals = new Map();
            document.querySelectorAll('.play-text-modal').forEach(modal => {
                const card = modal.closest('.fullscreen-game-card');
                if (card && !modal.classList.contains('fade-out')) {
                    const gameId = card.dataset.gameId;
                    const createdAt = parseInt(modal.dataset.createdAt) || 0;
                    const duration = parseInt(modal.dataset.duration) || 15000;
                    const elapsed = Date.now() - createdAt;
                    const remaining = duration - elapsed;

                    if (remaining > 1000) {
                        activePlayTextModals.set(gameId, {
                            modal: modal.cloneNode(true),
                            remaining: remaining
                        });
                    }
                }
            });

            // Update cards in place
            updateCardsInPlace();

            // Restore play text modals
            activePlayTextModals.forEach(({ modal, remaining }, gameId) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    card.style.position = 'relative';
                    card.appendChild(modal);

                    setTimeout(() => {
                        modal.classList.add('fade-out');
                        setTimeout(() => {
                            modal.remove();
                        }, 1500);
                    }, remaining);
                }
            });

            // Apply pending animations
            pendingAnimations.forEach(({ gameId, game, comp, prevData, league }) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    if (league === 'nhl') {
                        detectNHLPlayEvents(card, game, comp, prevData);
                    } else {
                        detectPlayEvents(card, game, comp, prevData);
                    }
                }
            });

            // Update stats modals
            updateStatsModals();

            // TV Performance: Debounced localStorage write
            debouncedLocalStorageSave();

            // Clean up memory from finished games
            cleanupFinishedGameData();

            // Check if all games are finished
            const activeGames = games.filter(g => g.state !== 'post');
            if (activeGames.length === 0) {
                console.log('[SportsBar] All games finished - stopping updates');
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                gameSocket.disconnect();
            }
        }

        async function refreshGameData() {
            const apiEndpoints = {
                'nfl': '/api/nfl/scoreboard',
                'nba': '/api/nba/scoreboard',
                'mlb': '/api/mlb/scoreboard',
                'nhl': '/api/nhl/scoreboard',
                'ncaa': '/api/ncaa/scoreboard',
                'ncaab': '/api/ncaab/scoreboard'
            };

            // Queue for animations to apply after render
            const pendingAnimations = [];

            // Only refresh games that aren't finished (live or upcoming)
            const activeGames = games.filter(g => g.state !== 'post');

            // If all games are finished, stop refreshing
            if (activeGames.length === 0) {
                console.log('📺 All games finished - stopping auto-refresh');
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                return;
            }

            // Group active games by league to minimize API calls
            const gamesByLeague = {};
            activeGames.forEach(game => {
                if (!gamesByLeague[game.league]) {
                    gamesByLeague[game.league] = [];
                }
                gamesByLeague[game.league].push(game);
            });

            // Fetch updates only for leagues with active games
            for (const league of Object.keys(gamesByLeague)) {
                try {
                    const response = await fetch(apiEndpoints[league]);
                    if (!response.ok) continue;

                    const data = await response.json();
                    const events = data.events || [];

                    // Update game objects with fresh data
                    gamesByLeague[league].forEach(game => {
                        // Extract numeric ID from game (handles both "401547643" and "nfl:401547643" formats)
                        const gameNumericId = game.id.includes(':') ? game.id.split(':')[1] : game.id;
                        let updated = events.find(e => e.id === gameNumericId);

                        // MLB fallback: match by team abbreviations (handles stale ESPN IDs in localStorage)
                        if (!updated && league === 'mlb') {
                            updated = events.find(e => {
                                const comps = e.competitions?.[0]?.competitors || e.competitors || [];
                                const abbrs = comps.map(c => c.team?.abbreviation);
                                return abbrs.includes(game.away.abbr) && abbrs.includes(game.home.abbr);
                            });
                            if (updated) {
                                // Migrate game.id to Statsapi gamePk so future refreshes work by ID
                                game.id = updated.id;
                                // Update livecast container's data-game-id too
                                const lcContainer = document.getElementById(`mlb-livecast-${gameNumericId}`);
                                if (lcContainer) {
                                    lcContainer.id = `mlb-livecast-${updated.id}`;
                                    lcContainer.dataset.gameId = updated.id;
                                    initMLBLiveCasts();
                                }
                            }
                        }
                        if (updated) {
                            // Store previous data for animation detection
                            const prevData = prevGameData.get(game.id) || {};

                            // Update game from event
                            updateGameFromEvent(game, updated);

                            // Store current state for next comparison
                            const comp = updated.competitions?.[0];
                            prevGameData.set(game.id, {
                                awayScore: game.away.score,
                                homeScore: game.home.score,
                                lastPlay: comp?.situation?.lastPlay?.text || '',
                                down: comp?.situation?.down || 0,
                                possession: game.possession || null,
                                downDistanceText: comp?.situation?.downDistanceText || '',
                                fieldPosition: game.fieldPosition || null
                            });

                            // Queue animation detection for after render (NFL, NCAA football, and NHL)
                            // Skip on first refresh to avoid triggering animations for old plays
                            if (!isFirstRefresh && (league === 'nfl' || league === 'ncaa' || league === 'nhl')) {
                                pendingAnimations.push({ gameId: game.id, game, comp, prevData, league });
                            }
                        }
                    });
                } catch (err) {
                    console.error(`Failed to refresh ${league} games:`, err);
                }
            }

            // Preserve any active play text modals before re-render (with timing info)
            const activePlayTextModals = new Map();
            document.querySelectorAll('.play-text-modal').forEach(modal => {
                const card = modal.closest('.fullscreen-game-card');
                if (card && !modal.classList.contains('fade-out')) {
                    const gameId = card.dataset.gameId;
                    const createdAt = parseInt(modal.dataset.createdAt) || 0;
                    const duration = parseInt(modal.dataset.duration) || 15000;
                    const elapsed = Date.now() - createdAt;
                    const remaining = duration - elapsed;

                    // Only preserve if there's still time remaining
                    if (remaining > 1000) {
                        activePlayTextModals.set(gameId, {
                            modal: modal.cloneNode(true),
                            remaining: remaining
                        });
                    }
                }
            });

            // Update cards in place instead of full re-render to avoid flickering
            updateCardsInPlace();

            // Note: No need to restore play text modals since we're not destroying cards
            // But keep restoration logic as fallback if renderGrid() was called
            activePlayTextModals.forEach(({ modal, remaining }, gameId) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    card.style.position = 'relative';
                    card.appendChild(modal);

                    // Set up new timeout for remaining duration
                    setTimeout(() => {
                        modal.classList.add('fade-out');
                        setTimeout(() => {
                            modal.remove();
                        }, 1500);
                    }, remaining);
                }
            });

            // Apply pending animations AFTER render so cards exist in DOM
            pendingAnimations.forEach(({ gameId, game, comp, prevData, league }) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    if (league === 'nhl') {
                        detectNHLPlayEvents(card, game, comp, prevData);
                    } else {
                        detectPlayEvents(card, game, comp, prevData);
                    }
                }
            });

            // Update stats modals for NFL games (show/hide based on play state)
            updateStatsModals();

            // TV Performance: Debounced localStorage write
            debouncedLocalStorageSave();

            // Clean up memory from finished games
            cleanupFinishedGameData();

            // After first refresh, enable animations for subsequent refreshes
            if (isFirstRefresh) {
                isFirstRefresh = false;
                console.log('📺 First refresh complete - animations now enabled');
            }
        }

        function updateGameFromEvent(game, event) {
            const comp = event.competitions?.[0];
            if (!comp) return;

            game.state = comp.status?.type?.state || event.status?.type?.state;
            game.status = comp.status?.type?.shortDetail || game.status;

            // Update scores
            const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
            const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');

            if (homeTeam) {
                game.home.score = parseInt(homeTeam.score || 0);
                game.home.winner = homeTeam.winner || false;
            }
            if (awayTeam) {
                game.away.score = parseInt(awayTeam.score || 0);
                game.away.winner = awayTeam.winner || false;
            }

            // MLB-specific data
            if (game.league === 'mlb') {
                const situation = comp.situation;

                // Get hits and errors from competitors
                if (homeTeam) {
                    game.home.hits = parseInt(homeTeam.hits || 0);
                    game.home.errors = parseInt(homeTeam.errors || 0);
                }
                if (awayTeam) {
                    game.away.hits = parseInt(awayTeam.hits || 0);
                    game.away.errors = parseInt(awayTeam.errors || 0);
                }

                if (situation) {
                    // Balls, strikes, outs
                    game.balls = situation.balls || 0;
                    game.strikes = situation.strikes || 0;
                    game.outs = situation.outs || 0;

                    // Runners on base
                    game.onFirst = situation.onFirst || false;
                    game.onSecond = situation.onSecond || false;
                    game.onThird = situation.onThird || false;

                    // Current batter/pitcher
                    game.batter = situation.batter?.athlete?.shortName || situation.batter?.athlete?.displayName || '';
                    game.pitcher = situation.pitcher?.athlete?.shortName || situation.pitcher?.athlete?.displayName || '';

                    // Inning info from period
                    const period = comp.status?.period || 1;
                    const periodType = situation.periodType || comp.status?.type?.detail?.toLowerCase() || '';
                    game.inning = period;
                    game.inningHalf = periodType.includes('bot') ? 'Bot' : 'Top';
                } else {
                    // Clear MLB-specific data if no situation
                    game.balls = 0;
                    game.strikes = 0;
                    game.outs = 0;
                    game.onFirst = false;
                    game.onSecond = false;
                    game.onThird = false;
                    game.batter = '';
                    game.pitcher = '';
                }
            }

            // Football-specific data (NFL and NCAA)
            if (game.league === 'nfl' || game.league === 'ncaa') {
                const situation = comp.situation;

                if (situation) {
                    // Check if game is in intermission (halftime, end of quarter)
                    // During intermission, possession and possessionText are not present
                    const lastPlayType = situation.lastPlay?.type?.text?.toLowerCase() || '';
                    const isIntermission = !situation.possession ||
                        lastPlayType.includes('end of half') ||
                        lastPlayType.includes('end of quarter') ||
                        lastPlayType.includes('end quarter');

                    // Possession
                    const possessionTeamId = situation.possession;
                    if (possessionTeamId) {
                        if (homeTeam && possessionTeamId === homeTeam.id) {
                            game.possession = 'home';
                        } else if (awayTeam && possessionTeamId === awayTeam.id) {
                            game.possession = 'away';
                        }
                    } else {
                        game.possession = null;
                    }

                    // Down and distance - use full text from API which includes field position
                    // Validate that down is 1-4 and distance is positive
                    // Don't set during intermissions (halftime, end of quarter)
                    const isValidDown = situation.down >= 1 && situation.down <= 4;
                    const isValidDistance = situation.distance > 0;

                    // Yard line and field position - set these first as they're needed for fallbacks
                    game.yardLine = situation.yardLine;
                    game.yardsToGo = situation.distance > 0 ? situation.distance : 0;
                    game.possessionOnOwn = situation.isRedZone === false; // Rough approximation

                    if (isIntermission) {
                        // Clear down/distance during intermissions
                        game.downDistance = null;
                        game.fieldPosition = null;
                    } else if (situation.downDistanceText && !situation.downDistanceText.includes('-1') && isValidDown) {
                        game.downDistance = situation.downDistanceText;
                    } else if (situation.shortDownDistanceText && !situation.shortDownDistanceText.includes('-1') && isValidDown) {
                        game.downDistance = situation.shortDownDistanceText;
                    } else if (isValidDown && isValidDistance) {
                        // Build manual downDistance if we have valid down/distance (don't require possessionText)
                        // This ensures 1st down of new drives is captured immediately
                        const downSuffix = getDownSuffix(situation.down);
                        game.downDistance = `${situation.down}${downSuffix} & ${situation.distance}`;
                    } else {
                        game.downDistance = null;
                    }

                    // Field position text
                    if (situation.possessionText && !isIntermission) {
                        game.fieldPosition = situation.possessionText;
                    } else if (isIntermission) {
                        game.fieldPosition = null;
                    } else if (game.downDistance && !isIntermission) {
                        // Fallback: extract field position from downDistanceText if possessionText not available
                        // Format: "1st & 10 at PIT 35" -> "PIT 35"
                        const atMatch = game.downDistance.match(/at\s+([A-Z]{2,4}\s+\d+)/i);
                        if (atMatch) {
                            game.fieldPosition = atMatch[1];
                        } else if (situation.yardLine && game.possession) {
                            // Build field position from yardLine and possession
                            const possessionTeam = game.possession === 'home' ? homeTeam : awayTeam;
                            const opposingTeam = game.possession === 'home' ? awayTeam : homeTeam;
                            const possessionAbbr = possessionTeam?.team?.abbreviation || '';
                            const opposingAbbr = opposingTeam?.team?.abbreviation || '';

                            if (situation.yardLine <= 50) {
                                const isOnOpponentSide = situation.isRedZone ||
                                    (situation.yardLine <= 20 && !game.possessionOnOwn);
                                const sideAbbr = isOnOpponentSide ? opposingAbbr : possessionAbbr;
                                game.fieldPosition = `${sideAbbr} ${situation.yardLine}`;
                            }
                        }
                    }

                    // Timeouts
                    if (homeTeam) {
                        const homeLinescores = homeTeam.linescores;
                        game.home.timeouts = extractTimeouts(homeTeam, situation, 'home');
                    }
                    if (awayTeam) {
                        game.away.timeouts = extractTimeouts(awayTeam, situation, 'away');
                    }

                    // Store last play text for kickoff/return/punt display
                    const lastPlayText = situation.lastPlay?.text || '';
                    game.lastPlayText = lastPlayText;

                    // Detect special plays (kickoff, punt, return) when no down/distance
                    if (!game.downDistance && lastPlayText && !isIntermission) {
                        const lowerPlay = lastPlayText.toLowerCase();
                        if (lowerPlay.includes('kickoff') || lowerPlay.includes('kicks off')) {
                            game.specialPlay = 'kickoff';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'kickoff');
                        } else if (lowerPlay.includes('punt')) {
                            game.specialPlay = 'punt';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'punt');
                        } else if (lowerPlay.includes('return') || lowerPlay.includes('returned')) {
                            game.specialPlay = 'return';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'return');
                        } else if (lowerPlay.includes('touchback')) {
                            game.specialPlay = 'touchback';
                            game.specialPlayText = 'Touchback';
                        } else if (lowerPlay.includes('fair catch')) {
                            game.specialPlay = 'faircatch';
                            game.specialPlayText = 'Fair Catch';
                        } else if (lowerPlay.includes('extra point') || lowerPlay.includes('pat ')) {
                            game.specialPlay = 'xp';
                            game.specialPlayText = lowerPlay.includes('good') ? 'XP Good' : 'Extra Point';
                        } else if (lowerPlay.includes('two-point') || lowerPlay.includes('2-pt') || lowerPlay.includes('2 pt')) {
                            game.specialPlay = '2pt';
                            game.specialPlayText = '2-Pt Conversion';
                        } else if (lowerPlay.includes('field goal')) {
                            game.specialPlay = 'fg';
                            game.specialPlayText = lowerPlay.includes('good') ? 'FG Good' : 'Field Goal';
                        } else {
                            game.specialPlay = null;
                            game.specialPlayText = null;
                        }
                    } else {
                        game.specialPlay = null;
                        game.specialPlayText = null;
                    }
                } else {
                    // Clear football-specific data if no situation
                    game.possession = null;
                    game.downDistance = null;
                    game.yardLine = undefined;
                    game.fieldPosition = null;
                    game.lastPlayText = null;
                    game.specialPlay = null;
                    game.specialPlayText = null;
                }
            }
        }

        function getDownSuffix(down) {
            switch (down) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function extractSpecialPlayText(playText, playType) {
            // Create a short summary of the special play
            const lowerPlay = playText.toLowerCase();

            if (playType === 'kickoff') {
                // Extract yards if available: "kicks off 65 yards"
                const yardMatch = playText.match(/kicks?\s*off\s*(\d+)\s*yard/i);
                if (yardMatch) {
                    return `Kickoff ${yardMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchback')) {
                    return 'Kickoff - Touchback';
                }
                if (lowerPlay.includes('out of bounds') || lowerPlay.includes('out-of-bounds')) {
                    return 'Kickoff OOB';
                }
                return 'Kickoff';
            }

            if (playType === 'punt') {
                const yardMatch = playText.match(/punts?\s*(\d+)\s*yard/i);
                if (yardMatch) {
                    if (lowerPlay.includes('touchback')) {
                        return `Punt ${yardMatch[1]} yds - TB`;
                    }
                    if (lowerPlay.includes('fair catch')) {
                        return `Punt ${yardMatch[1]} yds - FC`;
                    }
                    return `Punt ${yardMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchback')) {
                    return 'Punt - Touchback';
                }
                if (lowerPlay.includes('fair catch')) {
                    return 'Punt - Fair Catch';
                }
                return 'Punt';
            }

            if (playType === 'return') {
                // Try to find return yards
                const returnMatch = playText.match(/return(?:ed|s)?\s*(?:for\s*)?(\d+)\s*yard/i);
                if (returnMatch) {
                    if (lowerPlay.includes('touchdown')) {
                        return `Return TD (${returnMatch[1]} yds)`;
                    }
                    return `Return ${returnMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchdown')) {
                    return 'Return TD';
                }
                if (lowerPlay.includes('kickoff')) {
                    return 'Kick Return';
                }
                if (lowerPlay.includes('punt')) {
                    return 'Punt Return';
                }
                return 'Return';
            }

            return playType.charAt(0).toUpperCase() + playType.slice(1);
        }

        function extractTimeouts(team, situation, homeAway) {
            // Try to get timeouts from situation
            if (situation) {
                if (homeAway === 'home' && situation.homeTimeouts !== undefined) {
                    return situation.homeTimeouts;
                }
                if (homeAway === 'away' && situation.awayTimeouts !== undefined) {
                    return situation.awayTimeouts;
                }
            }
            // Default to 3 if not available
            return 3;
        }

        // ============================================
        // EXIT MODAL
        // ============================================
        function showExitModal() {
            isModalOpen = true;
            document.getElementById('exit-modal').classList.add('visible');
            document.getElementById('back-btn').classList.remove('focused');
            setModalFocus(0);
        }

        function hideExitModal() {
            isModalOpen = false;
            document.getElementById('exit-modal').classList.remove('visible');
            document.getElementById('back-btn').classList.add('focused');
            document.getElementById('back-btn').focus();
        }

        function setModalFocus(index) {
            modalFocusIndex = index;
            const confirmBtn = document.getElementById('confirm-exit');
            const cancelBtn = document.getElementById('cancel-exit');

            confirmBtn.classList.remove('focused');
            cancelBtn.classList.remove('focused');

            if (index === 0) {
                confirmBtn.classList.add('focused');
                confirmBtn.focus();
            } else {
                cancelBtn.classList.add('focused');
                cancelBtn.focus();
            }
        }

        function confirmExit() {
            // Clear refresh interval
            if (refreshInterval) clearInterval(refreshInterval);

            // Navigate back to TV Home with selections preserved
            window.location.href = '/tv-home?restoreSelections=1';
        }

        // ============================================
        // KEYBOARD NAVIGATION
        // ============================================
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', handleKeyDown);

            // Click handlers (skip in receiver mode - handled by initReceiverMode)
            if (!isReceiverMode) {
                document.getElementById('back-btn').addEventListener('click', showExitModal);
                document.getElementById('confirm-exit').addEventListener('click', confirmExit);
                document.getElementById('cancel-exit').addEventListener('click', hideExitModal);
            }
        }

        function handleKeyDown(e) {
            if (isModalOpen) {
                handleModalKeyDown(e);
            } else {
                handleMainKeyDown(e);
            }
        }

        function handleMainKeyDown(e) {
            const isEnterKey = e.key === 'Enter' || e.key === ' ' ||
                e.keyCode === 13 || e.keyCode === 66 || e.keyCode === 23;
            const isBackKey = e.key === 'Escape' || e.key === 'GoBack' ||
                e.keyCode === 27 || e.keyCode === 4;

            if (isEnterKey || isBackKey) {
                e.preventDefault();
                showExitModal();
            }
        }

        function handleModalKeyDown(e) {
            const isEnterKey = e.key === 'Enter' || e.key === ' ' ||
                e.keyCode === 13 || e.keyCode === 66 || e.keyCode === 23;
            const isBackKey = e.key === 'Escape' || e.key === 'GoBack' ||
                e.keyCode === 27 || e.keyCode === 4;

            switch (e.key) {
                case 'ArrowLeft':
                case 'Left':
                    e.preventDefault();
                    setModalFocus(0);
                    break;

                case 'ArrowRight':
                case 'Right':
                    e.preventDefault();
                    setModalFocus(1);
                    break;
            }

            if (isEnterKey) {
                e.preventDefault();
                if (modalFocusIndex === 0) {
                    confirmExit();
                } else {
                    hideExitModal();
                }
            }

            if (isBackKey) {
                e.preventDefault();
                hideExitModal();
            }
        }
    </script>
</body>

</html>