<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GridTV Sports - Sports Bar</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <!-- Scoreboard Typography -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600;700&display=swap">
    <link rel="stylesheet" href="/styles/fullscreen-cards.css">
    <link rel="stylesheet" href="/styles/tablet-fullscreen.css">
    <link rel="stylesheet" href="/styles/play-animations.css">
    <link rel="stylesheet" href="/styles/mlb-livecast.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/scripts/game-socket.js"></script>
    <script src="/scripts/play-animations.js?v=4"></script>
    <script src="/scripts/field-visualizer-svg.js?v=3"></script>
    <script src="/scripts/play-replay-engine.js?v=6"></script>
    <script src="/scripts/mlb-strike-zone.js"></script>
    <script src="/scripts/mlb-livecast.js"></script>
    <style>
        /* ================================ */
        /* SPORTS BAR MODE - RESPONSIVE     */
        /* ================================ */
        :root {
            /* Colors */
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --success: #22c55e;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #334155;

            /* Desktop defaults */
            --margin-h: 24px;
            --margin-v: 16px;
            --gutter: 12px;
            --card-radius: 12px;
            --touch-target: 44px;

            /* ═══════════════════════════════════════════════════════════════
               NEW SCOREBOARD SYSTEM VARIABLES (from scoreboard-variables.css)
               Premium Broadcast Graphics Design System
               ═══════════════════════════════════════════════════════════════ */

            /* Typography */
            --sb-font-score: 'Oswald', 'Impact', 'Arial Black', sans-serif;
            --sb-font-display: 'Oswald', 'Roboto Condensed', 'Arial Narrow', sans-serif;
            --sb-font-body: system-ui, -apple-system, 'Segoe UI', sans-serif;
            --sb-font-mono: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
            --sb-score-weight: 700;
            --sb-score-letter-spacing: -0.02em;
            --sb-team-weight: 600;
            --sb-team-letter-spacing: 0.04em;

            /* Geometric angles */
            --sb-skew-angle: -4deg;

            /* Metallic accent gradients */
            --sb-chrome-gradient: linear-gradient(135deg, #e8e8e8 0%, #b8b8b8 50%, #e0e0e0 100%);
            --sb-gold-gradient: linear-gradient(135deg, #f0d78c 0%, #c9943d 50%, #e8c860 100%);

            /* Shadows */
            --sb-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.4);
            --sb-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.5);
            --sb-shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.6);
            --sb-shadow-score: 0 2px 8px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 0, 0, 0.3);

            /* Status colors */
            --sb-live-color: #ef4444;
            --sb-live-glow: rgba(239, 68, 68, 0.6);

            /* Animation timing */
            --sb-transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --sb-transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --sb-transition-bounce: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
            --sb-score-pop-duration: 400ms;
            --sb-score-pop-scale: 1.15;
        }

        /* Tablet (768px - 1024px) */
        @media (max-width: 1024px) {
            :root {
                --margin-h: 16px;
                --margin-v: 12px;
                --gutter: 10px;
                --card-radius: 10px;
            }
        }

        /* Mobile (up to 767px) */
        @media (max-width: 767px) {
            :root {
                --margin-h: 12px;
                --margin-v: 8px;
                --gutter: 8px;
                --card-radius: 8px;
            }
        }

        /* Small mobile (up to 375px) */
        @media (max-width: 375px) {
            :root {
                --margin-h: 8px;
                --margin-v: 6px;
                --gutter: 6px;
                --card-radius: 6px;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            background: var(--bg-primary);
            font-family: Roboto, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--text-primary);
            -webkit-overflow-scrolling: touch;
        }

        /* Container Overrides for TV */
        .fullscreen-container {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        .fullscreen-grid {
            height: 100vh;
            padding: 20px;
            width: 100%;
        }

        /* ================================ */
        /* DESKTOP RESPONSIVE GRID LAYOUTS  */
        /* ================================ */

        /* Desktop (default) - Full grid layouts */
        .fullscreen-grid.grid-1 {
            padding: 24px;
        }

        .fullscreen-grid.grid-2 {
            gap: 16px;
            padding: 20px;
        }

        .fullscreen-grid.grid-3,
        .fullscreen-grid.grid-4 {
            gap: 14px;
            padding: 18px;
        }

        /* Grid 3 - Make bottom card same width as top cards, centered */
        .fullscreen-grid.grid-3 {
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(1) {
            grid-column: 1 / 3;
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(2) {
            grid-column: 3 / 5;
        }

        .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(3) {
            grid-column: 2 / 4;
        }

        .fullscreen-grid.grid-5,
        .fullscreen-grid.grid-6 {
            gap: 12px;
            padding: 16px;
        }

        .fullscreen-grid.grid-7:not([data-page]) {
            gap: 14px;
            padding: 16px;
        }

        .fullscreen-grid.grid-8:not([data-page]) {
            gap: 12px;
            padding: 14px;
            /* 2 big cards on left (narrower), 6 small cards on right (wider) */
            grid-template-columns: 0.9fr 0.9fr 1.1fr 1.1fr;
            grid-template-rows: repeat(6, 1fr);
        }

        /* Grid 8 - First big card (top-left, spans 2 cols x 3 rows) */
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) {
            grid-column: 1 / 3;
            grid-row: 1 / 4;
        }

        /* Grid 8 - Second big card (bottom-left, spans 2 cols x 3 rows) */
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) {
            grid-column: 1 / 3;
            grid-row: 4 / 7;
        }

        /* Grid 8 - Small cards 3-8 on the right side (2 columns x 3 rows) */
        /* Desktop only - tablets use uniform grid layout */
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(3) {
            grid-column: 3;
            grid-row: 1 / 3;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(4) {
            grid-column: 4;
            grid-row: 1 / 3;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(5) {
            grid-column: 3;
            grid-row: 3 / 5;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(6) {
            grid-column: 4;
            grid-row: 3 / 5;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(7) {
            grid-column: 3;
            grid-row: 5 / 7;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(8) {
            grid-column: 4;
            grid-row: 5 / 7;
        }

        /* Tablet (900x500 to 1400x1024 resolution range) */
        @media (min-width: 900px) and (max-width: 1400px) and (min-height: 500px) and (max-height: 1024px) {
            .fullscreen-grid {
                padding: 16px;
            }

            .fullscreen-grid.grid-1 {
                padding: 20px;
            }

            .fullscreen-grid.grid-2 {
                gap: 14px;
            }

            .fullscreen-grid.grid-3,
            .fullscreen-grid.grid-4 {
                gap: 12px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                gap: 10px;
            }

            .fullscreen-grid.grid-7:not([data-page]) {
                gap: 12px;
                padding: 14px;
            }

            .fullscreen-grid.grid-8:not([data-page]) {
                gap: 10px;
                padding: 12px;
            }

            /* Tablet - Adjust grid layouts for better viewing */

            /* Grid 5: 2 big cards on top, 3 small cards on bottom */
            .fullscreen-grid.grid-5 {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(1) {
                grid-column: 1 / 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(2) {
                grid-column: 3 / 4;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(3) {
                grid-column: 1 / 2;
                grid-row: 3 / 4;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(4) {
                grid-column: 2 / 3;
                grid-row: 3 / 4;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(5) {
                grid-column: 3 / 4;
                grid-row: 3 / 4;
            }

            /* Grid 5 small cards, Grid 6 all cards, Grid 7 page 1 & Grid 8 page 1: Show clock on top */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .tablet-top-clock,
            .fullscreen-grid.grid-6 .fullscreen-game-card .tablet-top-clock,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .tablet-top-clock,
            .fullscreen-grid.grid-8[data-page="1"] .fullscreen-game-card .tablet-top-clock {
                display: flex;
                justify-content: center;
                align-items: center;
                position: absolute;
                top: 16px;
                left: 0;
                right: 0;
                height: clamp(24px, 4vmin, 36px);
                z-index: 10;
                padding: 4px 8px;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time-box,
            .fullscreen-grid.grid-6 .fullscreen-game-card .tablet-top-clock .fs-sb-time-box,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time-box,
            .fullscreen-grid.grid-8[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time-box {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time-label,
            .fullscreen-grid.grid-6 .fullscreen-game-card .tablet-top-clock .fs-sb-time-label,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time-label,
            .fullscreen-grid.grid-8[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time-label {
                font-size: clamp(0.6rem, 1.4vmin, 0.75rem);
                font-weight: 600;
                color: #94a3b8;
                letter-spacing: 0.05em;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time,
            .fullscreen-grid.grid-6 .fullscreen-game-card .tablet-top-clock .fs-sb-time,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time,
            .fullscreen-grid.grid-8[data-page="1"] .fullscreen-game-card .tablet-top-clock .fs-sb-time {
                font-size: clamp(0.75rem, 1.8vmin, 1rem);
                font-weight: 700;
                color: #ffffff;
            }

            /* Grid 5 small cards & Grid 6 all cards: Hide center clock (clock is now on top) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-center,
            .fullscreen-grid.grid-6 .fullscreen-game-card .fs-sb-center,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .fs-sb-center,
            .fullscreen-grid.grid-8[data-page="1"] .fullscreen-game-card .fs-sb-center {
                display: none;
            }

            /* MLB cards at grid-3/4: hide center clock to avoid crowding the BSO badge */
            .fullscreen-grid.grid-3 .fs-mlb .fs-sb-center,
            .fullscreen-grid.grid-4 .fs-mlb .fs-sb-center {
                display: none;
            }

            /* MLB cards at grid-3/4: show tablet-top-clock (replaces hidden center clock) */
            .fullscreen-grid.grid-3 .fs-mlb .tablet-top-clock,
            .fullscreen-grid.grid-4 .fs-mlb .tablet-top-clock {
                display: flex;
                justify-content: center;
                align-items: center;
                position: absolute;
                top: 16px;
                left: 0;
                right: 0;
                height: clamp(24px, 4vmin, 36px);
            }

            /* Grid 5 small cards & Grid 6 all cards: Adjust card wrapper padding to accommodate top clock */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-card-wrapper,
            .fullscreen-grid.grid-6 .fullscreen-game-card .fs-card-wrapper,
            .fullscreen-grid.grid-7[data-page="1"] .fullscreen-game-card .fs-card-wrapper {
                padding-top: clamp(28px, 5vmin, 40px);
            }

            /* Grid 8: Show clock on top for small cards (3-8) */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .tablet-top-clock {
                display: flex;
                justify-content: center;
                align-items: center;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: clamp(20px, 3.5vmin, 30px);
                background: linear-gradient(135deg, rgba(17, 24, 39, 0.95) 0%, rgba(31, 41, 55, 0.95) 100%);
                border-bottom: 1px solid rgba(59, 130, 246, 0.3);
                z-index: 10;
                padding: 3px 6px;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time-box {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1px;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time-label {
                font-size: clamp(0.45rem, 1vmin, 0.6rem);
                font-weight: 600;
                color: #94a3b8;
                letter-spacing: 0.05em;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .tablet-top-clock .fs-sb-time {
                font-size: clamp(0.6rem, 1.4vmin, 0.8rem);
                font-weight: 700;
                color: #ffffff;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-center {
                display: none;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-card-wrapper {
                padding-top: clamp(22px, 4.2vmin, 34px);
            }

            /* Grid 5 all cards & Grid 6 all cards: Make all card elements smaller */
            .fullscreen-grid.grid-5 .fs-card-wrapper,
            .fullscreen-grid.grid-6 .fs-card-wrapper,
            .fullscreen-grid.grid-7[data-page="1"] .fs-card-wrapper,
            .fullscreen-grid.grid-8[data-page="1"] .fs-card-wrapper {
                gap: 16px !important;
                padding: 8px;
            }

            .fullscreen-grid.grid-5 .fs-scoreboard,
            .fullscreen-grid.grid-6 .fs-scoreboard,
            .fullscreen-grid.grid-7[data-page="1"] .fs-scoreboard,
            .fullscreen-grid.grid-8[data-page="1"] .fs-scoreboard {
                padding: 0px 0px;
                gap: 0px;
            }

            .fullscreen-grid.grid-5 .fs-sb-team-logo img,
            .fullscreen-grid.grid-6 .fs-sb-team-logo img,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-team-logo img,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-team-logo img {
                max-width: 35px;
                max-height: 35px;
            }

            .fullscreen-grid.grid-5 .fs-sb-team-abbr,
            .fullscreen-grid.grid-6 .fs-sb-team-abbr,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-team-abbr,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-team-abbr {
                font-size: clamp(0.7rem, 1.6vmin, 0.9rem);
            }

            .fullscreen-grid.grid-5 .fs-sb-score,
            .fullscreen-grid.grid-6 .fs-sb-score,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-score,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-score {
                font-size: clamp(1.2rem, 3vmin, 1.8rem);
            }

            .fullscreen-grid.grid-5 .fs-sb-time-label,
            .fullscreen-grid.grid-6 .fs-sb-time-label,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-time-label,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-time-label {
                font-size: clamp(0.55rem, 1.2vmin, 0.7rem);
            }

            .fullscreen-grid.grid-5 .fs-sb-time,
            .fullscreen-grid.grid-6 .fs-sb-time,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-time,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-time {
                font-size: clamp(0.7rem, 1.6vmin, 0.9rem);
            }

            .fullscreen-grid.grid-5 .fs-sb-timeouts,
            .fullscreen-grid.grid-6 .fs-sb-timeouts,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-timeouts,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-timeouts {
                gap: 2px;
            }

            .fullscreen-grid.grid-5 .fs-sb-timeout-bar,
            .fullscreen-grid.grid-6 .fs-sb-timeout-bar,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-timeout-bar,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-timeout-bar {
                width: 4px;
                height: 10px;
            }

            .fullscreen-grid.grid-5 .fs-down-distance,
            .fullscreen-grid.grid-6 .fs-down-distance,
            .fullscreen-grid.grid-7[data-page="1"] .fs-down-distance,
            .fullscreen-grid.grid-8[data-page="1"] .fs-down-distance {
                font-size: clamp(0.65rem, 1.4vmin, 0.8rem);
                padding: 3px 6px;
            }

            .fullscreen-grid.grid-5 .fs-ball-position,
            .fullscreen-grid.grid-6 .fs-ball-position,
            .fullscreen-grid.grid-7[data-page="1"] .fs-ball-position,
            .fullscreen-grid.grid-8[data-page="1"] .fs-ball-position {
                font-size: clamp(0.6rem, 1.3vmin, 0.75rem);
                padding: 3px 6px;
            }

            .fullscreen-grid.grid-5 .fs-possession-indicator,
            .fullscreen-grid.grid-6 .fs-possession-indicator,
            .fullscreen-grid.grid-7[data-page="1"] .fs-possession-indicator,
            .fullscreen-grid.grid-8[data-page="1"] .fs-possession-indicator {
                font-size: clamp(10px, 1.6vmin, 16px);
            }

            .fullscreen-grid.grid-5 .league-logo,
            .fullscreen-grid.grid-6 .league-logo,
            .fullscreen-grid.grid-7[data-page="1"] .league-logo,
            .fullscreen-grid.grid-8[data-page="1"] .league-logo {
                max-width: 32px;
                max-height: 32px;
            }

            .fullscreen-grid.grid-5 .field-container svg,
            .fullscreen-grid.grid-6 .field-container svg,
            .fullscreen-grid.grid-7[data-page="1"] .field-container svg,
            .fullscreen-grid.grid-8[data-page="1"] .field-container svg {
                max-height: 80px;
            }

            /* Grid 5-8: Custom .fs-sb-situation styling for tablet with possession-based positioning */

            /* Grid 5: Big cards (1-2) - Base sizing */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation {
                bottom: -31%;
                padding: 6px 12px;
                border-radius: 6px;
                border: 1px solid rgba(255, 255, 255, 0.15);
                gap: 8px;
                min-width: 120px;
            }

            /* Grid 5: Big cards - Away possession (left side) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation.possession-away {
                left: 27%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 5: Big cards - Home possession (right side) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation.possession-home {
                left: 73%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 5 small cards & Grid 6 all cards - Base sizing */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-situation,
            .fullscreen-grid.grid-6 .fs-sb-situation,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-situation,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-situation {
                bottom: -26%;
                padding: 4px 8px;
                border-radius: 4px;
                border: 1px solid rgba(255, 255, 255, 0.15);
                gap: 6px;
                min-width: 120px;
                font-size: 0.75rem;
            }

            /* Grid 5 small cards & Grid 6 all cards - Away possession (left side) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-situation.possession-away,
            .fullscreen-grid.grid-6 .fs-sb-situation.possession-away,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-situation.possession-away,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-situation.possession-away {
                left: 25%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 5 small cards & Grid 6 all cards - Home possession (right side) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-situation.possession-home,
            .fullscreen-grid.grid-6 .fs-sb-situation.possession-home,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-situation.possession-home,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-situation.possession-home {
                left: 75%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 8: Big cards (1-2) - Base sizing */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation {
                bottom: -17%;
                padding: 5px 10px;
                border-radius: 5px;
                border: 1px solid rgba(255, 255, 255, 0.15);
                gap: 7px;
                min-width: 140px;
                font-size: 0.85rem;
            }

            /* Grid 8: Big cards - Away possession */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation.possession-away {
                left: 26%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 8: Big cards - Home possession */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(-n+2) .fs-sb-situation.possession-home {
                left: 74%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 8: Small cards (3-8) - Base sizing */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-situation {
                bottom: -17%;
                padding: 3px 6px;
                border-radius: 4px;
                border: 1px solid rgba(255, 255, 255, 0.15);
                gap: 5px;
                min-width: 100px;
                font-size: 0.65rem;
            }

            /* Grid 8: Small cards - Away possession */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-situation.possession-away {
                left: 23%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 8: Small cards - Home possession */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-situation.possession-home {
                left: 77%;
                transform: translateX(-50%) translateY(50%);
            }

            /* Grid 5-8: Timeout bars positioning for tablet */

            /* Grid 5: Big cards (1-2) */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeouts.away {
                right: clamp(25px, 4vw, 45px) !important;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeouts.home {
                left: clamp(25px, 4vw, 45px) !important;
            }

            /* Grid 5 small cards & Grid 6 all cards */
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.away,
            .fullscreen-grid.grid-6 .fs-sb-timeouts.away,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-timeouts.away,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-timeouts.away {
                right: clamp(14px, 0vw, 32px) !important;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.home,
            .fullscreen-grid.grid-6 .fs-sb-timeouts.home,
            .fullscreen-grid.grid-7[data-page="1"] .fs-sb-timeouts.home,
            .fullscreen-grid.grid-8[data-page="1"] .fs-sb-timeouts.home {
                left: clamp(14px, 0vw, 32px) !important;
            }

            /* Grid 8: Big cards (1-2) */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeouts.away {
                right: clamp(22px, 3.5vw, 40px) !important;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(-n+2) .fs-sb-timeouts.home {
                left: clamp(22px, 3.5vw, 40px) !important;
            }

            /* Grid 8: Small cards (3-8) */
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.away {
                right: clamp(12px, 2vw, 24px) !important;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.home {
                left: clamp(12px, 2vw, 24px) !important;
            }

            .fullscreen-grid.grid-7:not([data-page]) {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }

            .fullscreen-grid.grid-8:not([data-page]) {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(2, 1fr);
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) {
                grid-column: span 2;
                grid-row: span 1;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) {
                grid-column: span 2;
            }
        }

        /* Small Tablet Landscape (960x540 and similar resolutions) */
        @media (max-width: 900px) and (min-width: 500px) and (max-height: 500px) {
            .fullscreen-grid {
                padding: 8px;
            }

            /* Grid 5: 2 big + 3 small - Optimized proportions */
            .fullscreen-grid.grid-5 {
                gap: 8px;
                padding: 8px;
                grid-template-columns: 1fr 1fr 0.85fr 0.85fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(1) {
                grid-column: 1 / 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(2) {
                grid-column: 1 / 3;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(3) {
                grid-column: 3 / 5;
                grid-row: 1 / 2;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(4) {
                grid-column: 3 / 5;
                grid-row: 2 / 3;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(5) {
                grid-column: 3 / 5;
                grid-row: 3 / 5;
            }

            /* Grid 6: 2 big + 4 small - Optimized proportions */
            .fullscreen-grid.grid-6 {
                gap: 8px;
                padding: 8px;
                grid-template-columns: 1fr 1fr 0.85fr 0.85fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(1) {
                grid-column: 1 / 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(2) {
                grid-column: 1 / 3;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(3) {
                grid-column: 3 / 5;
                grid-row: 1 / 2;
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(4) {
                grid-column: 3 / 5;
                grid-row: 2 / 3;
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(5) {
                grid-column: 3 / 5;
                grid-row: 3 / 4;
            }

            .fullscreen-grid.grid-6 .fullscreen-game-card:nth-child(6) {
                grid-column: 3 / 5;
                grid-row: 4 / 5;
            }

            /* Grid 7: 2 big + 5 small - Better width distribution */
            .fullscreen-grid.grid-7:not([data-page]) {
                gap: 6px;
                padding: 8px;
                grid-template-columns: 1fr 1fr 0.75fr 0.75fr 0.75fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(1) {
                grid-column: 1 / 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(2) {
                grid-column: 1 / 3;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(3) {
                grid-column: 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(4) {
                grid-column: 4;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(5) {
                grid-column: 5;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(6) {
                grid-column: 3 / 5;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(7) {
                grid-column: 5;
                grid-row: 3 / 5;
            }

            /* Grid 8: 2 big + 6 small - Better width distribution */
            .fullscreen-grid.grid-8:not([data-page]) {
                gap: 6px;
                padding: 8px;
                grid-template-columns: 1fr 1fr 0.75fr 0.75fr 0.75fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) {
                grid-column: 1 / 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) {
                grid-column: 1 / 3;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(3) {
                grid-column: 3;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(4) {
                grid-column: 4;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(5) {
                grid-column: 5;
                grid-row: 1 / 3;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(6) {
                grid-column: 3;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(7) {
                grid-column: 4;
                grid-row: 3 / 5;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(8) {
                grid-column: 5;
                grid-row: 3 / 5;
            }
        }

        /* Mobile Landscape (up to 767px, landscape) */
        @media (max-width: 767px) and (orientation: landscape) {
            .fullscreen-grid {
                padding: 10px;
            }

            .fullscreen-grid.grid-1 {
                padding: 12px;
            }

            .fullscreen-grid.grid-2 {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: 1fr;
                gap: 10px;
            }

            .fullscreen-grid.grid-3 {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: 1fr;
                gap: 8px;
            }

            .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(3) {
                grid-column: span 1;
            }

            .fullscreen-grid.grid-4 {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: 1fr;
                gap: 8px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 6px;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(1),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(2),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(3),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(4),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(5) {
                grid-column: span 1;
            }

            .fullscreen-grid.grid-7:not([data-page]),
            .fullscreen-grid.grid-8:not([data-page]) {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 6px;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(1),
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) {
                grid-column: span 1;
                grid-row: span 1;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) {
                grid-column: span 1;
            }
        }

        /* Mobile Portrait (up to 767px, portrait) */
        @media (max-width: 767px) and (orientation: portrait) {
            .fullscreen-container {
                flex-direction: column;
            }

            .fullscreen-grid {
                padding: 10px;
                height: 100vh;
                overflow-y: auto;
            }

            .fullscreen-grid.grid-1 {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr;
                padding: 12px;
            }

            .fullscreen-grid.grid-2 {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(2, 1fr);
                gap: 10px;
            }

            .fullscreen-grid.grid-3 {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(3, 1fr);
                gap: 8px;
            }

            .fullscreen-grid.grid-3 .fullscreen-game-card:nth-child(3) {
                grid-column: span 1;
            }

            .fullscreen-grid.grid-4 {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 8px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6 {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(3, 1fr);
                gap: 6px;
            }

            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(1),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(2),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(3),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(4),
            .fullscreen-grid.grid-5 .fullscreen-game-card:nth-child(5) {
                grid-column: span 1;
            }

            .fullscreen-grid.grid-7:not([data-page]),
            .fullscreen-grid.grid-8:not([data-page]) {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(4, 1fr);
                gap: 6px;
            }

            .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(1),
            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) {
                grid-column: span 1;
                grid-row: span 1;
            }

            .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) {
                grid-column: span 1;
            }
        }

        /* Small Mobile (up to 375px) */
        @media (max-width: 375px) {
            .fullscreen-grid {
                padding: 6px;
            }

            .fullscreen-grid.grid-1 {
                padding: 8px;
            }

            .fullscreen-grid.grid-2,
            .fullscreen-grid.grid-3,
            .fullscreen-grid.grid-4 {
                gap: 6px;
            }

            .fullscreen-grid.grid-5,
            .fullscreen-grid.grid-6,
            .fullscreen-grid.grid-7:not([data-page]),
            .fullscreen-grid.grid-8:not([data-page]) {
                gap: 4px;
            }
        }

        /* ================================ */
        /* BACK BUTTON                      */
        /* ================================ */
        .back-btn {
            position: fixed;
            top: 8px;
            left: 8px;
            z-index: 100000;
            padding: 6px 12px;
            background: rgba(51, 65, 85, 0.85);
            border: 2px solid transparent;
            border-radius: 6px;
            color: white;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .back-btn::before {
            content: '\2190';
            font-size: 12px;
        }

        .back-btn:hover,
        .back-btn.focused {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.3);
            transform: scale(1.02);
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
        }

        /* ================================ */
        /* EXIT CONFIRMATION MODAL          */
        /* ================================ */
        .exit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            z-index: 100001;
            align-items: center;
            justify-content: center;
        }

        .exit-modal.visible {
            display: flex;
        }

        .exit-modal-content {
            background: linear-gradient(135deg, #1a1f2e 0%, #252b3d 100%);
            border-radius: 20px;
            padding: 40px 60px;
            text-align: center;
            border: 3px solid var(--border);
            max-width: 500px;
        }

        .exit-modal-content h2 {
            font-size: 28px;
            margin-bottom: 16px;
        }

        .exit-modal-content p {
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 32px;
        }

        .exit-modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .exit-modal-btn {
            padding: 14px 36px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 10px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .exit-modal-btn.confirm {
            background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
            color: white;
        }

        .exit-modal-btn.cancel {
            background: #334155;
            color: white;
        }

        .exit-modal-btn.focused {
            border-color: white;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* ================================ */
        /* EMPTY STATE                      */
        /* ================================ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: var(--text-secondary);
        }

        .empty-state h2 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 24px;
        }

        /* ================================ */
        /* RESPONSIVE BREAKPOINTS           */
        /* ================================ */

        /* Tablet */
        @media (max-width: 1024px) {
            .back-btn {
                padding: 8px 16px;
                font-size: 12px;
                min-height: var(--touch-target);
            }

            .fullscreen-grid {
                padding: var(--margin-v) var(--margin-h);
            }

            .exit-modal-content {
                padding: 32px 40px;
                max-width: 90%;
            }
        }

        /* Mobile */
        @media (max-width: 767px) {
            .back-btn {
                top: 8px;
                left: 8px;
                padding: 10px 16px;
                font-size: 13px;
                min-height: 44px;
            }

            .fullscreen-grid {
                padding: var(--margin-v) var(--margin-h);
            }

            .fullscreen-container {
                flex-direction: column;
            }

            .exit-modal-content {
                padding: 24px 20px;
                max-width: 95%;
                border-radius: 16px;
            }

            .exit-modal-content h2 {
                font-size: 22px;
            }

            .exit-modal-content p {
                font-size: 14px;
                margin-bottom: 24px;
            }

            .exit-modal-btn {
                padding: 12px 24px;
                font-size: 14px;
                min-height: 44px;
            }

            .exit-modal-buttons {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* Small mobile */
        @media (max-width: 375px) {
            .back-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .exit-modal-content {
                padding: 20px 16px;
            }

            .exit-modal-content h2 {
                font-size: 20px;
            }
        }

        /* ============================================
           SCOREBOARD COMPONENT STYLES (Fullscreen Cards)
           ============================================ */

        /* Wrapper for entire fullscreen card content with scoreboard */
        .fs-card-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }

        /* Individual gap for each grid option */
        .fullscreen-grid.grid-1 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-2 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-3 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-4 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-5 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-6 .fs-card-wrapper {
            gap: 28px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-card-wrapper {
            gap: 0px;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fs-card-wrapper {
            gap: 28px;
        }

        /* Tablet top clock - hidden by default, shown only via tablet-fullscreen.css for tablet portrait grid-4 */
        .tablet-top-clock {
            display: none;
        }

        /* Possession indicator - football emoji near team logo */
        .fs-possession-indicator {
            position: absolute;
            font-size: clamp(14px, 2.0vmin, 24px);
            line-height: 1;
            animation: possessionBlink 1.5s infinite;
            filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.9));
            z-index: 5;
        }

        /* Away team: top-right */
        .fs-possession-indicator.away {
            top: -8px;
            right: -8px;
        }

        /* Home team: top-left */
        .fs-possession-indicator.home {
            top: -8px;
            left: -8px;
        }

        @keyframes possessionBlink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        /* Grid-specific possession indicator sizing */
        .fullscreen-grid.grid-1 .fs-possession-indicator {
            font-size: clamp(20px, 3.5vmin, 32px);
        }

        .fullscreen-grid.grid-1 .fs-possession-indicator.away {
            top: -12px;
            right: -12px;
        }

        .fullscreen-grid.grid-1 .fs-possession-indicator.home {
            top: -12px;
            left: -12px;
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator {
            font-size: clamp(18px, 3vmin, 28px);
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator.away {
            top: -10px;
            right: -10px;
        }

        .fullscreen-grid.grid-2 .fs-possession-indicator.home {
            top: -10px;
            left: -10px;
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator,
        .fullscreen-grid.grid-6 .fs-possession-indicator {
            font-size: clamp(12px, 2vmin, 18px);
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator.away,
        .fullscreen-grid.grid-6 .fs-possession-indicator.away {
            top: -6px;
            right: -6px;
        }

        .fullscreen-grid.grid-5 .fs-possession-indicator.home,
        .fullscreen-grid.grid-6 .fs-possession-indicator.home {
            top: -6px;
            left: -6px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-possession-indicator,
        .fullscreen-grid.grid-8:not([data-page]) .fs-possession-indicator {
            font-size: clamp(10px, 1.5vmin, 14px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-possession-indicator.away,
        .fullscreen-grid.grid-8:not([data-page]) .fs-possession-indicator.away {
            top: -4px;
            right: -4px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-possession-indicator.home,
        .fullscreen-grid.grid-8:not([data-page]) .fs-possession-indicator.home {
            top: -4px;
            left: -4px;
        }

        /* The scoreboard itself */
        .fs-scoreboard {
            /* Default fallback colors */
            --sb-away-primary: #4b5563;
            --sb-away-secondary: #374151;
            --sb-home-primary: #6b7280;
            --sb-home-secondary: #4b5563;
            --sb-center-bg: #1f2937;
            --sb-text-color: #ffffff;
            --sb-subtext-color: rgba(255, 255, 255, 0.7);
            /* Logo size variable for responsive sizing */
            --sb-logo-size: clamp(50px, 8vmin, 100px);

            position: relative;
            width: 90%;
            height: clamp(50px, 12vmin, 100px);
            display: flex;
            align-items: stretch;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.6));
            border-radius: 6px;
            overflow: visible;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.5),
                0 2px 6px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            /* Space for logos floating above */
            margin-top: calc(var(--sb-logo-size) + 12px);
        }

        /* Score boxes on sides - NEW SCOREBOARD DESIGN */
        .fs-sb-score-box {
            width: clamp(52px, 8vmin, 72px);
            height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            /* New: Dark background with skew for premium broadcast look */
            background: linear-gradient(180deg,
                    rgba(0, 0, 0, 0.7) 0%,
                    rgba(0, 0, 0, 0.85) 100%);
            transform: skewX(var(--sb-skew-angle));
            box-shadow: var(--sb-shadow-score);
            overflow: hidden;
        }

        /* Chrome edge highlight at top */
        .fs-sb-score-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--sb-chrome-gradient);
            opacity: 0.6;
        }

        .fs-sb-score-box.away {
            border-radius: 4px 0 0 4px;
            /* Team color accent on left edge */
            border-left: 3px solid var(--sb-away-primary);
        }

        .fs-sb-score-box.home {
            border-radius: 0 4px 4px 0;
            /* Team color accent on right edge */
            border-right: 3px solid var(--sb-home-primary);
        }

        .fs-sb-score {
            font-family: var(--sb-font-score);
            font-weight: var(--sb-score-weight);
            color: #fff;
            letter-spacing: var(--sb-score-letter-spacing);
            line-height: 1;
            /* Counter-skew to keep text straight */
            transform: skewX(calc(var(--sb-skew-angle) * -1));
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: transform var(--sb-score-pop-duration) var(--sb-transition-bounce);
        }

        /* Individual font-size for each grid option */
        .fullscreen-grid.grid-1 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-2 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-3 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-4 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-5 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-6 .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-sb-score {
            font-size: clamp(1.5rem, 5vmin, 3.5rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fs-sb-score {
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
        }

        /* Score update animation */
        .fs-sb-score.score-updated {
            animation: score-pop var(--sb-score-pop-duration) ease-out;
        }

        @keyframes score-pop {
            0% {
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }

            30% {
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(var(--sb-score-pop-scale));
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            }

            100% {
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }
        }

        /* Score box glow on update */
        .fs-sb-score-box.score-updated {
            animation: score-glow var(--sb-score-pop-duration) ease-out;
        }

        @keyframes score-glow {
            0% {
                box-shadow: var(--sb-shadow-score);
            }

            30% {
                box-shadow: var(--sb-shadow-score), 0 0 30px rgba(255, 255, 255, 0.5);
            }

            100% {
                box-shadow: var(--sb-shadow-score);
            }
        }

        /* Score increment animation */
        .fs-sb-score.score-fading-out {
            animation: scoreFadeOut 0.3s ease forwards;
        }

        .fs-sb-score.score-fading-in {
            animation: scoreFadeIn 0.4s ease forwards;
        }

        @keyframes scoreFadeOut {
            0% {
                opacity: 1;
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }

            100% {
                opacity: 0;
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(0.8);
            }
        }

        @keyframes scoreFadeIn {
            0% {
                opacity: 0;
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(1.2);
            }

            100% {
                opacity: 1;
                transform: skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }
        }

        .score-increment {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1));
            font-size: clamp(1.2rem, 3.5vmin, 2rem);
            font-weight: 900;
            color: #22c55e;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            text-shadow:
                0 0 10px #22c55e,
                0 0 20px #22c55e,
                0 0 30px #22c55e,
                0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .score-increment.active {
            animation: scoreIncrementSequence 2.8s ease forwards;
        }

        @keyframes scoreIncrementSequence {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1)) scale(0.5);
            }

            10% {
                opacity: 1;
                transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1)) scale(1.3);
            }

            15% {
                transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }

            20% {
                text-shadow: 0 0 15px #22c55e, 0 0 30px #22c55e, 0 0 45px #22c55e, 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            35% {
                text-shadow: 0 0 10px #22c55e, 0 0 20px #22c55e, 0 0 30px #22c55e, 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            50% {
                text-shadow: 0 0 15px #22c55e, 0 0 30px #22c55e, 0 0 45px #22c55e, 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            65% {
                text-shadow: 0 0 10px #22c55e, 0 0 20px #22c55e, 0 0 30px #22c55e, 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            80% {
                text-shadow: 0 0 15px #22c55e, 0 0 30px #22c55e, 0 0 45px #22c55e, 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            85% {
                opacity: 1;
                transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1)) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) skewX(calc(var(--sb-skew-angle) * -1)) scale(0.8);
            }
        }

        .fs-sb-score-box.score-animating {
            overflow: visible;
        }

        /* Team info sections inside scoreboard - NEW SCOREBOARD DESIGN with team colors */
        .fs-sb-team-section {
            flex: 1;
            align-self: stretch;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px 10px;
            position: relative;
            transition: background var(--sb-transition-normal);
        }

        /* Away team - uses team color gradient */
        .fs-sb-team-section.away {
            padding-left: clamp(60px, 10vmin, 90px);
            padding-right: clamp(40px, 6vmin, 60px);
            background: linear-gradient(135deg,
                    var(--sb-away-primary) 0%,
                    color-mix(in srgb, var(--sb-away-primary) 85%, var(--sb-away-secondary)) 60%,
                    color-mix(in srgb, var(--sb-away-primary) 70%, #000) 100%);
        }

        /* Away score box - far left */
        .fs-sb-team-section.away .fs-sb-score-box {
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%) skewX(var(--sb-skew-angle));
        }

        /* Home team - uses team color gradient */
        .fs-sb-team-section.home {
            padding-left: clamp(40px, 6vmin, 60px);
            padding-right: clamp(60px, 10vmin, 90px);
            background: linear-gradient(135deg,
                    color-mix(in srgb, var(--sb-home-primary) 70%, #000) 0%,
                    color-mix(in srgb, var(--sb-home-primary) 85%, var(--sb-home-secondary)) 40%,
                    var(--sb-home-primary) 100%);
        }

        /* Home score box - far right */
        .fs-sb-team-section.home .fs-sb-score-box {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%) skewX(var(--sb-skew-angle));
        }

        /* Inner glow effect on team panels */
        .fs-sb-team-section::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg,
                    rgba(255, 255, 255, 0.12) 0%,
                    transparent 40%,
                    transparent 60%,
                    rgba(0, 0, 0, 0.15) 100%);
            pointer-events: none;
            z-index: 0;
        }

        .fs-sb-team-info {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            z-index: 2;
        }

        /* Team logo inside team-info - positioned above the scoreboard */
        .fs-sb-team-logo {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: clamp(6px, 1vmin, 12px);
            width: var(--sb-logo-size);
            height: var(--sb-logo-size);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .fs-sb-team-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6));
            transition: transform var(--sb-transition-fast);
        }

        /* Winner highlight on logo */
        .fs-sb-team-section.winner .fs-sb-team-logo-img {
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6)) drop-shadow(0 0 12px rgba(255, 255, 255, 0.3));
        }

        .fs-sb-team-name {
            font-family: var(--sb-font-display);
            font-size: clamp(0.8rem, 7vmin, 2.1rem);
            font-weight: var(--sb-team-weight);
            color: #fff;
            text-transform: uppercase;
            letter-spacing: var(--sb-team-letter-spacing);
            line-height: 1.1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .fs-sb-team-record {
            font-size: clamp(0.6rem, 1.5vmin, 1.45rem);
            color: rgba(255, 255, 255, 0.75);
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        /* Timeout bars container - positioned absolutely between team name and center */
        .fs-sb-timeouts {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }

        .fs-sb-timeouts.away {
            right: 100px;
        }

        .fs-sb-timeouts.home {
            left: 100px;
        }

        /* NEW SCOREBOARD DESIGN - Vertical timeout bars with gold gradient */
        .fs-sb-timeout-bar {
            /* Vertical bars: height > width */
            width: clamp(4px, 0.8vmin, 6px);
            height: clamp(16px, 3vmin, 28px);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            transition: all var(--sb-transition-fast);
        }

        .fs-sb-timeout-bar.active,
        .fs-sb-timeout-bar:not(.used) {
            background: linear-gradient(180deg,
                    #ffd700 0%,
                    #ffaa00 50%,
                    #cc8800 100%);
            box-shadow: 0 0 8px rgba(255, 200, 0, 0.5);
        }

        .fs-sb-timeout-bar.used {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: none;
        }

        /* Center time/status section - NEW SCOREBOARD BADGE DESIGN */
        .fs-sb-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fs-sb-time-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: clamp(6px, 1.2vmin, 12px) clamp(12px, 2.5vmin, 24px);
            background: linear-gradient(180deg,
                    rgba(20, 25, 35, 0.95) 0%,
                    rgba(10, 12, 18, 0.98) 100%);
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.12);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            min-width: clamp(60px, 10vmin, 100px);
            text-align: center;
        }

        /* Live game indicator - red glow effect */
        .fs-sb-time-box.live {
            background: linear-gradient(135deg, #1a0505 0%, #2a0808 100%);
            box-shadow: var(--sb-shadow-md), 0 0 20px var(--sb-live-glow);
        }

        .fs-sb-time-box.live .fs-sb-time {
            color: var(--sb-live-color);
        }

        .fs-sb-time-label {
            font-family: var(--sb-font-display);
            font-size: clamp(1.1rem, 2.5vmin, 1.8rem);
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .fs-sb-time {
            font-family: var(--sb-font-display);
            font-size: clamp(0.6rem, 1.2vmin, 0.9rem);
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-variant-numeric: tabular-nums;
        }

        /* Live pulse dot */
        .fs-sb-live-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--sb-live-color);
            border-radius: 50%;
            margin-right: 4px;
            animation: live-pulse 1.5s ease-in-out infinite;
        }

        @keyframes live-pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        /* ============================================
           GAME SITUATION BOX (NFL/NCAA Football)
           NEW SCOREBOARD DESIGN
           ============================================ */
        .fs-sb-situation {
            --sb-possession-primary: #4b5563;
            --sb-possession-secondary: #374151;

            position: absolute;
            bottom: -17%;
            left: 50%;
            transform: translateX(-50%) translateY(50%);
            background: linear-gradient(135deg,
                    var(--sb-possession-primary) 0%,
                    color-mix(in srgb, var(--sb-possession-primary) 70%, #000) 100%);
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 5;
            transition: all 0.3s ease;
            font-family: var(--sb-font-display);
        }

        /* Inner highlight on situation box */
        .fs-sb-situation::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(180deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 50%);
            pointer-events: none;
        }

        .fs-sb-situation.possession-away {
            --sb-possession-primary: var(--sb-away-primary);
            --sb-possession-secondary: var(--sb-away-secondary);
            left: 27%;
            transform: translateX(-50%) translateY(50%);
        }

        .fs-sb-situation.possession-home {
            --sb-possession-primary: var(--sb-home-primary);
            --sb-possession-secondary: var(--sb-home-secondary);
            left: 74%;
            transform: translateX(-50%) translateY(50%);
        }

        .fs-sb-down-distance {
            font-family: var(--sb-font-display);
            font-size: clamp(0.8rem, 1.6vmin, 1.3rem);
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .fs-sb-situation-divider {
            width: 1px;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
        }

        .fs-sb-ball-position {
            font-size: clamp(0.6rem, 1.5vmin, 0.75rem);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .fs-sb-situation.redzone {
            border-color: #ef4444;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(239, 68, 68, 0.5);
        }

        /* Special play situations (kickoff, punt, return, etc.) */
        .fs-sb-situation.special-play {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(15, 35, 60, 0.95) 100%);
            border-color: #3b82f6;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .fs-sb-situation.special-play .fs-sb-down-distance {
            text-align: center;
            letter-spacing: 0.5px;
        }

        .fs-sb-situation.special-play-kickoff {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(60, 50, 20, 0.95) 0%, rgba(40, 30, 10, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(245, 158, 11, 0.3);
        }

        .fs-sb-situation.special-play-punt {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(50, 30, 70, 0.95) 0%, rgba(30, 20, 50, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(139, 92, 246, 0.3);
        }

        .fs-sb-situation.special-play-return {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(20, 60, 50, 0.95) 0%, rgba(10, 40, 30, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(16, 185, 129, 0.3);
        }

        .fs-sb-situation.special-play-touchback,
        .fs-sb-situation.special-play-faircatch {
            border-color: #6b7280;
            background: linear-gradient(135deg, rgba(40, 45, 55, 0.95) 0%, rgba(25, 30, 40, 0.95) 100%);
        }

        .fs-sb-situation.special-play-xp,
        .fs-sb-situation.special-play-fg {
            border-color: #22c55e;
            background: linear-gradient(135deg, rgba(20, 60, 40, 0.95) 0%, rgba(10, 40, 25, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(34, 197, 94, 0.3);
        }

        .fs-sb-situation.special-play-2pt {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(60, 30, 30, 0.95) 0%, rgba(40, 20, 20, 0.95) 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4), 0 0 8px rgba(239, 68, 68, 0.3);
        }

        .fs-sb-situation:empty,
        .fs-sb-situation.hidden {
            display: none;
        }

        /* ================================ */
        /* MLB SITUATION & DIAMOND STYLES   */
        /* ================================ */

        /* MLB scoreboard: reduce team section paddings at compact widths */
        .fullscreen-grid.grid-3 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-4 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(48px, 5vmin, 72px);
            padding-right: clamp(8px, 1vmin, 20px);
        }

        .fullscreen-grid.grid-3 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-4 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(8px, 1vmin, 20px);
            padding-right: clamp(48px, 5vmin, 72px);
        }

        .fullscreen-grid.grid-5 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-6 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(44px, 4.5vmin, 64px);
            padding-right: clamp(6px, 0.8vmin, 16px);
        }

        .fullscreen-grid.grid-5 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-6 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(6px, 0.8vmin, 16px);
            padding-right: clamp(44px, 4.5vmin, 64px);
        }

        .fullscreen-grid.grid-7 .fs-mlb .fs-sb-team-section.away,
        .fullscreen-grid.grid-8 .fs-mlb .fs-sb-team-section.away {
            padding-left: clamp(40px, 4vmin, 58px);
            padding-right: clamp(4px, 0.5vmin, 12px);
        }

        .fullscreen-grid.grid-7 .fs-mlb .fs-sb-team-section.home,
        .fullscreen-grid.grid-8 .fs-mlb .fs-sb-team-section.home {
            padding-left: clamp(4px, 0.5vmin, 12px);
            padding-right: clamp(40px, 4vmin, 58px);
        }

        /* MLB Diamond Visualizer */
        .mlb-diamond-visualizer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: clamp(16px, 3vmin, 28px);
            padding: clamp(8px, 1.5vmin, 16px);
        }

        .mlb-diamond {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(2px, 0.5vmin, 4px);
        }

        .mlb-base-row {
            display: flex;
            gap: clamp(20px, 4vmin, 40px);
        }

        .mlb-base {
            width: clamp(16px, 3vmin, 28px);
            height: clamp(16px, 3vmin, 28px);
            background: rgba(100, 116, 139, 0.3);
            border: 2px solid rgba(148, 163, 184, 0.5);
            transform: rotate(45deg);
            transition: all 0.3s ease;
        }

        .mlb-base.home {
            width: clamp(14px, 2.5vmin, 22px);
            height: clamp(14px, 2.5vmin, 22px);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
            clip-path: polygon(0% 0%, 100% 0%, 100% 70%, 50% 100%, 0% 70%);
            transform: none;
        }

        .mlb-base.occupied {
            background: #fbbf24;
            border-color: #f59e0b;
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* ============================================
           MLB LIVE CAST CONTAINER
           ============================================ */
        .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            /* Base margin — matches field-visualizer clearance for BSO badge overhang */
            margin: clamp(24px, 4vmin, 40px) auto 0;
            display: flex;
            justify-content: center;
        }

        /* Grid 1 — generous clearance */
        .fullscreen-grid.grid-1 .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            margin-top: clamp(32px, 5vmin, 50px);
        }

        /* Grid 2 */
        .fullscreen-grid.grid-2 .mlb-livecast-container {
            width: 85%;
            max-width: 85%;
            margin-top: clamp(28px, 4.5vmin, 45px);
        }

        /* Grid 3-4 — badge now translateY(100%) so needs ~badge-height clearance */
        .fullscreen-grid.grid-3 .mlb-livecast-container,
        .fullscreen-grid.grid-4 .mlb-livecast-container {
            width: 90%;
            max-width: 90%;
            margin-top: clamp(34px, 5vmin, 48px);
        }

        /* Grid 5-6 */
        .fullscreen-grid.grid-5 .mlb-livecast-container,
        .fullscreen-grid.grid-6 .mlb-livecast-container {
            width: 92%;
            max-width: 92%;
            margin-top: clamp(28px, 4vmin, 40px);
        }

        /* Grid 7-8 Featured Card */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .mlb-livecast-container,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:first-child .mlb-livecast-container {
            width: 88%;
            max-width: 88%;
            margin-top: clamp(18px, 2.8vmin, 30px);
        }

        /* Grid 7-8 Smaller Cards */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:not(:first-child) .mlb-livecast-container,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:not(:first-child) .mlb-livecast-container {
            width: 92%;
            max-width: 92%;
            margin-top: clamp(16px, 2.5vmin, 26px);
        }

        /* ============================================
           NBA SCORER NOTIFICATION (Floating Box)
           ============================================ */
        .nba-scorer-notification {
            position: absolute;
            bottom: 5%;
            padding: clamp(8px, 1.5vmin, 14px) clamp(14px, 2.5vmin, 24px);
            background: linear-gradient(135deg, rgba(20, 20, 35, 0.95) 0%, rgba(35, 35, 55, 0.95) 100%);
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-radius: 6px;
            font-family: var(--sb-font-display, 'Oswald', sans-serif);
            font-size: clamp(0.9rem, 2vmin, 1.3rem);
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            z-index: 50;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.5px;
        }

        .nba-scorer-notification.away {
            left: 18%;
            transform: translateX(-50%) translateY(20px);
            border-color: var(--sb-away-primary, rgba(255, 255, 255, 0.25));
        }

        .nba-scorer-notification.home {
            right: 18%;
            left: auto;
            transform: translateX(50%) translateY(20px);
            border-color: var(--sb-home-primary, rgba(255, 255, 255, 0.25));
        }

        @keyframes scorerSlideUpAway {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            12% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }

            80% {
                opacity: 1;
                transform: translateX(-50%) translateY(-40px);
            }

            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
        }

        @keyframes scorerSlideUpHome {
            0% {
                opacity: 0;
                transform: translateX(50%) translateY(20px);
            }

            12% {
                opacity: 1;
                transform: translateX(50%) translateY(0);
            }

            80% {
                opacity: 1;
                transform: translateX(50%) translateY(-40px);
            }

            100% {
                opacity: 0;
                transform: translateX(50%) translateY(-50px);
            }
        }

        .nba-scorer-notification.away.animate {
            animation: scorerSlideUpAway 3s ease-out forwards;
        }

        .nba-scorer-notification.home.animate {
            animation: scorerSlideUpHome 3s ease-out forwards;
        }

        /* Status text above scoreboard */
        .fs-status-container {
            margin-bottom: 4px;
        }

        .fs-status-text {
            font-size: clamp(0.7rem, 1.8vmin, 1rem);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fs-status-text.upcoming {
            color: #60a5fa;
        }

        .fs-status-text.final {
            color: #9ca3af;
        }

        /* League logo position adjustment for scoreboard layout */
        .fullscreen-game-card.has-scoreboard .sport-logo-indicator {
            top: 1px;
            right: 15px;
            width: clamp(50px, 8vmin, 70px);
            height: clamp(50px, 8vmin, 70px);
        }

        /* League-specific background images */
        .fullscreen-game-card.fs-nfl {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NFL-Field.jpg') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-ncaa {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NCAAF-Field.jpg') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-nba {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NBACourt.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-ncaab {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NCAABCourt.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-nhl {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/NHLIceRink.png') center center / cover no-repeat;
        }

        .fullscreen-game-card.fs-mlb {
            background: linear-gradient(180deg, rgba(26, 34, 53, 0.85) 0%, rgba(15, 21, 37, 0.9) 100%),
                url('/assets/MLBFiled.png') center center / cover no-repeat;
        }

        /* Hide default content when using scoreboard */
        .fullscreen-game-card.has-scoreboard .fullscreen-card-content {
            display: none;
        }

        /* Grid-specific scoreboard adjustments */
        /* Grid 1 - Largest cards, biggest logos */
        .fullscreen-grid.grid-1 .fs-scoreboard {
            --sb-logo-size: clamp(80px, 12vmin, 140px);
            height: clamp(70px, 10vmin, 100px);
        }

        .fullscreen-grid.grid-1 .fs-sb-score-box {
            width: clamp(56px, 12vmin, 96px);
        }

        /* Grid 2 - Large cards */
        .fullscreen-grid.grid-2 .fs-scoreboard {
            --sb-logo-size: clamp(60px, 10vmin, 100px);
        }

        /* Grid 3-4 - Medium cards */
        .fullscreen-grid.grid-3 .fs-scoreboard,
        .fullscreen-grid.grid-4 .fs-scoreboard {
            --sb-logo-size: clamp(45px, 7vmin, 70px);
        }

        /* Grid 3-4 timeout bars - vertical bars */
        .fullscreen-grid.grid-3 .fs-sb-timeout-bar,
        .fullscreen-grid.grid-4 .fs-sb-timeout-bar {
            width: clamp(3px, 0.6vmin, 5px);
            height: clamp(12px, 2.5vmin, 20px);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeouts.away,
        .fullscreen-grid.grid-4 .fs-sb-timeouts.away {
            right: clamp(65px, 9vw, 90px);
        }

        .fullscreen-grid.grid-3 .fs-sb-timeouts.home,
        .fullscreen-grid.grid-4 .fs-sb-timeouts.home {
            left: clamp(65px, 9vw, 90px);
        }

        /* Grid 5-6 - Smaller cards */
        .fullscreen-grid.grid-5 .fs-scoreboard,
        .fullscreen-grid.grid-6 .fs-scoreboard {
            --sb-logo-size: clamp(35px, 6vmin, 60px);
        }

        .fullscreen-grid.grid-5 .fs-sb-score-box,
        .fullscreen-grid.grid-6 .fs-sb-score-box {
            width: clamp(36px, 8.5vmin, 75px);
        }

        /* Grid 5-6 timeout bars - vertical bars */
        .fullscreen-grid.grid-5 .fs-sb-timeout-bar,
        .fullscreen-grid.grid-6 .fs-sb-timeout-bar {
            width: clamp(3px, 0.6vmin, 5px);
            height: clamp(10px, 2vmin, 18px);
        }

        .fullscreen-grid.grid-5 .fs-sb-timeouts.away,
        .fullscreen-grid.grid-6 .fs-sb-timeouts.away {
            right: clamp(55px, 8vw, 60px);
        }

        .fullscreen-grid.grid-5 .fs-sb-timeouts.home,
        .fullscreen-grid.grid-6 .fs-sb-timeouts.home {
            left: clamp(55px, 8vw, 60px);
        }

        /* ============================================
           GRID 7 - FEATURED BIG CARD (first-child, spans 3 rows)
           Desktop only - tablets use uniform grid layout
           ============================================ */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-scoreboard {
            --sb-logo-size: clamp(50px, 8vmin, 80px);
            height: clamp(45px, 15vmin, 100px);
            width: 88%;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-score-box {
            width: clamp(36px, 8vmin, 60px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-timeout-bar {
            width: clamp(4px, 0.8vmin, 6px);
            height: clamp(14px, 3vmin, 24px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-timeouts {
            gap: 3px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-timeouts.away {
            right: 20%;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-timeouts.home {
            left: 20%;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-score {
            font-size: clamp(1.2rem, 8vmin, 2.8rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-team-name {
            font-size: clamp(0.7rem, 3.8vmin, 2rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-team-record {
            font-size: clamp(0.55rem, 5.2vmin, 1.0rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-time-label {
            font-size: clamp(0.9rem, 2vmin, 1.2rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-time {
            font-size: clamp(0.55rem, 1.3vmin, 0.75rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-time-box {
            min-width: 60px;
            padding: 2px 8px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-situation {
            bottom: -16px;
            min-width: 100px;
            padding: 2px 8px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:first-child .fs-sb-down-distance {
            font-size: clamp(0.5rem, 1.2vmin, 0.7rem);
        }

        /* ============================================
           GRID 7 - 6 SMALLER CARDS (nth-child 2-7)
           ============================================ */
        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-scoreboard {
            --sb-logo-size: clamp(30px, 8vmin, 60px);
            height: clamp(40px, 10vmin, 66px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-score-box {
            width: clamp(32px, 8.8vmin, 70px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-timeout-bar {
            width: clamp(3px, 0.5vmin, 5px);
            height: clamp(10px, 2vmin, 16px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-timeouts {
            gap: 3px;
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-timeouts.away {
            right: clamp(50px, 8vw, 60px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-timeouts.home {
            left: clamp(50px, 8vw, 60px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fullscreen-game-card:nth-child(n+2) .fs-sb-situation {
            bottom: -16px;
            min-width: 100px;
            padding: 2px 8px;
        }

        /* ============================================
           GRID 8 - 2 BIG CARDS (first-child and nth-child(2))
           ============================================ */
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-scoreboard,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-scoreboard {
            --sb-logo-size: clamp(55px, 10vmin, 90px);
            height: clamp(55px, 8vmin, 75px);
            width: 90%;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-score-box,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-score-box {
            width: clamp(44px, 6.4vmin, 60px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-score,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-score {
            font-size: clamp(1.4rem, 3.5vmin, 2rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-team-name,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-team-name {
            font-size: clamp(0.8rem, 2vmin, 1.1rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-team-record,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-team-record {
            font-size: clamp(0.6rem, 1.4vmin, 0.85rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-timeout-bar,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-timeout-bar {
            width: clamp(4px, 0.7vmin, 6px);
            height: clamp(12px, 2.5vmin, 20px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-timeouts,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-timeouts {
            gap: 3px;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-timeouts.away,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-timeouts.away {
            right: 25%;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-timeouts.home,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-timeouts.home {
            left: 25%;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-time-label,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-time-label {
            font-size: clamp(1rem, 2.5vmin, 1.4rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-time,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-time {
            font-size: clamp(0.6rem, 1.5vmin, 0.85rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-time-box,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-time-box {
            min-width: 70px;
            padding: 3px 10px;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(1) .fs-sb-situation,
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(2) .fs-sb-situation {
            bottom: -18px;
            min-width: 120px;
            padding: 3px 10px;
        }

        /* ============================================
           GRID 8 - 6 SMALLER CARDS (nth-child 3-8)
           ============================================ */
        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-scoreboard {
            --sb-logo-size: clamp(28px, 4.5vmin, 45px);
            height: clamp(42px, 6vmin, 54px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-score-box {
            width: clamp(32px, 4.8vmin, 42px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-score {
            font-size: clamp(1rem, 2.5vmin, 1.4rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-team-name {
            font-size: clamp(0.65rem, 1.6vmin, 0.9rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-team-record {
            font-size: clamp(0.52rem, 1.2vmin, 0.72rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeout-bar {
            width: clamp(3px, 0.5vmin, 5px);
            height: clamp(8px, 1.5vmin, 14px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts {
            gap: 3px;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.away {
            right: clamp(30px, 4vw, 45px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-timeouts.home {
            left: clamp(30px, 4vw, 45px);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-time-label {
            font-size: clamp(0.85rem, 2vmin, 1.1rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-time {
            font-size: clamp(0.7rem, 1.6vmin, 0.85rem);
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-time-box {
            min-width: 65px;
            padding: 4px 8px;
            gap: 1px;
        }

        .fullscreen-grid.grid-8:not([data-page]) .fullscreen-game-card:nth-child(n+3) .fs-sb-situation {
            bottom: -14px;
            min-width: 90px;
            padding: 2px 6px;
        }

        /* Field visualizer spacing - push down from scoreboard */
        .fs-card-wrapper .field-visualizer {
            margin-top: clamp(24px, 4vmin, 40px);
        }

        .fullscreen-grid.grid-1 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(32px, 5vmin, 50px);
        }

        .fullscreen-grid.grid-2 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(28px, 4.5vmin, 45px);
        }

        .fullscreen-grid.grid-5 .fs-card-wrapper .field-visualizer,
        .fullscreen-grid.grid-6 .fs-card-wrapper .field-visualizer {
            margin-top: clamp(20px, 3vmin, 32px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .fs-card-wrapper .field-visualizer,
        .fullscreen-grid.grid-8:not([data-page]) .fs-card-wrapper .field-visualizer {
            margin-top: clamp(16px, 2.5vmin, 26px);
        }

        /* SVG Field Container */
        .svg-field-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .svg-field-container .field-svg {
            width: 100%;
            max-width: 100%;
            height: auto;
        }

        /* ================================ */
        /* NFL STATS MODAL (Between Plays)  */
        /* ================================ */
        .nfl-stats-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(10, 14, 26, 0.95) 0%, rgba(20, 30, 50, 0.95) 100%);
            display: flex;
            flex-direction: column;
            padding: clamp(8px, 2vmin, 16px);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            overflow: hidden;
        }

        .nfl-stats-modal.visible {
            opacity: 1;
            visibility: visible;
        }

        .nfl-stats-modal-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: clamp(8px, 2vmin, 16px);
            margin-bottom: clamp(6px, 1.5vmin, 12px);
            padding-bottom: clamp(4px, 1vmin, 8px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nfl-stats-modal-title {
            font-size: clamp(1.2rem, 3vmin, 2rem);
            font-weight: 700;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-content {
            display: flex;
            flex: 1;
            gap: clamp(12px, 3vmin, 24px);
            overflow: hidden;
        }

        .nfl-stats-team {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: clamp(10px, 2.5vmin, 20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .nfl-stats-team-header {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2.5vmin, 16px);
            margin-bottom: clamp(10px, 2.5vmin, 16px);
            padding-bottom: clamp(8px, 2vmin, 12px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.15);
        }

        .nfl-stats-team-score {
            font-size: clamp(2rem, 5vmin, 4rem);
            font-weight: 900;
            color: #4ade80;
            text-shadow: 0 2px 8px rgba(74, 222, 128, 0.4), 0 2px 4px rgba(0, 0, 0, 0.5);
            min-width: clamp(50px, 8vmin, 90px);
            text-align: center;
        }

        .nfl-stats-team-logo {
            width: clamp(40px, 7vmin, 70px);
            height: clamp(40px, 7vmin, 70px);
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .nfl-stats-team-name {
            font-size: clamp(1rem, 2.5vmin, 1.6rem);
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            flex: 1;
        }

        .nfl-stats-category {
            margin-bottom: clamp(8px, 2vmin, 14px);
        }

        .nfl-stats-category-title {
            font-size: clamp(0.9rem, 2.2vmin, 1.3rem);
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: clamp(4px, 1vmin, 8px);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(4px, 1vmin, 8px) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .nfl-stats-player:last-child {
            border-bottom: none;
        }

        .nfl-stats-player-name {
            font-size: clamp(0.85rem, 2vmin, 1.2rem);
            color: white;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 45%;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-player-value {
            font-size: clamp(0.8rem, 1.8vmin, 1.1rem);
            color: #4ade80;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .nfl-stats-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            color: #94a3b8;
            font-size: clamp(1rem, 2.5vmin, 1.5rem);
        }

        .nfl-stats-loading::after {
            content: '';
            width: 16px;
            height: 16px;
            margin-left: 8px;
            border: 2px solid #4ade80;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Grid 3-4 - slightly smaller */
        .fullscreen-grid.grid-3 .nfl-stats-modal-title,
        .fullscreen-grid.grid-4 .nfl-stats-modal-title {
            font-size: clamp(1rem, 2.5vmin, 1.6rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-team-score,
        .fullscreen-grid.grid-4 .nfl-stats-team-score {
            font-size: clamp(1.6rem, 4vmin, 3rem);
            min-width: clamp(40px, 6vmin, 70px);
        }

        .fullscreen-grid.grid-3 .nfl-stats-team-name,
        .fullscreen-grid.grid-4 .nfl-stats-team-name {
            font-size: clamp(0.85rem, 2vmin, 1.3rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-category-title,
        .fullscreen-grid.grid-4 .nfl-stats-category-title {
            font-size: clamp(0.75rem, 1.8vmin, 1.1rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-player-name,
        .fullscreen-grid.grid-4 .nfl-stats-player-name {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-3 .nfl-stats-player-value,
        .fullscreen-grid.grid-4 .nfl-stats-player-value {
            font-size: clamp(0.65rem, 1.5vmin, 0.95rem);
        }

        /* Grid 5-6 - compact but readable */
        .fullscreen-grid.grid-5 .nfl-stats-modal-title,
        .fullscreen-grid.grid-6 .nfl-stats-modal-title {
            font-size: clamp(0.85rem, 2vmin, 1.3rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-score,
        .fullscreen-grid.grid-6 .nfl-stats-team-score {
            font-size: clamp(1.3rem, 3.5vmin, 2.5rem);
            min-width: clamp(35px, 5vmin, 60px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-logo,
        .fullscreen-grid.grid-6 .nfl-stats-team-logo {
            width: clamp(30px, 5vmin, 50px);
            height: clamp(30px, 5vmin, 50px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-name,
        .fullscreen-grid.grid-6 .nfl-stats-team-name {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-category-title,
        .fullscreen-grid.grid-6 .nfl-stats-category-title {
            font-size: clamp(0.65rem, 1.5vmin, 0.9rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-player-name,
        .fullscreen-grid.grid-6 .nfl-stats-player-name {
            font-size: clamp(0.6rem, 1.3vmin, 0.85rem);
        }

        .fullscreen-grid.grid-5 .nfl-stats-player-value,
        .fullscreen-grid.grid-6 .nfl-stats-player-value {
            font-size: clamp(0.55rem, 1.2vmin, 0.8rem);
        }

        /* Grid 7-8 - smallest but still readable */
        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-modal-title,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-modal-title {
            font-size: clamp(0.7rem, 1.6vmin, 1rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-team-score,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-team-score {
            font-size: clamp(1rem, 2.8vmin, 2rem);
            min-width: clamp(28px, 4vmin, 50px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-team,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-team {
            padding: clamp(6px, 1.5vmin, 12px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-team-logo,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-team-logo {
            width: clamp(24px, 4vmin, 40px);
            height: clamp(24px, 4vmin, 40px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-team-name,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-team-name {
            font-size: clamp(0.6rem, 1.4vmin, 0.85rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-category-title,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-category-title {
            font-size: clamp(0.55rem, 1.2vmin, 0.75rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-player-name,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-player-name {
            font-size: clamp(0.5rem, 1.1vmin, 0.7rem);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-player-value,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-player-value {
            font-size: clamp(0.45rem, 1vmin, 0.65rem);
        }

        /* Grid 5-6: Hide receiving category and show only 1 player per category */
        .fullscreen-grid.grid-5 .nfl-stats-category:nth-child(3),
        .fullscreen-grid.grid-6 .nfl-stats-category:nth-child(3) {
            display: none;
        }

        .fullscreen-grid.grid-5 .nfl-stats-player:nth-child(n+2),
        .fullscreen-grid.grid-6 .nfl-stats-player:nth-child(n+2) {
            display: none;
        }

        .fullscreen-grid.grid-5 .nfl-stats-category,
        .fullscreen-grid.grid-6 .nfl-stats-category {
            margin-bottom: clamp(4px, 1vmin, 8px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-team-header,
        .fullscreen-grid.grid-6 .nfl-stats-team-header {
            margin-bottom: clamp(6px, 1.5vmin, 10px);
            padding-bottom: clamp(4px, 1vmin, 6px);
        }

        .fullscreen-grid.grid-5 .nfl-stats-modal-header,
        .fullscreen-grid.grid-6 .nfl-stats-modal-header {
            margin-bottom: clamp(4px, 1vmin, 8px);
            padding-bottom: clamp(2px, 0.5vmin, 4px);
        }

        /* Grid 7-8: Hide receiving category, show only 1 player, minimal spacing */
        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-category:nth-child(3),
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-category:nth-child(3) {
            display: none;
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-player:nth-child(n+2),
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-player:nth-child(n+2) {
            display: none;
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-category,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-category {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-category-title,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-category-title {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-team-header,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-team-header {
            margin-bottom: clamp(4px, 1vmin, 8px);
            padding-bottom: clamp(2px, 0.5vmin, 4px);
            gap: clamp(6px, 1.5vmin, 10px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-modal-header,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-modal-header {
            margin-bottom: clamp(2px, 0.5vmin, 4px);
            padding-bottom: clamp(1px, 0.3vmin, 2px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-modal,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-modal {
            padding: clamp(4px, 1vmin, 8px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-content,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-content {
            gap: clamp(6px, 1.5vmin, 12px);
        }

        .fullscreen-grid.grid-7:not([data-page]) .nfl-stats-player,
        .fullscreen-grid.grid-8:not([data-page]) .nfl-stats-player {
            padding: clamp(2px, 0.5vmin, 4px) 0;
        }

        /* Desktop hover states */
        .league-card:hover,
        .league-card.hovered {
            transform: scale(1.05);
            border-color: var(--accent, #6366f1);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
        }

        .game-card:hover,
        .game-card.hovered {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .sports-mode-btn:hover,
        .clear-selections-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        /* Cursor pointer for clickable elements */
        .league-card,
        .game-card,
        .sports-mode-btn,
        .clear-selections-btn,
        .sign-out-link,
        .login-option,
        .login-btn,
        .back-link {
            cursor: pointer;
        }

        /* ================================ */
        /* MOBILE RESPONSIVE STYLES         */
        /* ================================ */

        /* Tablet adjustments */
        @media (max-width: 1024px) {
            .fs-scoreboard {
                width: 95%;
            }

            .fs-sb-team-name {
                font-size: clamp(0.7rem, 1.8vmin, 1rem);
            }

            .fs-sb-score {
                font-size: clamp(1.3rem, 6.5vmin, 6rem);
            }
        }

        /* Mobile - Stack elements */
        @media (max-width: 767px) {
            .fullscreen-grid {
                display: flex;
                flex-direction: column;
                height: auto;
                min-height: 100vh;
                gap: var(--gutter);
            }

            .fullscreen-game-card {
                min-height: 300px;
                flex: 0 0 auto;
            }

            .fs-scoreboard {
                --sb-logo-size: clamp(40px, 12vw, 70px);
                width: 98%;
                height: clamp(45px, 12vw, 65px);
            }

            .fs-sb-score-box {
                width: clamp(40px, 11vw, 56px);
            }

            .fs-sb-score {
                font-size: clamp(1.2rem, 5vw, 1.8rem);
            }

            .fs-sb-team-name {
                font-size: clamp(0.65rem, 2.5vw, 0.9rem);
            }

            .fs-sb-team-record {
                font-size: clamp(0.5rem, 2vw, 0.7rem);
            }

            .fs-sb-time-label {
                font-size: clamp(1.1rem, 4vw, 1.4rem);
            }

            .fs-sb-time {
                font-size: clamp(0.6rem, 2.5vw, 0.85rem);
            }

            .fs-sb-situation {
                min-width: 120px;
                padding: 2px 10px;
            }

            .fs-sb-down-distance {
                font-size: clamp(0.5rem, 2vw, 0.7rem);
            }

            /* NFL stats modal mobile */
            .nfl-stats-content {
                flex-direction: column;
                gap: var(--gutter);
            }

            .nfl-stats-team {
                padding: var(--margin-v) var(--margin-h);
            }

            .nfl-stats-modal-title {
                font-size: clamp(1rem, 4vw, 1.4rem);
            }

            .nfl-stats-team-score {
                font-size: clamp(1.5rem, 8vw, 2.5rem);
            }

            .nfl-stats-team-name {
                font-size: clamp(0.85rem, 3.5vw, 1.2rem);
            }

            /* Hide timeouts on very small screens */
            .fs-sb-timeouts {
                display: none;
            }

            /* Adjust team section padding */
            .fs-sb-team-section.away,
            .fs-sb-team-section.home {
                padding: 4px 8px;
            }
        }

        /* Small mobile */
        @media (max-width: 375px) {
            .fullscreen-game-card {
                min-height: 250px;
            }

            .fs-scoreboard {
                --sb-logo-size: clamp(35px, 14vw, 55px);
                height: clamp(40px, 14vw, 55px);
            }

            .fs-sb-score-box {
                width: clamp(32px, 13vw, 44px);
            }

            .fs-sb-score {
                font-size: clamp(1rem, 6vw, 1.4rem);
            }

            .fs-sb-team-name {
                font-size: clamp(0.55rem, 3vw, 0.75rem);
            }

            .fs-sb-situation {
                min-width: 100px;
                padding: 2px 8px;
                bottom: -16px;
            }

            .nfl-stats-team-score {
                font-size: clamp(1.2rem, 10vw, 2rem);
            }
        }

        /* Touch-friendly enhancements */
        @media (hover: none) and (pointer: coarse) {
            .back-btn {
                min-height: 48px;
                min-width: 48px;
                padding: 12px 20px;
            }

            .exit-modal-btn {
                min-height: 48px;
                padding: 14px 28px;
            }

            /* Larger touch targets */
            .fullscreen-game-card {
                touch-action: manipulation;
            }
        }

        /* ================================ */
        /* REPLAY MODE CONTROLS             */
        /* ================================ */
        .replay-controls {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(10, 14, 26, 0.95);
            border: 1px solid var(--border);
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
            backdrop-filter: blur(8px);
        }

        .fullscreen-game-card:hover .replay-controls,
        .fullscreen-game-card.replay-controls-visible .replay-controls {
            opacity: 1;
        }

        .replay-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .replay-btn:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        .replay-btn:active {
            transform: scale(0.95);
        }

        .replay-btn.play-pause {
            width: 44px;
            height: 44px;
            background: var(--accent);
            font-size: 16px;
        }

        .replay-btn.play-pause:hover {
            background: var(--accent-light);
        }

        .replay-btn.play-pause.playing {
            background: var(--success);
        }

        .replay-progress {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin: 0 8px;
            min-width: 80px;
        }

        .replay-progress-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .replay-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--bg-secondary);
            border-radius: 2px;
            overflow: hidden;
        }

        .replay-progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Jump to play control */
        .replay-jump-control {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-left: 12px;
            border-left: 1px solid var(--border);
        }

        .replay-jump-label {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .replay-jump-input {
            width: 55px;
            padding: 6px 8px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            text-align: center;
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .replay-jump-input::-webkit-outer-spin-button,
        .replay-jump-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .replay-jump-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .replay-jump-btn {
            padding: 6px 10px !important;
            font-size: 11px !important;
        }

        .replay-speed-control {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .replay-speed-slider {
            width: 60px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--bg-secondary);
            border-radius: 2px;
            outline: none;
        }

        .replay-speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Speed Preset Buttons */
        .speed-preset-btns {
            display: flex;
            gap: 4px;
        }

        .speed-preset-btn {
            padding: 4px 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 11px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .speed-preset-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .speed-preset-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .replay-speed-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--text-muted);
            min-width: 32px;
        }

        /* Hover trigger zone at top of screen */
        .global-controls-trigger {
            position: fixed;
            top: 0;
            left: 120px;
            /* Leave space for back button */
            right: 0;
            height: 60px;
            z-index: 100000;
            /* Invisible trigger zone */
        }

        /* Global replay controls bar (top of screen) */
        .global-replay-controls {
            position: fixed;
            top: 8px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 10px 24px;
            background: rgba(10, 14, 26, 0.95);
            border: 1px solid var(--border);
            border-radius: 16px;
            z-index: 100001;
            backdrop-filter: blur(12px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            pointer-events: none;
        }

        /* Show controls when hovering trigger zone or the controls themselves */
        .global-controls-trigger:hover+.global-replay-controls,
        .global-replay-controls:hover {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .global-replay-controls .replay-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: linear-gradient(135deg, #ff6b35, #ff3366);
            border-radius: 6px;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            color: white;
            text-transform: uppercase;
        }

        .global-replay-controls .replay-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .global-replay-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .global-replay-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .global-replay-btn.active {
            background: var(--success);
            border-color: var(--success);
        }

        /* Play List Container - shows prev/current/next plays */
        .replay-play-list {
            position: relative;
            margin: 8px 0 0 0;
            background: rgba(10, 14, 26, 0.95);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            z-index: 50;
            height: 84px;
            /* Fixed height for 3 plays */
        }

        .replay-play-list-inner {
            position: relative;
        }

        /* Scroll animation: slide up and fade */
        @keyframes playListScrollUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            40% {
                transform: translateY(-14px);
                opacity: 0.3;
            }

            60% {
                transform: translateY(-14px);
                opacity: 0.3;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .replay-play-list.scrolling .replay-play-list-inner {
            animation: playListScrollUp 0.5s ease-in-out;
        }

        /* Individual play item in the list */
        .replay-play-item {
            padding: 4px 12px;
            font-size: 11px;
            color: var(--text-primary);
            line-height: 1.3;
            height: 28px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .replay-play-item.prev {
            opacity: 0.4;
            color: var(--text-muted);
        }

        .replay-play-item.current {
            opacity: 1;
            background: rgba(0, 240, 255, 0.08);
            border-left: 2px solid var(--accent);
            padding-left: 10px;
        }

        .replay-play-item.next {
            opacity: 0.4;
            color: var(--text-muted);
        }

        .replay-play-item .play-type {
            color: var(--accent);
            font-weight: 600;
            margin-right: 6px;
            text-transform: uppercase;
            font-size: 9px;
            flex-shrink: 0;
            min-width: 50px;
        }

        .replay-play-item.prev .play-type,
        .replay-play-item.next .play-type {
            color: var(--text-muted);
        }

        .replay-play-item .play-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Fade gradients at top and bottom */
        .replay-play-list::before,
        .replay-play-list::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 16px;
            pointer-events: none;
            z-index: 2;
        }

        .replay-play-list::before {
            top: 0;
            background: linear-gradient(to bottom, rgba(10, 14, 26, 1), transparent);
        }

        .replay-play-list::after {
            bottom: 0;
            background: linear-gradient(to top, rgba(10, 14, 26, 1), transparent);
        }

        /* Pulse animation for current play on change */
        @keyframes playPulse {
            0% {
                background: rgba(0, 240, 255, 0.08);
            }

            50% {
                background: rgba(0, 240, 255, 0.2);
            }

            100% {
                background: rgba(0, 240, 255, 0.08);
            }
        }

        .replay-play-list.scrolling .replay-play-item.current {
            animation: playPulse 0.4s ease;
        }

        /* Legacy single play display (keep for compatibility) */
        .replay-last-play {
            position: relative;
            margin: 8px 0 0 0;
            padding: 8px 12px;
            background: rgba(10, 14, 26, 0.95);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-primary);
            line-height: 1.4;
            opacity: 1;
            z-index: 50;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: none;
            /* Hidden when play list is used */
        }

        .replay-last-play strong {
            color: var(--accent);
            font-weight: 600;
            margin-right: 6px;
        }

        /* Down/Distance and Field Position info below play text */
        .replay-play-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0 0 0;
            padding: 6px 12px;
            background: rgba(20, 28, 46, 0.95);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .replay-play-info .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .replay-play-info .info-label {
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 9px;
            letter-spacing: 0.5px;
        }

        .replay-play-info .info-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .replay-play-info .info-value.down-distance {
            color: var(--accent);
        }

        .replay-play-info .info-value.field-position {
            color: #4ade80;
        }

        /* Hide replay elements when not in replay mode */
        body:not(.replay-mode) .replay-controls,
        body:not(.replay-mode) .global-replay-controls,
        body:not(.replay-mode) .global-controls-trigger,
        body:not(.replay-mode) .replay-last-play,
        body:not(.replay-mode) .replay-play-list,
        body:not(.replay-mode) .replay-play-info {
            display: none !important;
        }

        /* Hide replay play elements for grids 3-8 */
        .fullscreen-grid.grid-3 .replay-play-list,
        .fullscreen-grid.grid-3 .replay-play-info,
        .fullscreen-grid.grid-4 .replay-play-list,
        .fullscreen-grid.grid-4 .replay-play-info,
        .fullscreen-grid.grid-5 .replay-play-list,
        .fullscreen-grid.grid-5 .replay-play-info,
        .fullscreen-grid.grid-6 .replay-play-list,
        .fullscreen-grid.grid-6 .replay-play-info,
        .fullscreen-grid.grid-7:not([data-page]) .replay-play-list,
        .fullscreen-grid.grid-7:not([data-page]) .replay-play-info,
        .fullscreen-grid.grid-8:not([data-page]) .replay-play-list,
        .fullscreen-grid.grid-8:not([data-page]) .replay-play-info {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Back Button -->
    <button class="back-btn" id="back-btn">Back to Home</button>

    <!-- Hover trigger zone for global controls -->
    <div class="global-controls-trigger" id="global-controls-trigger"></div>

    <!-- Global Replay Controls (shown in replay mode) -->
    <div class="global-replay-controls" id="global-replay-controls">
        <div class="replay-badge">REPLAY MODE</div>
        <button class="global-replay-btn" id="global-play-all">Play All</button>
        <button class="global-replay-btn" id="global-pause-all">Pause All</button>
        <button class="global-replay-btn" id="global-reset-all">Reset All</button>
        <div class="replay-jump-control">
            <span class="replay-jump-label">Jump to:</span>
            <input type="number" class="replay-jump-input" id="global-jump-input" min="1" placeholder="#"
                title="Enter play number and press Enter">
            <button class="global-replay-btn replay-jump-btn" id="global-jump-btn">Go</button>
        </div>
        <div class="replay-speed-control">
            <span class="replay-speed-label">Speed:</span>
            <div class="speed-preset-btns">
                <button class="speed-preset-btn" data-speed="8000">0.25x</button>
                <button class="speed-preset-btn" data-speed="6000">0.5x</button>
                <button class="speed-preset-btn active" data-speed="3000">1x</button>
                <button class="speed-preset-btn" data-speed="1500">2x</button>
                <button class="speed-preset-btn" data-speed="750">4x</button>
            </div>
        </div>
    </div>

    <!-- Fullscreen Grid Container -->
    <div class="fullscreen-container active" id="fullscreen-container">
        <div class="fullscreen-grid" id="fullscreen-grid">
            <!-- Game cards rendered dynamically -->
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div class="exit-modal" id="exit-modal">
        <div class="exit-modal-content">
            <h2>Exit Sports Bar Mode?</h2>
            <div class="exit-modal-buttons">
                <button class="exit-modal-btn confirm focused" id="confirm-exit">Yes, Exit</button>
                <button class="exit-modal-btn cancel" id="cancel-exit">Stay</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STATE
        // ============================================
        let games = [];
        let refreshInterval = null;
        let isModalOpen = false;
        let modalFocusIndex = 0; // 0 = confirm, 1 = cancel

        // SVG Field Visualizers map (gameId -> SVGFieldVisualizer instance)
        // Exposed globally so play-animations.js can access visualizers
        window.fieldVisualizers = new Map();

        // MLB LiveCast instances map (gameId -> MLBLiveCast instance)
        window.mlbLiveCasts = new Map();

        // Replay Mode State
        let isReplayMode = false;
        let replayManager = null;

        // Stats modal timing state per game
        // Each game tracks: { noPlayStartTime, isShowingStats, showStartTime, currentPhase, cachedStats }
        // currentPhase: 0 = away team, 1 = home team
        const statsModalState = new Map();

        // NBA Scorer Notification State
        const nbaScoreTracker = new Map(); // gameId -> { away: score, home: score }
        const nbaAnimationQueue = new Map(); // gameId -> { queue: [], isPlaying: boolean }
        const nbaFetchLock = new Map(); // gameId -> boolean (prevents concurrent API fetches)

        // League logos
        const leagueLogos = {
            'nfl': '/assets/nfl-logo.png',
            'nba': '/assets/nba-logo.png',
            'mlb': '/assets/mlb-logo.png',
            'nhl': '/assets/nhl-logo.png',
            'ncaa': '/assets/ncaa-logo.png',
            'ncaab': '/assets/ncaa-basketball.png'
        };

        // NFL/NCAA Team Colors (primary)
        const teamColors = {
            // NFL Teams
            'ARI': '#97233F', 'ATL': '#A71930', 'BAL': '#241773', 'BUF': '#00338D',
            'CAR': '#0085CA', 'CHI': '#C83803', 'CIN': '#FB4F14', 'CLE': '#311D00',
            'DAL': '#003594', 'DEN': '#FB4F14', 'DET': '#0076B6', 'GB': '#203731',
            'HOU': '#03202F', 'IND': '#002C5F', 'JAX': '#006778', 'KC': '#E31837',
            'LAC': '#0080C6', 'LAR': '#003594', 'LV': '#000000', 'MIA': '#008E97',
            'MIN': '#4F2683', 'NE': '#002244', 'NO': '#D3BC8D', 'NYG': '#0B2265',
            'NYJ': '#125740', 'PHI': '#004C54', 'PIT': '#FFB612', 'SF': '#AA0000',
            'SEA': '#002244', 'TB': '#D50A0A', 'TEN': '#0C2340', 'WSH': '#5A1414',
            // NBA Teams
            'ATL': '#E03A3E', 'BOS': '#007A33', 'BKN': '#000000', 'CHA': '#1D1160',
            'CHI': '#CE1141', 'CLE': '#6F263D', 'DAL': '#00538C', 'DEN': '#0E2240',
            'DET': '#C8102E', 'GSW': '#1D428A', 'HOU': '#CE1141', 'IND': '#002D62',
            'LAC': '#C8102E', 'LAL': '#552583', 'MEM': '#5D76A9', 'MIA': '#98002E',
            'MIL': '#00471B', 'MIN': '#0C2340', 'NOP': '#0C2340', 'NYK': '#006BB6',
            'OKC': '#007AC1', 'ORL': '#0077C0', 'PHI': '#006BB6', 'PHX': '#1D1160',
            'POR': '#E03A3E', 'SAC': '#5A2D81', 'SAS': '#C4CED4', 'TOR': '#CE1141',
            'UTA': '#002B5C', 'WAS': '#002B5C'
        };

        function getTeamColor(abbr, league) {
            // Use league-specific colors for accurate team matching
            if (league === 'ncaa') {
                const ncaaColor = NCAA_TEAM_COLORS[abbr];
                if (ncaaColor) return ncaaColor.primary;
            } else if (league === 'nfl') {
                const nflColor = NFL_TEAM_COLORS[abbr];
                if (nflColor) return nflColor.primary;
            }
            // Fallback to generic teamColors object
            return teamColors[abbr] || '#fbbf24';
        }

        // Team colors with primary and secondary for scoreboard
        const NFL_TEAM_COLORS = {
            'ARI': { primary: '#97233F', secondary: '#000000' },
            'ATL': { primary: '#A71930', secondary: '#000000' },
            'BAL': { primary: '#241773', secondary: '#000000' },
            'BUF': { primary: '#00338D', secondary: '#C60C30' },
            'CAR': { primary: '#0085CA', secondary: '#101820' },
            'CHI': { primary: '#C83803', secondary: '#0B162A' },
            'CIN': { primary: '#FB4F14', secondary: '#000000' },
            'CLE': { primary: '#311D00', secondary: '#FF3C00' },
            'DAL': { primary: '#003594', secondary: '#041E42' },
            'DEN': { primary: '#FB4F14', secondary: '#002244' },
            'DET': { primary: '#0076B6', secondary: '#B0B7BC' },
            'GB': { primary: '#203731', secondary: '#FFB612' },
            'HOU': { primary: '#03202F', secondary: '#A71930' },
            'IND': { primary: '#002C5F', secondary: '#A2AAAD' },
            'JAX': { primary: '#006778', secondary: '#9F792C' },
            'KC': { primary: '#E31837', secondary: '#FFB81C' },
            'LAC': { primary: '#0080C6', secondary: '#FFC20E' },
            'LAR': { primary: '#003594', secondary: '#FFA300' },
            'LA': { primary: '#003594', secondary: '#FFA300' }, // ESPN uses LA for Rams
            'LV': { primary: '#000000', secondary: '#A5ACAF' },
            'MIA': { primary: '#008E97', secondary: '#FC4C02' },
            'MIN': { primary: '#4F2683', secondary: '#FFC62F' },
            'NE': { primary: '#002244', secondary: '#C60C30' },
            'NO': { primary: '#D3BC8D', secondary: '#101820' },
            'NYG': { primary: '#0B2265', secondary: '#A71930' },
            'NYJ': { primary: '#125740', secondary: '#000000' },
            'PHI': { primary: '#004C54', secondary: '#A5ACAF' },
            'PIT': { primary: '#FFB612', secondary: '#101820' },
            'SF': { primary: '#AA0000', secondary: '#B3995D' },
            'SEA': { primary: '#002244', secondary: '#69BE28' },
            'TB': { primary: '#D50A0A', secondary: '#FF7900' },
            'TEN': { primary: '#0C2340', secondary: '#4B92DB' },
            'WSH': { primary: '#5A1414', secondary: '#FFB612' },
            'WAS': { primary: '#5A1414', secondary: '#FFB612' }, // ESPN uses WAS for Washington
            'JAC': { primary: '#006778', secondary: '#9F792C' } // ESPN alias for JAX
        };

        // NCAA Football Team Colors (College)
        const NCAA_TEAM_COLORS = {
            'ALA': { primary: '#9E1B32', secondary: '#828A8F' },
            'ARIZ': { primary: '#CC0033', secondary: '#003366' },
            'ASU': { primary: '#8C1D40', secondary: '#FFC627' },
            'ARK': { primary: '#9D2235', secondary: '#000000' },
            'AUB': { primary: '#0C2340', secondary: '#E87722' },
            'BAY': { primary: '#154734', secondary: '#FFB81C' },
            'BGSU': { primary: '#FE5000', secondary: '#4F2C1D' },
            'BSU': { primary: '#0033A0', secondary: '#D64309' },
            'BC': { primary: '#98002E', secondary: '#BC9B6A' },
            'CAL': { primary: '#003262', secondary: '#FDB515' },
            'CLEM': { primary: '#F56600', secondary: '#522D80' },
            'COLO': { primary: '#CFB87C', secondary: '#000000' },
            'CONN': { primary: '#000E2F', secondary: '#E4002B' },
            'DUKE': { primary: '#003087', secondary: '#FFFFFF' },
            'FLA': { primary: '#0021A5', secondary: '#FA4616' },
            'FSU': { primary: '#782F40', secondary: '#CEB888' },
            'UGA': { primary: '#BA0C2F', secondary: '#000000' },
            'GT': { primary: '#B3A369', secondary: '#003057' },
            'HAW': { primary: '#024731', secondary: '#000000' },
            'HOU': { primary: '#C8102E', secondary: '#FFFFFF' },
            'ILL': { primary: '#E84A27', secondary: '#13294B' },
            'IND': { primary: '#990000', secondary: '#EEEDEB' },
            'IOWA': { primary: '#FFCD00', secondary: '#000000' },
            'ISU': { primary: '#C8102E', secondary: '#F1BE48' },
            'KU': { primary: '#0051BA', secondary: '#E8000D' },
            'UK': { primary: '#0033A0', secondary: '#FFFFFF' },
            'LSU': { primary: '#461D7C', secondary: '#FDD023' },
            'LOU': { primary: '#AD0000', secondary: '#000000' },
            'MD': { primary: '#E03A3E', secondary: '#FFD520' },
            'MICH': { primary: '#00274C', secondary: '#FFCB05' },
            'MSU': { primary: '#18453B', secondary: '#FFFFFF' },
            'MINN': { primary: '#7A0019', secondary: '#FFCC33' },
            'MISS': { primary: '#CE1126', secondary: '#14213D' },
            'MSST': { primary: '#660000', secondary: '#FFFFFF' },
            'MIZ': { primary: '#F1B82D', secondary: '#000000' },
            'NEB': { primary: '#E41C38', secondary: '#F5F1E7' },
            'NEV': { primary: '#003366', secondary: '#807F84' },
            'UNM': { primary: '#BA0C2F', secondary: '#63666A' },
            'NC': { primary: '#7BAFD4', secondary: '#13294B' },
            'NCST': { primary: '#CC0000', secondary: '#000000' },
            'NW': { primary: '#4E2A84', secondary: '#000000' },
            'ND': { primary: '#0C2340', secondary: '#C99700' },
            'OHIO': { primary: '#00694E', secondary: '#FFFFFF' },
            'OSU': { primary: '#BB0000', secondary: '#666666' },
            'OKLA': { primary: '#841617', secondary: '#FDF9D8' },
            'OKST': { primary: '#FF7300', secondary: '#000000' },
            'ORE': { primary: '#154733', secondary: '#FEE123' },
            'ORST': { primary: '#DC4405', secondary: '#000000' },
            'PSU': { primary: '#041E42', secondary: '#FFFFFF' },
            'PITT': { primary: '#003594', secondary: '#FFB81C' },
            'PUR': { primary: '#CEB888', secondary: '#000000' },
            'RICE': { primary: '#002469', secondary: '#5E6A71' },
            'RUTG': { primary: '#CC0033', secondary: '#5F6A72' },
            'SC': { primary: '#73000A', secondary: '#000000' },
            'SDSU': { primary: '#A6192E', secondary: '#000000' },
            'SMU': { primary: '#0033A0', secondary: '#C8102E' },
            'STAN': { primary: '#8C1515', secondary: '#FFFFFF' },
            'SYR': { primary: '#F76900', secondary: '#000E54' },
            'TCU': { primary: '#4D1979', secondary: '#A3A9AC' },
            'TEM': { primary: '#9D2235', secondary: '#000000' },
            'TENN': { primary: '#FF8200', secondary: '#FFFFFF' },
            'TEX': { primary: '#BF5700', secondary: '#FFFFFF' },
            'TXAM': { primary: '#500000', secondary: '#FFFFFF' },
            'TTU': { primary: '#CC0000', secondary: '#000000' },
            'TLSA': { primary: '#002D62', secondary: '#C8A875' },
            'UCLA': { primary: '#2D68C4', secondary: '#F2A900' },
            'USC': { primary: '#990000', secondary: '#FFC72C' },
            'UTAH': { primary: '#CC0000', secondary: '#000000' },
            'UVA': { primary: '#232D4B', secondary: '#F84C1E' },
            'VT': { primary: '#630031', secondary: '#CF4420' },
            'WAKE': { primary: '#9E7E38', secondary: '#000000' },
            'UW': { primary: '#4B2E83', secondary: '#B7A57A' },
            'WSU': { primary: '#981E32', secondary: '#5E6A71' },
            'WVU': { primary: '#002855', secondary: '#EAAA00' },
            'WIS': { primary: '#C5050C', secondary: '#FFFFFF' },
            'WYO': { primary: '#492F24', secondary: '#FFC425' },
            'ARMY': { primary: '#000000', secondary: '#D3BC8D' },
            'NAVY': { primary: '#00205B', secondary: '#C5B783' },
            'AFAL': { primary: '#003087', secondary: '#8A8D8F' },
            'MIA': { primary: '#F47321', secondary: '#005030' },
            'MIAMI': { primary: '#F47321', secondary: '#005030' },
            'UCF': { primary: '#BA9B37', secondary: '#000000' },
            'USF': { primary: '#006747', secondary: '#CFC493' },
            'FAU': { primary: '#003366', secondary: '#CC0000' },
            'FIU': { primary: '#081E3F', secondary: '#B6862C' },
            'CIN': { primary: '#E00122', secondary: '#000000' },
            'MEM': { primary: '#003087', secondary: '#898D8D' },
            'TUL': { primary: '#002D62', secondary: '#418FDE' },
            'TULN': { primary: '#006747', secondary: '#87CEEB' },
            'ECU': { primary: '#592A8A', secondary: '#FFC72C' },
            'APP': { primary: '#FFCC00', secondary: '#000000' },
            'CHAR': { primary: '#046A38', secondary: '#B9975B' },
            'JMU': { primary: '#450084', secondary: '#CBB677' },
            'MRSH': { primary: '#00B140', secondary: '#000000' },
            'ODU': { primary: '#003057', secondary: '#7C878E' },
            'GASO': { primary: '#011E41', secondary: '#87714D' },
            'GAST': { primary: '#002649', secondary: '#C60C30' },
            'CCU': { primary: '#006F71', secondary: '#A27752' },
            'ARST': { primary: '#CC092F', secondary: '#000000' },
            'SJSU': { primary: '#0055A2', secondary: '#E5A823' },
            'FRES': { primary: '#DB0032', secondary: '#13284C' },
            'UNLV': { primary: '#CF0A2C', secondary: '#666666' },
            'CSU': { primary: '#1E4D2B', secondary: '#C8C372' },
            'AFA': { primary: '#003087', secondary: '#8A8D8F' },
            'NMSU': { primary: '#8B0000', secondary: '#000000' },
            'UTEP': { primary: '#FF8200', secondary: '#041E42' },
            'UTSA': { primary: '#0C2340', secondary: '#F15A22' },
            'UNT': { primary: '#00853E', secondary: '#000000' },
            'MTSU': { primary: '#0066CC', secondary: '#000000' },
            'WKU': { primary: '#B01E24', secondary: '#000000' },
            'LT': { primary: '#003087', secondary: '#C8102E' },
            'RICE': { primary: '#002469', secondary: '#5E6A71' },
            'BUFF': { primary: '#005BBB', secondary: '#000000' },
            'KENT': { primary: '#002664', secondary: '#EAAB00' },
            'AKRN': { primary: '#041E42', secondary: '#A89968' },
            'BALL': { primary: '#BA0C2F', secondary: '#000000' },
            'CMU': { primary: '#6A0032', secondary: '#FFC82E' },
            'EMU': { primary: '#006633', secondary: '#000000' },
            'MAC': { primary: '#6A0032', secondary: '#FFC82E' },
            'NIU': { primary: '#BA0C2F', secondary: '#000000' },
            'OHIO': { primary: '#00694E', secondary: '#000000' },
            'TOL': { primary: '#003E7E', secondary: '#FFCE00' },
            'WMU': { primary: '#6C4023', secondary: '#B5A167' }
        };

        const NBA_TEAM_COLORS = {
            'ATL': { primary: '#E03A3E', secondary: '#C1D32F' },
            'BOS': { primary: '#007A33', secondary: '#BA9653' },
            'BKN': { primary: '#000000', secondary: '#FFFFFF' },
            'CHA': { primary: '#1D1160', secondary: '#00788C' },
            'CHI': { primary: '#CE1141', secondary: '#000000' },
            'CLE': { primary: '#6F263D', secondary: '#FFB81C' },
            'DAL': { primary: '#00538C', secondary: '#002B5E' },
            'DEN': { primary: '#0E2240', secondary: '#FEC524' },
            'DET': { primary: '#C8102E', secondary: '#1D42BA' },
            'GSW': { primary: '#1D428A', secondary: '#FFC72C' },
            'HOU': { primary: '#CE1141', secondary: '#000000' },
            'IND': { primary: '#002D62', secondary: '#FDBB30' },
            'LAC': { primary: '#C8102E', secondary: '#1D428A' },
            'LAL': { primary: '#552583', secondary: '#FDB927' },
            'MEM': { primary: '#5D76A9', secondary: '#12173F' },
            'MIA': { primary: '#98002E', secondary: '#F9A01B' },
            'MIL': { primary: '#00471B', secondary: '#EEE1C6' },
            'MIN': { primary: '#0C2340', secondary: '#236192' },
            'NOP': { primary: '#0C2340', secondary: '#C8102E' },
            'NYK': { primary: '#006BB6', secondary: '#F58426' },
            'OKC': { primary: '#007AC1', secondary: '#EF3B24' },
            'ORL': { primary: '#0077C0', secondary: '#C4CED4' },
            'PHI': { primary: '#006BB6', secondary: '#ED174C' },
            'PHX': { primary: '#1D1160', secondary: '#E56020' },
            'POR': { primary: '#E03A3E', secondary: '#000000' },
            'SAC': { primary: '#5A2D81', secondary: '#63727A' },
            'SAS': { primary: '#C4CED4', secondary: '#000000' },
            'TOR': { primary: '#CE1141', secondary: '#000000' },
            'UTA': { primary: '#002B5C', secondary: '#00471B' },
            'WAS': { primary: '#002B5C', secondary: '#E31837' },
            // ESPN abbreviation aliases
            'BRK': { primary: '#000000', secondary: '#FFFFFF' },
            'NO': { primary: '#0C2340', secondary: '#C8102E' },
            'PHO': { primary: '#1D1160', secondary: '#E56020' },
            'GS': { primary: '#1D428A', secondary: '#FFC72C' },
            'SA': { primary: '#C4CED4', secondary: '#000000' },
            'NY': { primary: '#006BB6', secondary: '#F58426' },
            'UTAH': { primary: '#002B5C', secondary: '#00471B' },
            'WSH': { primary: '#002B5C', secondary: '#E31837' }
        };

        const NHL_TEAM_COLORS = {
            'ANA': { primary: '#F47A38', secondary: '#B9975B' },
            'ARI': { primary: '#8C2633', secondary: '#E2D6B5' },
            'BOS': { primary: '#FFB81C', secondary: '#000000' },
            'BUF': { primary: '#002654', secondary: '#FCB514' },
            'CGY': { primary: '#C8102E', secondary: '#F1BE48' },
            'CAR': { primary: '#CC0000', secondary: '#000000' },
            'CHI': { primary: '#CF0A2C', secondary: '#000000' },
            'COL': { primary: '#6F263D', secondary: '#236192' },
            'CBJ': { primary: '#002654', secondary: '#CE1141' },
            'DAL': { primary: '#006847', secondary: '#8F8F8C' },
            'DET': { primary: '#CE1126', secondary: '#FFFFFF' },
            'EDM': { primary: '#041E42', secondary: '#FF4C00' },
            'FLA': { primary: '#041E42', secondary: '#C8102E' },
            'LAK': { primary: '#111111', secondary: '#A2AAAD' },
            'MIN': { primary: '#154734', secondary: '#A6192E' },
            'MTL': { primary: '#AF1E2D', secondary: '#192168' },
            'NSH': { primary: '#FFB81C', secondary: '#041E42' },
            'NJD': { primary: '#CE1126', secondary: '#000000' },
            'NYI': { primary: '#00539B', secondary: '#F47D30' },
            'NYR': { primary: '#0038A8', secondary: '#CE1126' },
            'OTT': { primary: '#C52032', secondary: '#C2912C' },
            'PHI': { primary: '#F74902', secondary: '#000000' },
            'PIT': { primary: '#FCB514', secondary: '#000000' },
            'SJS': { primary: '#006D75', secondary: '#EA7200' },
            'SEA': { primary: '#001628', secondary: '#99D9D9' },
            'STL': { primary: '#002F87', secondary: '#FCB514' },
            'TBL': { primary: '#002868', secondary: '#FFFFFF' },
            'TOR': { primary: '#00205B', secondary: '#FFFFFF' },
            'UTA': { primary: '#71AFE5', secondary: '#010101' },
            'VAN': { primary: '#00205B', secondary: '#00843D' },
            'VGK': { primary: '#B4975A', secondary: '#333F42' },
            'WSH': { primary: '#C8102E', secondary: '#041E42' },
            'WPG': { primary: '#041E42', secondary: '#004C97' },
            // ESPN abbreviation aliases
            'LA': { primary: '#111111', secondary: '#A2AAAD' },   // Los Angeles Kings
            'NJ': { primary: '#CE1126', secondary: '#000000' },   // New Jersey Devils
            'TB': { primary: '#002868', secondary: '#FFFFFF' },   // Tampa Bay Lightning
            'SJ': { primary: '#006D75', secondary: '#EA7200' },   // San Jose Sharks
            'VEG': { primary: '#B4975A', secondary: '#333F42' },  // Vegas Golden Knights
            'WAS': { primary: '#C8102E', secondary: '#041E42' }   // Washington Capitals
        };

        const MLB_TEAM_COLORS = {
            'ARI': { primary: '#A71930', secondary: '#E3D4AD' },
            'ATL': { primary: '#CE1141', secondary: '#13274F' },
            'BAL': { primary: '#DF4601', secondary: '#000000' },
            'BOS': { primary: '#BD3039', secondary: '#0C2340' },
            'CHC': { primary: '#0E3386', secondary: '#CC3433' },
            'CWS': { primary: '#27251F', secondary: '#C4CED4' },
            'CIN': { primary: '#C6011F', secondary: '#000000' },
            'CLE': { primary: '#00385D', secondary: '#E50022' },
            'COL': { primary: '#33006F', secondary: '#C4CED4' },
            'DET': { primary: '#0C2340', secondary: '#FA4616' },
            'HOU': { primary: '#002D62', secondary: '#EB6E1F' },
            'KC': { primary: '#004687', secondary: '#BD9B60' },
            'LAA': { primary: '#BA0021', secondary: '#003263' },
            'LAD': { primary: '#005A9C', secondary: '#EF3E42' },
            'MIA': { primary: '#00A3E0', secondary: '#EF3340' },
            'MIL': { primary: '#12284B', secondary: '#B6922E' },
            'MIN': { primary: '#002B5C', secondary: '#D31145' },
            'NYM': { primary: '#002D72', secondary: '#FF5910' },
            'NYY': { primary: '#003087', secondary: '#E4002C' },
            'OAK': { primary: '#003831', secondary: '#EFB21E' },
            'PHI': { primary: '#E81828', secondary: '#002D72' },
            'PIT': { primary: '#27251F', secondary: '#FDB827' },
            'SD': { primary: '#2F241D', secondary: '#FFC425' },
            'SF': { primary: '#FD5A1E', secondary: '#27251F' },
            'SEA': { primary: '#0C2C56', secondary: '#005C5C' },
            'STL': { primary: '#C41E3A', secondary: '#0C2340' },
            'TB': { primary: '#092C5C', secondary: '#8FBCE6' },
            'TEX': { primary: '#003278', secondary: '#C0111F' },
            'TOR': { primary: '#134A8E', secondary: '#E8291C' },
            'WSH': { primary: '#AB0003', secondary: '#14225A' },
            // ESPN abbreviation aliases
            'CHW': { primary: '#27251F', secondary: '#C4CED4' },  // Chicago White Sox
            'WAS': { primary: '#AB0003', secondary: '#14225A' },  // Washington Nationals
            'TBR': { primary: '#092C5C', secondary: '#8FBCE6' },  // Tampa Bay Rays
            'AZ': { primary: '#A71930', secondary: '#E3D4AD' }    // Arizona Diamondbacks
        };

        // Get team colors for scoreboard
        function getScoreboardColors(league, abbr) {
            const defaultColors = { primary: '#4b5563', secondary: '#374151' };

            if (league === 'nfl') {
                return NFL_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'ncaa') {
                return NCAA_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'nba' || league === 'ncaab') {
                return NBA_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'nhl') {
                return NHL_TEAM_COLORS[abbr] || defaultColors;
            } else if (league === 'mlb') {
                return MLB_TEAM_COLORS[abbr] || defaultColors;
            }
            return defaultColors;
        }

        // Parse game status for period/quarter and time
        function parseGameStatus(status, league) {
            if (!status) return { period: '', time: '' };

            // Handle common status formats
            const parts = status.split(' - ');
            if (parts.length === 2) {
                return { period: parts[0], time: parts[1] };
            }

            // Replay format: "Q1 15:00", "Q4 2:35"
            const replayMatch = status.match(/^Q(\d+)\s+(\d+:\d+)$/i);
            if (replayMatch) {
                return { period: `Q${replayMatch[1]}`, time: replayMatch[2] };
            }

            // Try to extract period and time
            const match = status.match(/^(\d+(?:st|nd|rd|th)|OT\d*|[A-Z]+)\s+(.+)$/i);
            if (match) {
                return { period: match[1], time: match[2] };
            }

            // NFL/NCAA format: "3rd 5:42"
            const nflMatch = status.match(/^(\d+(?:st|nd|rd|th))\s+(\d+:\d+)$/i);
            if (nflMatch) {
                return { period: nflMatch[1], time: nflMatch[2] };
            }

            // Just return the full status as time if can't parse
            return { period: '', time: status };
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        // Store original games for orientation changes
        let originalGames = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadGames();
            originalGames = [...games]; // Store original games before any tablet restrictions

            if (games.length === 0) {
                showEmptyState();
                return;
            }

            renderGrid();
            setupKeyboardNavigation();

            // Setup replay controls if in replay mode
            if (isReplayMode) {
                setupReplayControls();
            }

            // Only start auto-refresh if NOT using mock data
            if (!usingMockData) {
                // Immediately fetch fresh data to avoid stale localStorage data
                refreshGameData();
                startAutoRefresh();
            } else {
                console.log('📺 Mock data mode - auto-refresh disabled');
            }

            // Update stats modals for NFL games - check every 2 seconds for phase transitions
            updateStatsModals();
            setInterval(updateStatsModals, 2000);

            // Focus back button
            document.getElementById('back-btn').focus();

            // Handle orientation changes for tablet (re-render grid when rotating)
            if (isTabletDevice()) {
                window.addEventListener('orientationchange', () => {
                    // Restore original games and re-apply tablet restrictions
                    setTimeout(() => {
                        games = [...originalGames];
                        renderGrid();
                    }, 100); // Small delay for orientation to settle
                });

                // Also handle resize for desktop browser testing
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        games = [...originalGames];
                        renderGrid();
                    }, 250);
                });
            }
        });

        // Track if mock data is being used (to disable auto-refresh)
        let usingMockData = false;

        function loadGames() {
            const urlParams = new URLSearchParams(window.location.search);
            let replayGames = [];
            let liveGames = [];

            // Check for replay mode (URL parameter ?replay=true)
            const isReplayRequest = urlParams.get('replay') === 'true';
            // Parallel mode allows combining replay with live games (explicit opt-in)
            const wantParallelMode = urlParams.get('parallel') === 'true';

            if (isReplayRequest) {
                const replayLoaded = loadReplayGames();
                if (replayLoaded) {
                    isReplayMode = true;
                    document.body.classList.add('replay-mode');
                    replayGames = [...games]; // Copy replay games
                    console.log('🎬 Replay games loaded:', replayGames.length);

                    // In replay-only mode (no parallel flag), use only replay games
                    if (!wantParallelMode) {
                        games = replayGames;
                        usingMockData = true; // No live games to refresh
                        console.log('🎬 Replay-only mode with', games.length, 'games');
                        return;
                    }
                }
            }

            // Check for live games from localStorage (user-selected games)
            // Only load if not in replay-only mode
            // Skip if ?mock=true URL parameter is set (forces mock data)
            const forceMock = urlParams.get('mock') === 'true';
            if (!forceMock) {
                const saved = localStorage.getItem('gridtv_sports_bar_games');
                if (saved) {
                    try {
                        const parsedGames = JSON.parse(saved);
                        if (parsedGames.length > 0) {
                            liveGames = parsedGames;
                            console.log('📺 Live games loaded:', liveGames.length);
                        }
                    } catch (e) {
                        liveGames = [];
                    }
                }
            } else {
                console.log('🎭 Mock mode forced via URL parameter');
            }

            // Combine replay and live games if both exist (parallel mode was explicitly requested)
            if (replayGames.length > 0 && liveGames.length > 0 && wantParallelMode) {
                // Parallel mode: combine both types
                games = [...replayGames, ...liveGames];
                usingMockData = false; // Keep auto-refresh for live games
                console.log('🔀 Parallel mode: combining', replayGames.length, 'replay +', liveGames.length, 'live games');
                return;
            } else if (replayGames.length > 0) {
                // Replay-only mode
                games = replayGames;
                usingMockData = true; // No live games to refresh
                console.log('🎬 Replay-only mode with', games.length, 'games');
                return;
            } else if (liveGames.length > 0) {
                // Live-only mode
                games = liveGames;
                usingMockData = false;
                return;
            }

            // FALLBACK: Use mock live NFL games when no games are selected
            // This allows testing layouts directly without selecting games
            const USE_MOCK_DATA = false; // Set to false to disable mock fallback

            if (USE_MOCK_DATA && games.length === 0) {
                usingMockData = true;
                games = [
                    {
                        id: 'mock1',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '3rd 8:42',
                        away: { abbr: 'GB', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png', score: 21, record: '9-7-1', timeouts: 2 },
                        home: { abbr: 'CHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png', score: 17, record: '11-6', timeouts: 1 },
                        possession: 'away',
                        downDistance: '2nd & 7',
                        fieldPosition: 'CHI 35',
                        yardLine: 35,
                        yardsToGo: 7,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock2',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '4th 2:00',
                        away: { abbr: 'BUF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png', score: 28, record: '12-5', timeouts: 0 },
                        home: { abbr: 'JAX', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png', score: 24, record: '13-4', timeouts: 3 },
                        possession: 'home',
                        downDistance: '1st & 10',
                        fieldPosition: 'BUF 15',
                        yardLine: 15,
                        yardsToGo: 10,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock3',
                        league: 'nfl',
                        state: 'in', // LIVE - Red Zone!
                        status: '2nd 5:30',
                        away: { abbr: 'KC', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/kc.png', score: 14, record: '10-7', timeouts: 3 },
                        home: { abbr: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/mia.png', score: 10, record: '8-9', timeouts: 2 },
                        possession: 'away',
                        downDistance: '3rd & Goal',
                        fieldPosition: 'MIA 5',
                        yardLine: 5,
                        yardsToGo: 5,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock4',
                        league: 'nfl',
                        state: 'pre', // Upcoming
                        status: '1/12 4:30 PM EST',
                        away: { abbr: 'DAL', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/dal.png', score: '-', record: '7-10' },
                        home: { abbr: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png', score: '-', record: '11-6' }
                    },
                    {
                        id: 'mock5',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '1st 12:00',
                        away: { abbr: 'SF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png', score: 7, record: '11-6', timeouts: 3 },
                        home: { abbr: 'SEA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png', score: 0, record: '9-8', timeouts: 3 },
                        possession: 'home',
                        downDistance: '2nd & 5',
                        fieldPosition: 'SEA 40',
                        yardLine: 40,
                        yardsToGo: 5,
                        possessionOnOwn: true
                    },
                    {
                        id: 'mock6',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '2nd 3:15',
                        away: { abbr: 'LA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png', score: 10, record: '12-5', timeouts: 2 },
                        home: { abbr: 'CAR', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png', score: 7, record: '8-9', timeouts: 3 },
                        possession: 'away',
                        downDistance: '3rd & 3',
                        fieldPosition: 'CAR 42',
                        yardLine: 42,
                        yardsToGo: 3,
                        possessionOnOwn: false
                    },
                    {
                        id: 'mock7',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: 'Half',
                        away: { abbr: 'DEN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png', score: 14, record: '10-7', timeouts: 3 },
                        home: { abbr: 'LV', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lv.png', score: 14, record: '9-8', timeouts: 3 }
                    },
                    {
                        id: 'mock8',
                        league: 'nfl',
                        state: 'in', // LIVE
                        status: '4th 0:30',
                        away: { abbr: 'NYG', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png', score: 20, record: '6-11', timeouts: 0 },
                        home: { abbr: 'WAS', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png', score: 24, record: '11-6', timeouts: 1 },
                        possession: 'away',
                        downDistance: '4th & 15',
                        fieldPosition: 'NYG 25',
                        yardLine: 25,
                        yardsToGo: 15,
                        possessionOnOwn: true
                    }
                ];

                // Limit to selected mock game count from index page
                const mockGameCount = parseInt(localStorage.getItem('gridtv_mock_game_count')) || 8;
                games = games.slice(0, mockGameCount);
            }
        }

        // ============================================
        // REPLAY MODE FUNCTIONS
        // ============================================

        function loadReplayGames() {
            try {
                const data = sessionStorage.getItem('gridtv_replay_data');
                if (!data) {
                    console.warn('No replay data found in sessionStorage');
                    return false;
                }

                const replayData = JSON.parse(data);
                if (!replayData.games || !Array.isArray(replayData.games) || replayData.games.length === 0) {
                    console.warn('Invalid replay data format');
                    return false;
                }

                // Create replay manager
                replayManager = new ReplayManager();

                // Initialize games array with initial states
                games = [];
                replayData.games.forEach((gameData, index) => {
                    const gameId = gameData.id || `replay-game-${index + 1}`;
                    const metadata = gameData.metadata || {};

                    // Add engine to manager
                    const engine = replayManager.addGame(gameId, gameData.plays, metadata);

                    // Get initial game state and mark as replay
                    const initialState = engine.getCurrentGameState();
                    initialState.isReplay = true; // Mark as replay game
                    games.push(initialState);
                });

                // Set up update callback
                replayManager.onGameUpdate = handleReplayUpdate;

                // Apply grid size from URL if specified
                const urlParams = new URLSearchParams(window.location.search);
                const gridSize = parseInt(urlParams.get('grid'));
                if (gridSize && gridSize >= 1 && gridSize <= 8) {
                    games = games.slice(0, gridSize);
                }

                return true;
            } catch (e) {
                console.error('Failed to load replay data:', e);
                return false;
            }
        }

        function handleReplayUpdate(gameId, gameState, prevPlay) {
            // Find and update the game card
            const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
            if (!card) return;

            // Preserve the isReplay flag when updating
            gameState.isReplay = true;

            // Update the game in our games array
            const gameIndex = games.findIndex(g => g.id === gameId);
            if (gameIndex !== -1) {
                games[gameIndex] = gameState;
            }

            // Update scoreboard
            updateGameCardScoreboard(card, gameState);

            // Update field visualizer position (animations handled by analyzeAndAnimatePlay below)
            const visualizer = window.fieldVisualizers.get(gameId);

            // Ensure field is visible for replay mode
            const fieldContainer = card.querySelector('.field-visualizer');
            if (fieldContainer && fieldContainer.style.display === 'none') {
                fieldContainer.style.display = '';
            }

            if (visualizer && gameState.yardLine !== undefined) {
                // Calculate ball position for SVG (0-100)
                // Use startYard if play hasn't been executed yet, endYard after
                const ballPosition = gameState.playExecuted
                    ? (gameState.endYard || gameState.yardLine || 50)
                    : (gameState.startYard || gameState.yardLine || 50);

                // Check if we're about to animate
                const willAnimate = gameState.lastPlay && (!gameState.playExecuted || prevPlay);
                const isSpecialTeams = gameState.isKickoff || gameState.isPunt;
                const playType = gameState.playType?.toLowerCase() || '';
                const isPassOrRush = ['pass', 'complete', 'incomplete', 'rush', 'run', 'sack'].includes(playType);

                // Update first down line
                // For pass/rush animations: keep first down line at PREVIOUS position during animation
                // After animation completes, updateReplayDisplayAfterAnimation will set the new position
                if (willAnimate && isPassOrRush && prevPlay && !isSpecialTeams) {
                    // During animation: use PREVIOUS play's first down position
                    // prevPlay.down/distance represent the situation BEFORE this play
                    const prevDown = prevPlay.down || 0;
                    const prevDistance = prevPlay.yardsToGo || prevPlay.distance || 10;
                    const prevEndYard = prevPlay.endYard || prevPlay.yardLine || 50;
                    const showFirstDown = prevDown > 0;
                    if (prevDistance && prevPlay.possession && showFirstDown) {
                        const firstDownPos = calculateFirstDownForReplay(prevEndYard, prevDistance, prevPlay.possession);
                        visualizer.setFirstDownPosition(firstDownPos, showFirstDown);
                    } else {
                        visualizer.setFirstDownPosition(50, false);
                    }
                } else if (!isSpecialTeams) {
                    // Not animating or special teams: show current first down position
                    const showFirstDown = gameState.down > 0;
                    if (gameState.yardsToGo && gameState.possession && showFirstDown) {
                        const endPosition = gameState.endYard || gameState.yardLine || 50;
                        const firstDownPos = calculateFirstDownForReplay(endPosition, gameState.yardsToGo, gameState.possession);
                        visualizer.setFirstDownPosition(firstDownPos, showFirstDown);
                    } else {
                        visualizer.setFirstDownPosition(50, false);
                    }
                } else {
                    visualizer.setFirstDownPosition(50, false); // Hide for special teams
                }

                // Only set ball position directly if we're not animating
                // For first play (no prevPlay), still animate if playExecuted is false
                if (!willAnimate) {
                    visualizer.setBallPosition(ballPosition);
                }
            }

            // Trigger animations (UI overlays + SVG field) - same logic as live games
            // Also animate first play (when prevPlay is null) if playExecuted is false
            const shouldAnimate = gameState.lastPlay && (!gameState.playExecuted || prevPlay);
            if (shouldAnimate) {
                // For first play, use defaults for prev values
                const prevAwayScore = prevPlay?.awayScore || 0;
                const prevHomeScore = prevPlay?.homeScore || 0;
                const awayScoreChange = (gameState.away?.score || 0) - prevAwayScore;
                const homeScoreChange = (gameState.home?.score || 0) - prevHomeScore;
                const awayAbbr = gameState.away?.abbr || '';
                const homeAbbr = gameState.home?.abbr || '';

                // Build game context for intelligent play parser
                // For replay mode, yardLine is already in 0-100 field position format
                const gameContext = {
                    situation: {
                        // Use END position for animation target (where the play ends)
                        yardLine: gameState.endYard || gameState.yardLine,
                        down: gameState.down,
                        distance: gameState.yardsToGo,
                        isFieldPosition: true, // Replay data is already converted to 0-100 format
                        // END position text (e.g., "PIT 36") - used for animation target calculation
                        possessionText: gameState.possessionText || gameState.fieldPosition,
                        // Field position string for display (changes based on playExecuted)
                        fieldPosition: gameState.fieldPosition,
                        // START position (e.g., "HOU 18") for kickoff/punt origin
                        startPossessionText: gameState.startPossessionText,
                        startYard: gameState.startYard,
                        // Kickoff/Punt specific data for animations
                        kickLandingYard: gameState.kickLandingYard,
                        returnYards: gameState.returnYards,
                        isTouchback: gameState.isTouchback,
                        isFairCatch: gameState.isFairCatch
                    },
                    awayAbbr,
                    homeAbbr,
                    possession: gameState.possession,
                    awayScore: gameState.away?.score || 0,
                    homeScore: gameState.home?.score || 0
                };

                const prevState = {
                    awayScore: prevAwayScore,
                    homeScore: prevHomeScore,
                    possession: prevPlay?.possession || null,
                    lastPlay: prevPlay?.lastPlay || ''
                };

                // Execute SVG field animation FIRST, then show UI overlays after it completes
                const overlayOptions = {
                    awayTeam: { team: { abbreviation: awayAbbr, displayName: gameState.away?.name, logo: gameState.away?.logo } },
                    homeTeam: { team: { abbreviation: homeAbbr, displayName: gameState.home?.name, logo: gameState.home?.logo } },
                    awayScoreChange,
                    homeScoreChange,
                    prevDown: prevPlay?.down || 0,
                    currentDown: gameState.down || 0,
                    downDistanceText: gameState.downDistance || '',
                    prevDownDistance: prevPlay?.downDistance || '',
                    prevPossession: prevPlay?.possession,
                    currentPossession: gameState.possession,
                    fieldPosition: gameState.yardLine || gameState.fieldPosition || '',
                    awayAbbr,
                    homeAbbr,
                    // Play type info for accurate overlay detection (prevents false turnover-on-downs)
                    playType: gameState.playType || '',
                    isPunt: gameState.isPunt || false,
                    isKickoff: gameState.isKickoff || false,
                    // Previous play type - needed to detect if possession change was due to punt/kickoff
                    prevPlayType: prevPlay?.type || '',
                    prevIsPunt: prevPlay?.isPunt || prevPlay?.type === 'punt' || false,
                    prevIsKickoff: prevPlay?.isKickoff || prevPlay?.type === 'kickoff' || false
                };

                if (typeof parseAndAnimateNFLPlay === 'function') {
                    parseAndAnimateNFLPlay(gameState.lastPlay, gameContext, prevState, visualizer)
                        .then(result => {
                            if (result.errors.length > 0) {
                                console.warn('🎬 Replay animation errors:', result.errors);
                            }
                            // Mark play as executed and update final position
                            const engine = replayManager?.getEngine(gameId);
                            if (engine) {
                                engine.markPlayExecuted();
                                // Update display with final position after animation
                                updateReplayDisplayAfterAnimation(gameId, card, visualizer);
                            }
                            // Now show UI overlay AFTER field animation completes
                            if (typeof analyzeAndAnimatePlay === 'function') {
                                const cardId = card.dataset.gameId || card.id || 'unknown';
                                analyzeAndAnimatePlay(card, gameState.lastPlay, overlayOptions);
                                // Check if any overlay animations were actually queued
                                // If so, pause auto-play and set callback to resume when complete
                                if (typeof hasQueuedAnimations === 'function' && hasQueuedAnimations(cardId)) {
                                    const eng = replayManager?.getEngine(gameId);
                                    if (eng) eng.pauseForAnimation();
                                    // Set callback to resume when overlay animations complete
                                    if (typeof setAnimationCompleteCallback === 'function') {
                                        setAnimationCompleteCallback(cardId, () => {
                                            if (eng) eng.resumeFromAnimation();
                                        });
                                    }
                                }
                                // If no animations queued, auto-play continues normally
                            }
                        })
                        .catch(err => {
                            console.error('🎬 parseAndAnimateNFLPlay failed in replay:', err);
                            // Mark play as executed even if animation failed
                            const engine = replayManager?.getEngine(gameId);
                            if (engine) {
                                engine.markPlayExecuted();
                                updateReplayDisplayAfterAnimation(gameId, card, visualizer);
                            }
                            // Still show overlay even if field animation failed
                            if (typeof analyzeAndAnimatePlay === 'function') {
                                const cardId = card.dataset.gameId || card.id || 'unknown';
                                analyzeAndAnimatePlay(card, gameState.lastPlay, overlayOptions);
                                // Check if any overlay animations were actually queued
                                if (typeof hasQueuedAnimations === 'function' && hasQueuedAnimations(cardId)) {
                                    const eng = replayManager?.getEngine(gameId);
                                    if (eng) eng.pauseForAnimation();
                                    if (typeof setAnimationCompleteCallback === 'function') {
                                        setAnimationCompleteCallback(cardId, () => {
                                            if (eng) eng.resumeFromAnimation();
                                        });
                                    }
                                }
                            }
                        });
                } else if (typeof analyzeAndAnimatePlay === 'function') {
                    // Fallback if parseAndAnimateNFLPlay not available
                    const cardId = card.dataset.gameId || card.id || 'unknown';
                    analyzeAndAnimatePlay(card, gameState.lastPlay, overlayOptions);
                    // Check if any overlay animations were actually queued
                    if (typeof hasQueuedAnimations === 'function' && hasQueuedAnimations(cardId)) {
                        const eng = replayManager?.getEngine(gameId);
                        if (eng) eng.pauseForAnimation();
                        if (typeof setAnimationCompleteCallback === 'function') {
                            setAnimationCompleteCallback(cardId, () => {
                                if (eng) eng.resumeFromAnimation();
                            });
                        }
                    }
                }
            }

            // Update play list (prev/current/next)
            const replayEngine = replayManager?.getEngine(gameId);
            if (replayEngine) {
                // Animate scroll when play changes (when shouldAnimate is true)
                if (shouldAnimate) {
                    // Animation will update content after scroll completes
                    animatePlayListScroll(card, replayEngine, gameState);
                } else {
                    // No animation, just update content
                    updateReplayPlayList(card, replayEngine, gameState);
                }
            }

            // Update down/distance and field position info
            const playInfoEl = card.querySelector('.replay-play-info');
            if (playInfoEl) {
                const downDistEl = playInfoEl.querySelector('.down-distance');
                const fieldPosEl = playInfoEl.querySelector('.field-position');

                if (downDistEl) {
                    downDistEl.textContent = gameState.downDistance || '--';
                }
                if (fieldPosEl) {
                    fieldPosEl.textContent = gameState.fieldPosition || '--';
                }
            }

            // Update replay controls progress
            updateReplayProgress(gameId);
        }

        function calculateBallPositionForReplay(gameState) {
            // gameState.yardLine is already in 0-100 format from the parser
            return gameState.endYard || gameState.yardLine || 50;
        }

        function calculateFirstDownForReplay(ballPosition, yardsToGo, possession) {
            // Away team drives toward 100 (home end zone)
            // Home team drives toward 0 (away end zone)
            if (possession === 'away') {
                return Math.min(100, ballPosition + yardsToGo);
            } else {
                return Math.max(0, ballPosition - yardsToGo);
            }
        }

        /**
         * Update display after animation completes to show final position
         */
        function updateReplayDisplayAfterAnimation(gameId, card, visualizer) {
            const engine = replayManager?.getEngine(gameId);
            if (!engine) return;

            const gameState = engine.getCurrentGameState();
            if (!gameState) return;

            // Update ball position to end position
            const ballPosition = gameState.endYard || gameState.yardLine || 50;
            if (visualizer) {
                visualizer.setBallPosition(ballPosition);

                // Update first down line (keep visible after animation)
                // Don't show first down line for kickoffs/punts
                const isSpecialTeams = gameState.isKickoff || gameState.isPunt;
                if (gameState.yardsToGo && gameState.possession && gameState.down > 0 && !isSpecialTeams) {
                    // First down line calculated from END position (where down/distance come from)
                    const endPosition = gameState.endYard || gameState.yardLine || 50;
                    const firstDownPos = calculateFirstDownForReplay(endPosition, gameState.yardsToGo, gameState.possession);
                    visualizer.setFirstDownPosition(firstDownPos, true);
                } else {
                    visualizer.setFirstDownPosition(50, false); // Hide for special teams
                }
            }

            // Update field position display to show end position
            const playInfoEl = card?.querySelector('.replay-play-info');
            if (playInfoEl) {
                const fieldPosEl = playInfoEl.querySelector('.field-position');
                if (fieldPosEl) {
                    fieldPosEl.textContent = gameState.fieldPosition || '--';
                }
            }
        }

        function triggerPlayAnimation(visualizer, gameState, prevPlay) {
            const playType = gameState.playType?.toLowerCase();
            // For most plays, use previous play's end position as start
            const defaultStartYard = prevPlay?.endYard || prevPlay?.yardLine || 50;
            const endYard = gameState.endYard || gameState.yardLine || 50;

            // For kickoffs/punts, use the current play's startYard (where the kick originates)
            const kickStartYard = gameState.startYard || defaultStartYard;

            if (!playType || visualizer.state.animating) return;

            console.log(`[Replay Animation] Type: ${playType}, Start: ${kickStartYard}, End: ${endYard}`);

            switch (playType) {
                case 'pass':
                case 'complete':
                    visualizer.animatePass(defaultStartYard, endYard, 25, 1800);
                    break;
                case 'incomplete':
                    visualizer.animateIncompletePass(defaultStartYard, endYard, 1500);
                    break;
                case 'rush':
                case 'run':
                    visualizer.animateRush(defaultStartYard, endYard, 1200);
                    break;
                case 'sack':
                    // Sack field animation disabled - only card overlay animation is shown
                    // Just move ball to end position without animation
                    visualizer.setBallPosition(endYard);
                    break;
                case 'kickoff':
                    // Kickoff uses current play's startYard (kick origin), not previous play's endYard
                    visualizer.animateKickoff(kickStartYard, endYard, 0, 2000);
                    break;
                case 'punt':
                    // Punt uses current play's startYard (punt origin), not previous play's endYard
                    visualizer.animatePunt(kickStartYard, endYard, 0, 1800);
                    break;
                case 'field goal':
                case 'fg':
                case 'field_goal':
                    // Field goal uses kick start position
                    const direction = kickStartYard > 50 ? 'right' : 'left';
                    visualizer.animateFieldGoal(kickStartYard, direction, 2000);
                    break;
                case 'touchdown':
                case 'td':
                    const tdType = prevPlay?.type?.toLowerCase()?.includes('pass') ? 'pass' : 'rush';
                    visualizer.animateTouchdown(tdType, defaultStartYard, endYard, 1500);
                    break;
                case 'interception':
                case 'int':
                    visualizer.animateInterception(defaultStartYard, endYard, 0, 1200);
                    break;
                case 'fumble':
                case 'fum':
                    visualizer.animateFumble(defaultStartYard, endYard, null, gameState.possession === prevPlay?.possession, 1000);
                    break;
                case 'penalty':
                    visualizer.animatePenalty(defaultStartYard, endYard, 800);
                    break;
            }
        }

        function updateGameCardScoreboard(card, gameState) {
            // Update scores
            const awayScoreEl = card.querySelector('.fs-sb-score-box.away .fs-sb-score');
            const homeScoreEl = card.querySelector('.fs-sb-score-box.home .fs-sb-score');
            if (awayScoreEl) awayScoreEl.textContent = gameState.away.score;
            if (homeScoreEl) homeScoreEl.textContent = gameState.home.score;

            // Update time/period (update ALL clock elements - tablet-top-clock AND fs-sb-center)
            if (gameState.status) {
                const parts = parseGameStatus(gameState.status, 'nfl');
                card.querySelectorAll('.fs-sb-time').forEach(timeEl => {
                    timeEl.textContent = parts.time || gameState.status;
                });
                card.querySelectorAll('.fs-sb-time-label').forEach(timeLabelEl => {
                    timeLabelEl.textContent = parts.period || '';
                });
            }

            // Update down & distance (handle special plays like kickoffs)
            const downDistEl = card.querySelector('.fs-sb-down-distance');
            if (downDistEl) {
                if (gameState.downDistance) {
                    // Strip "at TEAM XX" from down distance (shown separately in ball-position)
                    const cleanDownDist = gameState.downDistance.replace(/\s+at\s+\w+\s+\d+$/i, '').trim();
                    downDistEl.textContent = cleanDownDist;
                } else if (gameState.playType) {
                    // Show play type for special plays (kickoff, punt, etc.)
                    const playType = gameState.playType.toUpperCase();
                    downDistEl.textContent = playType;
                } else {
                    downDistEl.textContent = '';
                }
            }

            // Update field position
            const fieldPosEl = card.querySelector('.fs-sb-ball-position');
            if (fieldPosEl) {
                fieldPosEl.textContent = gameState.fieldPosition || '';
            }

            // Update possession indicator
            const situationBox = card.querySelector('.fs-sb-situation');
            if (situationBox) {
                situationBox.classList.remove('possession-away', 'possession-home');
                if (gameState.possession === 'away') {
                    situationBox.classList.add('possession-away');
                } else if (gameState.possession === 'home') {
                    situationBox.classList.add('possession-home');
                }
            }

            // Update timeout bars
            updateTimeoutBars(card, '.fs-sb-timeouts.away', gameState.away?.timeouts);
            updateTimeoutBars(card, '.fs-sb-timeouts.home', gameState.home?.timeouts);
        }

        function updateTimeoutBars(card, selector, timeouts) {
            const container = card.querySelector(selector);
            if (!container || timeouts === undefined) return;

            const bars = container.querySelectorAll('.fs-sb-timeout-bar');
            const remaining = Math.max(0, Math.min(3, timeouts));

            bars.forEach((bar, index) => {
                if (index >= remaining) {
                    bar.classList.add('used');
                } else {
                    bar.classList.remove('used');
                }
            });
        }

        // ============================================
        // SCORE INCREMENT ANIMATION
        // ============================================
        /**
         * Animate a score change with increment display
         * @param {Element} scoreBox - The .fs-sb-score-box element
         * @param {number} oldScore - Previous score value
         * @param {number} newScore - New score value
         */
        function animateScoreIncrement(scoreBox, oldScore, newScore) {
            if (!scoreBox || oldScore === newScore) return;

            const increment = newScore - oldScore;
            if (increment <= 0) return; // Only animate score increases

            const scoreEl = scoreBox.querySelector('.fs-sb-score');
            if (!scoreEl) return;

            // Check if animation is already running
            if (scoreBox.classList.contains('score-animating')) return;

            // Create or get increment element
            let incrementEl = scoreBox.querySelector('.score-increment');
            if (!incrementEl) {
                incrementEl = document.createElement('span');
                incrementEl.className = 'score-increment';
                scoreBox.appendChild(incrementEl);
            }

            incrementEl.textContent = `+${increment}`;
            incrementEl.classList.remove('active');
            scoreBox.classList.add('score-animating');

            // Phase 1: Fade out current score (0-300ms)
            scoreEl.classList.add('score-fading-out');

            // Phase 2: Show increment after score fades (300ms)
            setTimeout(() => {
                incrementEl.classList.add('active');
            }, 300);

            // Phase 3: Update score text at 2.7s (before increment fades completely)
            setTimeout(() => {
                scoreEl.textContent = newScore;
                scoreEl.classList.remove('score-fading-out');
                scoreEl.classList.add('score-fading-in');
            }, 2700);

            // Phase 4: Clean up at 3.1s
            setTimeout(() => {
                scoreEl.classList.remove('score-fading-in');
                scoreBox.classList.remove('score-animating');
                incrementEl.classList.remove('active');
            }, 3100);
        }

        // ============================================
        // NBA SCORER NOTIFICATION SYSTEM
        // ============================================

        /**
         * Check for NBA score changes and trigger scorer notification
         * Handles both teams scoring simultaneously by queuing notifications
         */
        function checkNbaScoreChange(gameId, awayScore, homeScore) {
            const prev = nbaScoreTracker.get(gameId);
            if (!prev) {
                nbaScoreTracker.set(gameId, { away: awayScore, home: homeScore });
                return;
            }
            const awayScored = awayScore > prev.away;
            const homeScored = homeScore > prev.home;
            nbaScoreTracker.set(gameId, { away: awayScore, home: homeScore });

            // Queue notifications for each team that scored
            const scoringEvents = [];
            if (awayScored) {
                scoringEvents.push({ team: 'away', points: awayScore - prev.away });
            }
            if (homeScored) {
                scoringEvents.push({ team: 'home', points: homeScore - prev.home });
            }

            if (scoringEvents.length > 0) {
                fetchScoringPlays(gameId, scoringEvents);
            }
        }

        /**
         * Fetch scoring plays from NBA summary API and queue notifications
         */
        async function fetchScoringPlays(gameId, scoringEvents) {
            if (nbaFetchLock.get(gameId)) return;
            nbaFetchLock.set(gameId, true);

            try {
                const response = await fetch(`/api/nba/summary/${gameId}`);
                const data = await response.json();
                if (data._cache && data._cache.retryAfter) {
                    nbaFetchLock.set(gameId, false);
                    setTimeout(() => fetchScoringPlays(gameId, scoringEvents), data._cache.retryAfter * 1000);
                    return;
                }

                const plays = data.plays || [];
                const recentScoringPlays = [];
                const maxPlays = scoringEvents.length + 1;
                for (let i = plays.length - 1; i >= 0 && recentScoringPlays.length < maxPlays; i--) {
                    if (plays[i].scoringPlay && plays[i].scoreValue > 0) {
                        recentScoringPlays.push(plays[i]);
                    }
                }

                scoringEvents.forEach((event, index) => {
                    const play = recentScoringPlays[index];
                    const playerName = play ? extractPlayerName(play.text) : 'Score';
                    queueScorerNotification(gameId, event.team, playerName);
                });
            } catch (error) {
                console.error('Error fetching NBA scoring play:', error);
                scoringEvents.forEach(event => {
                    queueScorerNotification(gameId, event.team, 'Score');
                });
            } finally {
                nbaFetchLock.set(gameId, false);
            }
        }

        function extractPlayerName(playText) {
            if (!playText) return 'Score';
            const match = playText.match(/^([A-Z][a-z]+(?:\s+[A-Z][a-z'-]+)+)\s+(?:makes|hits|dunks|scores)/i);
            if (match) {
                const parts = match[1].split(' ');
                return parts.length >= 2 ? `${parts[0][0]}. ${parts[parts.length - 1]}` : match[1];
            }
            const nameMatch = playText.match(/^([A-Z][a-z]+\s+[A-Z][a-z'-]+)/);
            return nameMatch ? `${nameMatch[1].split(' ')[0][0]}. ${nameMatch[1].split(' ')[1]}` : 'Score';
        }

        /**
         * Queue a scorer notification to play after any current animations
         */
        function queueScorerNotification(gameId, team, playerName) {
            if (!nbaAnimationQueue.has(gameId)) {
                nbaAnimationQueue.set(gameId, { queue: [], isPlaying: false });
            }
            const gameQueue = nbaAnimationQueue.get(gameId);
            gameQueue.queue.push({ team, playerName });
            if (!gameQueue.isPlaying) {
                processAnimationQueue(gameId);
            }
        }

        /**
         * Process the animation queue for a game
         */
        function processAnimationQueue(gameId) {
            const gameQueue = nbaAnimationQueue.get(gameId);
            if (!gameQueue || gameQueue.queue.length === 0) {
                if (gameQueue) gameQueue.isPlaying = false;
                return;
            }
            gameQueue.isPlaying = true;
            const notification = gameQueue.queue.shift();
            showScorerNotification(gameId, notification.team, notification.playerName, () => {
                processAnimationQueue(gameId);
            });
        }

        /**
         * Show the scorer notification animation
         */
        function showScorerNotification(gameId, team, playerName, onComplete) {
            setTimeout(() => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (!card) {
                    if (onComplete) onComplete();
                    return;
                }
                const notification = card.querySelector(`.nba-scorer-notification.${team}`);
                if (!notification) {
                    if (onComplete) onComplete();
                    return;
                }
                notification.textContent = playerName || 'Score';
                notification.classList.remove('animate');
                void notification.offsetWidth;
                notification.classList.add('animate');
                setTimeout(() => {
                    notification.classList.remove('animate');
                    notification.textContent = '';
                    if (onComplete) onComplete();
                }, 3100);
            }, 3100);
        }

        // Update all game cards in place without destroying/recreating DOM
        function updateCardsInPlace() {
            // Check if number of cards matches number of games
            const grid = document.getElementById('fullscreen-grid');
            const existingCards = grid.querySelectorAll('.fullscreen-game-card');

            // If count doesn't match, we need a full re-render
            if (existingCards.length !== games.length) {
                console.log('📺 Game count changed, doing full re-render');
                renderGrid();
                return;
            }

            games.forEach((game, index) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${game.id}"]`);
                if (!card) return;

                const isFootball = game.league === 'nfl' || game.league === 'ncaa';
                const isLive = game.state === 'in';
                const isFinal = game.state === 'post';
                const isUpcoming = game.state === 'pre';

                // Update scores with animation for score increases
                const awayScoreBox = card.querySelector('.fs-sb-score-box.away');
                const homeScoreBox = card.querySelector('.fs-sb-score-box.home');
                const awayScoreEl = awayScoreBox?.querySelector('.fs-sb-score');
                const homeScoreEl = homeScoreBox?.querySelector('.fs-sb-score');

                if (awayScoreEl) {
                    const oldAwayScore = parseInt(awayScoreEl.textContent) || 0;
                    const newAwayScore = isUpcoming ? 0 : (parseInt(game.away.score) || 0);
                    if (!isUpcoming && newAwayScore > oldAwayScore && awayScoreEl.textContent !== '-') {
                        animateScoreIncrement(awayScoreBox, oldAwayScore, newAwayScore);
                    } else {
                        awayScoreEl.textContent = isUpcoming ? '-' : game.away.score;
                    }
                }

                if (homeScoreEl) {
                    const oldHomeScore = parseInt(homeScoreEl.textContent) || 0;
                    const newHomeScore = isUpcoming ? 0 : (parseInt(game.home.score) || 0);
                    if (!isUpcoming && newHomeScore > oldHomeScore && homeScoreEl.textContent !== '-') {
                        animateScoreIncrement(homeScoreBox, oldHomeScore, newHomeScore);
                    } else {
                        homeScoreEl.textContent = isUpcoming ? '-' : game.home.score;
                    }
                }

                // Check for NBA score changes (for scorer notifications)
                if (game.league === 'nba' && isLive) {
                    checkNbaScoreChange(game.id, parseInt(game.away.score) || 0, parseInt(game.home.score) || 0);
                }

                // Update time/period (update ALL clock elements - tablet-top-clock AND fs-sb-center)
                if (game.status) {
                    const parts = parseGameStatus(game.status, game.league);
                    card.querySelectorAll('.fs-sb-time').forEach(timeEl => {
                        timeEl.textContent = parts.time || game.status;
                    });
                    card.querySelectorAll('.fs-sb-time-label').forEach(timeLabelEl => {
                        timeLabelEl.textContent = parts.period || '';
                    });
                }

                // Update status text element
                const statusTextEl = card.querySelector('.fs-status-text');
                if (statusTextEl) {
                    statusTextEl.textContent = game.status || '';
                    statusTextEl.className = 'fs-status-text';
                    if (isUpcoming) statusTextEl.classList.add('upcoming');
                    else if (isFinal) statusTextEl.classList.add('final');
                }

                // Update card classes for win/loss state
                card.classList.remove('winning-away', 'winning-home', 'tied', 'upcoming-game', 'final-game');
                if (isUpcoming) {
                    card.classList.add('upcoming-game');
                } else if (isFinal) {
                    card.classList.add('final-game');
                    if (game.away.score > game.home.score) card.classList.add('winning-away');
                    else if (game.home.score > game.away.score) card.classList.add('winning-home');
                    else card.classList.add('tied');
                } else if (isLive) {
                    if (game.away.score > game.home.score) card.classList.add('winning-away');
                    else if (game.home.score > game.away.score) card.classList.add('winning-home');
                    else card.classList.add('tied');
                }

                // Update football-specific elements
                if (isFootball && isLive) {
                    // Check if game is in intermission (halftime, end of quarter, etc.)
                    const statusLower = (game.status || '').toLowerCase();
                    let isIntermission = statusLower.includes('halftime') ||
                        statusLower.includes('half') ||
                        statusLower.includes('end of') ||
                        statusLower.includes('intermission') ||
                        (statusLower.includes('2nd') && statusLower.includes('0:00')) ||
                        (statusLower.includes('4th') && statusLower.includes('0:00'));

                    // IMPORTANT: Check if a NEW play has arrived even though status still shows intermission
                    // ESPN sometimes sends the kickoff play before updating the game status
                    // In this case, we should show the field and situation box immediately
                    let forceShowField = false;
                    if (isIntermission && game.lastPlay) {
                        const prevData = prevGameData.get(game.id);
                        const prevLastPlay = prevData?.lastPlay || '';
                        // Normalize for comparison (ignore punctuation differences)
                        const normalizeText = (t) => (t || '').toLowerCase().replace(/[.,!?]/g, '').trim();
                        const hasNewPlay = normalizeText(game.lastPlay) !== normalizeText(prevLastPlay);
                        if (hasNewPlay) {
                            // New play arrived - game is active even if status hasn't updated
                            console.log(`🏈 New play arrived during intermission for ${game.id}, showing field`);
                            isIntermission = false;
                            forceShowField = true; // Force show even if downDistance isn't set yet
                        }
                    }

                    // Determine if we have valid play data to display
                    // Show situation box if we have downDistance OR yardLine (even if fieldPosition text isn't perfect)
                    // Also show if a new play just arrived (forceShowField) to prevent missing kickoff animations
                    const hasValidPlayData = !isIntermission && (
                        forceShowField ||
                        game.downDistance ||
                        (game.specialPlay && game.specialPlayText) ||
                        (game.yardLine && game.possession)
                    );

                    const scoreboard = card.querySelector('.fs-scoreboard');
                    const cardWrapper = card.querySelector('.fs-card-wrapper');
                    let situationBox = card.querySelector('.fs-sb-situation');
                    let fieldContainer = card.querySelector('.field-visualizer');

                    if (hasValidPlayData) {
                        // Check if we need to create the situation box (e.g., returning from halftime)
                        if (!situationBox && scoreboard) {
                            const possession = game.possession === 'away' ? 'possession-away' :
                                game.possession === 'home' ? 'possession-home' : '';
                            const isRedZone = game.yardLine && game.yardLine <= 20 && !game.possessionOnOwn;
                            const redzone = isRedZone ? 'redzone' : '';

                            if (game.downDistance) {
                                // Normal down/distance situation (fieldPosition may or may not be available)
                                const cleanDownDist = (game.downDistance || '').replace(/\s+at\s+\w+\s+\d+$/i, '').trim();
                                const fieldPosText = game.fieldPosition || (game.yardLine ? `${game.yardLine}` : '');
                                const situationHTML = `
                                    <div class="fs-sb-situation ${possession} ${redzone}">
                                        <span class="fs-sb-down-distance">${cleanDownDist}</span>
                                        <div class="fs-sb-situation-divider"></div>
                                        <span class="fs-sb-ball-position">${fieldPosText}</span>
                                    </div>
                                `;
                                scoreboard.insertAdjacentHTML('beforeend', situationHTML);
                            } else if (game.specialPlay && game.specialPlayText) {
                                // Special play situation (kickoff, punt, etc.)
                                const specialClass = `special-play-${game.specialPlay}`;
                                const situationHTML = `
                                    <div class="fs-sb-situation special-play ${specialClass}">
                                        <span class="fs-sb-down-distance">${game.specialPlayText}</span>
                                    </div>
                                `;
                                scoreboard.insertAdjacentHTML('beforeend', situationHTML);
                            } else if (forceShowField && game.lastPlay) {
                                // Kickoff/new play arriving without down/distance yet
                                // Create a minimal situation box showing the play type
                                const playText = game.lastPlay.toLowerCase();
                                let specialPlayText = '';
                                if (playText.includes('kickoff') || playText.includes('kicks')) {
                                    specialPlayText = 'KICKOFF';
                                } else if (playText.includes('punt')) {
                                    specialPlayText = 'PUNT';
                                } else {
                                    specialPlayText = 'IN PLAY';
                                }
                                const situationHTML = `
                                    <div class="fs-sb-situation special-play">
                                        <span class="fs-sb-down-distance">${specialPlayText}</span>
                                    </div>
                                `;
                                scoreboard.insertAdjacentHTML('beforeend', situationHTML);
                            }
                            situationBox = card.querySelector('.fs-sb-situation');
                            if (situationBox) {
                                console.log(`📺 Created situation box for game ${game.id} (returning from intermission)`);
                            }
                        }

                        // Check if we need to create the field visualizer
                        // Also create if forceShowField to handle kickoff animations
                        if (!fieldContainer && cardWrapper && (forceShowField || game.downDistance || game.yardLine)) {
                            const awayColors = getScoreboardColors(game.league, game.away.abbr);
                            const homeColors = getScoreboardColors(game.league, game.home.abbr);
                            const gridCount = games.length;
                            const isCompressed = true;
                            const fieldClass = isCompressed ? 'field-visualizer field-compressed' : 'field-visualizer';
                            // NCAA football games only show team colors in end zones (no logos)
                            const showEndZoneLogos = game.league !== 'ncaa';

                            const fieldHTML = `
                                <div class="${fieldClass}">
                                    <div class="svg-field-container"
                                         style="--away-color: ${awayColors.primary}; --home-color: ${homeColors.primary};"
                                         data-game-id="${game.id}"
                                         data-compressed="${isCompressed}"
                                         data-away-color="${awayColors.primary}"
                                         data-home-color="${homeColors.primary}"
                                         data-away-abbr="${game.away.abbr}"
                                         data-home-abbr="${game.home.abbr}"
                                         data-show-logos="${showEndZoneLogos}">
                                    </div>
                                </div>
                            `;
                            cardWrapper.insertAdjacentHTML('beforeend', fieldHTML);
                            fieldContainer = card.querySelector('.field-visualizer');

                            // Initialize the SVG field visualizer for this new container
                            const svgContainer = card.querySelector('.svg-field-container');
                            if (svgContainer && typeof SVGFieldVisualizer !== 'undefined') {
                                const visualizer = new SVGFieldVisualizer(svgContainer, {
                                    compressed: isCompressed,
                                    showGoalPosts: true,
                                    showYardNumbers: !isCompressed,
                                    showOneYardLines: !isCompressed,
                                    showEndZoneLogos: showEndZoneLogos,
                                    awayColor: awayColors.primary,
                                    homeColor: homeColors.primary,
                                    awayAbbr: game.away.abbr,
                                    homeAbbr: game.home.abbr
                                });
                                window.fieldVisualizers.set(game.id, visualizer);
                                console.log(`📺 Created field visualizer for game ${game.id} (returning from intermission)`);
                            }
                        }

                        // Show elements
                        if (situationBox) situationBox.classList.remove('hidden');
                        if (fieldContainer) fieldContainer.style.display = '';

                        // Update down & distance
                        const downDistEl = card.querySelector('.fs-sb-down-distance');
                        if (downDistEl) {
                            if (game.specialPlay && game.specialPlayText) {
                                downDistEl.textContent = game.specialPlayText;
                            } else {
                                const cleanDownDist = (game.downDistance || '').replace(/\s+at\s+\w+\s+\d+$/i, '').trim();
                                downDistEl.textContent = cleanDownDist;
                            }
                        }

                        // Update field position (use yardLine as fallback)
                        const fieldPosEl = card.querySelector('.fs-sb-ball-position');
                        if (fieldPosEl) {
                            const fieldPosText = game.fieldPosition || (game.yardLine ? `${game.yardLine}` : '');
                            fieldPosEl.textContent = fieldPosText;
                        }

                        // Update possession indicator
                        if (situationBox) {
                            situationBox.classList.remove('possession-away', 'possession-home', 'redzone');
                            situationBox.classList.remove('special-play', 'special-play-kickoff', 'special-play-punt',
                                'special-play-return', 'special-play-touchback', 'special-play-faircatch',
                                'special-play-xp', 'special-play-fg', 'special-play-2pt');

                            if (game.specialPlay && game.specialPlayText) {
                                situationBox.classList.add('special-play', `special-play-${game.specialPlay}`);
                            } else {
                                if (game.possession === 'away') {
                                    situationBox.classList.add('possession-away');
                                } else if (game.possession === 'home') {
                                    situationBox.classList.add('possession-home');
                                }
                                const isRedZone = game.yardLine && game.yardLine <= 20 && !game.possessionOnOwn;
                                if (isRedZone) situationBox.classList.add('redzone');
                            }
                        }

                        // Update ball position on field visualizer
                        if (game.fieldPosition || game.yardLine) {
                            updateBallPosition(card, game.fieldPosition, game.yardsToGo || 0, game.possession, game.away, game.home, game.league);
                        }
                    } else {
                        // No valid play data or in intermission - hide the elements
                        // BUT don't hide if there's an active animation (TD, FG, etc.)
                        // OR if a scoring play just happened (animation is about to trigger)
                        const hasActiveAnimation = card.querySelector('.play-animation');
                        const visualizer = window.fieldVisualizers?.get(game.id);
                        const isAnimating = visualizer?.state?.animating;

                        // Check BOTH current AND previous play text for scoring plays
                        // This handles the case where game.lastPlay already moved to the next play (kickoff)
                        // but the field goal animation hasn't triggered yet
                        const lastPlayText = (game.lastPlay || '').toLowerCase();
                        const prevData = prevGameData.get(game.id);
                        const prevPlayText = (prevData?.lastPlay || '').toLowerCase();

                        const checkScoringPlay = (text) => {
                            return text.includes('touchdown') ||
                                text.includes('field goal') ||
                                text.includes('extra point') ||
                                text.includes('safety') ||
                                text.includes('two-point') ||
                                text.includes('2-pt') ||
                                text.includes('intercepted') ||
                                text.includes('fumble');
                        };

                        const isScoringPlay = checkScoringPlay(lastPlayText) || checkScoringPlay(prevPlayText);

                        if (!hasActiveAnimation && !isAnimating && !isScoringPlay) {
                            if (situationBox) {
                                situationBox.classList.add('hidden');
                            }
                            if (fieldContainer) {
                                fieldContainer.style.display = 'none';
                            }
                        }
                    }
                }

                // Update MLB-specific elements
                if (game.league === 'mlb') {
                    // Tear down livecast if game is no longer live
                    if (!isLive) {
                        const lcContainer = card.querySelector('.mlb-livecast-container');
                        if (lcContainer) {
                            const livecast = window.mlbLiveCasts.get(game.id);
                            if (livecast && livecast.destroy) livecast.destroy();
                            window.mlbLiveCasts.delete(game.id);
                            lcContainer.remove();
                        }
                    }
                }

                if (game.league === 'mlb' && isLive) {
                    // Update base runners
                    const basesEl = card.querySelector('.mlb-bases');
                    if (basesEl) {
                        basesEl.querySelector('.base.first')?.classList.toggle('occupied', game.onFirst);
                        basesEl.querySelector('.base.second')?.classList.toggle('occupied', game.onSecond);
                        basesEl.querySelector('.base.third')?.classList.toggle('occupied', game.onThird);
                    }

                    // Update hits and errors
                    const awayHitsEl = card.querySelector('.fs-sb-score-box.away .fs-sb-hits');
                    const homeHitsEl = card.querySelector('.fs-sb-score-box.home .fs-sb-hits');
                    if (awayHitsEl) awayHitsEl.textContent = game.away.hits || 0;
                    if (homeHitsEl) homeHitsEl.textContent = game.home.hits || 0;

                    const awayErrorsEl = card.querySelector('.fs-sb-score-box.away .fs-sb-errors');
                    const homeErrorsEl = card.querySelector('.fs-sb-score-box.home .fs-sb-errors');
                    if (awayErrorsEl) awayErrorsEl.textContent = game.away.errors || 0;
                    if (homeErrorsEl) homeErrorsEl.textContent = game.home.errors || 0;
                }

                // Update timeouts (NFL/NCAA only)
                updateTimeoutBars(card, '.fs-sb-timeouts.away', game.away?.timeouts);
                updateTimeoutBars(card, '.fs-sb-timeouts.home', game.home?.timeouts);

                // Update play list for replay mode
                const engine = replayManager?.getEngine(game.id);
                if (engine) {
                    updateReplayPlayList(card, engine);
                }
            });
        }

        /**
         * Update the play list display showing prev/current/next plays
         */
        function updateReplayPlayList(card, engine, gameState = null) {
            const playList = card.querySelector('.replay-play-list');
            if (!playList) return;

            const prevPlay = engine.getPreviousPlay();
            const currentPlay = engine.getCurrentPlay();
            const nextPlay = engine.getNextPlay();
            const state = gameState || engine.getCurrentGameState();

            const prevItem = playList.querySelector('.replay-play-item.prev');
            const currentItem = playList.querySelector('.replay-play-item.current');
            const nextItem = playList.querySelector('.replay-play-item.next');

            // Helper to get play type label
            const getPlayType = (play) => {
                if (!play) return '--';
                return (play.type || 'play').toUpperCase();
            };

            // Helper to get play text
            const getPlayText = (play) => {
                if (!play) return '--';
                return play.text || 'No play data';
            };

            // Update previous play
            if (prevItem) {
                const typeEl = prevItem.querySelector('.play-type');
                const textEl = prevItem.querySelector('.play-text');
                if (typeEl) typeEl.textContent = prevPlay ? getPlayType(prevPlay) + ':' : '';
                if (textEl) textEl.textContent = prevPlay ? getPlayText(prevPlay) : '';
            }

            // Update current play
            if (currentItem) {
                const typeEl = currentItem.querySelector('.play-type');
                const textEl = currentItem.querySelector('.play-text');
                if (typeEl) typeEl.textContent = state?.playType?.toUpperCase() + ':' || getPlayType(currentPlay) + ':';
                if (textEl) textEl.textContent = state?.lastPlay || getPlayText(currentPlay);
            }

            // Update next play
            if (nextItem) {
                const typeEl = nextItem.querySelector('.play-type');
                const textEl = nextItem.querySelector('.play-text');
                if (typeEl) typeEl.textContent = nextPlay ? getPlayType(nextPlay) + ':' : '';
                if (textEl) textEl.textContent = nextPlay ? getPlayText(nextPlay) : '';
            }
        }

        /**
         * Animate the play list scroll when play changes
         * Uses CSS keyframe animation for smooth slide+fade effect
         */
        function animatePlayListScroll(card, engine, gameState) {
            const playList = card.querySelector('.replay-play-list');
            if (!playList) {
                // Fallback: just update without animation
                updateReplayPlayList(card, engine, gameState);
                return;
            }

            // Start the CSS animation
            playList.classList.add('scrolling');

            // Update content at the midpoint of animation (when faded out)
            setTimeout(() => {
                updateReplayPlayList(card, engine, gameState);
            }, 250);

            // Remove scrolling class after animation completes
            setTimeout(() => {
                playList.classList.remove('scrolling');
            }, 500);
        }

        function updateReplayProgress(gameId) {
            const engine = replayManager?.getEngine(gameId);
            if (!engine) return;

            const progress = engine.getProgress();
            const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
            if (!card) return;

            // Update progress bar
            const progressFill = card.querySelector('.replay-progress-fill');
            if (progressFill) {
                progressFill.style.width = `${progress.percentage}%`;
            }

            // Update progress text
            const progressText = card.querySelector('.replay-progress-text');
            if (progressText) {
                progressText.textContent = `${progress.currentIndex + 1}/${progress.totalPlays}`;
            }

            // Update play/pause button
            const playPauseBtn = card.querySelector('.replay-btn.play-pause');
            if (playPauseBtn) {
                playPauseBtn.textContent = progress.isPlaying ? '⏸' : '▶';
                playPauseBtn.classList.toggle('playing', progress.isPlaying);
            }
        }

        function setupReplayControls() {
            if (!isReplayMode || !replayManager) return;

            // Global controls
            document.getElementById('global-play-all')?.addEventListener('click', () => {
                replayManager.playAll();
                updateAllReplayProgress();
            });

            document.getElementById('global-pause-all')?.addEventListener('click', () => {
                replayManager.pauseAll();
                updateAllReplayProgress();
            });

            document.getElementById('global-reset-all')?.addEventListener('click', () => {
                replayManager.resetAll();
                // Re-render to show initial states
                games = replayManager.getAllGameStates();
                renderGrid();
                setupReplayControls();
            });

            // Jump to play control
            const jumpInput = document.getElementById('global-jump-input');
            const jumpBtn = document.getElementById('global-jump-btn');

            const jumpToPlay = () => {
                const playNumber = parseInt(jumpInput.value);
                if (!playNumber || playNumber < 1) return;

                // Jump all engines to the specified play (index is playNumber - 1)
                const targetIndex = playNumber - 1;
                let jumped = false;

                replayManager.engines.forEach((engine, gameId) => {
                    if (targetIndex < engine.plays.length) {
                        engine.jumpToPlay(targetIndex);
                        jumped = true;
                    }
                });

                if (jumped) {
                    // Update all displays
                    games = replayManager.getAllGameStates();
                    renderGrid();
                    setupReplayControls();
                    console.log(`Jumped to play #${playNumber}`);
                } else {
                    console.warn(`Play #${playNumber} out of range`);
                }

                // Clear input after jump
                jumpInput.value = '';
            };

            jumpBtn?.addEventListener('click', jumpToPlay);
            jumpInput?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    jumpToPlay();
                }
            });

            // Keyboard shortcut: Press 'g' to focus jump input (when not already in an input)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'g' && document.activeElement.tagName !== 'INPUT') {
                    e.preventDefault();
                    jumpInput?.focus();
                    jumpInput?.select();
                }
            });

            // Speed preset buttons
            const speedPresetBtns = document.querySelectorAll('.speed-preset-btn');
            speedPresetBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    speedPresetBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const speed = parseInt(btn.dataset.speed);
                    replayManager.setGlobalSpeed(speed);
                });
            });

            // Set initial speed from sessionStorage if available
            try {
                const replayData = JSON.parse(sessionStorage.getItem('gridtv_replay_data') || '{}');
                if (replayData.speed) {
                    replayManager.setGlobalSpeed(replayData.speed);
                    // Update active button
                    speedPresetBtns.forEach(btn => {
                        btn.classList.toggle('active', parseInt(btn.dataset.speed) === replayData.speed);
                    });
                }
            } catch (e) {
                console.log('No initial speed setting found');
            }

            // Per-card controls
            document.querySelectorAll('.fullscreen-game-card').forEach(card => {
                const gameId = card.dataset.gameId;
                const engine = replayManager.getEngine(gameId);
                if (!engine) return;

                // Play/pause button
                card.querySelector('.replay-btn.play-pause')?.addEventListener('click', () => {
                    engine.togglePlayPause();
                    updateReplayProgress(gameId);
                });

                // Previous button
                card.querySelector('.replay-btn.prev')?.addEventListener('click', () => {
                    engine.previousPlay();
                });

                // Next button
                card.querySelector('.replay-btn.next')?.addEventListener('click', () => {
                    engine.nextPlay();
                });
            });
        }

        function updateAllReplayProgress() {
            replayManager?.engines.forEach((engine, gameId) => {
                updateReplayProgress(gameId);
            });
        }

        function showEmptyState() {
            document.getElementById('fullscreen-grid').innerHTML = `
                <div class="empty-state">
                    <h2>No Games Selected</h2>
                    <p>Return to Home and select games to watch.</p>
                </div>
            `;

            // Auto-redirect after 3 seconds
            setTimeout(() => {
                window.location.href = '/index';
            }, 3000);
        }

        // ============================================
        // RENDER GRID
        // ============================================

        // Tablet detection for grid restrictions
        function isTabletDevice() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            // Tablet: 900x500 to 1400x1024 range
            return width >= 900 && width <= 1400 && height >= 500 && height <= 1024;
        }

        function isLandscapeOrientation() {
            return window.innerWidth > window.innerHeight;
        }

        function renderGrid() {
            const grid = document.getElementById('fullscreen-grid');
            let count = games.length;

            // Tablet restrictions: max 8 games (with pagination for Grid 7-8), grids 5-8 only in landscape
            const isTablet = isTabletDevice();
            if (isTablet) {
                // Limit to max 8 games for tablet (Grid 7 and Grid 8 use pagination)
                if (count > 8) {
                    count = 8;
                    games = games.slice(0, 8);
                }

                // Grids 5, 6, 7, 8 only work in landscape on tablet
                // In portrait, cap at 4 games
                if (!isLandscapeOrientation() && count >= 5) {
                    count = 4;
                    games = games.slice(0, 4);
                }
            }

            // Reset to page 1 if grid count changed
            if (window.lastGridCount !== count) {
                window.currentGridPage = 1;
                window.lastGridCount = count;
            }

            // Set grid class based on count
            grid.className = `fullscreen-grid grid-${count}`;

            // Page-based rendering for Grid 7 and Grid 8 on tablet
            if (isTablet && (count === 7 || count === 8)) {
                // Initialize current page if not set
                if (!window.currentGridPage) {
                    window.currentGridPage = 1;
                }

                // Determine page split
                const page1Count = 6; // Both Grid 7 and Grid 8 show 6 cards on page 1
                const page2Count = count - page1Count; // Grid 7: 1 card, Grid 8: 2 cards
                const totalPages = 2;

                // Set data-page attribute
                grid.setAttribute('data-page', String(window.currentGridPage));

                // Get games for current page
                let pageGames;
                if (window.currentGridPage === 1) {
                    pageGames = games.slice(0, page1Count);
                } else {
                    pageGames = games.slice(page1Count);
                }

                // Render cards for current page
                grid.innerHTML = pageGames.map((game, index) => {
                    // Adjust index for page 2 to maintain proper styling
                    const actualIndex = window.currentGridPage === 1 ? index : index + page1Count;
                    return createGameCard(game, actualIndex, count);
                }).join('');

                // Add page indicators
                const pageIndicatorsHTML = `
                    <div class="grid-page-indicators" style="
                        position: fixed;
                        bottom: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        display: flex;
                        gap: 12px;
                        z-index: 10000;
                        background: rgba(17, 24, 39, 0.9);
                        padding: 10px 20px;
                        border-radius: 20px;
                        backdrop-filter: blur(10px);
                    ">
                        ${Array.from({ length: totalPages }, (_, i) => `
                            <div class="page-dot ${i + 1 === window.currentGridPage ? 'active' : ''}"
                                 data-page="${i + 1}"
                                 style="
                                    width: 10px;
                                    height: 10px;
                                    border-radius: 50%;
                                    background: ${i + 1 === window.currentGridPage ? '#3b82f6' : 'rgba(156, 163, 175, 0.5)'};
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                 "
                                 onmouseover="this.style.transform='scale(1.3)'"
                                 onmouseout="this.style.transform='scale(1)'"
                            ></div>
                        `).join('')}
                    </div>
                `;
                grid.insertAdjacentHTML('afterend', pageIndicatorsHTML);

                // Add click handlers for page dots
                setTimeout(() => {
                    document.querySelectorAll('.page-dot').forEach(dot => {
                        dot.addEventListener('click', function () {
                            const newPage = parseInt(this.dataset.page);
                            if (newPage !== window.currentGridPage) {
                                window.currentGridPage = newPage;
                                renderGrid();
                            }
                        });
                    });

                    // Add keyboard navigation (arrow keys)
                    const keyHandler = (e) => {
                        if (e.key === 'ArrowLeft' && window.currentGridPage > 1) {
                            window.currentGridPage--;
                            renderGrid();
                            e.preventDefault();
                        } else if (e.key === 'ArrowRight' && window.currentGridPage < totalPages) {
                            window.currentGridPage++;
                            renderGrid();
                            e.preventDefault();
                        }
                    };

                    // Remove old handler if exists
                    if (window.gridPageKeyHandler) {
                        document.removeEventListener('keydown', window.gridPageKeyHandler);
                    }
                    window.gridPageKeyHandler = keyHandler;
                    document.addEventListener('keydown', keyHandler);

                    // Add swipe/touch navigation
                    let touchStartX = 0;
                    let touchEndX = 0;

                    const handleSwipe = () => {
                        const swipeThreshold = 50;
                        const diff = touchStartX - touchEndX;

                        if (Math.abs(diff) > swipeThreshold) {
                            if (diff > 0 && window.currentGridPage < totalPages) {
                                // Swipe left - go to next page
                                window.currentGridPage++;
                                renderGrid();
                            } else if (diff < 0 && window.currentGridPage > 1) {
                                // Swipe right - go to previous page
                                window.currentGridPage--;
                                renderGrid();
                            }
                        }
                    };

                    grid.addEventListener('touchstart', (e) => {
                        touchStartX = e.changedTouches[0].screenX;
                    });

                    grid.addEventListener('touchend', (e) => {
                        touchEndX = e.changedTouches[0].screenX;
                        handleSwipe();
                    });
                }, 0);
            } else {
                // Regular rendering for other grids
                // Remove data-page attribute if present
                grid.removeAttribute('data-page');

                // Remove any existing page indicators
                const existingIndicators = document.querySelector('.grid-page-indicators');
                if (existingIndicators) {
                    existingIndicators.remove();
                }

                // Remove keyboard handler if exists
                if (window.gridPageKeyHandler) {
                    document.removeEventListener('keydown', window.gridPageKeyHandler);
                    window.gridPageKeyHandler = null;
                }

                // Reset current page
                window.currentGridPage = null;

                // Render all cards
                grid.innerHTML = games.map((game, index) => createGameCard(game, index, count)).join('');
            }

            // Initialize SVG field visualizers for football games
            initFieldVisualizers();

            // Initialize MLB LiveCast for baseball games
            initMLBLiveCasts();

            // Update ball positions for football games
            games.forEach((game, index) => {
                if ((game.league === 'nfl' || game.league === 'ncaa') && game.state === 'in' && game.fieldPosition) {
                    // For paginated grids, adjust the card index
                    let cardIndex = index;
                    if (isTablet && (count === 7 || count === 8) && window.currentGridPage === 2) {
                        // On page 2, the card index is offset by page 1 count (6 cards)
                        cardIndex = index - 6;
                        // Only update if this game is on the current page
                        if (cardIndex < 0) return;
                    } else if (isTablet && (count === 7 || count === 8) && window.currentGridPage === 1) {
                        // On page 1, only update if within first 6 games
                        if (index >= 6) return;
                    }

                    const card = grid.children[cardIndex];
                    if (card) {
                        updateBallPosition(card, game.fieldPosition, game.yardsToGo || 0, game.possession, game.away, game.home, game.league);
                    }
                }
            });
        }

        // Initialize SVG field visualizers for all football game cards
        function initFieldVisualizers() {
            // Clear old visualizers
            window.fieldVisualizers.forEach(visualizer => visualizer.destroy());
            window.fieldVisualizers.clear();

            // Find all SVG field containers and initialize visualizers
            document.querySelectorAll('.svg-field-container').forEach(container => {
                const gameId = container.dataset.gameId;
                const isCompressed = container.dataset.compressed === 'true';
                const awayColor = container.dataset.awayColor;
                const homeColor = container.dataset.homeColor;
                const awayAbbr = container.dataset.awayAbbr;
                const homeAbbr = container.dataset.homeAbbr;
                const showEndZoneLogos = container.dataset.showLogos !== 'false';

                const visualizer = new SVGFieldVisualizer(container, {
                    compressed: isCompressed,
                    showGoalPosts: true,
                    showYardNumbers: !isCompressed,
                    showOneYardLines: !isCompressed,
                    showEndZoneLogos: showEndZoneLogos,
                    awayColor: awayColor,
                    homeColor: homeColor,
                    awayAbbr: awayAbbr,
                    homeAbbr: homeAbbr
                });

                window.fieldVisualizers.set(gameId, visualizer);
            });
        }

        // Initialize MLB LiveCast for all baseball game cards
        function initMLBLiveCasts() {
            // Clear old instances
            window.mlbLiveCasts.forEach(livecast => {
                if (livecast.destroy) livecast.destroy();
            });
            window.mlbLiveCasts.clear();

            // Determine current grid count from the fullscreen-grid element
            const gridEl = document.querySelector('.fullscreen-grid');
            let gridCount = 1;
            if (gridEl) {
                const match = [...gridEl.classList].find(c => /^grid-\d+$/.test(c));
                if (match) gridCount = parseInt(match.replace('grid-', ''), 10);
            }

            // Find all MLB livecast containers and initialize
            document.querySelectorAll('.mlb-livecast-container').forEach(container => {
                const gameId = container.dataset.gameId;
                if (gameId && typeof MLBLiveCast !== 'undefined') {
                    try {
                        const livecast = new MLBLiveCast(gameId, container);
                        window.mlbLiveCasts.set(gameId, livecast);

                        // Apply compact class based on grid count
                        const lcEl = container.querySelector('.mlb-livecast');
                        if (lcEl) {
                            lcEl.classList.remove('lc-compact-md', 'lc-compact-sm', 'lc-compact-xs');
                            if (gridCount >= 7) {
                                // For grid-7/8, featured card (first child) gets sm, others get xs
                                const card = container.closest('.fullscreen-game-card');
                                const isFirst = card && card === card.parentElement.firstElementChild;
                                lcEl.classList.add(isFirst ? 'lc-compact-sm' : 'lc-compact-xs');
                            } else if (gridCount >= 5) {
                                lcEl.classList.add('lc-compact-sm');
                            } else if (gridCount >= 3) {
                                lcEl.classList.add('lc-compact-md');
                            }
                        }
                    } catch (error) {
                        console.error(`[MLB LiveCast] Error initializing for game ${gameId}:`, error);
                    }
                }
            });
        }

        function createGameCard(game, index, gridCount) {
            const isFootball = game.league === 'nfl' || game.league === 'ncaa';
            const isLive = game.state === 'in';
            const isFinal = game.state === 'post';
            const isUpcoming = game.state === 'pre';

            // Determine card state class
            let cardClass = `fullscreen-game-card has-scoreboard fs-${game.league}`;
            if (isUpcoming) {
                cardClass += ' upcoming-game';
            } else if (isFinal) {
                cardClass += ' final-game';
                if (game.away.score > game.home.score) cardClass += ' winning-away';
                else if (game.home.score > game.away.score) cardClass += ' winning-home';
                else cardClass += ' tied';
            } else if (isLive) {
                if (game.away.score > game.home.score) cardClass += ' winning-away';
                else if (game.home.score > game.away.score) cardClass += ' winning-home';
                else cardClass += ' tied';
            }

            // Get league logo
            const leagueLogo = leagueLogos[game.league] || '/assets/logo.png';

            // Get team colors for scoreboard
            const awayColors = getScoreboardColors(game.league, game.away.abbr);
            const homeColors = getScoreboardColors(game.league, game.home.abbr);

            // Parse game status for period and time
            const statusParts = parseGameStatus(game.status, game.league);

            // Determine display values
            const awayScore = isUpcoming ? '-' : game.away.score;
            const homeScore = isUpcoming ? '-' : game.home.score;

            // Format status for display
            let displayStatus = game.status;
            if (isUpcoming && game.startTime) {
                const formatted = formatStartTime(game.startTime);
                if (formatted) displayStatus = formatted;
            }

            // Check if game is in intermission (halftime, end of quarter, etc.)
            const statusLower = (game.status || '').toLowerCase();
            const isIntermission = statusLower.includes('halftime') ||
                statusLower.includes('half') ||
                statusLower.includes('end of') ||
                statusLower.includes('intermission') ||
                statusLower.includes('2nd') && statusLower.includes('0:00') ||
                statusLower.includes('4th') && statusLower.includes('0:00');

            // Build game situation box for NFL/NCAA (hide during intermissions)
            let situationHTML = '';
            const isMLB = game.league === 'mlb';

            // For replay mode, always create situation box for NFL games (will be populated by replay updates)
            // Also show if we have valid down data (even without full fieldPosition text)
            if (isFootball && isLive && (game.downDistance || game.yardLine || isReplayMode) && !isIntermission) {
                const possession = game.possession === 'away' ? 'possession-away' :
                    game.possession === 'home' ? 'possession-home' : '';
                const isRedZone = game.yardLine && game.yardLine <= 20 && !game.possessionOnOwn;
                const redzone = isRedZone ? 'redzone' : '';
                // Strip "at TEAM XX" from down distance (shown separately in ball-position)
                const cleanDownDist = (game.downDistance || '').replace(/\s+at\s+\w+\s+\d+$/i, '').trim();
                const fieldPosText = game.fieldPosition || (game.yardLine ? `${game.yardLine}` : '');
                situationHTML = `
                    <div class="fs-sb-situation ${possession} ${redzone}">
                        <span class="fs-sb-down-distance">${cleanDownDist}</span>
                        <div class="fs-sb-situation-divider"></div>
                        <span class="fs-sb-ball-position">${fieldPosText}</span>
                    </div>
                `;
            } else if (isFootball && isLive && game.specialPlay && game.specialPlayText && !isIntermission) {
                // Show special play (kickoff, punt, return, etc.) when no down/distance
                const specialClass = `special-play-${game.specialPlay}`;
                situationHTML = `
                    <div class="fs-sb-situation special-play ${specialClass}">
                        <span class="fs-sb-down-distance">${game.specialPlayText}</span>
                    </div>
                `;
            }

            // Build field visualizer for NFL/NCAA (only show when situation box is showing, hide during intermissions)
            let fieldVisualizerHTML = '';

            // MLB LiveCast
            if (isMLB && isLive) {
                fieldVisualizerHTML = `
                    <div class="mlb-livecast-container" id="mlb-livecast-${game.id}" data-game-id="${game.id}">
                        <!-- MLB Live Cast will be initialized here -->
                    </div>
                `;
            } else if (isFootball && isLive && ((game.downDistance || game.yardLine) || isReplayMode) && !isIntermission) {
                // Get team primary colors for endzones
                const awayEndzoneColor = awayColors.primary;
                const homeEndzoneColor = homeColors.primary;

                // Always use compressed field for all grids (gridCount passed as parameter)
                const isCompressed = true;
                const fieldClass = isCompressed ? 'field-visualizer field-compressed' : 'field-visualizer';

                // SVG field container - SVGFieldVisualizer will populate this
                // NCAA football games only show team colors in end zones (no logos)
                const showEndZoneLogos = game.league !== 'ncaa';
                fieldVisualizerHTML = `
                    <div class="${fieldClass}">
                        <div class="svg-field-container"
                             style="--away-color: ${awayEndzoneColor}; --home-color: ${homeEndzoneColor};"
                             data-game-id="${game.id}"
                             data-compressed="${isCompressed}"
                             data-away-color="${awayEndzoneColor}"
                             data-home-color="${homeEndzoneColor}"
                             data-away-abbr="${game.away.abbr}"
                             data-home-abbr="${game.home.abbr}"
                             data-show-logos="${showEndZoneLogos}">
                        </div>
                    </div>
                `;
            }

            // Status class
            const statusClass = isUpcoming ? 'upcoming' : isFinal ? 'final' : '';

            // Possession indicator for NFL/NCAA (show football emoji next to team with ball)
            const awayHasPossession = isFootball && isLive && game.possession === 'away';
            const homeHasPossession = isFootball && isLive && game.possession === 'home';

            return `
                <div class="${cardClass}" data-game-id="${game.id}" data-league="${game.league}" data-is-replay="${game.isReplay || false}">
                    <img class="sport-logo-indicator" src="${leagueLogo}" alt="${game.league.toUpperCase()}">
                    <div class="fullscreen-refresh-indicator"></div>

                    <!-- Tablet clock (top-center of card, hidden by default - shown only for tablet portrait grid-4) -->
                    <div class="tablet-top-clock">
                        <div class="fs-sb-time-box">
                            ${isFinal ? `
                                <div class="fs-sb-time" style="font-size: clamp(0.8rem, 2.2vmin, 1.1rem);">FINAL</div>
                            ` : `
                                <div class="fs-sb-time-label">${statusParts.period || (isUpcoming ? 'STARTS' : '')}</div>
                                <div class="fs-sb-time">${statusParts.time || displayStatus}</div>
                            `}
                        </div>
                    </div>

                    <div class="fs-card-wrapper">
                        <!-- Scoreboard with logos inside team sections -->
                        <div class="fs-scoreboard" style="--sb-away-primary: ${awayColors.primary}; --sb-away-secondary: ${awayColors.secondary}; --sb-home-primary: ${homeColors.primary}; --sb-home-secondary: ${homeColors.secondary};">
                            <div class="fs-sb-team-section away">
                                <div class="fs-sb-score-box away">
                                    <span class="fs-sb-score">${awayScore}</span>
                                </div>
                                <div class="fs-sb-team-info">
                                    <div class="fs-sb-team-logo">
                                        <img class="fs-sb-team-logo-img" src="${game.away.logo}" alt="${game.away.abbr}" onerror="this.style.display='none'">
                                    </div>
                                    <span class="fs-sb-team-name">${game.away.abbr}</span>
                                    ${game.away.record ? `<span class="fs-sb-team-record">${game.away.record}</span>` : ''}
                                </div>
                                ${(isFootball && game.away.timeouts !== undefined) ? `<div class="fs-sb-timeouts away">${createTimeoutBars(game.away.timeouts)}</div>` : ''}
                            </div>
                            <div class="fs-sb-center">
                                <div class="fs-sb-time-box">
                                    ${isFinal ? `
                                        <div class="fs-sb-time" style="font-size: clamp(0.8rem, 2.2vmin, 1.1rem);">FINAL</div>
                                    ` : `
                                        <div class="fs-sb-time-label">${statusParts.period || (isUpcoming ? 'STARTS' : '')}</div>
                                        <div class="fs-sb-time">${statusParts.time || displayStatus}</div>
                                    `}
                                </div>
                            </div>
                            <div class="fs-sb-team-section home">
                                ${(isFootball && game.home.timeouts !== undefined) ? `<div class="fs-sb-timeouts home">${createTimeoutBars(game.home.timeouts)}</div>` : ''}
                                <div class="fs-sb-team-info">
                                    <div class="fs-sb-team-logo">
                                        <img class="fs-sb-team-logo-img" src="${game.home.logo}" alt="${game.home.abbr}" onerror="this.style.display='none'">
                                    </div>
                                    <span class="fs-sb-team-name">${game.home.abbr}</span>
                                    ${game.home.record ? `<span class="fs-sb-team-record">${game.home.record}</span>` : ''}
                                </div>
                                <div class="fs-sb-score-box home">
                                    <span class="fs-sb-score">${homeScore}</span>
                                </div>
                            </div>
                            ${situationHTML}
                        </div>

                        ${fieldVisualizerHTML}

                        ${(game.league === 'nba' && isLive) ? `
                        <!-- NBA Scorer Notifications -->
                        <div class="nba-scorer-notification away" data-team="away"></div>
                        <div class="nba-scorer-notification home" data-team="home"></div>
                        ` : ''}

                        ${gridCount < 3 ? `
                        <!-- Replay Mode: Play List (shows prev/current/next plays) - Hidden for grids 3-8 -->
                        <div class="replay-play-list" data-game-id="${game.id}">
                            <div class="replay-play-list-inner">
                                <div class="replay-play-item prev">
                                    <span class="play-type">--</span>
                                    <span class="play-text">--</span>
                                </div>
                                <div class="replay-play-item current">
                                    <span class="play-type">PLAY:</span>
                                    <span class="play-text">${game.lastPlay || 'Waiting for play...'}</span>
                                </div>
                                <div class="replay-play-item next">
                                    <span class="play-type">--</span>
                                    <span class="play-text">--</span>
                                </div>
                            </div>
                        </div>

                        <!-- Replay Mode: Down/Distance and Field Position Info - Hidden for grids 3-8 -->
                        <div class="replay-play-info">
                            <div class="info-item">
                                <span class="info-label">Down:</span>
                                <span class="info-value down-distance">${game.downDistance || '--'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ball:</span>
                                <span class="info-value field-position">${game.fieldPosition || '--'}</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    ${(game.league === 'nfl' && isLive) ? `
                    <!-- NFL Stats Modal (shows between plays) -->
                    <div class="nfl-stats-modal" data-game-stats-id="${game.id}">
                        <div class="nfl-stats-modal-header">
                            <span class="nfl-stats-modal-title">Game Stats</span>
                        </div>
                        <div class="nfl-stats-content">
                            <div class="nfl-stats-loading">Loading stats...</div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Replay Mode: Per-Card Controls (shows on hover) -->
                    <div class="replay-controls">
                        <button class="replay-btn prev" title="Previous Play">⏮</button>
                        <button class="replay-btn play-pause" title="Play/Pause">▶</button>
                        <button class="replay-btn next" title="Next Play">⏭</button>
                        <div class="replay-progress">
                            <span class="replay-progress-text">1/1</span>
                            <div class="replay-progress-bar">
                                <div class="replay-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createTimeoutBars(timeouts) {
            if (timeouts === undefined) return '';
            const remaining = Math.max(0, Math.min(3, timeouts));
            let bars = '';
            for (let i = 0; i < 3; i++) {
                const usedClass = i >= remaining ? 'used' : '';
                bars += `<div class="fs-sb-timeout-bar ${usedClass}"></div>`;
            }
            return bars;
        }

        function formatStartTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return '';

            const now = new Date();
            const diffMs = date - now;
            const diffMins = Math.round(diffMs / 60000);

            if (diffMins <= 0) return 'Starting';
            if (diffMins < 60) return `${diffMins}m`;

            // Format time in user's local timezone
            const timeStr = date.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });

            // If game is today, just show time
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                return timeStr;
            }

            // Otherwise show day and time
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        // ============================================
        // BALL POSITION CALCULATION (from NFL/NCAA pages)
        // ============================================
        function calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam) {
            if (!fieldPosition) return 50;

            const parts = fieldPosition.trim().split(' ');
            let yardLine;
            let fieldSideAbbr;

            if (parts.length === 1) {
                yardLine = 50;
                fieldSideAbbr = null;
            } else {
                fieldSideAbbr = parts[0];
                yardLine = parseInt(parts[1]);
            }

            const awayAbbr = awayTeam?.abbr || awayTeam?.team?.abbreviation;
            const homeAbbr = homeTeam?.abbr || homeTeam?.team?.abbreviation;

            let absolutePosition;

            if (yardLine === 50 || !fieldSideAbbr) {
                absolutePosition = 50;
            } else if (fieldSideAbbr === awayAbbr) {
                absolutePosition = yardLine;
            } else if (fieldSideAbbr === homeAbbr) {
                absolutePosition = 100 - yardLine;
            } else {
                absolutePosition = 50;
            }

            return Math.max(0, Math.min(100, absolutePosition));
        }

        function updateBallPosition(cardEl, fieldPosition, yardsToGo, possession, awayTeam, homeTeam, league) {
            // Get game ID from card
            const gameId = cardEl.dataset.gameId;
            if (!gameId) return;

            // Get SVG visualizer for this game
            const visualizer = window.fieldVisualizers.get(gameId);
            if (!visualizer) return;

            // Get team color for styling
            const possessionTeam = possession === 'away' ? awayTeam : homeTeam;
            const teamColor = possessionTeam?.abbr ? getTeamColor(possessionTeam.abbr, league) : '#3b82f6'; // Blue default

            // Apply team color to situation info (outside the SVG)
            const situationInfo = cardEl.querySelector('.fullscreen-situation-info');
            if (situationInfo) {
                situationInfo.style.color = teamColor;
                situationInfo.style.textShadow = `-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000, 0 0 3px rgba(0, 0, 0, 0.5)`;
            }

            // Calculate ball position (0-100 represents the playable field)
            // If fieldPosition is not available, default to midfield
            const ballPosition = fieldPosition ? calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam) : 50;

            // Update SVG visualizer
            visualizer.setBallPosition(ballPosition, teamColor);

            // Calculate and set first down line (hide on Goal situations)
            if (yardsToGo > 0) {
                const possessionIsAway = possession === 'away';
                let firstDownPosition;

                if (possessionIsAway) {
                    firstDownPosition = ballPosition + yardsToGo;
                } else {
                    firstDownPosition = ballPosition - yardsToGo;
                }

                // Clamp to playable field (0-100%)
                firstDownPosition = Math.max(0, Math.min(100, firstDownPosition));
                visualizer.setFirstDownPosition(firstDownPosition, true);
            } else {
                visualizer.setFirstDownPosition(50, false); // Hide first down line
            }
        }

        function getScoreClass(game, team) {
            if (game.state === 'pre') return '';
            const teamData = game[team];
            const opponent = team === 'home' ? game.away : game.home;
            if (teamData.score > opponent.score) return 'winning';
            if (teamData.score < opponent.score) return 'losing';
            return '';
        }

        // ============================================
        // PLAY ANIMATIONS - Using centralized module
        // All animation functions are now loaded from /scripts/play-animations.js
        // ============================================

        // Initialize the centralized animation module's skip timer
        setFullscreenEnteredAt(Date.now());

        // Wrapper for NFL/NCAA play detection using intelligent play parser
        function detectPlayEvents(card, game, comp, prevData) {
            if (game.league !== 'nfl' && game.league !== 'ncaa') return;

            const lastPlay = comp?.situation?.lastPlay?.text || '';

            // Use fuzzy duplicate detection (normalizes punctuation differences)
            if (!lastPlay || isDuplicatePlay(lastPlay, prevData.lastPlay || '')) return;

            // Skip administrative events that aren't actual football plays
            // These can appear in the API but aren't shown on ESPN's gamecast
            const lowerPlay = lastPlay.toLowerCase();
            const isAdministrativeEvent =
                (lowerPlay.includes('timeout') && !lowerPlay.includes('return')) ||
                lowerPlay.includes('coin toss') ||
                lowerPlay.includes('won the toss') ||
                lowerPlay.includes('delay of game') ||
                lowerPlay.includes('injury') ||
                lowerPlay.includes('review') ||
                lowerPlay.includes('challenge') ||
                lowerPlay.includes('measurement') ||
                lowerPlay.includes('two-minute warning') ||
                lowerPlay.includes('2-minute warning') ||
                lowerPlay.match(/^(official|officials?)\s+(timeout|review)/i);

            if (isAdministrativeEvent) {
                return;
            }

            const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');
            const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
            const awayAbbr = awayTeam?.team?.abbreviation || '';
            const homeAbbr = homeTeam?.team?.abbreviation || '';

            // Get field visualizer for this game
            const visualizer = window.fieldVisualizers?.get(game.id);

            // IMPORTANT: Ensure field container is visible before animating
            // This prevents the race condition where field is hidden before animation starts
            const fieldContainer = card.querySelector('.field-visualizer');
            if (fieldContainer && fieldContainer.style.display === 'none') {
                fieldContainer.style.display = '';
                console.log(`🏈 Restored field visibility for animation: ${game.id}`);
            }

            // Build game context for intelligent play parser
            // Use CURRENT situation data, not stale prevData
            const gameContext = {
                situation: comp?.situation || {},
                awayAbbr,
                homeAbbr,
                possession: game.possession || comp?.situation?.possession?.id || null,
                awayScore: game.away?.score || 0,
                homeScore: game.home?.score || 0
            };

            const prevState = {
                awayScore: prevData.awayScore || 0,
                homeScore: prevData.homeScore || 0,
                possession: prevData.possession || null,
                lastPlay: prevData.lastPlay || ''
            };

            // Execute SVG field animation FIRST, then show UI overlays after it completes
            parseAndAnimateNFLPlay(lastPlay, gameContext, prevState, visualizer)
                .then(result => {
                    if (result.errors.length > 0) {
                        console.warn('🏈 Play animation errors:', result.errors);
                    }
                    if (result.warnings.length > 0) {
                        console.log('🏈 Play animation warnings:', result.warnings);
                    }

                    // Now show UI overlay animations (TOUCHDOWN!, INTERCEPTION!, etc.) AFTER field animation
                    analyzeAndAnimatePlay(card, lastPlay, {
                        awayTeam: { team: awayTeam?.team },
                        homeTeam: { team: homeTeam?.team },
                        awayScoreChange: game.away.score - (prevData.awayScore || 0),
                        homeScoreChange: game.home.score - (prevData.homeScore || 0),
                        prevDown: prevData.down || 0,
                        currentDown: comp?.situation?.down || 0,
                        downDistanceText: comp?.situation?.downDistanceText || '',
                        prevDownDistance: prevData.downDistanceText || '',
                        prevPossession: prevData.possession || null,
                        currentPossession: game.possession || null,
                        fieldPosition: comp?.situation?.yardLine || game.fieldPosition || '',
                        awayAbbr,
                        homeAbbr
                    });
                })
                .catch(err => {
                    console.error('🏈 parseAndAnimateNFLPlay failed:', err);
                    // Still show overlay even if field animation failed
                    analyzeAndAnimatePlay(card, lastPlay, {
                        awayTeam: { team: awayTeam?.team },
                        homeTeam: { team: homeTeam?.team },
                        awayScoreChange: game.away.score - (prevData.awayScore || 0),
                        homeScoreChange: game.home.score - (prevData.homeScore || 0),
                        prevDown: prevData.down || 0,
                        currentDown: comp?.situation?.down || 0,
                        downDistanceText: comp?.situation?.downDistanceText || '',
                        prevDownDistance: prevData.downDistanceText || '',
                        prevPossession: prevData.possession || null,
                        currentPossession: game.possession || null,
                        fieldPosition: comp?.situation?.yardLine || game.fieldPosition || '',
                        awayAbbr,
                        homeAbbr
                    });
                });
        }

        /**
         * Detect NHL play events (goals, penalties, etc.)
         * Placeholder for NHL-specific animations
         */
        function detectNHLPlayEvents(card, game, comp, prevData) {
            if (game.league !== 'nhl') return;

            // For now, just log NHL events - can add animations later
            const situation = comp?.situation;
            const lastPlay = situation?.lastPlay?.text || '';

            if (lastPlay && prevData.lastPlay !== lastPlay) {
                console.log('🏒 NHL Play Event:', {
                    gameId: game.id,
                    lastPlay: lastPlay.substring(0, 80),
                    homeScore: game.home.score,
                    awayScore: game.away.score
                });

                // Update prevData to track this play
                prevData.lastPlay = lastPlay;
            }
        }

        // ============================================
        // NFL STATS MODAL (Between Plays)
        // ============================================
        const gameStatsCache = new Map(); // gameId -> { stats, lastFetch }
        const STATS_CACHE_TTL = 20000; // 20 seconds cache

        async function fetchGameStats(gameId, retryCount = 0) {
            const cached = gameStatsCache.get(gameId);
            const now = Date.now();

            // Return cached stats if still valid
            if (cached && (now - cached.lastFetch) < STATS_CACHE_TTL) {
                return cached.stats;
            }

            try {
                const response = await fetch(`/api/nfl/summary/${gameId}`);
                if (!response.ok) throw new Error('Failed to fetch stats');

                const data = await response.json();

                // Handle server cache miss - retry after delay
                if (data._cache && !data._cache.hit && data._cache.retryAfter && retryCount < 3) {
                    console.log(`[Stats] Cache miss for ${gameId}, retrying in ${data._cache.retryAfter}s...`);
                    await new Promise(resolve => setTimeout(resolve, data._cache.retryAfter * 1000));
                    return fetchGameStats(gameId, retryCount + 1);
                }

                const stats = parseGameStats(data);

                // Only cache if we got valid stats
                if (stats) {
                    gameStatsCache.set(gameId, { stats, lastFetch: now });
                }

                return stats;
            } catch (err) {
                console.error(`Failed to fetch stats for game ${gameId}:`, err);
                return null;
            }
        }

        function parseGameStats(data) {
            const boxscore = data.boxscore;
            if (!boxscore || !boxscore.players) return null;

            const stats = { away: null, home: null };

            // Get home/away team IDs from header
            const competitors = data.header?.competitions?.[0]?.competitors || [];
            const homeTeamId = competitors.find(c => c.homeAway === 'home')?.id;
            const awayTeamId = competitors.find(c => c.homeAway === 'away')?.id;

            boxscore.players.forEach(teamData => {
                // Determine home/away by matching team ID
                const teamId = teamData.team?.id;
                let homeAway = 'away'; // default
                if (teamId === homeTeamId) {
                    homeAway = 'home';
                } else if (teamId === awayTeamId) {
                    homeAway = 'away';
                }

                const teamInfo = {
                    name: teamData.team?.displayName || teamData.team?.abbreviation || '',
                    abbreviation: teamData.team?.abbreviation || '',
                    logo: teamData.team?.logo || '',
                    categories: {}
                };

                // Parse statistics by category
                if (teamData.statistics) {
                    teamData.statistics.forEach(stat => {
                        const category = stat.name?.toLowerCase();
                        if (!category) return;

                        const leaders = [];
                        if (stat.athletes) {
                            stat.athletes.slice(0, 2).forEach(athlete => {
                                if (athlete.athlete && athlete.stats && athlete.stats.length > 0) {
                                    // Build short name: "L. Jackson" format
                                    let name = athlete.athlete.displayName || '';
                                    if (athlete.athlete.firstName && athlete.athlete.lastName) {
                                        name = `${athlete.athlete.firstName.charAt(0)}. ${athlete.athlete.lastName}`;
                                    }
                                    leaders.push({
                                        name: name,
                                        value: formatStatValue(category, athlete.stats)
                                    });
                                }
                            });
                        }

                        if (leaders.length > 0) {
                            teamInfo.categories[category] = leaders;
                        }
                    });
                }

                stats[homeAway] = teamInfo;
            });

            return stats;
        }

        function formatStatValue(category, statsArray) {
            if (!statsArray || statsArray.length === 0) return '';

            // For different categories, format the display value
            switch (category) {
                case 'passing':
                    // C/ATT, YDS, TD-INT format: e.g., "18/25, 245 YDS, 2 TD"
                    if (statsArray.length >= 4) {
                        const cmp = statsArray[0], att = statsArray[1], yds = statsArray[2], td = statsArray[4] || 0;
                        return `${cmp}/${att}, ${yds} YDS, ${td} TD`;
                    }
                    return statsArray[0] || '';
                case 'rushing':
                    // CAR, YDS, TD format: e.g., "15 CAR, 87 YDS, 1 TD"
                    if (statsArray.length >= 3) {
                        return `${statsArray[0]} CAR, ${statsArray[1]} YDS, ${statsArray[3] || 0} TD`;
                    }
                    return statsArray[0] || '';
                case 'receiving':
                    // REC, YDS, TD format: e.g., "5 REC, 78 YDS, 1 TD"
                    if (statsArray.length >= 3) {
                        return `${statsArray[0]} REC, ${statsArray[1]} YDS, ${statsArray[3] || 0} TD`;
                    }
                    return statsArray[0] || '';
                case 'defensive':
                    // TCKL, SACK, INT format
                    if (statsArray.length >= 2) {
                        return `${statsArray[0]} TCKL, ${statsArray[1]} SACK`;
                    }
                    return statsArray[0] || '';
                default:
                    return statsArray[0] || '';
            }
        }

        function renderStatsModal(modal, stats, game, phase = 0) {
            if (!stats || !stats.away || !stats.home) {
                modal.querySelector('.nfl-stats-content').innerHTML = `
                    <div class="nfl-stats-loading">Stats unavailable</div>
                `;
                return;
            }

            const priorityCategories = ['passing', 'rushing', 'receiving'];

            const renderTeamStats = (teamStats, teamData, score) => {
                const categoriesHTML = priorityCategories.map(cat => {
                    const players = teamStats.categories[cat];
                    if (!players || players.length === 0) return '';

                    const categoryTitle = cat.charAt(0).toUpperCase() + cat.slice(1);
                    const playersHTML = players.map(p => `
                        <div class="nfl-stats-player">
                            <span class="nfl-stats-player-name">${p.name}</span>
                            <span class="nfl-stats-player-value">${p.value}</span>
                        </div>
                    `).join('');

                    return `
                        <div class="nfl-stats-category">
                            <div class="nfl-stats-category-title">${categoryTitle}</div>
                            ${playersHTML}
                        </div>
                    `;
                }).join('');

                // Use full team name from stats data, fallback to teamData
                const fullName = teamStats.name || teamData.name || teamData.abbr;

                return `
                    <div class="nfl-stats-team" style="max-width: 100%;">
                        <div class="nfl-stats-team-header">
                            <span class="nfl-stats-team-score">${score}</span>
                            <img class="nfl-stats-team-logo" src="${teamData.logo}" alt="${teamData.abbr}" onerror="this.style.display='none'">
                            <span class="nfl-stats-team-name">${fullName}</span>
                        </div>
                        ${categoriesHTML || '<div class="nfl-stats-loading">No stats yet</div>'}
                    </div>
                `;
            };

            // Phase 0 = away team, Phase 1 = home team
            if (phase === 0) {
                modal.querySelector('.nfl-stats-content').innerHTML = renderTeamStats(stats.away, game.away, game.away.score);
            } else {
                modal.querySelector('.nfl-stats-content').innerHTML = renderTeamStats(stats.home, game.home, game.home.score);
            }
        }

        let statsModalUpdateInProgress = false;

        async function updateStatsModals() {
            // Prevent concurrent updates
            if (statsModalUpdateInProgress) return;
            statsModalUpdateInProgress = true;

            try {
                const now = Date.now();
                const WAIT_BEFORE_SHOW = 30000; // 30 seconds of no play before showing stats
                const PHASE_DURATION = 15000;   // Show each team for 15 seconds (normal play)

                // Halftime-specific timing
                const HALFTIME_PHASE_DURATION = 60000;  // 1 minute per team during halftime
                const HALFTIME_OFF_DURATION = 120000;   // 2 minutes off between cycles during halftime

                for (const game of games) {
                    // Skip replay games - they don't have real ESPN stats
                    if (game.isReplay) continue;
                    if (game.league !== 'nfl' || game.state !== 'in') continue;

                    const modal = document.querySelector(`.nfl-stats-modal[data-game-stats-id="${game.id}"]`);
                    if (!modal) continue;

                    // Initialize state for this game if not exists
                    if (!statsModalState.has(game.id)) {
                        statsModalState.set(game.id, {
                            noPlayStartTime: null,
                            isShowingStats: false,
                            showStartTime: null,
                            currentPhase: 0,       // 0 = away team, 1 = home team
                            phaseStartTime: null,
                            cachedStats: null,
                            lastRenderedPhase: -1, // Track what phase was last rendered
                            halftimeCooldownStart: null // Track halftime cooldown period
                        });
                    }

                    const state = statsModalState.get(game.id);

                    // Check if game is specifically at halftime (not just any intermission)
                    const statusLower = (game.status || '').toLowerCase();
                    const isHalftime = statusLower.includes('halftime') ||
                        statusLower === 'half' ||
                        (statusLower.includes('2nd') && statusLower.includes('0:00'));

                    // Check for other intermissions (end of quarters, etc.)
                    const isIntermission = isHalftime ||
                        statusLower.includes('end of') ||
                        statusLower.includes('intermission') ||
                        (statusLower.includes('4th') && statusLower.includes('0:00'));

                    const hasActivePlays = !!game.downDistance && !isIntermission;

                    // Check if there's an active animation playing - hide stats during animations
                    const card = modal.closest('.fullscreen-card');
                    const hasActiveAnimation = card && card.querySelector('.play-animation');
                    if (hasActiveAnimation) {
                        modal.classList.remove('visible');
                        // Continue to manage state timing, but don't show modal during animation
                    }

                    // Use halftime-specific timing if at halftime
                    const phaseDuration = isHalftime ? HALFTIME_PHASE_DURATION : PHASE_DURATION;

                    // If in halftime cooldown period, check if it's over
                    if (state.halftimeCooldownStart && isHalftime) {
                        const cooldownElapsed = now - state.halftimeCooldownStart;
                        if (cooldownElapsed < HALFTIME_OFF_DURATION) {
                            // Still in cooldown - keep modal hidden
                            modal.classList.remove('visible');
                            continue;
                        } else {
                            // Cooldown complete - reset and start new cycle
                            state.halftimeCooldownStart = null;
                            state.noPlayStartTime = now - WAIT_BEFORE_SHOW; // Immediately trigger stats display
                        }
                    }

                    // Reset halftime cooldown if no longer at halftime
                    if (!isHalftime && state.halftimeCooldownStart) {
                        state.halftimeCooldownStart = null;
                    }

                    // If stats are currently showing, manage phase transitions
                    if (state.isShowingStats) {
                        // If a new play started, immediately hide stats
                        if (hasActivePlays) {
                            modal.classList.remove('visible');
                            state.isShowingStats = false;
                            state.showStartTime = null;
                            state.phaseStartTime = null;
                            state.currentPhase = 0;
                            state.cachedStats = null;
                            state.lastRenderedPhase = -1;
                            state.noPlayStartTime = null;
                            continue;
                        }

                        // Re-add visible class if no active play and no animation
                        // (needed because renderGrid recreates the modal element without the class)
                        if (!hasActiveAnimation) {
                            modal.classList.add('visible');
                        }

                        const elapsedPhaseTime = now - state.phaseStartTime;

                        if (elapsedPhaseTime >= phaseDuration) {
                            // Current phase complete
                            if (state.currentPhase === 0) {
                                // Switch to phase 1 (home team)
                                state.currentPhase = 1;
                                state.phaseStartTime = now;
                                state.lastRenderedPhase = 1;
                                if (state.cachedStats) {
                                    renderStatsModal(modal, state.cachedStats, game, 1);
                                }
                            } else {
                                // Both phases complete - hide and reset
                                modal.classList.remove('visible');
                                state.isShowingStats = false;
                                state.showStartTime = null;
                                state.phaseStartTime = null;
                                state.currentPhase = 0;
                                state.cachedStats = null;
                                state.lastRenderedPhase = -1;

                                if (isHalftime) {
                                    // Start halftime cooldown period
                                    state.halftimeCooldownStart = now;
                                    state.noPlayStartTime = null;
                                } else {
                                    state.noPlayStartTime = hasActivePlays ? null : now; // Reset wait timer
                                }
                            }
                        }
                        // Keep showing current phase
                        continue;
                    }

                    // Stats are not currently showing
                    if (hasActivePlays) {
                        // Play is active - reset the no-play timer
                        state.noPlayStartTime = null;
                        modal.classList.remove('visible');
                    } else {
                        // No active play - start or continue the wait timer
                        if (!state.noPlayStartTime) {
                            state.noPlayStartTime = now;
                        }

                        const waitedTime = now - state.noPlayStartTime;
                        // At halftime, start showing immediately (no wait period needed)
                        const waitTime = isHalftime ? 0 : WAIT_BEFORE_SHOW;

                        if (waitedTime >= waitTime) {
                            // Show the stats modal
                            state.isShowingStats = true;
                            state.showStartTime = now;
                            state.phaseStartTime = now;
                            state.currentPhase = 0; // Start with away team
                            state.lastRenderedPhase = 0;
                            modal.classList.add('visible');

                            // Fetch and cache stats
                            const stats = await fetchGameStats(game.id);
                            if (stats) {
                                state.cachedStats = stats;
                                console.log(`📊 Stats modal started: showing AWAY team for game ${game.id}${isHalftime ? ' (halftime mode - 1 min per team)' : ''}`, stats.away?.name, 'vs', stats.home?.name);
                                renderStatsModal(modal, stats, game, 0); // Phase 0 = away team
                            }
                        }
                        // Otherwise keep waiting (modal stays hidden)
                    }
                }
            } finally {
                statsModalUpdateInProgress = false;
            }
        }

        // ============================================
        // AUTO-REFRESH
        // ============================================
        let prevGameData = new Map(); // Store previous game state for animation detection
        let isFirstRefresh = true; // Skip animations on first refresh (data baseline)

        function startAutoRefresh() {
            // Initialize Socket.io for real-time updates
            initGameSocketForSportsBar();

            // Keep a slow polling fallback (every 60 seconds) as safety net
            refreshInterval = setInterval(() => {
                if (!gameSocket.isConnected()) {
                    refreshGameData();
                }
            }, 60000);
        }

        // Track if GameSocket is initialized for Sports Bar
        let sportsBarGameSocketInitialized = false;

        /**
         * Initialize GameSocket for real-time game updates on Sports Bar
         */
        async function initGameSocketForSportsBar() {
            if (sportsBarGameSocketInitialized) return;
            sportsBarGameSocketInitialized = true;

            try {
                await gameSocket.connect();

                // Get unique leagues from displayed games (excluding replay games)
                const displayedLeagues = [...new Set(games.filter(g => !g.isReplay).map(g => g.league))];
                await gameSocket.subscribe(displayedLeagues);

                // Handle updates
                gameSocket.onUpdate('all', (sport, data, cacheKey, timestamp) => {
                    console.log(`[Desktop SportsBar] Received ${sport} update`);
                    handlePushedGameUpdate(sport, data);
                });

                // Fallback handler
                window.addEventListener('gamesocket:fallback-poll', () => {
                    console.log('[Desktop SportsBar] Fallback polling triggered');
                    refreshGameData();
                });

                console.log('[Desktop SportsBar] GameSocket initialized for real-time updates');

            } catch (error) {
                console.error('[Desktop SportsBar] GameSocket failed, using polling:', error);
                refreshInterval = setInterval(refreshGameData, 10000);
            }
        }

        /**
         * Handle pushed game updates for a specific sport
         */
        function handlePushedGameUpdate(sport, data) {
            const events = data.events || [];

            // Queue for animations to apply after render
            const pendingAnimations = [];

            // Filter to only games we're displaying for this sport (excluding replay and finished)
            const displayedGamesOfSport = games.filter(g => g.league === sport && g.state !== 'post' && !g.isReplay);

            if (displayedGamesOfSport.length === 0) {
                return; // No active games of this sport to update
            }

            displayedGamesOfSport.forEach(game => {
                const updated = events.find(e => e.id === game.id);

                if (updated) {
                    // Store previous data for animation detection
                    const prevData = prevGameData.get(game.id) || {};

                    // Update game from event
                    updateGameFromEvent(game, updated);

                    // Queue animation detection for after render (NFL, NCAA football, and NHL)
                    const comp = updated.competitions?.[0];
                    if (!isFirstRefresh && (sport === 'nfl' || sport === 'ncaa' || sport === 'nhl')) {
                        const newState = {
                            awayScore: game.away.score,
                            homeScore: game.home.score,
                            lastPlay: comp?.situation?.lastPlay?.text || '',
                            down: comp?.situation?.down || 0,
                            possession: game.possession || null,
                            fieldPosition: game.fieldPosition || null,
                            downDistanceText: comp?.situation?.downDistanceText || ''
                        };
                        pendingAnimations.push({ gameId: game.id, game, comp, prevData, league: sport, newState });
                    } else if (!isFirstRefresh) {
                        // For other leagues (NBA, MLB), store state immediately
                        prevGameData.set(game.id, {
                            awayScore: game.away.score,
                            homeScore: game.home.score,
                            lastPlay: comp?.situation?.lastPlay?.text || '',
                            down: comp?.situation?.down || 0,
                            possession: game.possession || null,
                            fieldPosition: game.fieldPosition || null,
                            downDistanceText: comp?.situation?.downDistanceText || ''
                        });
                    }
                }
            });

            // After first update, enable animations
            if (isFirstRefresh) {
                isFirstRefresh = false;
                console.log('[Desktop SportsBar] First update complete - animations now enabled');
            }

            // Preserve any active play text modals before re-render
            const activePlayTextModals = new Map();
            document.querySelectorAll('.play-text-modal').forEach(modal => {
                const card = modal.closest('.fullscreen-game-card');
                if (card && !modal.classList.contains('fade-out')) {
                    const gameId = card.dataset.gameId;
                    const createdAt = parseInt(modal.dataset.createdAt) || 0;
                    const duration = parseInt(modal.dataset.duration) || 15000;
                    const elapsed = Date.now() - createdAt;
                    const remaining = duration - elapsed;

                    if (remaining > 1000) {
                        activePlayTextModals.set(gameId, {
                            modal: modal.cloneNode(true),
                            remaining: remaining
                        });
                    }
                }
            });

            // Update cards in place
            updateCardsInPlace();

            // Apply pending animations and store new state
            pendingAnimations.forEach(({ gameId, game, comp, prevData, league, newState }) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    if (league === 'nhl') {
                        detectNHLPlayEvents(card, game, comp, prevData);
                    } else {
                        detectPlayEvents(card, game, comp, prevData);
                    }
                }
                // Store new state for next comparison
                if (newState) {
                    prevGameData.set(gameId, newState);
                }
            });

            // Update stats modals
            updateStatsModals();

            // Update localStorage
            localStorage.setItem('gridtv_sports_bar_games', JSON.stringify(games));

            // Check if all games are finished
            const activeGames = games.filter(g => g.state !== 'post' && !g.isReplay);
            if (activeGames.length === 0) {
                console.log('[Desktop SportsBar] All games finished - stopping updates');
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                gameSocket.disconnect();
            }
        }

        async function refreshGameData() {
            const apiEndpoints = {
                'nfl': '/api/nfl/scoreboard',
                'nba': '/api/nba/scoreboard',
                'mlb': '/api/mlb/scoreboard',
                'nhl': '/api/nhl/scoreboard',
                'ncaa': '/api/ncaa/scoreboard',
                'ncaab': '/api/ncaab/scoreboard'
            };

            // Queue for animations to apply after render
            const pendingAnimations = [];

            // Only refresh games that aren't finished (live or upcoming) and not replay games
            const activeGames = games.filter(g => g.state !== 'post' && !g.isReplay);

            // If all games are finished, stop refreshing
            if (activeGames.length === 0) {
                console.log('📺 All games finished - stopping auto-refresh');
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                return;
            }

            // Group active games by league to minimize API calls
            const gamesByLeague = {};
            activeGames.forEach(game => {
                if (!gamesByLeague[game.league]) {
                    gamesByLeague[game.league] = [];
                }
                gamesByLeague[game.league].push(game);
            });

            // Fetch updates only for leagues with active games
            for (const league of Object.keys(gamesByLeague)) {
                try {
                    const response = await fetch(apiEndpoints[league]);
                    if (!response.ok) continue;

                    const data = await response.json();
                    const events = data.events || [];

                    // Update game objects with fresh data
                    gamesByLeague[league].forEach(game => {
                        // Extract numeric ID (handles both "401547643" and "nfl:401547643" formats)
                        const gameNumericId = game.id.includes(':') ? game.id.split(':')[1] : game.id;
                        let updated = events.find(e => e.id === gameNumericId);

                        // MLB fallback: match by team abbreviations (handles stale ESPN IDs in localStorage)
                        if (!updated && league === 'mlb') {
                            updated = events.find(e => {
                                const comps = e.competitions?.[0]?.competitors || e.competitors || [];
                                const abbrs = comps.map(c => c.team?.abbreviation);
                                return abbrs.includes(game.away.abbr) && abbrs.includes(game.home.abbr);
                            });
                            if (updated) {
                                // Migrate game.id to Statsapi gamePk so future refreshes work by ID
                                game.id = updated.id;
                                // Update livecast container's data-game-id too
                                const lcContainer = document.getElementById(`mlb-livecast-${gameNumericId}`);
                                if (lcContainer) {
                                    lcContainer.id = `mlb-livecast-${updated.id}`;
                                    lcContainer.dataset.gameId = updated.id;
                                    initMLBLiveCasts();
                                }
                            }
                        }

                        if (updated) {
                            // Store previous data for animation detection
                            const prevData = prevGameData.get(game.id) || {};

                            // Update game from event
                            updateGameFromEvent(game, updated);

                            // Queue animation detection for after render (NFL, NCAA football, and NHL)
                            // Skip on first refresh to avoid triggering animations for old plays
                            const comp = updated.competitions?.[0];
                            if (!isFirstRefresh && (league === 'nfl' || league === 'ncaa' || league === 'nhl')) {
                                // Capture new state for later storage (after updateCardsInPlace)
                                // This delay allows updateCardsInPlace to see the OLD state for new play detection
                                const newState = {
                                    awayScore: game.away.score,
                                    homeScore: game.home.score,
                                    lastPlay: comp?.situation?.lastPlay?.text || '',
                                    down: comp?.situation?.down || 0,
                                    possession: game.possession || null,
                                    fieldPosition: game.fieldPosition || null,
                                    downDistanceText: comp?.situation?.downDistanceText || ''
                                };
                                pendingAnimations.push({ gameId: game.id, game, comp, prevData, league, newState });
                            } else if (!isFirstRefresh) {
                                // For other leagues (NBA, MLB), store state immediately
                                prevGameData.set(game.id, {
                                    awayScore: game.away.score,
                                    homeScore: game.home.score,
                                    lastPlay: comp?.situation?.lastPlay?.text || '',
                                    down: comp?.situation?.down || 0,
                                    possession: game.possession || null,
                                    fieldPosition: game.fieldPosition || null,
                                    downDistanceText: comp?.situation?.downDistanceText || ''
                                });
                            }
                        }
                    });
                } catch (err) {
                    console.error(`Failed to refresh ${league} games:`, err);
                }
            }

            // Preserve any active play text modals before re-render (with timing info)
            const activePlayTextModals = new Map();
            document.querySelectorAll('.play-text-modal').forEach(modal => {
                const card = modal.closest('.fullscreen-game-card');
                if (card && !modal.classList.contains('fade-out')) {
                    const gameId = card.dataset.gameId;
                    const createdAt = parseInt(modal.dataset.createdAt) || 0;
                    const duration = parseInt(modal.dataset.duration) || 15000;
                    const elapsed = Date.now() - createdAt;
                    const remaining = duration - elapsed;

                    // Only preserve if there's still time remaining
                    if (remaining > 1000) {
                        activePlayTextModals.set(gameId, {
                            modal: modal.cloneNode(true),
                            remaining: remaining
                        });
                    }
                }
            });

            // Update cards in place instead of full re-render to avoid flickering
            updateCardsInPlace();

            // Note: No need to restore play text modals since we're not destroying cards

            // Apply pending animations AFTER render so cards exist in DOM
            // Also store the new state after processing (so updateCardsInPlace can see old state)
            pendingAnimations.forEach(({ gameId, game, comp, prevData, league, newState }) => {
                const card = document.querySelector(`.fullscreen-game-card[data-game-id="${gameId}"]`);
                if (card) {
                    if (league === 'nhl') {
                        detectNHLPlayEvents(card, game, comp, prevData);
                    } else {
                        detectPlayEvents(card, game, comp, prevData);
                    }
                }
                // Store new state for next comparison (delayed from game loop)
                if (newState) {
                    prevGameData.set(gameId, newState);
                }
            });

            // Update stats modals for NFL games (show/hide based on play state)
            updateStatsModals();

            // Update localStorage so Home has latest data
            localStorage.setItem('gridtv_sports_bar_games', JSON.stringify(games));

            // After first refresh, enable animations for subsequent refreshes
            if (isFirstRefresh) {
                isFirstRefresh = false;
                console.log('📺 First refresh complete - animations now enabled');
            }
        }

        function updateGameFromEvent(game, event) {
            const comp = event.competitions?.[0];
            if (!comp) return;

            game.state = comp.status?.type?.state || event.status?.type?.state;
            game.status = comp.status?.type?.shortDetail || game.status;

            // Update scores
            const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
            const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');

            if (homeTeam) {
                game.home.score = parseInt(homeTeam.score || 0);
                game.home.winner = homeTeam.winner || false;
            }
            if (awayTeam) {
                game.away.score = parseInt(awayTeam.score || 0);
                game.away.winner = awayTeam.winner || false;
            }

            // MLB-specific data
            if (game.league === 'mlb') {
                const situation = comp.situation;

                // Get hits and errors from competitors
                if (homeTeam) {
                    game.home.hits = parseInt(homeTeam.hits || 0);
                    game.home.errors = parseInt(homeTeam.errors || 0);
                }
                if (awayTeam) {
                    game.away.hits = parseInt(awayTeam.hits || 0);
                    game.away.errors = parseInt(awayTeam.errors || 0);
                }

                if (situation) {
                    // Balls, strikes, outs
                    game.balls = situation.balls || 0;
                    game.strikes = situation.strikes || 0;
                    game.outs = situation.outs || 0;

                    // Runners on base
                    game.onFirst = situation.onFirst || false;
                    game.onSecond = situation.onSecond || false;
                    game.onThird = situation.onThird || false;

                    // Current batter/pitcher
                    game.batter = situation.batter?.athlete?.shortName || situation.batter?.athlete?.displayName || '';
                    game.pitcher = situation.pitcher?.athlete?.shortName || situation.pitcher?.athlete?.displayName || '';

                    // Inning info from period
                    const period = comp.status?.period || 1;
                    const periodType = situation.periodType || comp.status?.type?.detail?.toLowerCase() || '';
                    game.inning = period;
                    game.inningHalf = periodType.includes('bot') ? 'Bot' : 'Top';
                } else {
                    // Clear MLB-specific data if no situation
                    game.balls = 0;
                    game.strikes = 0;
                    game.outs = 0;
                    game.onFirst = false;
                    game.onSecond = false;
                    game.onThird = false;
                    game.batter = '';
                    game.pitcher = '';
                }
            }

            // Football-specific data (NFL and NCAA)
            if (game.league === 'nfl' || game.league === 'ncaa') {
                const situation = comp.situation;

                if (situation) {
                    // Check if game is in intermission (halftime, end of quarter)
                    // During intermission, possession and possessionText are not present
                    const lastPlayType = situation.lastPlay?.type?.text?.toLowerCase() || '';
                    const isIntermission = !situation.possession ||
                        lastPlayType.includes('end of half') ||
                        lastPlayType.includes('end of quarter') ||
                        lastPlayType.includes('end quarter');

                    // Possession
                    const possessionTeamId = situation.possession;
                    if (possessionTeamId) {
                        if (homeTeam && possessionTeamId === homeTeam.id) {
                            game.possession = 'home';
                        } else if (awayTeam && possessionTeamId === awayTeam.id) {
                            game.possession = 'away';
                        }
                    } else {
                        game.possession = null;
                    }

                    // Down and distance - use full text from API which includes field position
                    // Validate that down is 1-4 and distance is positive
                    // Don't set during intermissions (halftime, end of quarter)
                    const isValidDown = situation.down >= 1 && situation.down <= 4;
                    const isValidDistance = situation.distance > 0;

                    // Yard line and field position - set these first as they're needed for fallbacks
                    game.yardLine = situation.yardLine;
                    game.yardsToGo = situation.distance > 0 ? situation.distance : 0;
                    game.possessionOnOwn = situation.isRedZone === false; // Rough approximation

                    if (isIntermission) {
                        // Clear down/distance during intermissions
                        game.downDistance = null;
                        game.fieldPosition = null;
                    } else if (situation.downDistanceText && !situation.downDistanceText.includes('-1') && isValidDown) {
                        game.downDistance = situation.downDistanceText;
                    } else if (situation.shortDownDistanceText && !situation.shortDownDistanceText.includes('-1') && isValidDown) {
                        game.downDistance = situation.shortDownDistanceText;
                    } else if (isValidDown && isValidDistance) {
                        // Build manual downDistance if we have valid down/distance (don't require possessionText)
                        // This ensures 1st down of new drives is captured immediately
                        const downSuffix = getDownSuffix(situation.down);
                        game.downDistance = `${situation.down}${downSuffix} & ${situation.distance}`;
                    } else {
                        game.downDistance = null;
                    }

                    // Field position text
                    if (situation.possessionText && !isIntermission) {
                        game.fieldPosition = situation.possessionText;
                    } else if (isIntermission) {
                        game.fieldPosition = null;
                    } else if (game.downDistance && !isIntermission) {
                        // Fallback: extract field position from downDistanceText if possessionText not available
                        // Format: "1st & 10 at PIT 35" -> "PIT 35"
                        const atMatch = game.downDistance.match(/at\s+([A-Z]{2,4}\s+\d+)/i);
                        if (atMatch) {
                            game.fieldPosition = atMatch[1];
                        } else if (situation.yardLine && game.possession) {
                            // Build field position from yardLine and possession
                            // Determine which team's side based on possession and yardLine
                            const possessionTeam = game.possession === 'home' ? homeTeam : awayTeam;
                            const opposingTeam = game.possession === 'home' ? awayTeam : homeTeam;
                            const possessionAbbr = possessionTeam?.team?.abbreviation || '';
                            const opposingAbbr = opposingTeam?.team?.abbreviation || '';

                            // If yardLine > 50, we're on opponent's side; if <= 50, on our side
                            // But API yardLine is always from 1-50, so we need isRedZone to help
                            // If in red zone (yardLine <= 20) and NOT on own side, we're on opponent's side
                            if (situation.yardLine <= 50) {
                                // Determine side based on isRedZone flag
                                // isRedZone is true when in opponent's red zone (their 20 or closer)
                                const isOnOpponentSide = situation.isRedZone ||
                                    (situation.yardLine <= 20 && !game.possessionOnOwn);
                                const sideAbbr = isOnOpponentSide ? opposingAbbr : possessionAbbr;
                                game.fieldPosition = `${sideAbbr} ${situation.yardLine}`;
                            }
                        }
                    }

                    // Timeouts
                    if (homeTeam) {
                        const homeLinescores = homeTeam.linescores;
                        game.home.timeouts = extractTimeouts(homeTeam, situation, 'home');
                    }
                    if (awayTeam) {
                        game.away.timeouts = extractTimeouts(awayTeam, situation, 'away');
                    }

                    // Store last play text for kickoff/return/punt display
                    const lastPlayText = situation.lastPlay?.text || '';
                    game.lastPlayText = lastPlayText;

                    // Detect special plays (kickoff, punt, return) when no down/distance
                    if (!game.downDistance && lastPlayText && !isIntermission) {
                        const lowerPlay = lastPlayText.toLowerCase();
                        if (lowerPlay.includes('kickoff') || lowerPlay.includes('kicks off')) {
                            game.specialPlay = 'kickoff';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'kickoff');
                        } else if (lowerPlay.includes('punt')) {
                            game.specialPlay = 'punt';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'punt');
                        } else if (lowerPlay.includes('return') || lowerPlay.includes('returned')) {
                            game.specialPlay = 'return';
                            game.specialPlayText = extractSpecialPlayText(lastPlayText, 'return');
                        } else if (lowerPlay.includes('touchback')) {
                            game.specialPlay = 'touchback';
                            game.specialPlayText = 'Touchback';
                        } else if (lowerPlay.includes('fair catch')) {
                            game.specialPlay = 'faircatch';
                            game.specialPlayText = 'Fair Catch';
                        } else if (lowerPlay.includes('extra point') || lowerPlay.includes('pat ')) {
                            game.specialPlay = 'xp';
                            game.specialPlayText = lowerPlay.includes('good') ? 'XP Good' : 'Extra Point';
                        } else if (lowerPlay.includes('two-point') || lowerPlay.includes('2-pt') || lowerPlay.includes('2 pt')) {
                            game.specialPlay = '2pt';
                            game.specialPlayText = '2-Pt Conversion';
                        } else if (lowerPlay.includes('field goal')) {
                            game.specialPlay = 'fg';
                            game.specialPlayText = lowerPlay.includes('good') ? 'FG Good' : 'Field Goal';
                        } else {
                            game.specialPlay = null;
                            game.specialPlayText = null;
                        }
                    } else {
                        game.specialPlay = null;
                        game.specialPlayText = null;
                    }
                } else {
                    // Clear football-specific data if no situation
                    game.possession = null;
                    game.downDistance = null;
                    game.yardLine = undefined;
                    game.fieldPosition = null;
                    game.lastPlayText = null;
                    game.specialPlay = null;
                    game.specialPlayText = null;
                }
            }
        }

        function getDownSuffix(down) {
            switch (down) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function extractSpecialPlayText(playText, playType) {
            // Create a short summary of the special play
            const lowerPlay = playText.toLowerCase();

            if (playType === 'kickoff') {
                // Extract yards if available: "kicks off 65 yards"
                const yardMatch = playText.match(/kicks?\s*off\s*(\d+)\s*yard/i);
                if (yardMatch) {
                    return `Kickoff ${yardMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchback')) {
                    return 'Kickoff - Touchback';
                }
                if (lowerPlay.includes('out of bounds') || lowerPlay.includes('out-of-bounds')) {
                    return 'Kickoff OOB';
                }
                return 'Kickoff';
            }

            if (playType === 'punt') {
                const yardMatch = playText.match(/punts?\s*(\d+)\s*yard/i);
                if (yardMatch) {
                    if (lowerPlay.includes('touchback')) {
                        return `Punt ${yardMatch[1]} yds - TB`;
                    }
                    if (lowerPlay.includes('fair catch')) {
                        return `Punt ${yardMatch[1]} yds - FC`;
                    }
                    return `Punt ${yardMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchback')) {
                    return 'Punt - Touchback';
                }
                if (lowerPlay.includes('fair catch')) {
                    return 'Punt - Fair Catch';
                }
                return 'Punt';
            }

            if (playType === 'return') {
                // Try to find return yards
                const returnMatch = playText.match(/return(?:ed|s)?\s*(?:for\s*)?(\d+)\s*yard/i);
                if (returnMatch) {
                    if (lowerPlay.includes('touchdown')) {
                        return `Return TD (${returnMatch[1]} yds)`;
                    }
                    return `Return ${returnMatch[1]} yds`;
                }
                if (lowerPlay.includes('touchdown')) {
                    return 'Return TD';
                }
                if (lowerPlay.includes('kickoff')) {
                    return 'Kick Return';
                }
                if (lowerPlay.includes('punt')) {
                    return 'Punt Return';
                }
                return 'Return';
            }

            return playType.charAt(0).toUpperCase() + playType.slice(1);
        }

        function extractTimeouts(team, situation, homeAway) {
            // Try to get timeouts from situation
            if (situation) {
                if (homeAway === 'home' && situation.homeTimeouts !== undefined) {
                    return situation.homeTimeouts;
                }
                if (homeAway === 'away' && situation.awayTimeouts !== undefined) {
                    return situation.awayTimeouts;
                }
            }
            // Default to 3 if not available
            return 3;
        }

        // ============================================
        // EXIT MODAL
        // ============================================
        function showExitModal() {
            isModalOpen = true;
            document.getElementById('exit-modal').classList.add('visible');
            setModalFocus(0);
        }

        function hideExitModal() {
            isModalOpen = false;
            document.getElementById('exit-modal').classList.remove('visible');
            document.getElementById('back-btn').focus();
        }

        function setModalFocus(index) {
            modalFocusIndex = index;
            const confirmBtn = document.getElementById('confirm-exit');
            const cancelBtn = document.getElementById('cancel-exit');

            if (index === 0) {
                confirmBtn.focus();
            } else {
                cancelBtn.focus();
            }
        }

        function confirmExit() {
            // Clear refresh interval
            if (refreshInterval) clearInterval(refreshInterval);

            // Navigate back to Home with selections preserved
            window.location.href = '/index?restoreSelections=1';
        }

        // ============================================
        // KEYBOARD NAVIGATION
        // ============================================
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', handleKeyDown);

            // Click handlers
            document.getElementById('back-btn').addEventListener('click', () => {
                if (isReplayMode) {
                    // Navigate back to replay setup page
                    window.location.href = '/replay-setup.html';
                } else {
                    showExitModal();
                }
            });
            document.getElementById('confirm-exit').addEventListener('click', confirmExit);
            document.getElementById('cancel-exit').addEventListener('click', hideExitModal);
        }

        function handleKeyDown(e) {
            if (isModalOpen) {
                handleModalKeyDown(e);
            } else {
                handleMainKeyDown(e);
            }
        }

        function handleMainKeyDown(e) {
            const isEnterKey = e.key === 'Enter' || e.key === ' ' ||
                e.keyCode === 13 || e.keyCode === 66 || e.keyCode === 23;
            const isBackKey = e.key === 'Escape' || e.key === 'GoBack' ||
                e.keyCode === 27 || e.keyCode === 4;

            if (isEnterKey || isBackKey) {
                e.preventDefault();
                if (isReplayMode) {
                    // Navigate back to replay setup page
                    window.location.href = '/replay-setup.html';
                } else {
                    showExitModal();
                }
            }
        }

        function handleModalKeyDown(e) {
            const isEnterKey = e.key === 'Enter' || e.key === ' ' ||
                e.keyCode === 13 || e.keyCode === 66 || e.keyCode === 23;
            const isBackKey = e.key === 'Escape' || e.key === 'GoBack' ||
                e.keyCode === 27 || e.keyCode === 4;

            switch (e.key) {
                case 'ArrowLeft':
                case 'Left':
                    e.preventDefault();
                    setModalFocus(0);
                    break;

                case 'ArrowRight':
                case 'Right':
                    e.preventDefault();
                    setModalFocus(1);
                    break;
            }

            if (isEnterKey) {
                e.preventDefault();
                if (modalFocusIndex === 0) {
                    confirmExit();
                } else {
                    hideExitModal();
                }
            }

            if (isBackKey) {
                e.preventDefault();
                hideExitModal();
            }
        }

    </script>
</body>

</html>