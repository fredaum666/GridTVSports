<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NCAA College Football Live Games - GridTV Sports</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèà</text></svg>">
  <link rel="preload" href="/assets/YFrame.png" as="image">
  <link rel="preload" href="/assets/1stDown1.png" as="image">
  <link rel="preload" href="/assets/1stDown2.png" as="image">
  <style>
    /* ============================================
       EASY EDIT SECTION - ALL CARD SIZING VARIABLES
       ============================================
       Edit these values to change card sizes globally
    */
    :root {
      /* ========== REGULAR CARD SIZES ========== */

      /* Regular Card - Team Logos */
      --regular-team-logo-large: 80px;           /* Upcoming game logos */
      --regular-team-logo-live: 48px;            /* Live game logos */

      /* Regular Card - Team Names */
      --regular-team-name-large: 18px;           /* Upcoming game team names */
      --regular-team-name-live: 16px;            /* Live game team names */

      /* Regular Card - Scores */
      --regular-score-size: 48px;                /* Live/Final game scores */

      /* Regular Card - Records */
      --regular-team-record: 11px;               /* Team records (e.g., "10-3") */

      /* Regular Card - Status Text */
      --regular-status-badge: 9px;               /* LIVE/FINAL badge text */
      --regular-status-detail: 10px;             /* Quarter/time info */

      /* Regular Card - Quarter Grid */
      --regular-quarter-header: 9px;             /* Quarter numbers (1,2,3,4,T) */
      --regular-quarter-score: 13px;             /* Quarter scores */
      --regular-quarter-total: 14px;             /* Total score in grid */

      /* Regular Card - Spacing */
      --regular-card-gap: 12px;                  /* Gap between elements */
      --regular-page-padding: 16px;              /* Internal padding */

      /* Regular Card - Down/Distance & Ball Position */
      --regular-down-distance-size: 20px;        /* Down & distance text (e.g., "2nd & 7") */
      --regular-ball-position-size: 15px;        /* Ball position text (e.g., "at NYG 45") */
      --regular-possession-arrow-size: 16px;     /* Possession arrow indicator */


      /* ========== FULLSCREEN CARD SIZES ========== */

      /* Fullscreen - Team Logos (min, preferred, max) */
      --fs-logo-min: 48px;
      --fs-logo-preferred: 10vmin;
      --fs-logo-max: 120px;

      /* Fullscreen - Team Names (min, preferred, max) */
      --fs-team-name-min: 1rem;
      --fs-team-name-preferred: 3vmin;
      --fs-team-name-max: 2.5rem;

      /* Fullscreen - Scores (min, preferred, max) */
      --fs-score-min: 2.5rem;
      --fs-score-preferred: 10vmin;
      --fs-score-max: 7rem;

      /* Fullscreen - Records (min, preferred, max) */
      --fs-record-min: 0.7rem;
      --fs-record-preferred: 1.8vmin;
      --fs-record-max: 1.3rem;

      /* Fullscreen - VS Divider (min, preferred, max) */
      --fs-vs-min: 1rem;
      --fs-vs-preferred: 3vmin;
      --fs-vs-max: 2rem;

      /* Fullscreen - Status Text (min, preferred, max) */
      --fs-status-min: 0.7rem;
      --fs-status-preferred: 1.8vmin;
      --fs-status-max: 1.2rem;

      /* Fullscreen - Down/Distance (min, preferred, max) */
      --fs-down-distance-min: 0.8rem;
      --fs-down-distance-preferred: 2vmin;
      --fs-down-distance-max: 1.5rem;

      /* Fullscreen - Possession Icon (min, preferred, max) */
      --fs-possession-min: 18px;
      --fs-possession-preferred: 4vmin;
      --fs-possession-max: 32px;

      /* Fullscreen - Spacing (min, preferred, max) */
      --fs-gap-horizontal-min: 12px;
      --fs-gap-horizontal-preferred: 2.5vw;
      --fs-gap-horizontal-max: 40px;

      --fs-gap-vertical-min: 4px;
      --fs-gap-vertical-preferred: 1vh;
      --fs-gap-vertical-max: 12px;

      /* Fullscreen - Field Visualizer Height (min, preferred, max) */
      --fs-field-height-min: 30px;
      --fs-field-height-preferred: 6vh;
      --fs-field-height-max: 50px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      overflow-x: hidden;
      width: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary, #0a0e1a);
      color: var(--text-primary, #e0e0e0);
      min-height: 100vh;
      overflow-x: hidden;
      width: 100%;
      max-width: 100vw;
    }

    /* Header */
    .header {
      background: var(--bg-secondary, linear-gradient(135deg, #1e293b 0%, #334155 100%));
      color: var(--text-primary, white);
      padding: 20px;
      box-shadow: var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, 0.3));
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .back-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }

    .sports-bar-btn {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
    }

    .sports-bar-btn:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.5);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: var(--bg-secondary, #1a1f2e);
      border-radius: 12px;
      padding: 20px;
      max-width: 700px;
      width: 95%;
      max-height: 95vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg, 0 8px 32px rgba(0, 0, 0, 0.5));
      border: 1px solid var(--border-primary, #334155);
      display: flex;
      flex-direction: column;
    }

    .modal-content h2 {
      margin-bottom: 16px;
      color: var(--text-primary, #fff);
      font-size: clamp(18px, 4vw, 24px);
      text-align: center;
      line-height: 1.3;
    }

    .layout-options {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .layout-options label {
      background: var(--bg-tertiary, #334155);
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
      font-size: clamp(13px, 3vw, 15px);
      white-space: nowrap;
      flex: 1 1 auto;
      min-width: fit-content;
      text-align: center;
    }

    .layout-options label:hover {
      background: var(--border-hover, #475569);
      border-color: var(--nfl-border, #17a2b8);
    }

    .layout-options input[type="radio"] {
      margin-right: 8px;
    }

    .layout-options input[type="radio"]:checked + label,
    .layout-options label:has(input[type="radio"]:checked) {
      background: var(--nfl-border, #17a2b8);
      border-color: var(--nfl-border, #17a2b8);
      font-weight: 700;
    }

    /* Grid Preview in Modal */
    .grid-preview {
      margin-bottom: 16px;
      display: grid;
      gap: 10px;
      padding: 12px;
      background: #0a0e1a;
      border-radius: 8px;
      max-height: 60vh;
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }

    .grid-preview.grid-1 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-3 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-4 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-6 {
      grid-template-columns: repeat(3, 1fr);
    }

    .grid-slot {
      background: var(--bg-secondary, #1a1f2e);
      border: 2px solid var(--border-primary, #334155);
      border-radius: 8px;
      padding: 12px;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .slot-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--nfl-border, #17a2b8);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .game-selector {
      width: 100%;
      padding: 10px;
      background: #334155;
      color: #fff;
      border: 2px solid #475569;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .game-selector:hover {
      border-color: var(--nfl-border, #17a2b8);
      background: var(--border-hover, #3d4d63);
    }

    .game-selector:focus {
      outline: none;
      border-color: var(--nfl-border, #17a2b8);
      box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.2);
    }

    .game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
    }

    /* Full Screen Game Selector */
    .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      display: none;
      z-index: 1100;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fs-game-selector {
      width: 100%;
      padding: 8px 12px;
      background: rgba(26, 31, 46, 0.95);
      color: #fff;
      border: 2px solid #17a2b8;
      border-radius: 6px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .fs-game-selector:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }

    .fs-game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
      font-size: 1rem;
    }

    .game-checkboxes {
      margin-bottom: 24px;
      max-height: 400px;
      overflow-y: auto;
    }

    .game-checkbox-item {
      background: #334155;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
    }

    .game-checkbox-item:hover {
      background: #475569;
      border-color: #17a2b8;
    }

    .game-checkbox-item.selected {
      background: #17a2b8;
      border-color: #17a2b8;
    }

    .game-checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .game-checkbox-info {
      flex: 1;
    }

    .game-checkbox-teams {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .game-checkbox-score {
      font-size: 14px;
      color: #94a3b8;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-buttons button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: clamp(14px, 3.5vw, 16px);
      cursor: pointer;
      transition: all 0.2s;
      flex: 1;
      min-width: 100px;
    }

    #enter-fullscreen {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
    }

    #enter-fullscreen:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
    }

    #enter-fullscreen:disabled {
      background: #475569;
      cursor: not-allowed;
      opacity: 0.5;
    }

    #cancel-modal {
      background: #64748b;
      color: white;
    }

    #cancel-modal:hover {
      background: #475569;
    }

    .selection-counter {
      text-align: center;
      margin-bottom: 16px;
      font-size: 14px;
      color: #94a3b8;
    }

    .selection-counter.error {
      color: #ef4444;
      font-weight: 700;
    }

    /* Full Screen Container */
    .fullscreen-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg-primary, #0a0e1a);
      z-index: 99999;
      overflow: hidden;
    }

    .fullscreen-container.active {
      display: flex;
      flex-direction: column;
    }

    /* Hover trigger zone at top of screen */
    .fullscreen-hover-trigger {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 999;
      pointer-events: auto;
    }

    .fullscreen-hover-trigger:hover ~ .fullscreen-controls {
      transform: translateY(0);
    }

    .fullscreen-controls {
      background: rgba(26, 31, 46, 0.95);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #334155;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      transform: translateY(-100%);
      transition: transform 0.3s ease-in-out;
    }

    .fullscreen-controls.visible {
      transform: translateY(0);
    }

    /* Show controls only on hover at top zone or on controls themselves */
    .fullscreen-controls:hover {
      transform: translateY(0);
    }

    .fullscreen-controls button {
      background: #334155;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
    }

    .fullscreen-controls button:hover {
      background: #475569;
    }

    #exit-fullscreen {
      background: #ef4444;
    }

    #exit-fullscreen:hover {
      background: #dc2626;
    }

    /* Cast Button Styles */
    .cast-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      display: none;
      align-items: center;
      gap: 8px;
    }

    .cast-btn:hover {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .cast-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .cast-btn.casting {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      animation: castPulse 2s infinite;
    }

    .cast-icon {
      font-size: 16px;
    }

    @keyframes castPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
    }

    .fullscreen-grid {
      flex: 1;
      display: grid;
      gap: clamp(10px, 1.5vh, 20px);
      padding: clamp(15px, 2vh, 25px);
      overflow: hidden;
      height: calc(100vh - 80px);
      box-sizing: border-box;
    }

    /* Custom scrollbar for fullscreen grid */
    .fullscreen-grid::-webkit-scrollbar {
      width: 12px;
    }

    .fullscreen-grid::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 6px;
    }

    .fullscreen-grid::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.6);
      border-radius: 6px;
      border: 2px solid rgba(15, 23, 42, 0.5);
    }

    .fullscreen-grid::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.8);
    }

    .fullscreen-grid.grid-1 {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr;
      place-items: center;
      padding: clamp(20px, 3vh, 40px);
    }

    .fullscreen-grid.grid-1 .fullscreen-game-card {
      max-width: min(900px, 90vw);
      max-height: 90vh;
      width: 100%;
      height: 100%;
    }

    .fullscreen-grid.grid-2 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 1fr;
      gap: clamp(10px, 1.5vw, 20px);
      height: calc(100vh - 80px);
    }

    .fullscreen-grid.grid-2 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-grid.grid-4 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(8px, 1.2vh, 15px);
      height: calc(100vh - 80px);
      overflow: hidden;
    }

    .fullscreen-grid.grid-4 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-grid.grid-6 {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(6px, 1vh, 12px);
      height: calc(100vh - 80px);
      overflow: hidden;
    }

    .fullscreen-grid.grid-6 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-game-card {
      background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
      border-radius: clamp(8px, 1.2vh, 16px);
      padding: clamp(15px, 2.5vh, 30px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      border: 3px solid #334155;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      position: relative;
      width: 100%;
      height: 100%;
      min-height: 0;
      box-sizing: border-box;
      overflow: hidden;
    }

    /* Sport Logo in Top Left */
    .sport-logo-indicator {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 120px;
      height: 120px;
      object-fit: contain;
      opacity: 0.9;
      filter: drop-shadow(0 2px 12px rgba(0, 0, 0, 0.6));
    }

    .fullscreen-game-card.empty-slot {
      border-style: dashed;
      border-color: #475569;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .fullscreen-game-card.empty-slot .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
    }

    .fullscreen-game-card.winning-home {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.winning-away {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.tied {
      border-color: #fbbf24;
      background: linear-gradient(135deg, #1a1f2e 0%, #3a2e1e 100%);
    }

    /* Upcoming game styling */
    .fullscreen-game-card.upcoming-game {
      border-color: #6366f1;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e2a3a 100%);
      opacity: 0.95;
    }

    .fullscreen-game-card.upcoming-game .fullscreen-quarter {
      color: #818cf8;
      font-size: 1.8rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .fullscreen-game-card.upcoming-game .fullscreen-score {
      color: #6366f1;
      font-size: 5rem;
      opacity: 0.6;
    }

    /* Game Status Container - Quarter/Clock or Upcoming */
    .fullscreen-game-status {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 0;
    }

    .fullscreen-quarter-clock {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(3px, 0.8vh, 10px);
    }

    .fullscreen-quarter-text {
      font-size: clamp(1rem, 3vmin, 2.5rem);
      font-weight: 700;
      color: #17a2b8;
      text-transform: uppercase;
      line-height: 1;
      text-align: center;
    }

    .fullscreen-clock {
      font-size: clamp(1.2rem, 3.5vmin, 2.8rem);
      font-weight: 900;
      color: #fbbf24;
      font-family: 'Courier New', monospace;
      line-height: 1;
      text-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
    }

    .fullscreen-upcoming-status {
      font-size: clamp(1rem, 3vmin, 2.2rem);
      font-weight: 700;
      color: #818cf8;
      text-transform: uppercase;
      animation: pulse 2s ease-in-out infinite;
    }

    .fullscreen-final-status {
      font-size: clamp(1.2rem, 3.5vmin, 2.5rem);
      font-weight: 900;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: clamp(1px, 0.2vw, 2px);
    }

    .fullscreen-clock {
      font-size: 2.2rem;
      font-weight: 900;
      color: #fbbf24;
      font-family: 'Courier New', monospace;
      line-height: 1;
      text-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
    }

    .fullscreen-upcoming-status {
      font-size: 1.8rem;
      font-weight: 700;
      color: #818cf8;
      text-transform: uppercase;
      animation: pulse 2s ease-in-out infinite;
    }

    /* Final game styling */
    .fullscreen-game-card.final-game {
      border-color: #64748b;
      background: linear-gradient(135deg, #1a1f2e 0%, #2a2e3a 100%);
      opacity: 0.92;
    }

    .fullscreen-final-status {
      font-size: 2rem;
      font-weight: 900;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .fullscreen-quarter {
      font-size: clamp(1rem, 3vmin, 2rem);
      font-weight: 700;
      color: #17a2b8;
      margin-bottom: clamp(10px, 2vh, 20px);
      text-transform: uppercase;
    }

    .fullscreen-card-content {
      width: 100%;
      height: 100%;
      min-height: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: clamp(12px, 2.5vh, 40px);
      padding: clamp(10px, 2vmin, 30px);
      box-sizing: border-box;
      overflow: hidden;
    }

    /* Fullscreen horizontal layout - matches regular card page 1 */
    .fullscreen-live-score-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: clamp(var(--fs-gap-horizontal-min), var(--fs-gap-horizontal-preferred), var(--fs-gap-horizontal-max));
      width: 100%;
      max-width: 95%;
      margin: 0 auto;
      flex-shrink: 1;
      min-height: 0;
    }

    .fullscreen-team-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(var(--fs-gap-vertical-min), var(--fs-gap-vertical-preferred), var(--fs-gap-vertical-max));
      position: relative;
      flex-shrink: 1;
      min-height: 0;
    }

    .fullscreen-team-logo {
      width: clamp(var(--fs-logo-min), var(--fs-logo-preferred), var(--fs-logo-max));
      height: clamp(var(--fs-logo-min), var(--fs-logo-preferred), var(--fs-logo-max));
      object-fit: contain;
      flex-shrink: 1;
    }

    .fullscreen-live-team-name {
      font-size: clamp(var(--fs-team-name-min), var(--fs-team-name-preferred), var(--fs-team-name-max));
      font-weight: 700;
      color: #e5e7eb;
      line-height: 1.1;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: clamp(6px, 1.2vw, 12px);
    }

    .fullscreen-live-team-name.winning {
      color: #10b981;
    }

    .fullscreen-team-record {
      font-size: clamp(var(--fs-record-min), var(--fs-record-preferred), var(--fs-record-max));
      color: #9ca3af;
      font-weight: 600;
      text-align: center;
    }

    /* Timeout Indicators */
    .fullscreen-timeouts {
      display: flex;
      justify-content: center;
      gap: clamp(4px, 0.8vw, 8px);
      margin-top: clamp(4px, 0.8vh, 8px);
    }

    .timeout-bar {
      width: clamp(16px, 3vw, 28px);
      height: clamp(5px, 1vh, 8px);
      border: 2px solid rgba(255, 255, 255, 0.8);
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.9);
      transition: background 0.3s ease;
    }

    .timeout-bar.used {
      background: transparent;
    }

    .fullscreen-team-score {
      font-size: clamp(var(--fs-score-min), var(--fs-score-preferred), var(--fs-score-max));
      font-weight: 700;
      color: #e5e7eb;
      min-width: clamp(60px, 12vmin, 120px);
      text-align: center;
      line-height: 1;
    }

    .fullscreen-team-score.winning {
      color: #10b981;
    }

    .fullscreen-team-score.losing {
      color: #9ca3af;
    }

    @-webkit-keyframes scoreUpdate {
      0% { -webkit-transform: scale(1); transform: scale(1); }
      50% { -webkit-transform: scale(1.1); transform: scale(1.1); color: #22c55e; }
      100% { -webkit-transform: scale(1); transform: scale(1); }
    }

    @keyframes scoreUpdate {
      0% { -webkit-transform: scale(1); transform: scale(1); }
      50% { -webkit-transform: scale(1.1); transform: scale(1.1); color: #22c55e; }
      100% { -webkit-transform: scale(1); transform: scale(1); }
    }

    .fullscreen-vs-divider-live {
      font-size: clamp(var(--fs-vs-min), var(--fs-vs-preferred), var(--fs-vs-max));
      color: #64748b;
      margin: 0;
      font-weight: 700;
      text-align: center;
    }

    /* Fullscreen status badges */
    .fullscreen-status-container {
      text-align: center;
      margin-bottom: clamp(8px, 2vh, 20px);
      width: 100%;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
    }

    .fullscreen-status-badge {
      display: inline-block;
      padding: clamp(3px, 0.8vmin, 10px) clamp(10px, 2vmin, 20px);
      border-radius: clamp(10px, 2vmin, 20px);
      font-size: clamp(var(--fs-status-min), var(--fs-status-preferred), var(--fs-status-max));
      font-weight: 700;
      text-transform: uppercase;
    }

    .fullscreen-status-badge.live {
      background: #ef4444;
      color: white;
    }

    .fullscreen-status-badge.final {
      background: #6b7280;
      color: white;
    }

    .fullscreen-status-text {
      color: #9ca3af;
      font-size: clamp(var(--fs-status-min), var(--fs-status-preferred), var(--fs-status-max));
      margin-top: clamp(3px, 0.8vh, 8px);
      font-weight: 600;
    }

    .fullscreen-upcoming-status-text {
      color: #9ca3af;
      font-size: clamp(var(--fs-status-min), var(--fs-status-preferred), var(--fs-status-max));
      font-weight: 600;
      text-align: center;
      margin-bottom: clamp(8px, 2vh, 16px);
      width: 100%;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
    }

    .fullscreen-situation-info {
      font-size: clamp(var(--fs-down-distance-min), var(--fs-down-distance-preferred), var(--fs-down-distance-max));
      color: #fbbf24;
      font-weight: 700;
      text-align: center;
      margin-top: clamp(8px, 1.5vh, 16px);
      width: 100%;
      max-width: 95%;
    }

    .fullscreen-possession {
      position: absolute;
      top: -5px;
      right: -5px;
      font-size: clamp(var(--fs-possession-min), var(--fs-possession-preferred), var(--fs-possession-max));
      line-height: 1;
      animation: blink 1.5s infinite;
      filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.9));
    }

    @-webkit-keyframes possessionBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    @keyframes possessionBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Down/Distance and Field Position Container */
    .fullscreen-down-distance-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(6px, 1.5vh, 18px);
      padding: 0;
    }

    .fullscreen-down-distance {
      font-size: clamp(1rem, 3vmin, 2.5rem);
      color: #fbbf24;
      font-weight: 700;
      text-transform: uppercase;
      text-shadow: 0 2px 6px rgba(251, 191, 36, 0.4);
      line-height: 1;
      text-align: center;
    }

    .fullscreen-field-position {
      font-size: clamp(0.9rem, 2.5vmin, 2rem);
      color: #94a3b8;
      font-weight: 600;
      line-height: 1;
    }

    /* Field Position Visualizer */
    .field-visualizer {
      width: 100%;
      max-width: 90%;
      margin-top: clamp(8px, 1.5vh, 16px);
      margin-left: auto;
      margin-right: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(3px, 0.8vh, 6px);
      flex-shrink: 1;
      min-height: 0;
    }

    .field-container {
      width: 100%;
      max-width: 100%;
      position: relative;
      height: clamp(var(--fs-field-height-min), var(--fs-field-height-preferred), var(--fs-field-height-max));
      background: linear-gradient(to right, #064e3b 0%, #065f46 50%, #064e3b 100%);
      border: clamp(1px, 0.3vmin, 3px) solid #10b981;
      border-radius: clamp(2px, 0.5vmin, 6px);
      overflow: visible;
    }

    .yard-markers {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0;
    }

    .yard-marker {
      position: relative;
      width: clamp(1px, 0.2vmin, 2px);
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .yard-marker.endzone {
      background: rgba(255, 255, 255, 0.6);
      width: clamp(2px, 0.4vmin, 3px);
    }

    .yard-label {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: clamp(8px, 1.5vmin, 12px);
      font-weight: 700;
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      white-space: nowrap;
      pointer-events: none;
    }

    .endzone-label {
      position: absolute;
      font-size: clamp(7px, 1.2vmin, 10px);
      font-weight: 700;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
      top: 50%;
      margin-top: clamp(-15px, -3vh, -20px);
    }

    .endzone-label.left {
      left: clamp(4px, 1vmin, 8px);
    }

    .endzone-label.right {
      right: clamp(4px, 1vmin, 8px);
    }

    .ball-indicator {
      position: absolute;
      top: clamp(-6px, -1.5vmin, -10px);
      bottom: clamp(-6px, -1.5vmin, -10px);
      width: clamp(2px, 0.5vmin, 4px);
      background: linear-gradient(to bottom, #fbbf24, #f59e0b);
      box-shadow: 0 0 clamp(4px, 1.5vmin, 10px) rgba(251, 191, 36, 0.8), 0 0 clamp(2px, 0.8vmin, 6px) rgba(251, 191, 36, 0.6);
      transition: left 0.6s ease-out;
      z-index: 10;
      border-radius: clamp(1px, 0.3vmin, 3px);
    }

    .ball-indicator::before {
      content: 'üèà';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(12px, 2.5vmin, 20px);
      filter: drop-shadow(0 clamp(1px, 0.5vmin, 3px) clamp(2px, 1vmin, 5px) rgba(0, 0, 0, 0.8));
    }

    /* Timeout Indicators */
    .fullscreen-timeouts {
      display: flex;
      justify-content: center;
      gap: clamp(4px, 0.8vw, 8px);
      margin-top: clamp(4px, 0.8vh, 8px);
    }

    .timeout-bar {
      width: clamp(16px, 3vw, 28px);
      height: clamp(5px, 1vh, 8px);
      border: 2px solid rgba(255, 255, 255, 0.8);
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.9);
      transition: background 0.3s ease;
    }

    .timeout-bar.used {
      background: transparent;
    }

    .fullscreen-field-position {
      font-size: 2rem;
      color: #64748b;
      margin-top: 10px;
    }

    .fullscreen-refresh-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      background: #22c55e;
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .fullscreen-refresh-indicator.active {
      opacity: 1;
      animation: pulse 1s;
    }

    /* Play Animations */
    .play-animation {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      z-index: 100;
      pointer-events: none;
      animation: fadeOut 3s forwards;
    }

    .play-animation-icon {
      font-size: clamp(3rem, 8vh, 8rem);
      margin-bottom: clamp(10px, 2vh, 20px);
      animation: playIconBounce 0.8s ease-out;
    }

    .play-animation-text {
      font-size: clamp(1.5rem, 4vh, 4rem);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: clamp(1px, 0.3vh, 3px);
      animation: playTextSlide 0.8s ease-out;
      text-align: center;
      padding: 0 10px;
      line-height: 1.2;
    }

    .play-animation-subtext {
      font-size: clamp(1rem, 2.5vh, 2.5rem);
      font-weight: 700;
      margin-top: clamp(5px, 1vh, 10px);
      text-align: center;
      padding: 0 10px;
      line-height: 1.2;
    }

    /* Touchdown Animation - Green/Gold */
    .play-animation.touchdown .play-animation-icon {
      color: #fbbf24;
      text-shadow: 0 0 30px #fbbf24, 0 0 60px #fbbf24;
    }

    .play-animation.touchdown .play-animation-text {
      background: linear-gradient(90deg, #22c55e, #fbbf24, #22c55e);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: playTextSlide 0.8s ease-out, gradientShift 2s linear infinite;
    }

    /* Field Goal Animation - Blue with YFrame and spinning ball */
    .play-animation.field-goal .play-animation-icon {
      color: #3b82f6;
      text-shadow: 0 0 30px #3b82f6, 0 0 60px #3b82f6;
    }

    .play-animation.field-goal .play-animation-text {
      color: #3b82f6;
      text-shadow: 0 0 20px #3b82f6;
    }

    .field-goal-container {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .yframe-image {
      width: clamp(80px, 15vmin, 150px);
      height: auto;
      filter: drop-shadow(0 0 20px #3b82f6) drop-shadow(0 0 40px #3b82f6);
      animation: yframeGlow 1s ease-in-out infinite alternate;
    }

    .spinning-football {
      position: absolute;
      font-size: clamp(1.5rem, 4vmin, 3rem);
      animation: footballSpin 0.5s linear infinite, footballArc 1.5s ease-out forwards;
      filter: drop-shadow(0 0 10px #8b4513);
    }

    @keyframes yframeGlow {
      0% { filter: drop-shadow(0 0 20px #3b82f6) drop-shadow(0 0 40px #3b82f6); }
      100% { filter: drop-shadow(0 0 30px #60a5fa) drop-shadow(0 0 60px #60a5fa); }
    }

    @keyframes footballSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes footballArc {
      0% {
        bottom: -50px;
        opacity: 1;
      }
      50% {
        bottom: 30%;
        opacity: 1;
      }
      100% {
        bottom: 80%;
        opacity: 0;
      }
    }

    /* 1st Down Animation - Green with arrows coming together */
    .play-animation.first-down .play-animation-text {
      color: #22c55e;
      text-shadow: 0 0 20px #22c55e;
    }

    .first-down-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0;
      margin-bottom: clamp(5px, 1.5vh, 15px);
      width: 100%;
      max-width: clamp(80px, 25vmin, 200px);
      overflow: hidden;
    }

    .first-down-arrow {
      width: clamp(30px, 8vmin, 80px);
      height: auto;
      filter: drop-shadow(0 0 10px #22c55e) drop-shadow(0 0 20px #22c55e);
      flex-shrink: 0;
    }

    .first-down-arrow.left {
      animation: arrowSlideLeft 0.8s ease-out forwards;
    }

    @keyframes arrowSlideLeft {
      0% {
        transform: translateX(-150%);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Interception Animation - Red */
    .play-animation.interception .play-animation-icon {
      color: #ef4444;
      text-shadow: 0 0 30px #ef4444, 0 0 60px #ef4444;
    }

    .play-animation.interception .play-animation-text {
      color: #ef4444;
      text-shadow: 0 0 20px #ef4444;
    }

    /* Fumble Animation - Orange */
    .play-animation.fumble .play-animation-icon {
      color: #f97316;
      text-shadow: 0 0 30px #f97316, 0 0 60px #f97316;
    }

    .play-animation.fumble .play-animation-text {
      color: #f97316;
      text-shadow: 0 0 20px #f97316;
    }

    /* First Down Animation - Yellow/Gold */
    .play-animation.first-down .play-animation-icon {
      color: #eab308;
      text-shadow: 0 0 30px #eab308, 0 0 60px #eab308;
    }

    .play-animation.first-down .play-animation-text {
      color: #eab308;
      text-shadow: 0 0 20px #eab308;
      animation: playTextSlide 0.8s ease-out, firstDownPulse 0.5s ease-in-out 3;
    }

    @keyframes firstDownPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      70% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes playIconBounce {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
    }

    @keyframes playTextSlide {
      0% { transform: translateY(50px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes gradientShift {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }

    /* Grid-specific responsive sizing */
    /* 6-Grid Layout - Smaller text to fit 3 columns */
    .fullscreen-grid.grid-6 .fullscreen-team-logo {
      width: 45px !important;
      height: 45px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-header {
      gap: 6px !important;
      margin-bottom: 6px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-name {
      font-size: 1.6rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-score {
      font-size: 3rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-quarter {
      font-size: 1.2rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-vs {
      font-size: 1rem !important;
      margin: 3px 0 !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-record {
      font-size: 0.9rem !important;
      min-width: 45px !important;
      padding-right: 8px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-down-distance {
      font-size: 1.4rem !important;
      margin-top: 5px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-field-position {
      font-size: 1rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-possession {
      width: 16px !important;
      height: 16px !important;
      margin-left: 4px !important;
    }

    .fullscreen-grid.grid-6 .timeout-bar {
      width: 16px !important;
      height: 5px !important;
      border-width: 1.5px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-timeouts {
      gap: 4px !important;
      margin-top: 4px !important;
    }

    .fullscreen-grid.grid-6 .sport-logo-indicator {
      width: 70px !important;
      height: 70px !important;
      top: 10px !important;
      left: 10px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-game-card {
      padding: 15px !important;
    }

    /* 4-Grid Layout - Medium text */
    .fullscreen-grid.grid-4 .fullscreen-team-logo {
      width: 55px !important;
      height: 55px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-header {
      gap: 8px !important;
      margin-bottom: 8px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-name {
      font-size: 1.8rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-score {
      font-size: 3.5rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-quarter {
      font-size: 1.3rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-vs {
      font-size: 1.1rem !important;
      margin: 3px 0 !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-down-distance {
      font-size: 1.6rem !important;
      margin-top: 6px !important;
    }

    .fullscreen-grid.grid-4 .timeout-bar {
      width: 18px !important;
      height: 6px !important;
      border-width: 1.5px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-timeouts {
      gap: 5px !important;
      margin-top: 6px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-field-position {
      font-size: 1.1rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-possession {
      width: 18px !important;
      height: 18px !important;
      margin-left: 5px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-record {
      font-size: 1.1rem !important;
      min-width: 52px !important;
      padding-right: 9px !important;
    }

    .fullscreen-grid.grid-4 .sport-logo-indicator {
      width: 85px !important;
      height: 85px !important;
      top: 12px !important;
      left: 12px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-game-card {
      padding: 18px !important;
    }

    /* 2-Grid Layout - Keep large text (default) */
    .fullscreen-grid.grid-2 .fullscreen-team-name {
      font-size: 3.5rem !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-score {
      font-size: 6rem !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-team-record {
      font-size: 1.3rem !important;
      min-width: 58px !important;
      padding-right: 10px !important;
    }

    /* 4-Grid Layout - Smaller text to fit 2x2 grid */
    .fullscreen-grid.grid-4 .fullscreen-team-name {
      font-size: 2rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-score {
      font-size: 4rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-logo {
      width: 60px !important;
      height: 60px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-quarter {
      font-size: 1.4rem !important;
      margin-bottom: 12px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team {
      margin-bottom: 8px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-record {
      font-size: 0.9rem !important;
    }

    .fullscreen-grid.grid-4 .sport-logo-indicator {
      width: 80px !important;
      height: 80px !important;
      top: 10px !important;
      left: 10px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-vs {
      font-size: 1rem !important;
      margin: 5px 0 !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-down-distance {
      font-size: 1rem !important;
    }

    /* 6-Grid Layout - Very compact text to fit 3x2 grid */
    .fullscreen-grid.grid-6 .fullscreen-team-name {
      font-size: 1.6rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-score {
      font-size: 3.5rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-logo {
      width: 50px !important;
      height: 50px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-quarter {
      font-size: 1.2rem !important;
      margin-bottom: 10px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team {
      margin-bottom: 6px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-record {
      font-size: 0.8rem !important;
    }

    .fullscreen-grid.grid-6 .sport-logo-indicator {
      width: 60px !important;
      height: 60px !important;
      top: 8px !important;
      left: 8px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-vs {
      font-size: 0.9rem !important;
      margin: 4px 0 !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-down-distance {
      font-size: 0.9rem !important;
    }

    /* Responsive - Tablets and smaller */
    @media (max-width: 1200px) {
      .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }

      .fullscreen-grid.grid-6 .fullscreen-team-name {
        font-size: 2.5rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-score {
        font-size: 4.5rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-name {
        font-size: 2.5rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-score {
        font-size: 4rem !important;
      }
    }

    /* MOBILE RESPONSIVE - STACK ALL GRIDS VERTICALLY */
    @media (max-width: 768px) {
      /* Grid preview in modal */
      .grid-preview.grid-4,
      .grid-preview.grid-6 {
        grid-template-columns: 1fr;
      }

      /* Fullscreen grid layouts - ALL become single column vertical stack */
      .fullscreen-grid {
        grid-template-columns: 1fr !important;
        grid-template-rows: auto !important;
        gap: clamp(10px, 2vh, 20px) !important;
        padding: clamp(10px, 2vh, 20px) !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        height: calc(100vh - 80px) !important;
      }

      /* Grid-1: Single card takes most of screen - large sizing */
      .fullscreen-grid.grid-1 {
        place-items: stretch !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-game-card {
        max-width: 100% !important;
        height: auto !important;
        padding: clamp(20px, 3vh, 30px) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-team-logo {
        width: clamp(60px, 10vh, 90px) !important;
        height: clamp(60px, 10vh, 90px) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-team-name {
        font-size: clamp(2rem, 5vh, 3.5rem) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-score {
        font-size: clamp(3rem, 8vh, 6rem) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-quarter {
        font-size: clamp(1.2rem, 2.5vh, 2rem) !important;
        margin-bottom: clamp(12px, 2vh, 20px) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-team {
        margin-bottom: clamp(10px, 2vh, 15px) !important;
      }

      .fullscreen-grid.grid-1 .sport-logo-indicator {
        width: clamp(70px, 12vh, 100px) !important;
        height: clamp(70px, 12vh, 100px) !important;
      }

      /* Grid-2: Two cards stacked - medium sizing */
      .fullscreen-grid.grid-2 .fullscreen-game-card {
        height: auto !important;
        padding: clamp(15px, 2.5vh, 25px) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team-logo {
        width: clamp(50px, 8vh, 70px) !important;
        height: clamp(50px, 8vh, 70px) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team-name {
        font-size: clamp(1.5rem, 4vh, 2.5rem) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-score {
        font-size: clamp(2.5rem, 6vh, 4.5rem) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-quarter {
        font-size: clamp(1rem, 2vh, 1.5rem) !important;
        margin-bottom: clamp(8px, 1.5vh, 15px) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team {
        margin-bottom: clamp(8px, 1.5vh, 12px) !important;
      }

      .fullscreen-grid.grid-2 .sport-logo-indicator {
        width: clamp(60px, 10vh, 80px) !important;
        height: clamp(60px, 10vh, 80px) !important;
      }

      /* Grid-4: Four cards stacked - compact sizing */
      .fullscreen-grid.grid-4 .fullscreen-game-card {
        height: auto !important;
        padding: clamp(12px, 2vh, 20px) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-logo {
        width: clamp(40px, 6vh, 60px) !important;
        height: clamp(40px, 6vh, 60px) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-name {
        font-size: clamp(1.2rem, 3vh, 2rem) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-score {
        font-size: clamp(2rem, 5vh, 3.5rem) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-quarter {
        font-size: clamp(0.9rem, 1.8vh, 1.3rem) !important;
        margin-bottom: clamp(6px, 1.2vh, 12px) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team {
        margin-bottom: clamp(6px, 1.2vh, 10px) !important;
      }

      .fullscreen-grid.grid-4 .sport-logo-indicator {
        width: clamp(50px, 8vh, 70px) !important;
        height: clamp(50px, 8vh, 70px) !important;
      }

      /* Grid-6: Six cards stacked - very compact sizing */
      .fullscreen-grid.grid-6 .fullscreen-game-card {
        height: auto !important;
        padding: clamp(10px, 1.8vh, 18px) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team-logo {
        width: clamp(35px, 5vh, 50px) !important;
        height: clamp(35px, 5vh, 50px) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team-name {
        font-size: clamp(1rem, 2.5vh, 1.8rem) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-score {
        font-size: clamp(1.8rem, 4.5vh, 3rem) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-quarter {
        font-size: clamp(0.85rem, 1.5vh, 1.2rem) !important;
        margin-bottom: clamp(5px, 1vh, 10px) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team {
        margin-bottom: clamp(5px, 1vh, 8px) !important;
      }

      .fullscreen-grid.grid-6 .sport-logo-indicator {
        width: clamp(40px, 6vh, 60px) !important;
        height: clamp(40px, 6vh, 60px) !important;
      }

      /* Common mobile styles for all grids */
      .fullscreen-team {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        justify-content: center !important;
        gap: clamp(8px, 1.5vh, 20px) !important;
      }

      .fullscreen-team-info {
        display: flex !important;
        align-items: center !important;
        gap: clamp(6px, 1vh, 12px) !important;
        flex: 0 1 auto !important;
        min-width: 0 !important;
      }

      .fullscreen-team-header {
        display: flex !important;
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: clamp(2px, 0.4vh, 4px) !important;
        flex: 1 !important;
        min-width: 0 !important;
        margin-bottom: 0 !important;
      }

      .fullscreen-team-record {
        font-size: clamp(0.7rem, 1.1vh, 0.95rem) !important;
        opacity: 0.7 !important;
        order: -1 !important;
      }

      .fullscreen-score {
        text-align: center !important;
      }

      .fullscreen-vs {
        font-size: clamp(0.8rem, 1.5vh, 1.2rem) !important;
        margin: clamp(3px, 0.6vh, 8px) 0 !important;
      }

      .fullscreen-team-record {
        font-size: clamp(0.75rem, 1.2vh, 1rem) !important;
        opacity: 0.7 !important;
      }

      .fullscreen-down-distance {
        font-size: clamp(0.9rem, 1.8vh, 1.4rem) !important;
        margin-top: clamp(5px, 1vh, 10px) !important;
      }

      .timeout-bar {
        width: clamp(12px, 2vh, 18px) !important;
        height: clamp(4px, 0.8vh, 6px) !important;
        border-width: 1.5px !important;
      }

      .fullscreen-timeouts {
        display: flex !important;
        gap: clamp(3px, 0.6vh, 5px) !important;
        margin-top: clamp(2px, 0.4vh, 4px) !important;
      }

      .sport-logo-indicator {
        top: 8px !important;
        left: 8px !important;
        opacity: 0.75 !important;
      }

      .fullscreen-game-card {
        border-radius: clamp(8px, 1.5vh, 12px) !important;
        border-width: 2px !important;
      }

      .fs-game-selector {
        font-size: clamp(0.8rem, 1.2vh, 0.95rem) !important;
        padding: 4px !important;
      }

      .fullscreen-possession {
        font-size: clamp(16px, 2.5vh, 24px) !important;
        margin-left: 5px !important;
      }

      /* Ensure proper card structure on mobile */
      .fullscreen-game-card {
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
      }
    }

    /* Extra small screens (phones in portrait) - Scale down clamp minimums */
    @media (max-width: 480px) {
      .fullscreen-grid {
        gap: 8px !important;
        padding: 8px !important;
      }

      /* Further reduce for very small screens */
      .fullscreen-grid.grid-1 .fullscreen-team-name {
        font-size: clamp(1.6rem, 5vh, 3rem) !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-score {
        font-size: clamp(2.5rem, 8vh, 5rem) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team-name {
        font-size: clamp(1.3rem, 4vh, 2.2rem) !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-score {
        font-size: clamp(2rem, 6vh, 4rem) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-name {
        font-size: clamp(1rem, 3vh, 1.8rem) !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-score {
        font-size: clamp(1.7rem, 5vh, 3rem) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team-name {
        font-size: clamp(0.9rem, 2.5vh, 1.5rem) !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-score {
        font-size: clamp(1.5rem, 4.5vh, 2.5rem) !important;
      }

      .sport-logo-indicator {
        opacity: 0.6 !important;
      }
    }

    /* HEIGHT-BASED RESPONSIVE - HORIZONTAL LAYOUT FOR SHORT SCREENS (DESKTOP/TABLET ONLY) */
    /* OLD MEDIA QUERY REMOVED - Conflicted with new horizontal layout and dynamic scaling
       The old vertical layout media query used outdated class names and prevented
       proper scaling above 769px width. Now using dynamic scaling based on card size. */

    /* Main Container */
    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 10px;
    }

    /* Live Games List - Full Width Emphasis */
    .live-games-panel {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .panel-header {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .auto-refresh-info {
      font-size: 12px;
      color: #9ca3af;
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .refresh-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .refresh-btn:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    /* Games Grid - Fully Responsive */
    .games-grid {
      display: grid;
      /* Auto-fill creates responsive columns - smaller min width allows more columns */
      grid-template-columns: repeat(auto-fill, minmax(min(300px, 100%), 1fr));
      gap: 15px;
      padding: 5px 10px 20px 10px;
      margin-top: 10px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      justify-content: start;
    }

    /* Large Desktop: 4+ cards per row (1600px+) */
    @media (min-width: 1600px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 18px;
        padding: 5px 15px 20px 15px;
      }
    }

    /* Desktop: 3-4 cards per row (1200px - 1599px) */
    @media (min-width: 1200px) and (max-width: 1599px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 15px;
      }
    }

    /* Tablet Landscape: 3 cards per row (900px - 1199px) */
    @media (min-width: 900px) and (max-width: 1199px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 12px;
      }
    }

    /* Tablet Portrait: 2-3 cards (650px - 899px) */
    @media (min-width: 650px) and (max-width: 899px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 12px;
        padding: 5px 8px 20px 8px;
      }
    }

    /* Small Tablet / Large Mobile: 2 cards (500px - 649px) */
    @media (min-width: 500px) and (max-width: 649px) {
      .games-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 5px 5px 20px 5px;
      }
    }

    /* Mobile: 1 card per row (< 500px) */
    @media (max-width: 499px) {
      .games-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 5px 5px 20px 5px;
        overflow-x: hidden;
      }
    }

    /* Scrollbar styling */
    .games-grid::-webkit-scrollbar {
      width: 8px;
    }

    .games-grid::-webkit-scrollbar-track {
      background: #0a0e1a;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb:hover {
      background: #2563eb;
    }

    /* Game Card - Prominent Display */
    .game-card {
      background: linear-gradient(135deg, #242b3d 0%, #2d3548 100%);
      border-radius: 12px;
      padding: 0;
      border: 2px solid transparent;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      position: relative;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      min-height: fit-content;
    }

    /* Hover effect removed - cards are static */

    /* Game Start Time Badge for Upcoming Games */
    .game-start-time-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(99, 102, 241, 0.95);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      line-height: 1;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .game-start-date-badge {
      font-size: 0.75rem;
      opacity: 0.95;
    }

    .quarter-header {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .team-column {
      flex: 1;
    }

    .scores-header {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .quarter-label {
      font-size: 11px;
      font-weight: 600;
      color: #9ca3af;
      min-width: 24px;
      text-align: center;
    }

    .quarter-label:last-child {
      min-width: 36px;
      margin-left: 8px;
    }

    .possession-arrow {
      color: #10b981;
      font-size: var(--regular-possession-arrow-size);
      margin-right: 8px;
      width: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .team-row {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .team-row:last-of-type {
      border-bottom: none;
    }

    .team-row.winning {
      background: rgba(16, 185, 129, 0.05);
    }

    .team-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .team-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .team-name {
      font-weight: 600;
      font-size: 15px;
      color: #e0e0e0;
      min-width: 150px;
    }

    .quarter-scores {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-left: auto;
    }

    .quarter-score {
      font-size: 14px;
      font-weight: 600;
      color: #9ca3af;
      min-width: 24px;
      text-align: center;
    }

    .quarter-score.total-score {
      font-size: 24px;
      font-weight: 700;
      color: #e0e0e0;
      min-width: 36px;
      margin-left: 8px;
    }

    .team-row.winning .quarter-score.total-score {
      color: #10b981;
    }

    .game-footer-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
    }

    .live-badge .live-dot {
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    .game-situation {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }

    .quarter-clock {
      font-weight: 600;
      color: var(--card-quarter-clock, #94a3b8);
    }

    .down-distance {
      color: var(--card-down-distance, #fbbf24);
      font-weight: 600;
      font-size: var(--regular-down-distance-size);
      padding: 2px 8px;
      background: var(--card-down-distance-bg, rgba(251, 191, 36, 0.1));
      border-radius: 4px;
    }

    .yard-line {
      color: var(--card-yard-line, #3b82f6);
      font-weight: 600;
    }

    /* Refresh indicator */
    .refresh-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #10b981;
      animation: pulse 2s infinite;
    }

    @keyframes refreshSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .refresh-indicator.active {
      animation: none;
    }

    .refresh-indicator.active .spin {
      animation: refreshSpin 1s linear;
    }

    /* No Games Message */
    .no-games-message {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
    }

    .no-games-message .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .no-games-message h3 {
      font-size: 20px;
      color: #e0e0e0;
      margin-bottom: 8px;
    }

    .no-games-message p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      backdrop-filter: blur(4px);
      overflow-y: auto;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    /* Game Detail Panel */
    .game-detail-panel {
      background: #1a1f2e;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      margin: 40px auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      animation: slideIn 0.3s ease;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
    }

    .close-detail-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .close-detail-btn:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }

    .detail-matchup {
      display: flex;
      align-items: center;
      justify-content: space-around;
      gap: 20px;
    }

    .detail-team {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .detail-team-logo {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }

    .detail-team-name {
      font-size: 14px;
      font-weight: 700;
      text-align: center;
      line-height: 1.2;
    }

    .detail-team-score {
      font-size: 32px;
      font-weight: 700;
      color: #10b981;
    }

    .detail-vs {
      font-size: 18px;
      color: #6b7280;
      font-weight: 600;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #3b82f6 #1a1f2e;
      position: relative;
    }

    .tabs::-webkit-scrollbar {
      height: 4px;
    }

    .tabs::-webkit-scrollbar-track {
      background: #1a1f2e;
    }

    .tabs::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 2px;
    }

    .tab {
      background: transparent;
      color: #9ca3af;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      border-radius: 8px 8px 0 0;
      position: relative;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .tab:hover {
      background: #242b3d;
      color: #e0e0e0;
    }

    .tab.active {
      background: #3b82f6;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .tab-content.active {
      display: block;
    }

    /* Stats Table */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
      background: #242b3d;
      border-radius: 10px;
      overflow: hidden;
    }

    .stats-table th {
      padding: 12px;
      font-size: 14px;
      font-weight: 600;
      background: #1a1f2e;
    }

    .stats-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #1a1f2e;
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    /* Win Probability */
    .win-prob-container {
      margin-top: 20px;
    }

    .prob-bar-container {
      display: flex;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .prob-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      transition: width 0.5s ease;
    }

    .prob-bar.away {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
    }

    .prob-bar.home {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    }

    .prob-legend {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #9ca3af;
    }

    /* Predictions */
    .prediction-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: #242b3d;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
    }

    .stat-label {
      color: #9ca3af;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
    }

    /* Clickable cards */
    /* Sliding Card Pages */
    .card-slider-container {
      position: relative;
      overflow: hidden;
      width: 100%;
      min-height: 100%;
      padding-bottom: 24px;
    }

    .card-pages {
      display: flex;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      min-height: 100%;
      overflow: visible;
    }

    .card-page {
      min-width: 100%;
      flex-shrink: 0;
      overflow: visible;
      box-sizing: border-box;
      min-height: 200px;
    }

    .page-indicators {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 10;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }

    .page-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s;
      cursor: pointer;
    }

    .page-dot.active {
      background: rgba(255, 255, 255, 0.9);
      width: 18px;
      border-radius: 3px;
    }

    .page-dot:hover {
      background: rgba(255, 255, 255, 0.6);
    }

    /* Page 1 - Main Info */
    .page-1-content {
      padding: 16px;
      padding-bottom: 36px;
      min-height: 100%;
      box-sizing: border-box;
    }

    .page-1-upcoming {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      height: 100%;
      min-height: 200px;
    }

    .page-1-upcoming .team-display {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 400px;
    }

    .page-1-upcoming .team-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .page-1-upcoming .team-logo-large {
      width: var(--regular-team-logo-large);
      height: var(--regular-team-logo-large);
      object-fit: contain;
      flex-shrink: 0;
    }

    .page-1-upcoming .team-name-large {
      font-size: var(--regular-team-name-large);
      font-weight: 700;
      text-align: center;
      color: #e5e7eb;
      line-height: 1.2;
    }

    .page-1-upcoming .team-standing {
      font-size: var(--regular-team-record);
      color: #9ca3af;
      font-weight: 600;
    }

    .page-1-upcoming .vs-divider {
      font-size: 14px;
      font-weight: 700;
      color: #6b7280;
    }

    /* Page 1 - Live/Final with Play-by-Play */
    .page-1-live {
      padding: 10px;
      padding-bottom: 36px;
      min-height: fit-content;
      box-sizing: border-box;
      overflow: visible;
    }

    .live-score-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .team-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .live-team-logo {
      width: var(--regular-team-logo-live);
      height: var(--regular-team-logo-live);
      object-fit: contain;
      flex-shrink: 0;
      max-width: 100%;
    }

    .possession-icon {
      position: absolute;
      top: -5px;
      right: -5px;
      font-size: 20px;
      line-height: 1;
      animation: blink 1.5s infinite;
      filter: drop-shadow(0 0 3px rgba(251, 191, 36, 0.8));
    }

    .live-team-name {
      font-size: var(--regular-team-name-live);
      font-weight: 700;
      color: #e5e7eb;
      line-height: 1.1;
      text-align: center;
    }

    .live-team-name.winning {
      color: #10b981;
    }

    .live-team-standing {
      font-size: var(--regular-team-record);
      color: #9ca3af;
      font-weight: 600;
      text-align: center;
    }

    .live-team-score {
      font-size: var(--regular-score-size);
      font-weight: 700;
      color: #e5e7eb;
      min-width: 60px;
      text-align: center;
      line-height: 1;
    }

    .live-team-score.winning {
      color: #10b981;
    }

    .live-team-score.losing {
      color: #9ca3af;
    }

    .vs-divider-live {
      font-size: 14px;
      font-weight: 700;
      color: #6b7280;
      padding: 0 4px;
    }

    .game-situation-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
      margin-top: 4px;
    }

    .down-distance {
      font-size: var(--regular-down-distance-size);
      font-weight: 700;
      color: #f59e0b;
    }

    .ball-position {
      font-size: var(--regular-ball-position-size);
      color: #9ca3af;
      font-weight: 600;
    }

    /* Page 2 - Scoring History */
    .page-2-content {
      padding: 16px;
      padding-bottom: 36px;
      min-height: 200px;
      box-sizing: border-box;
    }

    .scoring-history-header {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .scoring-team-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .scoring-history-title {
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: #9ca3af;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .quarters-grid {
      display: grid;
      grid-template-columns: auto repeat(5, 1fr);
      gap: 5px;
      align-items: center;
    }

    .quarter-header-cell {
      font-size: var(--regular-quarter-header);
      font-weight: 700;
      color: #9ca3af;
      text-align: center;
      padding: 4px 2px;
    }

    .team-label-cell {
      font-size: var(--regular-team-record);
      font-weight: 600;
      color: #e5e7eb;
      padding: 6px 8px;
    }

    .score-cell {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      padding: 6px 3px;
      text-align: center;
      font-size: var(--regular-quarter-score);
      font-weight: 700;
      color: #e5e7eb;
    }

    .score-cell.total {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      font-size: var(--regular-quarter-total);
    }

    .score-cell.empty {
      opacity: 0.3;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      /* Grid layout handled by main .games-grid rules above */
      
      .quarter-scores {
        gap: 12px;
      }
      
      .quarter-score {
        font-size: 13px;
        min-width: 20px;
      }
      
      .quarter-score.total-score {
        font-size: 22px;
      }
      
      .team-name {
        font-size: 14px;
        min-width: 120px;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 15px 10px;
      }

      .header-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .header h1 {
        font-size: 18px;
        justify-content: center;
      }

      .header h1 img {
        height: 35px !important;
      }

      .live-indicator {
        font-size: 10px;
        padding: 3px 8px;
      }

      .header-content > div {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
      }

      .theme-select {
        min-width: 140px;
        font-size: 12px;
        padding: 8px 12px;
      }

      .back-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 120px;
      }

      .sports-bar-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 140px;
      }
      
      .panel-header {
        font-size: 16px;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .refresh-btn {
        font-size: 12px;
        padding: 6px 12px;
      }
      
      .games-grid {
        /* Grid layout handled by main .games-grid rules above */
        max-height: none;
      }
      
      .game-card {
        padding: 0;
        border-radius: 12px;
        min-height: 200px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .team-row {
        padding: 16px 12px;
        flex-wrap: nowrap;
        width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }

      .team-info {
        gap: 10px;
        flex-shrink: 1;
        min-width: 0;
        max-width: 50%;
      }

      .team-logo {
        width: 28px;
        height: 28px;
        flex-shrink: 0;
      }
      
      .team-name {
        font-size: 12px;
        min-width: 0;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }
      
      .quarter-scores {
        gap: 8px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
      }
      
      .quarter-score {
        font-size: 11px;
        min-width: 18px;
        max-width: 24px;
        text-align: center;
      }
      
      .quarter-score.total-score {
        font-size: 20px;
        min-width: 32px;
        max-width: 40px;
        font-weight: 700;
        margin-left: 4px;
      }
      
      .quarter-header {
        padding: 10px 12px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .scores-header {
        gap: 8px;
      }
      
      .quarter-label {
        font-size: 9px;
        min-width: 18px;
        max-width: 24px;
        text-align: center;
      }
      
      .quarter-label:last-child {
        min-width: 32px;
        max-width: 40px;
        margin-left: 4px;
      }

      .game-footer-info {
        padding: 12px;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 50px;
        width: 100%;
        box-sizing: border-box;
      }

      .live-badge {
        font-size: 9px;
        padding: 4px 8px;
      }
      
      .game-situation {
        flex-direction: row;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        font-size: 10px;
      }
      
      .quarter-clock {
        font-size: 10px;
        font-weight: 600;
      }
      
      .down-distance,
      .yard-line {
        font-size: 9px;
        padding: 2px 6px;
      }

      /* Modal fixes for mobile */
      .modal-overlay {
        padding: 10px;
      }

      .modal-content {
        padding: 15px;
        width: 98%;
        max-height: 98vh;
      }

      .modal-content h2 {
        font-size: 16px;
        margin-bottom: 12px;
      }

      .layout-options {
        gap: 6px;
        margin-bottom: 12px;
      }

      .layout-options label {
        padding: 8px 12px;
        font-size: 12px;
      }

      /* Hide 6 game option on mobile - max 4 games */
      .layout-options label:has(input[value="6"]) {
        display: none;
      }

      .grid-preview {
        padding: 8px;
        gap: 8px;
        max-height: 50vh;
      }

      .grid-preview.grid-2,
      .grid-preview.grid-4,
      .grid-preview.grid-6 {
        grid-template-columns: 1fr;
      }

      .grid-slot {
        padding: 10px;
        min-height: 70px;
      }

      .slot-label {
        font-size: 11px;
      }

      .game-selector {
        padding: 8px;
        font-size: 12px;
      }

      .modal-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .modal-buttons button {
        width: 100%;
        padding: 10px 16px;
        font-size: 14px;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 400px) {
      .game-card {
        border-radius: 10px;
      }

      .team-row {
        padding: 12px 8px;
      }

      .team-info {
        gap: 8px;
        max-width: 45%;
      }

      .team-logo {
        width: 24px;
        height: 24px;
      }

      .team-name {
        font-size: 11px;
      }

      .quarter-scores {
        gap: 6px;
      }

      .quarter-score {
        font-size: 10px;
        min-width: 16px;
        max-width: 20px;
      }

      .quarter-score.total-score {
        font-size: 18px;
        min-width: 28px;
        max-width: 36px;
      }

      .quarter-header {
        padding: 8px;
      }

      .quarter-label {
        font-size: 8px;
        min-width: 16px;
        max-width: 20px;
      }

      .quarter-label:last-child {
        min-width: 28px;
        max-width: 36px;
      }

      .game-footer-info {
        padding: 10px 8px;
        gap: 6px;
      }

      .live-badge {
        font-size: 8px;
        padding: 3px 6px;
      }

      .game-situation {
        font-size: 9px;
        gap: 6px;
      }

      .quarter-clock {
        font-size: 9px;
      }

      .down-distance,
      .yard-line {
        font-size: 8px;
        padding: 2px 4px;
      }
    }

    @media (max-width: 400px) {
      /* Modal fixes for mobile */
      .modal-overlay {
        padding: 10px;
      }

      .game-detail-panel {
        margin: 20px auto;
        max-height: 95vh;
        width: calc(100% - 20px);
      }

      .detail-header {
        padding: 16px;
        flex-direction: column;
        gap: 12px;
      }

      .detail-matchup {
        flex-direction: row;
        gap: 8px;
        width: 100%;
        justify-content: space-between;
      }

      .detail-team {
        gap: 4px;
        flex: 1;
      }

      .detail-team-logo {
        width: 40px;
        height: 40px;
      }

      .detail-team-name {
        font-size: 11px;
        max-width: 100px;
      }

      .detail-team-score {
        font-size: 24px;
      }

      .detail-vs {
        font-size: 14px;
        align-self: center;
      }

      .close-detail-btn {
        width: 100%;
        padding: 10px;
      }

      /* Tabs container for mobile */
      .tabs {
        padding: 0 12px;
        gap: 4px;
      }

      .tab {
        padding: 10px 16px;
        font-size: 12px;
        min-width: auto;
      }

      .tab-content {
        padding: 16px;
      }

      /* Stats table responsive */
      .stats-table {
        font-size: 12px;
      }

      .stats-table th,
      .stats-table td {
        padding: 8px 4px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 24px;
      }
    }
  </style>
  <link rel="stylesheet" href="/styles/themes.css">
  <link rel="stylesheet" href="/styles/theme-overrides.css">
  <link rel="stylesheet" href="/styles/mobile-fullscreen.css">
  <script src="/scripts/theme-manager.js"></script>
  <link rel="stylesheet" href="/styles/responsive-grid.css?v=1761528533781">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  </head>
<body>
  <div class="header">
    <div class="header-content">
      <h1 style="display: flex; align-items: center; gap: 15px;">
        <img src="/assets/NCAA logo.png" alt="NCAA" style="height: 50px; width: auto; object-fit: contain;">
        NCAA College Football Live Games
        <span class="live-indicator">
          <span class="live-dot"></span>
          LIVE
        </span>
      </h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button class="sports-bar-btn" id="sports-bar-btn">
          üì∫ Sports Bar Mode
        </button>
        <button class="back-btn" onclick="window.location.href='/'">
          ‚Üê Back to Sports
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Live Games List -->
    <div class="live-games-panel">
      <div class="panel-header">
        <div>
          <span>üèà All Games</span>
          <div class="auto-refresh-info">
            <span>‚óè</span>
            <span>Auto-refreshing every 5 seconds</span>
          </div>
        </div>
        <button class="refresh-btn" onclick="manualRefresh()">
          <span>üîÑ</span>
          <span>Refresh Now</span>
        </button>
      </div>
      <div class="games-grid" id="games-list"></div>
    </div>
  </div>

  <script>
    let refreshInterval = null;
    let liveGames = [];
    let finalGames = [];
    let currentWeek = 1; // Will be fetched from server

    // Team data for logos
    const teams = [
      { name: "Arizona Cardinals", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/ARI" },
      { name: "Atlanta Falcons", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/ATL" },
      { name: "Baltimore Ravens", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/BAL" },
      { name: "Buffalo Bills", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/BUF" },
      { name: "Carolina Panthers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/CAR" },
      { name: "Chicago Bears", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/CHI" },
      { name: "Cincinnati Bengals", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/CIN" },
      { name: "Cleveland Browns", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/CLE" },
      { name: "Dallas Cowboys", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/DAL" },
      { name: "Denver Broncos", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/DEN" },
      { name: "Detroit Lions", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/DET" },
      { name: "Green Bay Packers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/GB" },
      { name: "Houston Texans", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/HOU" },
      { name: "Indianapolis Colts", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/IND" },
      { name: "Jacksonville Jaguars", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/JAX" },
      { name: "Kansas City Chiefs", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/KC" },
      { name: "Las Vegas Raiders", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/LV" },
      { name: "Los Angeles Chargers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/LAC" },
      { name: "Los Angeles Rams", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/LAR" },
      { name: "Miami Dolphins", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/MIA" },
      { name: "Minnesota Vikings", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/MIN" },
      { name: "New England Patriots", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/NE" },
      { name: "New Orleans Saints", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/NO" },
      { name: "New York Giants", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/NYG" },
      { name: "New York Jets", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/NYJ" },
      { name: "Philadelphia Eagles", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/PHI" },
      { name: "Pittsburgh Steelers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/PIT" },
      { name: "San Francisco 49ers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/SF" },
      { name: "Seattle Seahawks", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/SEA" },
      { name: "Tampa Bay Buccaneers", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/TB" },
      { name: "Tennessee Titans", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/TEN" },
      { name: "Washington Commanders", logo: "https://static.www.nfl.com/t_q-best/league/api/clubs/logos/WAS" }
    ];

    function getTeamLogo(teamName) {
      const team = teams.find(t => t.name === teamName);
      return team ? team.logo : '';
    }

    async function fetchLiveGames() {
      try {
        // Fetch current week from server if not already set
        if (currentWeek === 1) {
          try {
            const weekResponse = await fetch('/api/ncaa/current-week');
            const weekData = await weekResponse.json();
            currentWeek = weekData.week;
            console.log(`üìÖ Fetched current NFL week from server: Week ${currentWeek}`);
          } catch (error) {
            console.error('Error fetching current week, defaulting to 1:', error);
            currentWeek = 1;
          }
        }
        
        console.log(`üîç Fetching NFL games for Week ${currentWeek} and Week ${currentWeek + 1}...`);
        
        // Fetch BOTH current week AND next week to catch upcoming games within 36 hours
        const [currentWeekResponse, nextWeekResponse] = await Promise.all([
          fetch(`/api/ncaa/scoreboard?week=${currentWeek}`),
          fetch(`/api/ncaa/scoreboard?week=${currentWeek + 1}`)
        ]);
        
        if (!currentWeekResponse.ok && !nextWeekResponse.ok) {
          throw new Error(`Failed to fetch games from both weeks`);
        }
        
        // Combine games from both weeks
        const currentWeekData = currentWeekResponse.ok ? await currentWeekResponse.json() : { events: [] };
        const nextWeekData = nextWeekResponse.ok ? await nextWeekResponse.json() : { events: [] };
        
        const allEvents = [
          ...(currentWeekData.events || []),
          ...(nextWeekData.events || [])
        ];
        
        console.log('üìä ESPN API Response:', {
          currentWeekGames: currentWeekData.events?.length || 0,
          nextWeekGames: nextWeekData.events?.length || 0,
          totalEvents: allEvents.length
        });

        // Use the FULL events data from ESPN API (has period, clock, etc.)
        if (allEvents.length > 0) {
          const allGames = allEvents.map(event => {
            // Get competition data
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');
            
            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });

          // CATEGORIZE ALL GAMES
          // Separate games into live, upcoming, and final categories
          let liveGamesList = [];
          let upcomingGamesList = [];
          let finalGamesList = [];

          allGames.forEach(game => {
            const comp = game.competitions[0];
            const isCompleted = comp.status.type.completed;
            const statusState = comp.status.type.state;
            const statusName = comp.status.type.name || '';
            const isFinal = statusName.includes('Final') || statusState === 'post';
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');
            
            // Check if this game is completed and save it to database
            if (isFinal || isCompleted) {
              fetch('/api/final-games/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  sport: 'nfl',
                  gameId: game.id,
                  gameData: game,
                  week: currentWeek
                })
              }).catch(err => console.error('Error saving final game:', err));
            }
            
            // Game is live if status state is 'in' OR if not completed/final and has started playing (period > 0)
            const isLive = statusState === 'in' || (comp.status.period > 0 && !isCompleted && !isFinal);
            
            // Game is upcoming if it's scheduled (pre)
            const isUpcoming = statusState === 'pre';
            const gameTime = new Date(game.date);
            const now = new Date();
            const hoursUntilGame = (gameTime - now) / (1000 * 60 * 60);
            const isWithin36Hours = hoursUntilGame >= 0 && hoursUntilGame <= 36;
            
            // Categorize the game
            if (isLive) {
              liveGamesList.push(game);
            } else if (isUpcoming && isWithin36Hours) {
              upcomingGamesList.push(game);
            } else if (isFinal || isCompleted) {
              finalGamesList.push(game);
            }
          });

          // Combine all games in order: Live -> Upcoming -> Final
          liveGames = [...liveGamesList, ...upcomingGamesList, ...finalGamesList];

          console.log(`üèà Found ${allGames.length} total games:`);
          console.log(`  üî¥ ${liveGamesList.length} LIVE`);
          console.log(`  ‚è∞ ${upcomingGamesList.length} UPCOMING`);
          console.log(`  üèÅ ${finalGamesList.length} FINAL`);

        } else {
          liveGames = [];
        }

        // Store in window for Sports Bar Mode
        window.liveGamesData = liveGames;

        renderGamesList();

      } catch (error) {
        console.error('Error fetching games:', error);
        document.getElementById('games-list').innerHTML = `
          <div style="padding: 20px; text-align: center; color: #ef4444;">
            <div style="font-size: 32px; margin-bottom: 12px;">‚ö†Ô∏è</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Error Loading Games</div>
            <div style="font-size: 13px; color: #9ca3af; margin-top: 8px; max-width: 400px; margin-left: auto; margin-right: auto; line-height: 1.5;">
              ${error.message}
            </div>
            <button 
              onclick="fetchLiveGames()" 
              style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;"
              onmouseover="this.style.background='#2563eb'" 
              onmouseout="this.style.background='#3b82f6'">
              üîÑ Retry Now
            </button>
            <div style="font-size: 11px; color: #6b7280; margin-top: 12px;">
              The page will automatically retry in 30 seconds
            </div>
          </div>
        `;
      }
    }

    function renderGamesList() {
      const container = document.getElementById('games-list');

      if (liveGames.length === 0) {
        container.innerHTML = `
          <div class="no-games-message">
            <div class="icon">üèà</div>
            <h3>No Games Available</h3>
            <p>There are no games to display right now.<br>Check back later!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = '';

      liveGames.forEach((game, index) => {
        const comp = game.competitions[0];
        const home = comp.competitors.find(c => c.homeAway === 'home');
        const away = comp.competitors.find(c => c.homeAway === 'away');

        const homeScore = parseInt(home.score) || 0;
        const awayScore = parseInt(away.score) || 0;

        const statusType = comp.status.type.state;
        const statusName = comp.status.type.name;
        const isCompleted = comp.status.type.completed;

        // Enhanced live detection
        const isLive = statusType === 'in' ||
                       (comp.status.period && comp.status.period > 0 && !isCompleted) ||
                       statusName.toLowerCase().includes('progress') ||
                       statusName.toLowerCase().includes('halftime') ||
                       statusName.toLowerCase().includes('quarter');

        const isFinal = isCompleted || statusType === 'post';
        const isPregame = statusType === 'pre';

        // Get team standings
        const awayRecord = away.records?.[0]?.summary || '';
        const homeRecord = home.records?.[0]?.summary || '';

        // Get line scores (quarter by quarter)
        const awayLineScores = away.linescores || [];
        const homeLineScores = home.linescores || [];

        // Get current period and clock
        const quarter = comp.status.period || 1;
        const clock = comp.status.displayClock || '15:00';

        // Get last play for play-by-play
        const lastPlay = comp.situation?.lastPlay?.text || '';

        let statusText = '';
        if (isLive) {
          statusText = `${quarter === 1 ? '1st' : quarter === 2 ? '2nd' : quarter === 3 ? '3rd' : '4th'} - ${clock}`;
        } else if (isFinal) {
          statusText = 'Final';
        } else {
          const gameDate = new Date(game.date);
          const dateStr = gameDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
          const timeStr = gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
          statusText = `${dateStr} ‚Ä¢ ${timeStr}`;
        }

        // Determine number of pages
        // Upcoming: 1 page
        // Live: 2 pages (live score + quarter history)
        // Final: 1 page (final score with quarter history combined)
        const numPages = isLive ? 2 : 1;

        // Build the card HTML
        let cardHtml = `
          <div class="game-card" data-game-id="${game.id}">
            <div class="card-slider-container">
              <div class="card-pages" data-current-page="0">
        `;

        // PAGE 1
        if (isPregame) {
          // Upcoming Game - Page 1 Only
          cardHtml += `
            <div class="card-page">
              <div class="page-1-upcoming">
                <div style="text-align: center; color: #9ca3af; font-size: 11px; font-weight: 600; margin-bottom: 4px;">
                  ${statusText}
                </div>
                <div class="team-display">
                  <div class="team-block">
                    <img src="${away.team.logo}" alt="${away.team.displayName}" class="team-logo-large">
                    <div class="team-name-large">${away.team.shortDisplayName || away.team.displayName}</div>
                    <div class="team-standing">${awayRecord}</div>
                  </div>
                  <div class="vs-divider">VS</div>
                  <div class="team-block">
                    <img src="${home.team.logo}" alt="${home.team.displayName}" class="team-logo-large">
                    <div class="team-name-large">${home.team.shortDisplayName || home.team.displayName}</div>
                    <div class="team-standing">${homeRecord}</div>
                  </div>
                </div>
              </div>
            </div>
          `;
        } else if (isLive || isFinal) {
          // Get down, distance and ball position
          const downDistanceText = comp.situation?.downDistanceText || '';
          const ballPosition = comp.situation?.possessionText || '';

          // Get possession
          const possession = comp.situation?.possession || null;
          const awayHasPossession = possession === away.id;
          const homeHasPossession = possession === home.id;

          // Live or Final Game - Page 1
          cardHtml += `
            <div class="card-page">
              <div class="page-1-live">
                <div style="text-align: center; margin-bottom: 8px;">
                  <div style="display: inline-block; background: ${isLive ? '#ef4444' : '#6b7280'}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 9px; font-weight: 700; text-transform: uppercase;">
                    ${isLive ? '<span style="display: inline-block; width: 5px; height: 5px; background: white; border-radius: 50%; margin-right: 4px; animation: blink 1.5s infinite;"></span>LIVE' : 'FINAL'}
                  </div>
                  <div style="color: #9ca3af; font-size: 10px; margin-top: 3px; font-weight: 600;">
                    ${statusText}
                  </div>
                </div>

                <div class="live-score-header">
                  <div class="team-stack">
                    <div style="position: relative;">
                      <img src="${away.team.logo}" alt="${away.team.displayName}" class="live-team-logo">
                      ${isLive && awayHasPossession ? '<span class="possession-icon">üèà</span>' : ''}
                    </div>
                    <div class="live-team-name ${awayScore > homeScore ? 'winning' : ''}">${away.team.abbreviation}</div>
                    <div class="live-team-standing">${awayRecord}</div>
                  </div>
                  <div class="live-team-score ${awayScore > homeScore ? 'winning' : 'losing'}">${awayScore}</div>
                  <div class="vs-divider-live">VS</div>
                  <div class="live-team-score ${homeScore > awayScore ? 'winning' : 'losing'}">${homeScore}</div>
                  <div class="team-stack">
                    <div style="position: relative;">
                      <img src="${home.team.logo}" alt="${home.team.displayName}" class="live-team-logo">
                      ${isLive && homeHasPossession ? '<span class="possession-icon">üèà</span>' : ''}
                    </div>
                    <div class="live-team-name ${homeScore > awayScore ? 'winning' : ''}">${home.team.abbreviation}</div>
                    <div class="live-team-standing">${homeRecord}</div>
                  </div>
                </div>

                ${isLive && downDistanceText ? `
                  <div class="game-situation-info">
                    <span class="down-distance">${downDistanceText}</span>
                  </div>
                ` : ''}
                
                ${isFinal ? `
                  <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div class="scoring-history-title">Scoring by Quarter</div>
                    <div class="quarters-grid">
                      <div class="quarter-header-cell"></div>
                      <div class="quarter-header-cell">1</div>
                      <div class="quarter-header-cell">2</div>
                      <div class="quarter-header-cell">3</div>
                      <div class="quarter-header-cell">4</div>
                      <div class="quarter-header-cell">T</div>

                      <div class="team-label-cell">${away.team.abbreviation}</div>
                      <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                      <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                      <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                      <div class="score-cell ${awayLineScores[3] ? '' : 'empty'}">${awayLineScores[3]?.value || 0}</div>
                      <div class="score-cell total">${awayScore}</div>

                      <div class="team-label-cell">${home.team.abbreviation}</div>
                      <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                      <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                      <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                      <div class="score-cell ${homeLineScores[3] ? '' : 'empty'}">${homeLineScores[3]?.value || 0}</div>
                      <div class="score-cell total">${homeScore}</div>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          `;

          // PAGE 2 - Scoring History (ONLY FOR LIVE GAMES)
          if (isLive) {
            cardHtml += `
              <div class="card-page">
                <div class="page-2-content">
                  <div class="scoring-history-header">
                    <img src="${away.team.logo}" alt="${away.team.displayName}" class="scoring-team-logo">
                    <img src="${home.team.logo}" alt="${home.team.displayName}" class="scoring-team-logo">
                  </div>

                  <div class="scoring-history-title">Scoring by Quarter</div>

                  <div class="quarters-grid">
                    <div class="quarter-header-cell"></div>
                    <div class="quarter-header-cell">1</div>
                    <div class="quarter-header-cell">2</div>
                    <div class="quarter-header-cell">3</div>
                    <div class="quarter-header-cell">4</div>
                    <div class="quarter-header-cell">T</div>

                    <div class="team-label-cell">${away.team.abbreviation}</div>
                    <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[3] ? '' : 'empty'}">${awayLineScores[3]?.value || 0}</div>
                    <div class="score-cell total">${awayScore}</div>

                    <div class="team-label-cell">${home.team.abbreviation}</div>
                    <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[3] ? '' : 'empty'}">${homeLineScores[3]?.value || 0}</div>
                    <div class="score-cell total">${homeScore}</div>
                  </div>
                </div>
              </div>
            `;
          }
        }

        // Close pages container
        cardHtml += `
              </div>

              ${numPages > 1 ? `
                <div class="page-indicators">
                  <div class="page-dot active" data-page="0"></div>
                  <div class="page-dot" data-page="1"></div>
                </div>
              ` : ''}
            </div>
          </div>
        `;

        container.insertAdjacentHTML('beforeend', cardHtml);
      });

      // Add swipe and click handlers
      initializeCardSliders();
    }

    function initializeCardSliders() {
      const cards = document.querySelectorAll('.game-card');

      cards.forEach(card => {
        const pagesContainer = card.querySelector('.card-pages');
        const dots = card.querySelectorAll('.page-dot');

        if (!pagesContainer || dots.length === 0) return; // Skip cards with only 1 page

        let currentPage = 0;
        const maxPage = dots.length - 1;

        // Touch/swipe handling
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        const updatePage = (newPage) => {
          currentPage = Math.max(0, Math.min(newPage, maxPage));
          pagesContainer.style.transform = `translateX(-${currentPage * 100}%)`;
          pagesContainer.dataset.currentPage = currentPage;

          dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentPage);
          });
        };

        // Mouse/Touch events
        pagesContainer.addEventListener('mousedown', (e) => {
          startX = e.clientX;
          isDragging = true;
          pagesContainer.style.transition = 'none';
        });

        pagesContainer.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          isDragging = true;
          pagesContainer.style.transition = 'none';
        });

        pagesContainer.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          currentX = e.clientX;
          const diff = startX - currentX;
          const percentMoved = (diff / pagesContainer.offsetWidth) * 100;
          pagesContainer.style.transform = `translateX(calc(-${currentPage * 100}% + ${-percentMoved}%))`;
        });

        pagesContainer.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          currentX = e.touches[0].clientX;
          const diff = startX - currentX;
          const percentMoved = (diff / pagesContainer.offsetWidth) * 100;
          pagesContainer.style.transform = `translateX(calc(-${currentPage * 100}% + ${-percentMoved}%))`;
        });

        const endDrag = () => {
          if (!isDragging) return;
          isDragging = false;
          pagesContainer.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';

          const diff = startX - currentX;
          const threshold = 50; // pixels

          if (Math.abs(diff) > threshold) {
            if (diff > 0 && currentPage < maxPage) {
              updatePage(currentPage + 1);
            } else if (diff < 0 && currentPage > 0) {
              updatePage(currentPage - 1);
            } else {
              updatePage(currentPage);
            }
          } else {
            updatePage(currentPage);
          }

          currentX = 0;
          startX = 0;
        };

        pagesContainer.addEventListener('mouseup', endDrag);
        pagesContainer.addEventListener('mouseleave', endDrag);
        pagesContainer.addEventListener('touchend', endDrag);

        // Dot click handling
        dots.forEach((dot, index) => {
          dot.addEventListener('click', (e) => {
            e.stopPropagation();
            updatePage(index);
          });
        });
      });
    }

    async function loadWinProbability(gameId, awayTeam, homeTeam) {
      try {
        console.log('üìä Loading win probability for game:', gameId);
        // Use comprehensive game summary with win probability for every play
        const response = await fetch(`/api/ncaa/summary/${gameId}`);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch game summary: ${response.status}`);
        }

        const gameSummary = await response.json();
        console.log('üìä Game Summary data:', gameSummary);

        // Get win probability data
        const winProbData = gameSummary.winprobability;
        
        if (!winProbData || winProbData.length === 0) {
          document.getElementById('tab-probability').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Win probability data not yet available
            </div>
          `;
          return;
        }

        // Get latest probability
        const latestProb = winProbData[winProbData.length - 1];
        const awayProb = Math.round((1 - latestProb.homeWinPercentage) * 100);
        const homeProb = Math.round(latestProb.homeWinPercentage * 100);

        document.getElementById('tab-probability').innerHTML = `
          <div class="win-prob-container">
            <h3 style="margin-bottom: 12px; font-size: 16px;">Win Probability Chart</h3>
            <div class="prob-bar-container">
              <div class="prob-bar away" style="width: ${awayProb}%">${awayProb > 15 ? awayProb + '%' : ''}</div>
              <div class="prob-bar home" style="width: ${homeProb}%">${homeProb > 15 ? homeProb + '%' : ''}</div>
            </div>
            <div class="prob-legend">
              <span>${awayTeam}: ${awayProb}%</span>
              <span>${homeTeam}: ${homeProb}%</span>
            </div>
            
            <div style="margin-top: 30px;">
              <canvas id="winProbChart" width="600" height="300" style="max-width: 100%; background: #1a1f2e; border-radius: 8px; padding: 10px;"></canvas>
            </div>
          </div>
        `;
        
        // Draw win probability chart
        const canvas = document.getElementById('winProbChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Chart styling
        const padding = 40;
        const chartWidth = width - 2 * padding;
        const chartHeight = height - 2 * padding;
        
        // Draw grid lines
        ctx.strokeStyle = '#2a3142';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i++) {
          const y = padding + (chartHeight * i / 4);
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(padding + chartWidth, y);
          ctx.stroke();
        }
        
        // Draw 50% line
        ctx.strokeStyle = '#4a5568';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(padding, padding + chartHeight / 2);
        ctx.lineTo(padding + chartWidth, padding + chartHeight / 2);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Draw probability line
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        const step = chartWidth / (winProbData.length - 1);
        
        winProbData.forEach((point, index) => {
          const x = padding + (index * step);
          const y = padding + chartHeight - (point.homeWinPercentage * chartHeight);
          
          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });
        
        ctx.stroke();
        
        // Draw labels
        ctx.fillStyle = '#9ca3af';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('100%', padding - 5, padding + 5);
        ctx.fillText('50%', padding - 5, padding + chartHeight / 2 + 5);
        ctx.fillText('0%', padding - 5, padding + chartHeight + 5);
        
        ctx.textAlign = 'center';
        ctx.fillText('Game Progress ‚Üí', width / 2, height - 10);
        
        ctx.save();
        ctx.translate(15, height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText(`${homeTeam} Win %`, 0, 0);
        ctx.restore();
        
      } catch (error) {
        console.error('Error loading win probability:', error);
        document.getElementById('tab-probability').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load win probability: ${error.message}
          </div>
        `;
      }
    }

    async function loadGameStats(gameId, awayTeam, homeTeam) {
      try {
        console.log('üìä Loading game stats for:', gameId);
        
        // Fetch comprehensive game summary (includes leaders, team stats, everything)
        const summaryResponse = await fetch(`/api/ncaa/summary/${gameId}`);
        const gameSummary = await summaryResponse.json();
        
        console.log('NFL Game Summary:', gameSummary);

        // Build stats HTML starting with Team Statistics
        let statsHtml = '';
        
        // Add Team Statistics first
        if (gameSummary.boxscore?.teams && gameSummary.boxscore.teams.length >= 2) {
          const teams = gameSummary.boxscore.teams;
          const awayStats = teams.find(t => t.homeAway === 'away')?.statistics || [];
          const homeStats = teams.find(t => t.homeAway === 'home')?.statistics || [];

          // Check if we have any stats
          if (awayStats.length > 0 && homeStats.length > 0) {
            const keyStats = [
              'firstDowns', 'totalYards', 'netPassingYards', 'completionAttempts',
              'rushingYards', 'rushingAttempts', 'thirdDownEff', 'fourthDownEff',
              'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
            ];

            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="background: #242b3d; border-radius: 10px; padding: 20px; margin-bottom: 30px; overflow-x: auto;">
                <table class="stats-table" style="width: 100%;">
                  <thead>
                    <tr>
                      <th style="text-align: left; color: #3b82f6;">${awayTeam}</th>
                      <th style="color: #9ca3af; text-align: center;">STAT</th>
                      <th style="text-align: right; color: #10b981;">${homeTeam}</th>
                    </tr>
                  </thead>
                  <tbody>
            `;

            keyStats.forEach(statName => {
              const awayStat = awayStats.find(s => s.name === statName);
              const homeStat = homeStats.find(s => s.name === statName);

              if (awayStat && homeStat) {
                const awayVal = awayStat.displayValue;
                const homeVal = homeStat.displayValue;
                const label = awayStat.label;

                let awayStyle = '';
                let homeStyle = '';
                if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
                  if (awayStat.value > homeStat.value) {
                    awayStyle = 'font-weight: 700; color: #3b82f6;';
                  } else if (homeStat.value > awayStat.value) {
                    homeStyle = 'font-weight: 700; color: #10b981;';
                  }
                }

                statsHtml += `
                  <tr>
                    <td style="text-align: left; padding: 8px; ${awayStyle}">${awayVal}</td>
                    <td style="color: #9ca3af; font-size: 12px; text-align: center; padding: 8px;">${label}</td>
                    <td style="text-align: right; padding: 8px; ${homeStyle}">${homeVal}</td>
                  </tr>
                `;
              }
            });

            statsHtml += `
                  </tbody>
                </table>
              </div>
            `;
          } else {
            // No team stats available yet
            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
                <div style="font-size: 36px; margin-bottom: 12px;">üìä</div>
                <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
              </div>
            `;
          }
        } else {
          // No boxscore data available
          statsHtml += `
            <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
            <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
              <div style="font-size: 36px; margin-bottom: 12px;">üìä</div>
              <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
            </div>
          `;
        }
        
        // Add Player Leaders section from game summary
        statsHtml += `<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Player Leaders</h3>`;

        // Use leaders from game summary (gameSummary.leaders)
        // The structure is: [ { team: {...}, leaders: [...] }, { team: {...}, leaders: [...] } ]
        const leadersData = gameSummary.leaders || [];
        
        console.log('üèà Player Leaders RAW data:', JSON.stringify(leadersData, null, 2));
        console.log('üèà Leaders array length:', leadersData.length);
        console.log('üèà Full game summary keys:', Object.keys(gameSummary));

        // Check if we have leaders data and it's not empty
        let hasValidLeaders = false;
        
        if (leadersData && leadersData.length > 0) {
          // Each entry in leadersData is a team with their leaders
          leadersData.forEach((teamData, teamIdx) => {
            const team = teamData.team || {};
            const teamName = team.displayName || team.abbreviation || 'Team';
            const teamColor = team.color || '3b82f6';
            const teamLeaders = teamData.leaders || [];
            
            console.log(`Team ${teamIdx}: ${teamName}, Categories: ${teamLeaders.length}`);
            
            if (teamLeaders.length > 0) {
              // Add team header
              statsHtml += `
                <div style="background: #1a1f2e; padding: 12px 20px; border-radius: 10px 10px 0 0; margin-top: ${teamIdx > 0 ? '20px' : '0'};">
                  <h3 style="font-size: 16px; font-weight: 700; color: #e0e0e0; margin: 0;">${teamName}</h3>
                </div>
              `;
              
              // Process each category (passing, rushing, receiving, etc.)
              teamLeaders.forEach((category, catIdx) => {
                const categoryName = category.displayName || category.name || 'Statistics';
                const leaders = category.leaders || [];
                
                console.log(`  Category: ${categoryName}, Leaders: ${leaders.length}`);

                if (leaders.length > 0) {
                  hasValidLeaders = true;
                  
                  statsHtml += `
                    <div style="background: #242b3d; border-radius: ${catIdx === 0 ? '0' : '0'} ${catIdx === teamLeaders.length - 1 ? '0 0 10px 10px' : '0'}; padding: 16px 20px; ${catIdx < teamLeaders.length - 1 ? 'border-bottom: 1px solid #1a1f2e;' : ''}">
                      <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #9ca3af; text-transform: uppercase;">${categoryName}</h4>
                  `;

                  leaders.forEach((leader, leaderIdx) => {
                    console.log(`    Leader ${leaderIdx}:`, leader);
                    
                    // Extract athlete data
                    const athlete = leader.athlete || {};
                    const athleteName = athlete.displayName || athlete.fullName || athlete.shortName || 'Unknown Player';
                    const position = athlete.position?.abbreviation || '';
                    const displayValue = leader.displayValue || leader.value || 'N/A';
                    const headshot = athlete.headshot?.href || '';

                    console.log(`      Athlete: ${athleteName}, Position: ${position}, Value: ${displayValue}`);

                    // Only add if we have a valid athlete name
                    if (athleteName && athleteName !== 'Unknown Player') {
                      statsHtml += `
                        <div style="display: flex; align-items: center; padding: 10px; background: #1a1f2e; border-radius: 8px; margin-top: ${leaderIdx > 0 ? '8px' : '0'};">
                          ${headshot ? `
                            <img src="${headshot}" alt="${athleteName}" 
                                 style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px;" 
                                 onerror="this.style.display='none'" />
                          ` : `
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #2d3548; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 14px; font-weight: 600; color: #6b7280;">${athleteName.charAt(0)}</div>
                          `}
                          <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; color: #e0e0e0;">${athleteName}</div>
                            <div style="font-size: 11px; color: #9ca3af;">${position}</div>
                          </div>
                          <div style="font-size: 16px; font-weight: 700; color: #10b981;">${displayValue}</div>
                        </div>
                      `;
                    }
                  });

                  statsHtml += `</div>`;
                }
              });
            }
          });
        }
        
        if (!hasValidLeaders) {
          console.log('‚ö†Ô∏è No valid leaders data available');
          statsHtml += `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
              <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Player Statistics Loading...</div>
              <div style="font-size: 14px; color: #6b7280;">Player statistics will appear as the game progresses. Please refresh to see updated stats.</div>
            </div>
          `;
        }

        document.getElementById('tab-stats').innerHTML = statsHtml;
      } catch (error) {
        console.error('Error loading game stats:', error);
        document.getElementById('tab-stats').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Statistics Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game statistics are not available at the moment.</div>
          </div>
        `;
      }
    }

    let playsRefreshInterval = null;
    let currentGameId = null;
    let isLiveGame = false;
    let autoPlayMode = true;

    async function loadPlays(gameId) {
      try {
        currentGameId = gameId;
        const response = await fetch(`/api/ncaa/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch plays');

        const data = await response.json();
        console.log('üìä Plays API response:', data);
        
        // Handle different API response structures
        let plays = [];
        if (data.items && Array.isArray(data.items)) {
          // RapidAPI structure: { items: [...] }
          plays = data.items;
        } else if (data.drives?.previous) {
          // ESPN structure: { drives: { previous: [{ plays: [...] }] } }
          const drives = data.drives.previous || [];
          plays = drives.flatMap(drive => drive.plays || []);
        } else if (Array.isArray(data)) {
          // Direct array of plays
          plays = data;
        }

        if (plays.length === 0) {
          document.getElementById('tab-plays').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              No play-by-play data available yet
            </div>
          `;
          return;
        }

        // Get recent plays (last 30) and REVERSE so latest appears first
        const recentPlays = plays.slice(-30).reverse();

        // Check if this is first load or update
        const isInitialLoad = !window.currentPlays;
        const previousPlayCount = window.currentPlays?.length || 0;
        const newPlayDetected = recentPlays.length > previousPlayCount;

        // Store plays data for animation
        window.currentPlays = recentPlays;

        // Only rebuild HTML on initial load
        if (isInitialLoad) {
          document.getElementById('tab-plays').innerHTML = `
            <div class="field-tracker-container">
              ${isLiveGame ? `
                <div class="live-update-indicator" id="liveIndicator">
                  <span class="live-dot"></span>
                  <span>Live Updates Active</span>
                  <button class="auto-play-toggle" id="autoPlayToggle" onclick="toggleAutoPlay()">
                    Auto-Play: ON
                  </button>
                </div>
              ` : ''}
            </div>
            <div class="plays-list" id="playsList">
            </div>
          `;

          window.currentPlayIndex = 0;
        }

        // Update plays list
        updatePlaysList(recentPlays);

        // ALWAYS show the latest play (first in reversed array) on the field
        if (recentPlays.length > 0) {
          window.currentPlayIndex = 0; // Index 0 is now the latest play (after reverse)
          selectPlay(0, false); // false = don't scroll list
        }

        // Start live refresh if game is live
        if (isLiveGame && !playsRefreshInterval) {
          startLivePlayUpdates();
        }
      } catch (error) {
        console.error('Error loading plays:', error);
        document.getElementById('tab-plays').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load play-by-play data
          </div>
        `;
      }
    }

    function updatePlaysList(plays) {
      const playsList = document.getElementById('playsList');
      if (!playsList) return;

      playsList.innerHTML = plays.map((play, idx) => `
        <div class="play-item ${play.scoringPlay ? 'scoring' : ''}" onclick="selectPlay(${idx}, true)" id="play-${idx}">
          <div class="play-header">
            <span>Q${play.period?.number || '?'} - ${play.clock?.displayValue || ''}</span>
            <span>${play.start?.down ? play.start.down + ' & ' + play.start.distance : ''}</span>
          </div>
          <div class="play-text">${play.text || 'No description'}</div>
          ${idx === 0 ? '<div class="latest-play-badge">LATEST</div>' : ''}
        </div>
      `).join('');

      // Remove play counter update since we removed the counter element
    }

    function startLivePlayUpdates() {
      if (playsRefreshInterval) return;

      // Refresh plays every 10 seconds during live games
      playsRefreshInterval = setInterval(() => {
        if (currentGameId && isLiveGame) {
          loadPlays(currentGameId);
        }
      }, 10000); // 10 seconds
    }

    function stopLivePlayUpdates() {
      if (playsRefreshInterval) {
        clearInterval(playsRefreshInterval);
        playsRefreshInterval = null;
      }
      window.currentPlays = null;
      window.currentPlayIndex = 0;
    }

    function toggleAutoPlay() {
      autoPlayMode = !autoPlayMode;
      const toggle = document.getElementById('autoPlayToggle');
      if (toggle) {
        toggle.textContent = `Auto-Play: ${autoPlayMode ? 'ON' : 'OFF'}`;
        toggle.style.background = autoPlayMode ? '#10b981' : '#6b7280';
      }
    }

    function selectPlay(index, shouldScroll = true) {
      if (!window.currentPlays || index < 0 || index >= window.currentPlays.length) return;

      window.currentPlayIndex = index;
      const play = window.currentPlays[index];

      // Save current scroll position
      const savedScrollTop = window.pageYOffset || document.documentElement.scrollTop;

      // Highlight selected play in list
      document.querySelectorAll('.play-item').forEach((el, i) => {
        el.style.background = i === index ? 'rgba(59, 130, 246, 0.2)' : '';
        el.style.borderLeft = i === index ? '3px solid #3b82f6' : '';
      });

      // Restore scroll position to prevent unwanted jumping
      window.scrollTo(0, savedScrollTop);

      // Scroll to play in list if requested (only scrolls the play list, not the page)
      if (shouldScroll) {
        const playElement = document.getElementById(`play-${index}`);
        if (playElement) {
          playElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    }

    async function loadBoxScore(gameId, awayTeam, homeTeam) {
      try {
        const response = await fetch(`/api/ncaa/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch box score');

        const data = await response.json();
        const teams = data.boxscore?.teams || [];

        if (teams.length < 2) {
          document.getElementById('tab-boxscore').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Box score data not yet available
            </div>
          `;
          return;
        }

        // Teams are usually [away, home]
        const awayStats = teams[0].statistics;
        const homeStats = teams[1].statistics;

        // Key stats to display
        const keyStats = [
          'firstDowns', 'totalYards', 'netPassingYards', 'completionAttempts',
          'rushingYards', 'rushingAttempts', 'thirdDownEff', 'fourthDownEff',
          'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
        ];

        // Build comparison table
        let statsHtml = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
          <div style="background: #242b3d; border-radius: 10px; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #1a1f2e;">
                  <th style="padding: 12px; text-align: left; font-size: 14px; font-weight: 600; color: #3b82f6;">${awayTeam}</th>
                  <th style="padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #9ca3af;">STAT</th>
                  <th style="padding: 12px; text-align: right; font-size: 14px; font-weight: 600; color: #10b981;">${homeTeam}</th>
                </tr>
              </thead>
              <tbody>
        `;

        keyStats.forEach(statName => {
          const awayStat = awayStats.find(s => s.name === statName);
          const homeStat = homeStats.find(s => s.name === statName);

          if (awayStat && homeStat) {
            const awayVal = awayStat.displayValue;
            const homeVal = homeStat.displayValue;
            const label = awayStat.label;

            // Determine which value is "winning" for highlighting
            let awayStyle = '';
            let homeStyle = '';
            if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
              if (awayStat.value > homeStat.value) {
                awayStyle = 'font-weight: 700; color: #3b82f6;';
              } else if (homeStat.value > awayStat.value) {
                homeStyle = 'font-weight: 700; color: #10b981;';
              }
            }

            statsHtml += `
              <tr style="border-bottom: 1px solid #1a1f2e;">
                <td style="padding: 12px; ${awayStyle}">${awayVal}</td>
                <td style="padding: 12px; text-align: center; font-size: 12px; color: #9ca3af;">${label}</td>
                <td style="padding: 12px; text-align: right; ${homeStyle}">${homeVal}</td>
              </tr>
            `;
          }
        });

        statsHtml += `
              </tbody>
            </table>
          </div>
        `;

        // Add player stats if available
        if (data.boxscore.players && data.boxscore.players.length > 0) {
          statsHtml += `<h3 style="margin: 24px 0 16px; font-size: 18px; font-weight: 700;">Top Performers</h3>`;

          data.boxscore.players.slice(0, 2).forEach((teamData, idx) => {
            const teamName = idx === 0 ? awayTeam : homeTeam;
            const teamColor = idx === 0 ? '#3b82f6' : '#10b981';

            statsHtml += `
              <div style="background: #242b3d; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
                <h4 style="margin-bottom: 12px; color: ${teamColor}; font-size: 16px;">${teamName}</h4>
            `;

            // Passing
            const passing = teamData.statistics.find(cat => cat.name === 'passing');
            if (passing && passing.athletes.length > 0) {
              const qb = passing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Passing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${qb.athlete.displayName}: ${qb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Rushing
            const rushing = teamData.statistics.find(cat => cat.name === 'rushing');
            if (rushing && rushing.athletes.length > 0) {
              const rb = rushing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Rushing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${rb.athlete.displayName}: ${rb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Receiving
            const receiving = teamData.statistics.find(cat => cat.name === 'receiving');
            if (receiving && receiving.athletes.length > 0) {
              const wr = receiving.athletes[0];
              statsHtml += `
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px;">Receiving</div>
                  <div style="color: #9ca3af; font-size: 14px;">${wr.athlete.displayName}: ${wr.stats.join(', ')}</div>
                </div>
              `;
            }

            statsHtml += `</div>`;
          });
        }

        document.getElementById('tab-boxscore').innerHTML = statsHtml;

      } catch (error) {
        console.error('Error loading box score:', error);
        document.getElementById('tab-boxscore').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load box score data
          </div>
        `;
      }
    }

    async function loadPredictions(gameId, awayTeam, homeTeam) {
      try {
        console.log('üìä Loading predictions for game:', gameId, 'Home:', homeTeam, 'Away:', awayTeam);
        
        // Fetch predictor data from ESPN API
        const response = await fetch(`/api/ncaa/summary/${gameId}`);
        
        if (!response.ok) {
          throw new Error('Predictor data not available');
        }

        const data = await response.json();
        console.log('NFL Predictor response received');

        // Helper function to extract stat values from statistics array
        const getStat = (team, statName) => {
          if (!team || !team.statistics) return null;
          const stat = team.statistics.find(s => s.name === statName);
          return stat ? stat.displayValue : null;
        };

        // Extract prediction information from statistics arrays
        const homeWinProb = getStat(data.homeTeam, 'gameProjection') || 'N/A';
        const awayWinProb = getStat(data.awayTeam, 'gameProjection') || 'N/A';
        const homePointDiff = getStat(data.homeTeam, 'teamPredPtDiff') || 'N/A';
        const awayPointDiff = getStat(data.awayTeam, 'teamPredPtDiff') || 'N/A';
        const matchupQuality = getStat(data.homeTeam, 'matchupQuality') || getStat(data.awayTeam, 'matchupQuality') || 'N/A';
        
        // Additional stats
        const homeChanceLoss = getStat(data.homeTeam, 'teamChanceLoss') || 'N/A';
        const awayChanceLoss = getStat(data.awayTeam, 'teamChanceLoss') || 'N/A';
        const homeOppStrength = getStat(data.homeTeam, 'oppSeasonStrengthRating') || 'N/A';
        const awayOppStrength = getStat(data.awayTeam, 'oppSeasonStrengthRating') || 'N/A';

        document.getElementById('tab-predictions').innerHTML = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Game Predictions</h3>
          <div class="prediction-grid">
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Win Probability</div>
              <div class="stat-value" style="color: #10b981;">${homeWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Win Probability</div>
              <div class="stat-value" style="color: #3b82f6;">${awayWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Point Differential</div>
              <div class="stat-value" style="color: #f59e0b;">${homePointDiff}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Point Differential</div>
              <div class="stat-value" style="color: #8b5cf6;">${awayPointDiff}</div>
            </div>
          </div>
          <div style="margin-top: 24px; padding: 16px; background: #242b3d; border-radius: 10px;">
            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #9ca3af;">Additional Statistics</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${awayTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">
                  ${awayOppStrength}
                </div>
              </div>
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${homeTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #10b981;">
                  ${homeOppStrength}
                </div>
              </div>
            </div>
          </div>
          ${matchupQuality !== 'N/A' ? `
            <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 4px;">
              <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Matchup Quality (0-100 scale)</div>
              <div style="font-size: 16px; font-weight: 600; color: #60a5fa;">${matchupQuality}/100</div>
            </div>
          ` : ''}
        `;
      } catch (error) {
        console.error('Error loading predictions:', error);
        document.getElementById('tab-predictions').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">ÔøΩ</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Predictions Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game prediction data is not available for this game at the moment.</div>
          </div>
        `;
      }
    }

    function refreshLiveGames() {
      fetchLiveGames();
    }

    function manualRefresh() {
      console.log('üîÑ Manual refresh triggered');
      fetchLiveGames();
      
      // Visual feedback
      const btn = event.target.closest('.refresh-btn');
      const originalBg = btn.style.background;
      btn.style.background = '#059669';
      btn.style.transform = 'rotate(360deg)';
      btn.style.transition = 'transform 0.5s ease';
      
      setTimeout(() => {
        btn.style.background = originalBg;
        btn.style.transform = 'rotate(0deg)';
      }, 500);
    }

    // Initialize
    fetchLiveGames();

    // Auto-refresh every 5 seconds for live updates
    refreshInterval = setInterval(() => {
      console.log('üîÑ Auto-refreshing games...');
      fetchLiveGames();
    }, 5000);

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
    });
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
    });
  </script>

  <!-- Game Selection Modal -->
  <div id="game-selection-modal" class="modal">
    <div class="modal-content">
      <h2>üì∫ Sports Bar Mode - Select Grid Layout</h2>
      
      <!-- Layout Selection -->
      <div class="layout-options">
        <label>
          <input type="radio" name="layout" value="1"> 1 Game
        </label>
        <label>
          <input type="radio" name="layout" value="2"> 2 Games
        </label>
        <label>
          <input type="radio" name="layout" value="3"> 3 Games
        </label>
        <label>
          <input type="radio" name="layout" value="4" checked> 4 Games
        </label>
        <label>
          <input type="radio" name="layout" value="6"> 6 Games
        </label>
      </div>

      <p style="text-align: center; color: #94a3b8; margin: 20px 0;">
        Select your grid layout, then choose games for each position
      </p>
      
      <!-- Grid Preview with Game Selectors -->
      <div id="grid-preview" class="grid-preview">
        <!-- Dynamically populated with grid slots -->
      </div>
      
      <div class="modal-buttons">
        <button id="enter-fullscreen">Enter Sports Bar Mode</button>
        <button id="cancel-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Full Screen Container -->
  <div id="fullscreen-container" class="fullscreen-container">
    <!-- Hover trigger zone at top -->
    <div class="fullscreen-hover-trigger"></div>
    
    <div class="fullscreen-controls" id="fullscreen-controls">
      <div style="display: flex; gap: 10px;">
        <button id="change-layout-fs">Change Layout</button>
        <button id="cast-btn" class="cast-btn">
          <span class="cast-icon">üì∫</span> Cast to TV
        </button>
      </div>
      <button id="exit-fullscreen">Exit Sports Bar Mode</button>
    </div>
    <div id="fullscreen-grid" class="fullscreen-grid grid-4">
      <!-- Dynamically populated game cards -->
    </div>
  </div>

  <script>
    // ============================================
    // SPORTS BAR MODE - FULL SCREEN FUNCTIONALITY
    // ============================================

    let gridGames = {}; // { 0: gameId, 1: gameId, ... } - Maps slot index to game ID
    let presentationRequest = null;
    let presentationConnection = null;
    let currentLayout = 4;
    let fullscreenRefreshInterval = null;
    let dynamicStyles = null; // Store dynamic style element

    // ============================================
    // DYNAMIC RESPONSIVE SCALING SYSTEM
    // ============================================
    
    /**
     * Calculate optimal card dimensions and font sizes based on:
     * - Screen resolution (viewport width/height)
     * - Grid layout (1, 2, 4, or 6 games)
     * - Available space per card
     * - Content density requirements
     */
    function calculateDynamicScaling() {
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const layout = currentLayout;
      
      console.log('üé® Dynamic Scaling Calculation:', {
        viewport: `${vw}x${vh}`,
        layout: `grid-${layout}`,
        aspectRatio: (vw / vh).toFixed(2)
      });

      // Calculate available space per card
      const controlsHeight = 80; // Top controls bar
      const availableHeight = vh - controlsHeight;
      const availableWidth = vw;

      // Grid configurations
      let cols, rows, padding, gap;
      
      switch(layout) {
        case 1:
          cols = 1; rows = 1;
          padding = Math.min(40, vh * 0.03);
          gap = 0;
          break;
        case 2:
          cols = 2; rows = 1;
          padding = Math.min(25, vh * 0.025);
          gap = Math.min(20, vw * 0.015);
          break;
        case 4:
          cols = 2; rows = 2;
          padding = Math.min(20, vh * 0.02);
          gap = Math.min(15, vh * 0.012);
          break;
        case 6:
          cols = 3; rows = 2;
          padding = Math.min(15, vh * 0.015);
          gap = Math.min(12, vh * 0.01);
          break;
        default:
          cols = 2; rows = 2;
          padding = 20;
          gap = 15;
      }

      // Calculate card dimensions
      const cardWidth = (availableWidth - (padding * 2) - (gap * (cols - 1))) / cols;
      const cardHeight = (availableHeight - (padding * 2) - (gap * (rows - 1))) / rows;
      
      console.log('üìê Card Dimensions:', {
        cardWidth: cardWidth.toFixed(0),
        cardHeight: cardHeight.toFixed(0),
        padding,
        gap
      });

      // Calculate optimal font sizes based on card height
      // Use card height as the primary scaling factor
      const baseScale = cardHeight / 500; // 500px is reference height
      const heightScale = Math.max(0.4, Math.min(1.5, baseScale)); // Limit scale range
      
      // Calculate element sizes based on available card space
      const sizes = {
        // Quarter/Status text
        quarterFontSize: Math.max(12, Math.min(28, cardHeight * 0.038)),
        quarterMargin: Math.max(6, Math.min(20, cardHeight * 0.025)),
        
        // Clock text
        clockFontSize: Math.max(14, Math.min(32, cardHeight * 0.048)),
        
        // Game status container
        statusMargin: Math.max(8, Math.min(20, cardHeight * 0.028)),
        statusGap: Math.max(4, Math.min(8, cardHeight * 0.012)),
        
        // Team logo
        logoSize: Math.max(35, Math.min(90, cardHeight * 0.15)),
        
        // Team name
        teamNameFontSize: Math.max(14, Math.min(56, cardHeight * 0.075)),
        
        // Score
        scoreFontSize: Math.max(24, Math.min(96, cardHeight * 0.14)),
        scoreMinWidth: Math.max(50, Math.min(150, cardWidth * 0.15)),
        
        // Team record
        recordFontSize: Math.max(10, Math.min(18, cardHeight * 0.022)),
        
        // VS text
        vsFontSize: Math.max(12, Math.min(32, cardHeight * 0.04)),
        vsMargin: Math.max(3, Math.min(12, cardHeight * 0.015)),
        
        // Team spacing
        teamMargin: Math.max(6, Math.min(20, cardHeight * 0.025)),
        teamGap: Math.max(8, Math.min(25, cardWidth * 0.025)),
        teamInfoGap: Math.max(6, Math.min(15, cardWidth * 0.015)),
        
        // Down/Distance
        downDistanceFontSize: Math.max(12, Math.min(32, cardHeight * 0.042)),
        downDistanceMargin: Math.max(8, Math.min(15, cardHeight * 0.022)),
        downDistanceGap: Math.max(4, Math.min(8, cardHeight * 0.012)),
        fieldPositionFontSize: Math.max(10, Math.min(20, cardHeight * 0.028)),
        
        // Sport logo indicator
        sportLogoSize: Math.max(40, Math.min(120, cardHeight * 0.18)),
        sportLogoTop: Math.max(8, Math.min(15, cardHeight * 0.025)),
        sportLogoLeft: Math.max(8, Math.min(15, cardWidth * 0.015)),
        
        // Card padding and border
        cardPadding: Math.max(10, Math.min(30, cardHeight * 0.04)),
        cardBorderRadius: Math.max(6, Math.min(16, cardHeight * 0.025)),
        cardBorderWidth: cardHeight < 300 ? 2 : 3,
        
        // Timeouts
        timeoutWidth: Math.max(12, Math.min(24, cardWidth * 0.025)),
        timeoutHeight: Math.max(4, Math.min(8, cardHeight * 0.012)),
        timeoutGap: Math.max(3, Math.min(6, cardWidth * 0.006)),
        timeoutMargin: Math.max(3, Math.min(8, cardHeight * 0.012)),
        
        // Possession indicator
        possessionSize: Math.max(16, Math.min(30, cardHeight * 0.05)),
        
        // Field visualizer
        fieldVisualizerHeight: Math.max(30, Math.min(50, cardHeight * 0.08)),
        fieldVisualizerMargin: Math.max(8, Math.min(15, cardHeight * 0.022)),
        yardLabelFontSize: Math.max(8, Math.min(12, cardHeight * 0.018)),
        endzoneLabelFontSize: Math.max(6, Math.min(10, cardHeight * 0.015)),
        ballIndicatorSize: Math.max(12, Math.min(20, cardHeight * 0.032)),
        possessionLabelFontSize: Math.max(9, Math.min(14, cardHeight * 0.02))
      };

      console.log('üìä Calculated Sizes:', {
        teamName: sizes.teamNameFontSize.toFixed(1) + 'px',
        score: sizes.scoreFontSize.toFixed(1) + 'px',
        logo: sizes.logoSize.toFixed(1) + 'px',
        cardPadding: sizes.cardPadding.toFixed(1) + 'px',
        cardDimensions: `${cardWidth.toFixed(0)}x${cardHeight.toFixed(0)}`,
        fieldVisualizerHeight: sizes.fieldVisualizerHeight.toFixed(1) + 'px'
      });

      return { sizes, padding, gap };
    }

    /**
     * Apply dynamic styles to the fullscreen grid
     * Scales elements based on actual card size, not viewport
     */
    function applyDynamicScaling() {
      console.log('‚úÖ Dynamic scaling ENABLED - scaling based on card size');
      console.log('üìê Viewport:', `${window.innerWidth}x${window.innerHeight}`);
      console.log('üéÆ Layout:', `grid-${currentLayout}`);

      const { sizes, padding, gap } = calculateDynamicScaling();
      const layout = currentLayout;
      
      // Remove existing dynamic styles
      if (dynamicStyles) {
        dynamicStyles.remove();
      }
      
      // Create new style element
      dynamicStyles = document.createElement('style');
      dynamicStyles.id = 'dynamic-fullscreen-styles';
      dynamicStyles.textContent = `
        /* Dynamic Responsive Scaling - Generated based on ${window.innerWidth}x${window.innerHeight} for grid-${layout} */
        
        .fullscreen-grid.grid-${layout} {
          padding: ${padding}px !important;
          gap: ${gap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-game-card {
          padding: ${sizes.cardPadding}px !important;
          border-radius: ${sizes.cardBorderRadius}px !important;
          border-width: ${sizes.cardBorderWidth}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-status-container {
          margin-bottom: ${sizes.statusMargin}px !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-card-content {
          gap: ${sizes.statusGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-quarter-clock {
          gap: ${sizes.statusGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-status-text,
        .fullscreen-grid.grid-${layout} .fullscreen-upcoming-status-text {
          font-size: ${sizes.quarterFontSize}px !important;
          line-height: 1.1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-clock {
          font-size: ${sizes.clockFontSize}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-quarter {
          font-size: ${sizes.quarterFontSize}px !important;
          margin-bottom: ${sizes.quarterMargin}px !important;
          line-height: 1.2 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-logo {
          width: ${sizes.logoSize}px !important;
          height: ${sizes.logoSize}px !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-live-team-name {
          font-size: ${sizes.teamNameFontSize}px !important;
          line-height: 1.1 !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-team-score {
          font-size: ${sizes.scoreFontSize}px !important;
          min-width: ${sizes.scoreMinWidth}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-record {
          font-size: ${sizes.recordFontSize}px !important;
          line-height: 1.2 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-vs-divider-live {
          font-size: ${sizes.vsFontSize}px !important;
          margin: ${sizes.vsMargin}px 0 !important;
          line-height: 1 !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-live-score-header {
          gap: ${sizes.teamGap}px !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-team-stack {
          gap: ${sizes.teamInfoGap}px !important;
        }

        .fullscreen-grid.grid-${layout} .fullscreen-situation-info {
          font-size: ${sizes.downDistanceFontSize}px !important;
          line-height: 1.1 !important;
          margin-top: ${sizes.downDistanceMargin}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-field-position {
          font-size: ${sizes.fieldPositionFontSize}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .sport-logo-indicator {
          width: ${sizes.sportLogoSize}px !important;
          height: ${sizes.sportLogoSize}px !important;
          top: ${sizes.sportLogoTop}px !important;
          left: ${sizes.sportLogoLeft}px !important;
        }
        
        /* Timeouts removed from new layout */
        
        .fullscreen-grid.grid-${layout} .fullscreen-possession {
          font-size: ${sizes.possessionSize}px !important;
          margin-left: ${Math.max(4, sizes.possessionSize * 0.3)}px !important;
        }
        
        /* Field visualizer responsive sizing */
        .fullscreen-grid.grid-${layout} .field-visualizer {
          margin-top: ${sizes.fieldVisualizerMargin}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .field-container {
          height: ${sizes.fieldVisualizerHeight}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .yard-label {
          font-size: ${sizes.yardLabelFontSize}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .endzone-label {
          font-size: ${sizes.endzoneLabelFontSize}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .ball-indicator::before {
          font-size: ${sizes.ballIndicatorSize}px !important;
        }

        /* Ensure cards fit perfectly in grid */
        .fullscreen-grid.grid-${layout} .fullscreen-game-card {
          overflow: hidden !important;
        }
      `;
      
      document.head.appendChild(dynamicStyles);

      console.log('‚úÖ Dynamic styles applied for grid-' + layout);
      console.log('üîç Applied CSS includes:');
      console.log(`  - Team Name: ${sizes.teamNameFontSize.toFixed(1)}px`);
      console.log(`  - Score: ${sizes.scoreFontSize.toFixed(1)}px`);
      console.log(`  - Logo: ${sizes.logoSize.toFixed(1)}px`);
      console.log(`  - Card Padding: ${sizes.cardPadding.toFixed(1)}px`);
      console.log(`  - Field Height: ${sizes.fieldVisualizerHeight.toFixed(1)}px`);

      // Log first card measurements after a brief delay to allow styles to apply
      setTimeout(() => {
        const firstCard = document.querySelector('.fullscreen-game-card');
        if (firstCard) {
          const cardRect = firstCard.getBoundingClientRect();
          const logo = firstCard.querySelector('.fullscreen-team-logo');
          const logoRect = logo ? logo.getBoundingClientRect() : null;
          const field = firstCard.querySelector('.field-container');
          const fieldRect = field ? field.getBoundingClientRect() : null;

          console.log('üìä First Card Measurements:');
          console.log(`  Card Size: ${Math.round(cardRect.width)}x${Math.round(cardRect.height)}px`);
          if (logoRect) {
            console.log(`  Logo Size: ${Math.round(logoRect.width)}px x ${Math.round(logoRect.height)}px`);
          }
          if (fieldRect) {
            console.log(`  Field Height: ${fieldRect.height.toFixed(2)}px`);
          }
        }
      }, 100);
    }

    /**
     * Handle window resize - recalculate and apply scaling
     */
    let resizeTimeout;
    function handleFullscreenResize() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const container = document.getElementById('fullscreen-container');
        if (container && container.classList.contains('active')) {
          console.log('üîÑ Window resized - recalculating scaling...');
          applyDynamicScaling();
        }
      }, 250); // Debounce resize events
    }

    // Listen for window resize
    window.addEventListener('resize', handleFullscreenResize);

    // Open game selection modal
    function openGameSelectionModal() {
      const modal = document.getElementById('game-selection-modal');
      modal.classList.add('show');

      // Auto-select 4-grid layout
      const fourGridRadio = document.querySelector('input[name="layout"][value="4"]');
      if (fourGridRadio) {
        fourGridRadio.checked = true;
      }

      // Reset game selections and render
      gridGames = {};
      renderGridPreview();

      // Auto-select first 4 games
      autoSelectFirstGames();
    }

    // Auto-select the first N games based on current layout
    function autoSelectFirstGames() {
      const liveGames = window.liveGamesData || [];
      const layout = parseInt(document.querySelector('input[name="layout"]:checked').value);
      const selectors = document.querySelectorAll('.game-selector');

      // Reset gridGames
      gridGames = {};

      // Select first N games (up to available games)
      const gamesToSelect = Math.min(layout, liveGames.length);

      selectors.forEach((selector, index) => {
        if (index < gamesToSelect && liveGames[index]) {
          const gameId = liveGames[index].id;
          gridGames[index] = gameId;
        }
      });

      // Update selectors to reflect the auto-selection
      updateAllGameSelectors();
      checkAllSlotsSelected();
    }

    // Render grid preview with game selectors
    function renderGridPreview() {
      const container = document.getElementById('grid-preview');
      const layout = parseInt(document.querySelector('input[name="layout"]:checked').value);
      currentLayout = layout;
      
      container.innerHTML = '';
      container.className = `grid-preview grid-${layout}`;

      const liveGames = window.liveGamesData || [];
      
      console.log('üéÆ Sports Bar Mode - Live games check:', {
        windowData: window.liveGamesData?.length || 0,
        totalGames: liveGames.length
      });
      
      if (liveGames.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; color: #ef4444; padding: 40px; grid-column: 1/-1;">
            ‚ùå No live games detected<br>
            <span style="font-size: 14px; color: #94a3b8; margin-top: 10px; display: block;">
              If you see games on the main page, try refreshing the page and opening Sports Bar Mode again.
            </span>
          </p>`;
        document.getElementById('enter-fullscreen').disabled = true;
        return;
      }

      for (let i = 0; i < layout; i++) {
        const slot = document.createElement('div');
        slot.className = 'grid-slot';
        slot.innerHTML = `
          <div class="slot-label">Position ${i + 1}</div>
          <select class="game-selector" data-slot="${i}">
            <option value="">-- Select Game --</option>
          </select>
        `;
        container.appendChild(slot);
      }

      updateAllGameSelectors();
      
      // Enable/disable enter button based on selections
      checkAllSlotsSelected();
    }

    // Update all game selectors with available games
    function updateAllGameSelectors() {
      const selectors = document.querySelectorAll('.game-selector');
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now stores game IDs

      selectors.forEach(selector => {
        const slotIndex = parseInt(selector.dataset.slot);
        const currentSelection = gridGames[slotIndex]; // Game ID
        
        // Clear existing options except first
        selector.innerHTML = '<option value="">-- Select Game --</option>';

        liveGames.forEach((game, gameIndex) => {
          const gameId = game.id;
          // Show game if: it's not used OR it's the current selection for this slot
          if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
            const comp = game.competitions?.[0];
            const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
            const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';
            const awayScore = comp?.competitors?.[1]?.score || '0';
            const homeScore = comp?.competitors?.[0]?.score || '0';
            
            // Determine status - LIVE or UPCOMING
            const statusState = comp?.status?.type?.state;
            const isLive = statusState === 'in' || comp?.status?.period > 0;
            const isUpcoming = statusState === 'pre';
            
            let statusLabel;
            if (isUpcoming) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
              statusLabel = `UPCOMING (${hoursUntil}h)`;
            } else if (isLive) {
              const quarter = comp?.status?.type?.shortDetail || 'Live';
              statusLabel = `LIVE - ${quarter}`;
            } else {
              statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
            }

            const option = document.createElement('option');
            option.value = gameId; // Store game ID instead of index
            option.textContent = `${awayTeam} (${awayScore}) @ ${homeTeam} (${homeScore}) - ${statusLabel}`;
            
            if (currentSelection === gameId) {
              option.selected = true;
            }
            
            selector.appendChild(option);
          }
        });

        // Add change event listener
        selector.removeEventListener('change', handleGameSelection);
        selector.addEventListener('change', handleGameSelection);
      });
    }

    // Handle game selection change
    function handleGameSelection(e) {
      const slotIndex = parseInt(e.target.dataset.slot);
      const gameId = e.target.value === '' ? null : e.target.value; // Now uses game ID string

      if (gameId === null) {
        delete gridGames[slotIndex];
      } else {
        gridGames[slotIndex] = gameId; // Store game ID
      }

      // Update all selectors to reflect new availability
      updateAllGameSelectors();
      checkAllSlotsSelected();
    }

    // Check if all slots have games selected (NOW OPTIONAL - allow empty slots)
    function checkAllSlotsSelected() {
      // Always enable button - allow entering with empty slots
      document.getElementById('enter-fullscreen').disabled = false;
    }

    // Layout change handler
    document.querySelectorAll('input[name="layout"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        gridGames = {}; // Reset selections when layout changes
        renderGridPreview();
        autoSelectFirstGames(); // Auto-select first N games for new layout
      });
    });

    // Enter full screen mode
    function enterFullScreenMode() {
      // No validation - allow empty slots

      const modal = document.getElementById('game-selection-modal');
      const container = document.getElementById('fullscreen-container');
      const controls = document.getElementById('fullscreen-controls');
      
      modal.classList.remove('show');
      container.classList.add('active');
      
      // Show controls briefly when entering full screen
      controls.classList.add('visible');
      setTimeout(() => {
        controls.classList.remove('visible');
      }, 3000); // Hide after 3 seconds
      
      renderFullScreenGames();
      
      // Apply dynamic scaling based on screen size IMMEDIATELY
      applyDynamicScaling();
      
      // Apply again after a small delay to ensure everything is rendered
      setTimeout(() => {
        applyDynamicScaling();
      }, 100);
      
      // Start auto-refresh
      fullscreenRefreshInterval = setInterval(() => {
        updateFullScreenScores();
      }, 5000);

      // Request browser fullscreen (with safety check)
      try {
        if (container.requestFullscreen) {
          container.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        } else if (container.webkitRequestFullscreen) {
          container.webkitRequestFullscreen();
        } else if (container.msRequestFullscreen) {
          container.msRequestFullscreen();
        }
      } catch (err) {
        console.log('Fullscreen not supported or failed:', err);
      }
    }

    // Render full screen games
    function renderFullScreenGames() {
      const grid = document.getElementById('fullscreen-grid');
      grid.className = `fullscreen-grid grid-${currentLayout}`;
      grid.innerHTML = '';

      const liveGames = window.liveGamesData || [];

      // Render in slot order (0, 1, 2, ...)
      for (let slotIndex = 0; slotIndex < currentLayout; slotIndex++) {
        const gameId = gridGames[slotIndex]; // Now uses game ID
        const game = liveGames.find(g => g.id === gameId); // Find game by ID
        
        if (game) {
          const card = createFullScreenGameCard(game, slotIndex);
          grid.appendChild(card);
        } else {
          // Empty slot - show logo and game selector
          const card = createEmptySlotCard(slotIndex);
          grid.appendChild(card);
        }
      }
    }

    // Calculate ball position percentage on field (0-100%)
    // Field position format: "DAL 32" means Dallas has ball at their own 32 yard line
    // 0% = offensive team's own endzone, 100% = opponent's endzone (target)
    function calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam) {
      if (!fieldPosition) return 50; // Default to midfield
      
      // Parse field position (e.g., "DAL 32", "LV 45", "50")
      const parts = fieldPosition.trim().split(' ');
      
      let yardLine;
      let teamWithBall;
      
      if (parts.length === 1) {
        // At the 50 yard line
        yardLine = 50;
        teamWithBall = null;
      } else {
        teamWithBall = parts[0];
        yardLine = parseInt(parts[1]);
      }
      
      // Determine which team has possession
      const awayAbbr = awayTeam?.team?.abbreviation;
      const homeAbbr = homeTeam?.team?.abbreviation;
      const possessionIsAway = possession === awayTeam?.id;
      
      // Calculate distance to target endzone (opponent's endzone)
      let distanceToTarget;
      
      if (yardLine === 50) {
        distanceToTarget = 50; // Midfield
      } else if (teamWithBall === awayAbbr) {
        // Away team has the ball
        distanceToTarget = 100 - yardLine; // Distance to home team's endzone
      } else if (teamWithBall === homeAbbr) {
        // Home team has the ball  
        distanceToTarget = yardLine; // Distance to away team's endzone (from home's perspective)
      } else {
        distanceToTarget = 50; // Default to midfield if we can't determine
      }
      
      // Convert to percentage (0% = own endzone, 100% = opponent's endzone)
      // For display purposes, we show from left (away team's endzone) to right (home team's endzone)
      let percentage;
      if (possessionIsAway) {
        // Away team going right (towards home endzone)
        percentage = 100 - distanceToTarget;
      } else {
        // Home team going left (towards away endzone)  
        percentage = distanceToTarget;
      }
      
      // Clamp between 0 and 100
      return Math.max(0, Math.min(100, percentage));
    }

    // Update ball position on field visualizer
    function updateBallPosition(card, fieldPosition, possession, awayTeam, homeTeam) {
      const ballIndicator = card.querySelector('.ball-indicator');
      if (!ballIndicator || !fieldPosition) return;
      
      const ballPosition = calculateBallPosition(fieldPosition, possession, awayTeam, homeTeam);
      ballIndicator.style.left = `${ballPosition}%`;
      ballIndicator.dataset.fieldPosition = fieldPosition;
    }

    // Create empty slot card with logo
    function createEmptySlotCard(slotIndex) {
      const div = document.createElement('div');
      div.className = 'fullscreen-game-card empty-slot';
      div.dataset.slotIndex = slotIndex;
      
      // Determine logo and text size based on current grid layout
      const logoSize = currentLayout === 6 ? '50%' : currentLayout === 4 ? '55%' : '60%';
      const textSize = currentLayout === 6 ? '1.2rem' : currentLayout === 4 ? '1.4rem' : '1.5rem';
      
      div.innerHTML = `
        <!-- Game Selector Dropdown -->
        <div class="fs-game-selector-container" style="display: block;">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <option value="">-- Select Game --</option>
          </select>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; opacity: 0.6;">
          <img src="/assets/logo.png" alt="GridTV Sports" style="max-width: ${logoSize}; max-height: 35%; object-fit: contain; margin-bottom: 15px;">
          <div style="font-size: ${textSize}; color: #64748b; text-align: center; line-height: 1.4;">
            Select a game above<br>to display
          </div>
        </div>
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      return div;
    }

    // Create full screen game card with game selector
    function createFullScreenGameCard(game, slotIndex) {
      const div = document.createElement('div');
      
      const comp = game.competitions?.[0];
      const awayTeam = comp?.competitors?.[1];
      const homeTeam = comp?.competitors?.[0];
      const awayScore = parseInt(awayTeam?.score || 0);
      const homeScore = parseInt(homeTeam?.score || 0);
      
      // Get team records
      const awayRecord = awayTeam?.records?.[0]?.summary || awayTeam?.record?.displayValue || '';
      const homeRecord = homeTeam?.records?.[0]?.summary || homeTeam?.record?.displayValue || '';
      
      // Determine if game is live or upcoming
      const statusState = comp?.status?.type?.state;
      const isLive = statusState === 'in' || comp?.status?.period > 0;
      const isUpcoming = statusState === 'pre';
      const isFinal = statusState === 'post';
      
      console.log('üéÆ Creating game card:', {
        gameName: game.name,
        statusState: statusState,
        statusName: comp?.status?.type?.name,
        period: comp?.status?.period,
        isLive: isLive,
        isUpcoming: isUpcoming,
        isFinal: isFinal,
        gameDate: game.date
      });
      
      let cardClass = 'fullscreen-game-card';
      
      // Add status-specific class for styling
      if (isUpcoming) {
        cardClass += ' upcoming-game';
      } else if (isFinal) {
        cardClass += ' final-game';
        // Show winning/losing colors for final games
        if (awayScore > homeScore) cardClass += ' winning-away';
        else if (homeScore > awayScore) cardClass += ' winning-home';
        else cardClass += ' tied';
      } else if (isLive) {
        // Only show winning/losing colors for live games
        if (awayScore > homeScore) cardClass += ' winning-away';
        else if (homeScore > awayScore) cardClass += ' winning-home';
        else cardClass += ' tied';
      }

      // Get status display text
      let statusDisplay = comp?.status?.type?.shortDetail || 'Live';
      
      // Get game clock and quarter information
      const gameClock = comp?.status?.displayClock || '';
      const quarter = comp?.status?.period || 0;
      const quarterText = comp?.status?.type?.shortDetail || '';
      
      // For upcoming games, show scheduled time
      if (isUpcoming) {
        const gameDate = new Date(game.date);
        const now = new Date();
        const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
        const minutesUntil = Math.round((gameDate - now) / (1000 * 60));
        
        console.log('‚è∞ Upcoming game countdown:', {
          gameDate: gameDate.toLocaleString(),
          now: now.toLocaleString(),
          minutesUntil: minutesUntil,
          hoursUntil: hoursUntil
        });
        
        if (minutesUntil < 60) {
          statusDisplay = `STARTS IN ${minutesUntil} MIN`;
        } else if (hoursUntil < 24) {
          statusDisplay = `STARTS IN ${hoursUntil}H`;
        } else {
          statusDisplay = `${gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
        }
        
        console.log('‚è∞ Status display:', statusDisplay);
      }
      
      const possession = comp?.situation?.possession;
      const downDistance = comp?.situation?.downDistanceText || '';
      const fieldPosition = comp?.situation?.possessionText || '';

      // Get timeout information - ESPN API provides this in the situation object
      const awayTimeouts = comp?.situation?.awayTimeouts ?? 3;
      const homeTimeouts = comp?.situation?.homeTimeouts ?? 3;

      div.className = cardClass;
      div.dataset.slotIndex = slotIndex;
      div.dataset.isLive = isLive ? 'true' : 'false';
      div.dataset.isFinal = isFinal ? 'true' : 'false';
      div.dataset.gameId = game.id;
      
      div.innerHTML = `
        <img src="/assets/NCAA logo.png" alt="NCAA" class="sport-logo-indicator">
        <div class="fullscreen-refresh-indicator"></div>
        
        <!-- Game Selector Dropdown (hidden initially) -->
        <div class="fs-game-selector-container">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <!-- Populated dynamically -->
          </select>
        </div>

        <div class="fullscreen-card-content">
          ${isUpcoming ? `
            <!-- Upcoming Game -->
            <div class="fullscreen-upcoming-status-text">‚è∞ ${statusDisplay}</div>
            <div class="fullscreen-live-score-header">
              <div class="fullscreen-team-stack">
                ${awayTeam?.team?.logo ? `<img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                <div class="fullscreen-live-team-name">${awayTeam?.team?.abbreviation || awayTeam?.team?.shortDisplayName || awayTeam?.team?.displayName || 'AWAY'}</div>
                ${awayRecord ? `<div class="fullscreen-team-record">${awayRecord}</div>` : ''}
              </div>
              <div class="fullscreen-team-score">-</div>
              <div class="fullscreen-vs-divider-live">VS</div>
              <div class="fullscreen-team-score">-</div>
              <div class="fullscreen-team-stack">
                ${homeTeam?.team?.logo ? `<img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                <div class="fullscreen-live-team-name">${homeTeam?.team?.abbreviation || homeTeam?.team?.shortDisplayName || homeTeam?.team?.displayName || 'HOME'}</div>
                ${homeRecord ? `<div class="fullscreen-team-record">${homeRecord}</div>` : ''}
              </div>
            </div>
          ` : `
            <!-- Live or Final Game -->
            <div class="fullscreen-status-container">
              <div class="fullscreen-status-text">${quarterText}</div>
            </div>

            <div class="fullscreen-live-score-header">
              <div class="fullscreen-team-stack">
                <div style="position: relative;">
                  ${awayTeam?.team?.logo ? `<img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                  ${isLive && possession === awayTeam?.id ? '<span class="fullscreen-possession">üèà</span>' : ''}
                </div>
                <div class="fullscreen-live-team-name ${awayScore > homeScore ? 'winning' : ''}">${awayTeam?.team?.abbreviation || awayTeam?.team?.shortDisplayName || awayTeam?.team?.displayName || 'AWAY'}</div>
                ${awayRecord ? `<div class="fullscreen-team-record">${awayRecord}</div>` : ''}
                ${isLive ? `
                  <div class="fullscreen-timeouts">
                    <div class="timeout-bar ${awayTimeouts < 3 ? 'used' : ''}"></div>
                    <div class="timeout-bar ${awayTimeouts < 2 ? 'used' : ''}"></div>
                    <div class="timeout-bar ${awayTimeouts < 1 ? 'used' : ''}"></div>
                  </div>
                ` : ''}
              </div>
              <div class="fullscreen-team-score ${awayScore > homeScore ? 'winning' : 'losing'}">${awayScore}</div>
              <div class="fullscreen-vs-divider-live">VS</div>
              <div class="fullscreen-team-score ${homeScore > awayScore ? 'winning' : 'losing'}">${homeScore}</div>
              <div class="fullscreen-team-stack">
                <div style="position: relative;">
                  ${homeTeam?.team?.logo ? `<img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                  ${isLive && possession === homeTeam?.id ? '<span class="fullscreen-possession">üèà</span>' : ''}
                </div>
                <div class="fullscreen-live-team-name ${homeScore > awayScore ? 'winning' : ''}">${homeTeam?.team?.abbreviation || homeTeam?.team?.shortDisplayName || homeTeam?.team?.displayName || 'HOME'}</div>
                ${homeRecord ? `<div class="fullscreen-team-record">${homeRecord}</div>` : ''}
                ${isLive ? `
                  <div class="fullscreen-timeouts">
                    <div class="timeout-bar ${homeTimeouts < 3 ? 'used' : ''}"></div>
                    <div class="timeout-bar ${homeTimeouts < 2 ? 'used' : ''}"></div>
                    <div class="timeout-bar ${homeTimeouts < 1 ? 'used' : ''}"></div>
                  </div>
                ` : ''}
              </div>
            </div>

            ${isLive && downDistance ? `
              <div class="fullscreen-situation-info">${downDistance}</div>
            ` : ''}

            ${isLive && downDistance && fieldPosition ? `
              <div class="field-visualizer">
                <div class="field-container">
                  <div class="endzone-label left">${awayTeam?.team?.abbreviation || 'AWAY'}</div>
                  <div class="endzone-label right">${homeTeam?.team?.abbreviation || 'HOME'}</div>
                  <div class="yard-markers">
                    <div class="yard-marker endzone"><span class="yard-label">0</span></div>
                    <div class="yard-marker"><span class="yard-label">10</span></div>
                    <div class="yard-marker"><span class="yard-label">20</span></div>
                    <div class="yard-marker"><span class="yard-label">30</span></div>
                    <div class="yard-marker"><span class="yard-label">40</span></div>
                    <div class="yard-marker"><span class="yard-label">50</span></div>
                    <div class="yard-marker"><span class="yard-label">40</span></div>
                    <div class="yard-marker"><span class="yard-label">30</span></div>
                    <div class="yard-marker"><span class="yard-label">20</span></div>
                    <div class="yard-marker"><span class="yard-label">10</span></div>
                    <div class="yard-marker endzone"><span class="yard-label">0</span></div>
                  </div>
                  <div class="ball-indicator" data-field-position="${fieldPosition}"></div>
                </div>
              </div>
            ` : ''}
          `}
        </div>
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      // Update ball position on field visualizer if present
      if (isLive && fieldPosition) {
        updateBallPosition(div, fieldPosition, possession, awayTeam, homeTeam);
      }

      // Show selector on card hover
      div.addEventListener('mouseenter', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'block';
      });
      div.addEventListener('mouseleave', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'none';
      });

      return div;
    }

    // Populate full screen game selector
    function populateFullScreenGameSelector(selector, slotIndex) {
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now uses game IDs
      const currentSelection = gridGames[slotIndex]; // Game ID

      selector.innerHTML = '<option value="">-- Select Game --</option>';

      liveGames.forEach((game, gameIndex) => {
        const gameId = game.id;
        if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
          const comp = game.competitions?.[0];
          const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
          const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';

          // Determine status - LIVE or UPCOMING
          const statusState = comp?.status?.type?.state;
          const isLive = statusState === 'in' || comp?.status?.period > 0;
          const isUpcoming = statusState === 'pre';
          
          let statusLabel;
          if (isUpcoming) {
            statusLabel = 'üïí UPCOMING';
          } else if (isLive) {
            const quarter = comp?.status?.type?.shortDetail || 'Live';
            statusLabel = `üî¥ ${quarter}`;
          } else {
            statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
          }

          const option = document.createElement('option');
          option.value = gameId; // Store game ID
          option.textContent = `${awayTeam} @ ${homeTeam} - ${statusLabel}`;
          
          if (currentSelection === gameId) {
            option.selected = true;
          }
          
          selector.appendChild(option);
        }
      });

      // Handle game change in full screen
      selector.addEventListener('change', (e) => {
        const newGameId = e.target.value; // Game ID
        const card = document.querySelector(`[data-slot-index="${slotIndex}"]`);
        
        if (newGameId === '') {
          // User deselected - show empty slot
          delete gridGames[slotIndex];
          if (card) {
            const emptyCard = createEmptySlotCard(slotIndex);
            card.replaceWith(emptyCard);
          }
        } else {
          // User selected a game
          gridGames[slotIndex] = newGameId; // Store game ID
          
          const liveGames = window.liveGamesData || [];
          const newGame = liveGames.find(g => g.id === newGameId); // Find by ID
          
          if (newGame && card) {
            const newCard = createFullScreenGameCard(newGame, slotIndex);
            card.replaceWith(newCard);
          }
        }

        // Update all other selectors to reflect new availability
        document.querySelectorAll('.fs-game-selector').forEach(sel => {
          const slot = parseInt(sel.dataset.slot);
          populateFullScreenGameSelector(sel, slot);
        });
      });
    }

    // Detect play type based on score change and show animation
    function detectAndAnimatePlay(card, scoreChange, teamName) {
      let playType, playText;
      
      if (scoreChange === 6) {
        playType = 'touchdown';
        playText = 'TOUCHDOWN!';
      } else if (scoreChange === 7 || scoreChange === 8) {
        playType = 'touchdown';
        playText = 'TOUCHDOWN!';
      } else if (scoreChange === 3) {
        playType = 'field-goal';
        playText = 'FIELD GOAL!';
      } else if (scoreChange === 2) {
        playType = 'field-goal';
        playText = 'SAFETY!';
      } else if (scoreChange === 1) {
        playType = 'field-goal';
        playText = 'EXTRA POINT!';
      } else {
        return; // Unknown score change
      }
      
      showPlayAnimation(card, playType, playText, teamName);
    }

    // Show play animation overlay
    function showPlayAnimation(card, playType, playText, teamName = '', recoveryInfo = '', recoveryLogo = '') {
      // Remove any existing animation
      const existingAnimation = card.querySelector('.play-animation');
      if (existingAnimation) {
        existingAnimation.remove();
      }

      // Create animation overlay
      const animationDiv = document.createElement('div');
      animationDiv.className = `play-animation ${playType}`;

      // Choose icon based on play type
      let icon;
      switch(playType) {
        case 'touchdown':
          icon = 'üèà';
          break;
        case 'field-goal':
          icon = 'ü•Ö';
          break;
        case 'interception':
          icon = 'üö´';
          break;
        case 'fumble':
          icon = 'üí®';
          break;
        case 'first-down':
          icon = 'üèÉ';
          break;
        default:
          icon = '‚ö°';
      }

      // Build recovery HTML with logo for fumbles
      let recoveryHTML = '';
      if (playType === 'fumble' && recoveryLogo) {
        recoveryHTML = `
          <div class="play-animation-subtext" style="margin-top: clamp(5px, 1vh, 10px);">Recovered by</div>
          <img src="${recoveryLogo}" alt="Team" style="width: clamp(40px, 8vmin, 80px); height: clamp(40px, 8vmin, 80px); object-fit: contain; margin-top: clamp(5px, 1vh, 10px);">
        `;
      } else if (recoveryInfo) {
        recoveryHTML = `<div class="play-animation-subtext" style="margin-top: clamp(5px, 1vh, 10px);">${recoveryInfo}</div>`;
      }

      // Special HTML for field goal with YFrame and spinning ball
      if (playType === 'field-goal') {
        animationDiv.innerHTML = `
          <div class="field-goal-container">
            <img src="/assets/YFrame.png" alt="Goal Post" class="yframe-image" onerror="this.style.display='none';">
            <div class="spinning-football">üèà</div>
          </div>
          <div class="play-animation-text">${playText}</div>
          ${teamName ? `<div class="play-animation-subtext">${teamName}</div>` : ''}
        `;
      } else if (playType === 'first-down') {
        // Special HTML for 1st down with arrows coming together
        animationDiv.innerHTML = `
          <div class="first-down-container">
            <img src="/assets/1stDown1.png" alt="Arrow" class="first-down-arrow left" onerror="this.style.display='none';">
            <img src="/assets/1stDown2.png" alt="Arrow" class="first-down-arrow right" onerror="this.style.display='none';">
          </div>
          <div class="play-animation-text">${playText}</div>
          ${teamName ? `<div class="play-animation-subtext">${teamName}</div>` : ''}
        `;
      } else {
        animationDiv.innerHTML = `
          <div class="play-animation-icon">${icon}</div>
          <div class="play-animation-text">${playText}</div>
          ${teamName ? `<div class="play-animation-subtext">${teamName}</div>` : ''}
          ${recoveryHTML}
        `;
      }

      card.style.position = 'relative';
      card.appendChild(animationDiv);

      // Remove after animation completes (5 seconds)
      setTimeout(() => {
        animationDiv.remove();
      }, 5000);
    }

    // Update full screen scores
    async function updateFullScreenScores() {
      try {
        // Fetch updated game data from BOTH current week AND next week (same as initial fetch)
        const [currentWeekResponse, nextWeekResponse] = await Promise.all([
          fetch(`/api/ncaa/scoreboard?week=${currentWeek}`),
          fetch(`/api/ncaa/scoreboard?week=${currentWeek + 1}`)
        ]);

        if (!currentWeekResponse.ok && !nextWeekResponse.ok) {
          throw new Error(`Failed to fetch scores from both weeks`);
        }

        // Combine games from both weeks
        const currentWeekData = currentWeekResponse.ok ? await currentWeekResponse.json() : { events: [] };
        const nextWeekData = nextWeekResponse.ok ? await nextWeekResponse.json() : { events: [] };

        const allEvents = [
          ...(currentWeekData.events || []),
          ...(nextWeekData.events || [])
        ];

        // Update the global games data
        if (allEvents.length > 0) {
          const allGames = allEvents.map(event => {
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');

            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });

          window.liveGamesData = allGames;
        }

        const grid = document.getElementById('fullscreen-grid');
        const cards = grid.querySelectorAll('.fullscreen-game-card');

        cards.forEach((card, index) => {
          const slotIndex = parseInt(card.dataset.slotIndex);
          const gameId = gridGames[slotIndex]; // Now uses game ID
          const game = window.liveGamesData.find(g => g.id === gameId); // Find by ID
          
          if (!game || card.classList.contains('empty-slot')) return;

          const comp = game.competitions?.[0];
          const statusState = comp?.status?.type?.state;
          const wasUpcoming = card.dataset.isLive === 'false';
          const wasFinal = card.dataset.isFinal === 'true';
          const isNowLive = statusState === 'in' || comp?.status?.period > 0;
          const isNowFinal = statusState === 'post';

          // If game transitioned from upcoming to live, or live to final, recreate the card
          if ((wasUpcoming && isNowLive) || (!wasFinal && isNowFinal)) {
            console.log(`üèà Game status changed! Recreating card:`, game.name);
            const newCard = createFullScreenGameCard(game, slotIndex);
            card.replaceWith(newCard);
            return;
          }

          // For upcoming games, update countdown
          if (statusState === 'pre') {
            const upcomingStatus = card.querySelector('.fullscreen-upcoming-status-text');
            if (upcomingStatus) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const minutesUntil = Math.round((gameDate - now) / (1000 * 60));
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));

              if (minutesUntil < 60) {
                upcomingStatus.textContent = `‚è∞ STARTS IN ${minutesUntil} MIN`;
              } else if (hoursUntil < 24) {
                upcomingStatus.textContent = `‚è∞ STARTS IN ${hoursUntil}H`;
              } else {
                upcomingStatus.textContent = `‚è∞ ${gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
              }
            }
            return; // Don't update scores for upcoming games
          }

          // For final games, no updates needed - just show final scores
          if (statusState === 'post') {
            return;
          }

          // Update live game data
          const indicator = card.querySelector('.fullscreen-refresh-indicator');
          if (indicator) {
            indicator.classList.add('active');
            setTimeout(() => indicator.classList.remove('active'), 1000);
          }

          const awayTeam = comp?.competitors?.[1];
          const homeTeam = comp?.competitors?.[0];
          const awayScore = parseInt(awayTeam?.score || 0);
          const homeScore = parseInt(homeTeam?.score || 0);

          // Get team name elements for later use
          const teamNames = card.querySelectorAll('.fullscreen-live-team-name');

          // Update status text (quarter/time)
          const statusTextEl = card.querySelector('.fullscreen-status-text');

          if (statusTextEl) {
            const quarterText = comp?.status?.type?.shortDetail || 'Live';
            statusTextEl.textContent = quarterText;
          }

          // Get previous scores from card data attributes
          const prevAwayScore = parseInt(card.dataset.prevAwayScore || 0);
          const prevHomeScore = parseInt(card.dataset.prevHomeScore || 0);

          // Detect score changes and determine play type
          const awayScoreChange = awayScore - prevAwayScore;
          const homeScoreChange = homeScore - prevHomeScore;

          if (awayScoreChange > 0) {
            detectAndAnimatePlay(card, awayScoreChange, awayTeam?.team?.displayName || 'Away');
          } else if (homeScoreChange > 0) {
            detectAndAnimatePlay(card, homeScoreChange, homeTeam?.team?.displayName || 'Home');
          }

          // Check for turnovers (interceptions/fumbles) from play description
          const lastPlay = comp?.situation?.lastPlay?.text || '';
          if (lastPlay.toLowerCase().includes('interception') || lastPlay.toLowerCase().includes('intercepted')) {
            if (!card.dataset.lastInterception || card.dataset.lastInterception !== lastPlay) {
              showPlayAnimation(card, 'interception', 'INTERCEPTION!');
              card.dataset.lastInterception = lastPlay;
            }
          } else if (lastPlay.toLowerCase().includes('fumble')) {
            if (!card.dataset.lastFumble || card.dataset.lastFumble !== lastPlay) {
              // Extract recovery information and team logo from play text
              let recoveryInfo = '';
              let recoveryLogo = '';
              const lowerPlay = lastPlay.toLowerCase();

              // Try to find who recovered and get their logo
              if (lowerPlay.includes('recovered by')) {
                const recoveredIndex = lowerPlay.indexOf('recovered by');
                const afterRecovered = lastPlay.substring(recoveredIndex + 13); // Skip 'recovered by '

                // Check if away team recovered
                if (afterRecovered.toLowerCase().includes(awayTeam?.team?.abbreviation?.toLowerCase()) ||
                    afterRecovered.toLowerCase().includes(awayTeam?.team?.shortDisplayName?.toLowerCase())) {
                  recoveryLogo = awayTeam?.team?.logo || '';
                }
                // Check if home team recovered
                else if (afterRecovered.toLowerCase().includes(homeTeam?.team?.abbreviation?.toLowerCase()) ||
                         afterRecovered.toLowerCase().includes(homeTeam?.team?.shortDisplayName?.toLowerCase())) {
                  recoveryLogo = homeTeam?.team?.logo || '';
                }
              } else if (lowerPlay.includes(awayTeam?.team?.abbreviation?.toLowerCase())) {
                recoveryLogo = awayTeam?.team?.logo || '';
              } else if (lowerPlay.includes(homeTeam?.team?.abbreviation?.toLowerCase())) {
                recoveryLogo = homeTeam?.team?.logo || '';
              }

              showPlayAnimation(card, 'fumble', 'FUMBLE!', '', recoveryInfo, recoveryLogo);
              card.dataset.lastFumble = lastPlay;
            }
          }

          // Check for 1st down - when down changes to 1 from 2, 3, or 4
          const currentDown = comp?.situation?.down;
          const prevDown = parseInt(card.dataset.prevDown) || 0;

          // Only trigger if:
          // - Current down is 1
          // - Previous down was 2, 3, or 4 (not 0 or 1)
          // - No score change (to avoid showing after touchdowns)
          // - Not showing other animations (interception/fumble)
          if (currentDown === 1 && prevDown >= 2 && prevDown <= 4 &&
              awayScoreChange === 0 && homeScoreChange === 0 &&
              !lastPlay.toLowerCase().includes('interception') &&
              !lastPlay.toLowerCase().includes('intercepted') &&
              !lastPlay.toLowerCase().includes('fumble')) {
            // Check if we already showed this 1st down
            const downDistanceText = comp?.situation?.downDistanceText || '';
            if (card.dataset.lastFirstDown !== downDistanceText) {
              showPlayAnimation(card, 'first-down', '1ST DOWN!');
              card.dataset.lastFirstDown = downDistanceText;
            }
          }

          // Store current down for next update
          card.dataset.prevDown = currentDown || 0;

          // Store current scores for next update
          card.dataset.prevAwayScore = awayScore;
          card.dataset.prevHomeScore = homeScore;

          // Update scores with animation
          const scores = card.querySelectorAll('.fullscreen-team-score');
          const awayScoreEl = scores[0];
          const homeScoreEl = scores[1];
          
          if (awayScoreEl && awayScoreEl.textContent !== awayScore.toString()) {
            awayScoreEl.textContent = awayScore;
            awayScoreEl.style.animation = 'none';
            awayScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              awayScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              awayScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }
          
          if (homeScoreEl && homeScoreEl.textContent !== homeScore.toString()) {
            homeScoreEl.textContent = homeScore;
            homeScoreEl.style.animation = 'none';
            homeScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              homeScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              homeScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }

          // Update winning/losing classes for scores
          if (awayScoreEl) {
            awayScoreEl.classList.remove('winning', 'losing');
            if (awayScore > homeScore) awayScoreEl.classList.add('winning');
            else if (awayScore < homeScore) awayScoreEl.classList.add('losing');
          }
          if (homeScoreEl) {
            homeScoreEl.classList.remove('winning', 'losing');
            if (homeScore > awayScore) homeScoreEl.classList.add('winning');
            else if (homeScore < awayScore) homeScoreEl.classList.add('losing');
          }

          // Update winning classes for team names
          if (teamNames.length >= 2) {
            teamNames[0].classList.remove('winning');
            teamNames[1].classList.remove('winning');
            if (awayScore > homeScore) teamNames[0].classList.add('winning');
            else if (homeScore > awayScore) teamNames[1].classList.add('winning');
          }

          // Update card class for winner
          card.className = 'fullscreen-game-card';
          card.dataset.slotIndex = slotIndex;
          card.dataset.isLive = 'true';
          card.dataset.gameId = game.id;

          if (awayScore > homeScore) card.classList.add('winning-away');
          else if (homeScore > awayScore) card.classList.add('winning-home');
          else card.classList.add('tied');

          // Update down/distance
          const downDistanceEl = card.querySelector('.fullscreen-situation-info');
          const downDistance = comp?.situation?.downDistanceText || '';

          if (downDistanceEl) {
            downDistanceEl.textContent = downDistance || '';
            // Show/hide based on whether we have down/distance data
            if (downDistance) {
              downDistanceEl.style.display = 'block';
            } else {
              downDistanceEl.style.display = 'none';
            }
          } else if (downDistance) {
            // Create down/distance element if it doesn't exist (for cards that just went live)
            const scoreHeader = card.querySelector('.fullscreen-live-score-header');
            if (scoreHeader) {
              scoreHeader.insertAdjacentHTML('afterend', `
                <div class="fullscreen-situation-info">${downDistance}</div>
              `);
            }
          }

          // Update possession
          const possession = comp?.situation?.possession;

          // Remove ALL existing possession icons from the entire card first
          const allPossessionIcons = card.querySelectorAll('.fullscreen-possession');
          allPossessionIcons.forEach(icon => icon.remove());

          // Find the logo containers (they have position: relative and contain the logo)
          const teamStacks = card.querySelectorAll('.fullscreen-team-stack');

          if (possession === awayTeam?.id && teamStacks[0]) {
            // Add possession icon next to away team logo
            const awayLogoContainer = teamStacks[0].querySelector('div[style*="position: relative"]');
            if (awayLogoContainer) {
              awayLogoContainer.insertAdjacentHTML('beforeend', '<span class="fullscreen-possession">üèà</span>');
            }
          } else if (possession === homeTeam?.id && teamStacks[1]) {
            // Add possession icon next to home team logo
            const homeLogoContainer = teamStacks[1].querySelector('div[style*="position: relative"]');
            if (homeLogoContainer) {
              homeLogoContainer.insertAdjacentHTML('beforeend', '<span class="fullscreen-possession">üèà</span>');
            }
          }

          // Update field position visualizer
          const fieldPosition = comp?.situation?.possessionText || '';
          let fieldVisualizer = card.querySelector('.field-visualizer');

          if (downDistance && fieldPosition) {
            // Create field visualizer if it doesn't exist
            if (!fieldVisualizer) {
              const situationInfo = card.querySelector('.fullscreen-situation-info');
              if (situationInfo) {
                situationInfo.insertAdjacentHTML('afterend', `
                  <div class="field-visualizer">
                    <div class="field-container">
                      <div class="endzone-label left">${awayTeam?.team?.abbreviation || 'AWAY'}</div>
                      <div class="endzone-label right">${homeTeam?.team?.abbreviation || 'HOME'}</div>
                      <div class="yard-markers">
                        <div class="yard-marker endzone"><span class="yard-label">0</span></div>
                        <div class="yard-marker"><span class="yard-label">10</span></div>
                        <div class="yard-marker"><span class="yard-label">20</span></div>
                        <div class="yard-marker"><span class="yard-label">30</span></div>
                        <div class="yard-marker"><span class="yard-label">40</span></div>
                        <div class="yard-marker"><span class="yard-label">50</span></div>
                        <div class="yard-marker"><span class="yard-label">40</span></div>
                        <div class="yard-marker"><span class="yard-label">30</span></div>
                        <div class="yard-marker"><span class="yard-label">20</span></div>
                        <div class="yard-marker"><span class="yard-label">10</span></div>
                        <div class="yard-marker endzone"><span class="yard-label">0</span></div>
                      </div>
                      <div class="ball-indicator" data-field-position="${fieldPosition}"></div>
                    </div>
                  </div>
                `);
                fieldVisualizer = card.querySelector('.field-visualizer');
              }
            }

            // Update ball position
            if (fieldVisualizer) {
              updateBallPosition(card, fieldPosition, possession, awayTeam, homeTeam);

              fieldVisualizer.style.display = 'flex';
            }
          } else if (fieldVisualizer) {
            // Hide field visualizer if no down/distance data
            fieldVisualizer.style.display = 'none';
          }
        });

        const fsContainer = document.getElementById('fullscreen-container');
        if (fsContainer && fsContainer.classList.contains('active')) {
          applyDynamicScaling();
        }

      } catch (error) {
        console.error('Error updating full screen scores:', error);
      }
    }

    // Exit full screen mode
    function exitFullScreenMode() {
      const container = document.getElementById('fullscreen-container');
      container.classList.remove('active');
      
      // Remove dynamic styles
      if (dynamicStyles) {
        dynamicStyles.remove();
        dynamicStyles = null;
      }
      
      if (fullscreenRefreshInterval) {
        clearInterval(fullscreenRefreshInterval);
        fullscreenRefreshInterval = null;
      }

      // Exit browser fullscreen
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    // Event Listeners
    document.getElementById('sports-bar-btn').addEventListener('click', openGameSelectionModal);
    
    document.getElementById('cancel-modal').addEventListener('click', () => {
      document.getElementById('game-selection-modal').classList.remove('show');
    });
    
    document.getElementById('enter-fullscreen').addEventListener('click', enterFullScreenMode);
    document.getElementById('exit-fullscreen').addEventListener('click', exitFullScreenMode);
    
    document.getElementById('change-layout-fs').addEventListener('click', () => {
      exitFullScreenMode();
      gridGames = {}; // Reset selections
      setTimeout(() => openGameSelectionModal(), 100);
    });

    // ESC key to exit
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const container = document.getElementById('fullscreen-container');
        if (container.classList.contains('active')) {
          exitFullScreenMode();
        }
      }
    });

    // Close modal on outside click
    document.getElementById('game-selection-modal').addEventListener('click', (e) => {
      if (e.target.id === 'game-selection-modal') {
        document.getElementById('game-selection-modal').classList.remove('show');
      }
    });

    // ==================== PRESENTATION API FOR TV CASTING ====================

    function initializePresentationAPI() {
      const castBtn = document.getElementById('cast-btn');

      if ('PresentationRequest' in window) {
        // Create presentation request with current page URL
        const presentationUrl = window.location.href;
        presentationRequest = new PresentationRequest([presentationUrl]);

        // Monitor for available presentation displays
        presentationRequest.getAvailability().then(availability => {
          handleAvailabilityChange(availability.value);
          availability.addEventListener('change', () => {
            handleAvailabilityChange(availability.value);
          });
        }).catch(err => {
          console.log('Presentation availability error:', err);
          // Still show button on desktop Chrome/Edge - user can try
          if (navigator.userAgent.includes('Chrome') || navigator.userAgent.includes('Edg')) {
            castBtn.style.display = 'flex';
          }
        });

        // Handle connections from receiver
        presentationRequest.addEventListener('connectionavailable', (event) => {
          handleConnectionAvailable(event.connection);
        });

        console.log('Presentation API initialized');
      } else {
        console.log('Presentation API not supported in this browser');
        castBtn.style.display = 'none';
      }
    }

    function handleAvailabilityChange(available) {
      const castBtn = document.getElementById('cast-btn');
      if (available) {
        castBtn.style.display = 'flex';
        console.log('Presentation displays available');
      } else {
        // Still show on desktop browsers - displays might become available
        if (navigator.userAgent.includes('Chrome') || navigator.userAgent.includes('Edg')) {
          castBtn.style.display = 'flex';
        }
      }
    }

    function startCasting() {
      if (!presentationRequest) {
        alert('Casting is not available in this browser. Please use Chrome or Edge on desktop.');
        return;
      }

      const castBtn = document.getElementById('cast-btn');
      castBtn.disabled = true;
      castBtn.innerHTML = '<span class="cast-icon">üì°</span> Connecting...';

      presentationRequest.start().then(connection => {
        handleConnectionAvailable(connection);
      }).catch(err => {
        console.error('Presentation request failed:', err);
        resetCastButton();
        if (err.name !== 'NotAllowedError') {
          alert('Failed to start casting. Make sure you have a compatible display available.');
        }
      });
    }

    function handleConnectionAvailable(connection) {
      presentationConnection = connection;
      const castBtn = document.getElementById('cast-btn');

      castBtn.classList.add('casting');
      castBtn.innerHTML = '<span class="cast-icon">üì∫</span> Casting...';
      castBtn.disabled = false;

      connection.addEventListener('close', () => {
        console.log('Presentation connection closed');
        resetCastButton();
        presentationConnection = null;
      });

      connection.addEventListener('terminate', () => {
        console.log('Presentation connection terminated');
        resetCastButton();
        presentationConnection = null;
      });

      connection.addEventListener('message', (event) => {
        console.log('Message from receiver:', event.data);
      });

      // Send initial state to the presentation display
      setTimeout(() => {
        sendStateToPresentationDisplay();
      }, 1000);

      console.log('Connected to presentation display');
    }

    function sendStateToPresentationDisplay() {
      if (presentationConnection && presentationConnection.state === 'connected') {
        const state = {
          type: 'ENTER_FULLSCREEN',
          games: gridGames,
          layout: Object.keys(gridGames).length
        };
        try {
          presentationConnection.send(JSON.stringify(state));
        } catch (e) {
          console.log('Could not send state:', e);
        }
      }
    }

    function stopCasting() {
      if (presentationConnection) {
        presentationConnection.terminate();
        presentationConnection = null;
      }
      resetCastButton();
    }

    function resetCastButton() {
      const castBtn = document.getElementById('cast-btn');
      castBtn.classList.remove('casting');
      castBtn.innerHTML = '<span class="cast-icon">üì∫</span> Cast to TV';
      castBtn.disabled = false;
    }

    // Check if this page is running as a presentation receiver
    if (navigator.presentation && navigator.presentation.receiver) {
      navigator.presentation.receiver.connectionList.then(list => {
        list.connections.forEach(connection => {
          connection.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'ENTER_FULLSCREEN' && data.games) {
              gridGames = data.games;
              enterFullScreenMode();
            }
          });
        });

        list.addEventListener('connectionavailable', (event) => {
          event.connection.addEventListener('message', (msgEvent) => {
            const data = JSON.parse(msgEvent.data);
            if (data.type === 'ENTER_FULLSCREEN' && data.games) {
              gridGames = data.games;
              enterFullScreenMode();
            }
          });
        });
      });
    }

    // Cast button click handler
    document.getElementById('cast-btn').addEventListener('click', () => {
      if (presentationConnection && presentationConnection.state === 'connected') {
        stopCasting();
      } else {
        startCasting();
      }
    });

    // Override enterFullScreenMode to also send state to presentation
    const originalEnterFullScreenMode = enterFullScreenMode;
    enterFullScreenMode = function() {
      originalEnterFullScreenMode();
      setTimeout(() => {
        sendStateToPresentationDisplay();
      }, 500);
    };

    // Initialize Presentation API on page load
    initializePresentationAPI();

    // Listen for fullscreen change events to recalculate scaling
    document.addEventListener('fullscreenchange', () => {
      const container = document.getElementById('fullscreen-container');
      if (container && container.classList.contains('active')) {
        setTimeout(() => {
          console.log('üîÑ Fullscreen state changed - recalculating scaling...');
          applyDynamicScaling();
        }, 100);
      }
    });

    // Also handle webkit/moz fullscreen events
    document.addEventListener('webkitfullscreenchange', () => {
      const container = document.getElementById('fullscreen-container');
      if (container && container.classList.contains('active')) {
        setTimeout(() => applyDynamicScaling(), 100);
      }
    });

    document.addEventListener('mozfullscreenchange', () => {
      const container = document.getElementById('fullscreen-container');
      if (container && container.classList.contains('active')) {
        setTimeout(() => applyDynamicScaling(), 100);
      }
    });

  </script>

</body>
</html>

