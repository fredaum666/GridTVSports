<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>⚾ MLB Live Games - GridTV Sports</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚾</text></svg>">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      overflow-x: hidden;
      width: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0a0e1a;
      color: #e0e0e0;
      min-height: 100vh;
      overflow-x: hidden;
      width: 100%;
      max-width: 100vw;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .back-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }

    .sports-bar-btn {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
    }

    .sports-bar-btn:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.5);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 30px;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      border: 1px solid #334155;
    }

    .modal-content h2 {
      margin-bottom: 24px;
      color: #fff;
      font-size: 24px;
      text-align: center;
    }

    .layout-options {
      display: flex;
      gap: 15px;
      margin-bottom: 24px;
      justify-content: center;
    }

    .layout-options label {
      background: #334155;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .layout-options label:hover {
      background: #475569;
      border-color: #17a2b8;
    }

    .layout-options input[type="radio"] {
      margin-right: 8px;
    }

    .layout-options input[type="radio"]:checked + label,
    .layout-options label:has(input[type="radio"]:checked) {
      background: #17a2b8;
      border-color: #17a2b8;
      font-weight: 700;
    }

    /* Grid Preview in Modal */
    .grid-preview {
      margin-bottom: 24px;
      display: grid;
      gap: 15px;
      padding: 20px;
      background: #0a0e1a;
      border-radius: 8px;
      max-height: 500px;
      overflow-y: auto;
    }

    .grid-preview.grid-1 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-3 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-4 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-6 {
      grid-template-columns: repeat(3, 1fr);
    }

    .grid-slot {
      background: #1a1f2e;
      border: 2px solid #334155;
      border-radius: 8px;
      padding: 15px;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .slot-label {
      font-size: 12px;
      font-weight: 700;
      color: #17a2b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .game-selector {
      width: 100%;
      padding: 10px;
      background: #334155;
      color: #fff;
      border: 2px solid #475569;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .game-selector:hover {
      border-color: #17a2b8;
      background: #3d4d63;
    }

    .game-selector:focus {
      outline: none;
      border-color: #17a2b8;
      box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.2);
    }

    .game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
    }

    /* Full Screen Game Selector */
    .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      display: none;
      z-index: 1100;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fs-game-selector {
      width: 100%;
      padding: 8px 12px;
      background: rgba(26, 31, 46, 0.95);
      color: #fff;
      border: 2px solid #17a2b8;
      border-radius: 6px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .fs-game-selector:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }

    .fs-game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
      font-size: 1rem;
    }

    .game-checkboxes {
      margin-bottom: 24px;
      max-height: 400px;
      overflow-y: auto;
    }

    .game-checkbox-item {
      background: #334155;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
    }

    .game-checkbox-item:hover {
      background: #475569;
      border-color: #17a2b8;
    }

    .game-checkbox-item.selected {
      background: #17a2b8;
      border-color: #17a2b8;
    }

    .game-checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .game-checkbox-info {
      flex: 1;
    }

    .game-checkbox-teams {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .game-checkbox-score {
      font-size: 14px;
      color: #94a3b8;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-buttons button {
      padding: 12px 32px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #enter-fullscreen {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
    }

    #enter-fullscreen:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
    }

    #enter-fullscreen:disabled {
      background: #475569;
      cursor: not-allowed;
      opacity: 0.5;
    }

    #cancel-modal {
      background: #64748b;
      color: white;
    }

    #cancel-modal:hover {
      background: #475569;
    }

    .selection-counter {
      text-align: center;
      margin-bottom: 16px;
      font-size: 14px;
      color: #94a3b8;
    }

    .selection-counter.error {
      color: #ef4444;
      font-weight: 700;
    }

    /* Full Screen Container */
    .fullscreen-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #0a0e1a;
      z-index: 99999;
      overflow: hidden;
    }

    .fullscreen-container.active {
      display: flex;
      flex-direction: column;
    }

    /* Hover trigger zone at top of screen */
    .fullscreen-hover-trigger {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 999;
      pointer-events: auto;
    }

    .fullscreen-hover-trigger:hover ~ .fullscreen-controls {
      transform: translateY(0);
    }

    .fullscreen-controls {
      background: rgba(26, 31, 46, 0.95);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #334155;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      transform: translateY(-100%);
      transition: transform 0.3s ease-in-out;
    }

    .fullscreen-controls.visible {
      transform: translateY(0);
    }

    /* Show controls only on hover at top zone or on controls themselves */
    .fullscreen-controls:hover {
      transform: translateY(0);
    }

    .fullscreen-controls button {
      background: #334155;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
    }

    .fullscreen-controls button:hover {
      background: #475569;
    }

    #exit-fullscreen {
      background: #ef4444;
    }

    #exit-fullscreen:hover {
      background: #dc2626;
    }

    .fullscreen-grid {
      flex: 1;
      display: grid;
      gap: clamp(10px, 1.5vh, 20px);
      padding: clamp(10px, 1.5vh, 20px);
      overflow-y: auto;
      overflow-x: hidden;
      height: calc(100vh - 80px);
      box-sizing: border-box;
    }

    .fullscreen-grid.grid-1 {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr;
      place-items: center;
      padding: clamp(20px, 3vh, 40px);
    }

    .fullscreen-grid.grid-1 .fullscreen-game-card {
      max-width: min(900px, 90vw);
      max-height: 90vh;
      width: 100%;
      height: 100%;
    }

    .fullscreen-grid.grid-2 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 1fr;
      gap: clamp(10px, 1.5vw, 20px);
    }

    .fullscreen-grid.grid-2 .fullscreen-game-card {
      height: 100%;
      max-height: calc(100vh - 120px);
    }

    .fullscreen-grid.grid-4 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(8px, 1.2vh, 15px);
    }

    .fullscreen-grid.grid-4 .fullscreen-game-card {
      height: 100%;
      max-height: calc((100vh - 140px) / 2);
    }

    .fullscreen-grid.grid-6 {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(6px, 1vh, 12px);
    }

    .fullscreen-grid.grid-6 .fullscreen-game-card {
      height: 100%;
      max-height: calc((100vh - 150px) / 2);
    }

    .fullscreen-game-card {
      background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
      border-radius: clamp(8px, 1.2vh, 16px);
      padding: clamp(15px, 2.5vh, 30px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      border: 3px solid #334155;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      min-height: fit-content;
      max-width: 100%;
    }

    /* Sport Logo in Top Left */
    .sport-logo-indicator {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 120px;
      height: 120px;
      object-fit: contain;
      opacity: 0.9;
      filter: drop-shadow(0 2px 12px rgba(0, 0, 0, 0.6));
    }

    .fullscreen-game-card.empty-slot {
      border-style: dashed;
      border-color: #475569;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .fullscreen-game-card.empty-slot .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
    }

    .fullscreen-game-card.winning-home {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.winning-away {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.tied {
      border-color: #fbbf24;
      background: linear-gradient(135deg, #1a1f2e 0%, #3a2e1e 100%);
    }

    /* Upcoming game styling */
    .fullscreen-game-card.upcoming-game {
      border-color: #6366f1;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e2a3a 100%);
      opacity: 0.95;
    }

    .fullscreen-game-card.upcoming-game .fullscreen-inning {
      color: #818cf8;
      font-size: 1.8rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .fullscreen-game-card.upcoming-game .fullscreen-score {
      color: #6366f1;
      font-size: 5rem;
      opacity: 0.6;
    }

    .fullscreen-inning {
      font-size: 2rem;
      font-weight: 700;
      color: #17a2b8;
      margin-bottom: 20px;
      text-transform: uppercase;
    }

    .fullscreen-team {
      width: 100%;
      margin-bottom: 15px;
    }

    .fullscreen-team-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .fullscreen-team-logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .fullscreen-team-name {
      font-size: 3.5rem;
      font-weight: 900;
      line-height: 1.1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .fullscreen-score {
      font-size: 6rem;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      animation: scoreUpdate 0.5s ease-out;
      min-width: fit-content;
      flex-shrink: 0;
    }

    @keyframes scoreUpdate {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); color: #22c55e; }
      100% { transform: scale(1); }
    }

    .fullscreen-team.winning .fullscreen-team-name {
      color: #22c55e;
    }

    .fullscreen-team.losing .fullscreen-team-name {
      color: #ef4444;
    }

    .fullscreen-vs {
      font-size: 2rem;
      color: #64748b;
      margin: 10px 0;
      font-weight: 700;
    }

    .fullscreen-possession {
      display: inline-block;
      width: 30px;
      height: 30px;
      background: #fbbf24;
      border-radius: 50%;
      margin-left: 10px;
      animation: possessionBlink 1s infinite;
    }

    @keyframes possessionBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .fullscreen-Outs-distance {
      font-size: 2.8rem;
      color: #94a3b8;
      margin-top: 15px;
      font-weight: 600;
    }

    .fullscreen-field-position {
      font-size: 2rem;
      color: #64748b;
      margin-top: 10px;
    }

    /* MLB Fullscreen Baseball-Specific Styles */
    .fullscreen-game-title {
      font-size: 1.4rem;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .fullscreen-inning.live {
      color: #ef4444;
    }

    .fullscreen-baseball-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }

    .fullscreen-diamond-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
    }

    .fullscreen-count {
      display: flex;
      gap: 14px;
      font-size: 1.5rem;
      font-weight: 600;
      color: #9ca3af;
    }

    .fullscreen-count span {
      letter-spacing: 0.5px;
    }

    .fullscreen-refresh-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      background: #22c55e;
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .fullscreen-refresh-indicator.active {
      opacity: 1;
      animation: pulse 1s;
    }

    /* Play Animations */
    .play-animation {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      z-index: 100;
      pointer-events: none;
      animation: fadeOut 3s forwards;
    }

    .play-animation-icon {
      font-size: 8rem;
      margin-bottom: 20px;
      animation: playIconBounce 0.8s ease-out;
    }

    .play-animation-text {
      font-size: 4rem;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 3px;
      animation: playTextSlide 0.8s ease-out;
    }

    /* Home Run Animation - Yellow/Orange */
    .play-animation.homerun .play-animation-icon {
      color: #fbbf24;
      text-shadow: 0 0 30px #fbbf24, 0 0 60px #fbbf24;
    }

    .play-animation.homerun .play-animation-text {
      background: linear-gradient(90deg, #f97316, #fbbf24, #f97316);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: playTextSlide 0.8s ease-out, gradientShift 2s linear infinite;
    }

    /* Strikeout Animation - Red */
    .play-animation.strikeout .play-animation-icon {
      color: #dc2626;
      text-shadow: 0 0 30px #dc2626, 0 0 60px #dc2626;
    }

    .play-animation.strikeout .play-animation-text {
      color: #dc2626;
      text-shadow: 0 0 20px #dc2626;
    }

    /* Stolen Base Animation - Blue */
    .play-animation.stolenbase .play-animation-icon {
      color: #3b82f6;
      text-shadow: 0 0 30px #3b82f6, 0 0 60px #3b82f6;
    }

    .play-animation.stolenbase .play-animation-text {
      color: #3b82f6;
      text-shadow: 0 0 20px #3b82f6;
    }

    /* Double Play Animation - Purple */
    .play-animation.doubleplay .play-animation-icon {
      color: #a855f7;
      text-shadow: 0 0 30px #a855f7, 0 0 60px #a855f7;
    }

    .play-animation.doubleplay .play-animation-text {
      color: #a855f7;
      text-shadow: 0 0 20px #a855f7;
    }

    /* Grand Slam Animation - Rainbow/Gold */
    .play-animation.grandslam .play-animation-icon {
      color: #ef4444;
      text-shadow: 0 0 30px #ef4444, 0 0 60px #ef4444;
    }

    .play-animation.grandslam .play-animation-text {
      background: linear-gradient(90deg, #ef4444, #fbbf24, #22c55e, #3b82f6);
      background-size: 300% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: playTextSlide 0.8s ease-out, gradientShift 2s linear infinite;
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      70% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes playIconBounce {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
    }

    @keyframes playTextSlide {
      0% { transform: translateY(50px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes gradientShift {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }

    /* ════════════════════════════════════════════════════════════════════════════════
       ███ DESKTOP/TABLET SCREENS (min-width: 769px) ███
       Grid-specific responsive sizing - Only applies to larger screens
       ════════════════════════════════════════════════════════════════════════════════ */
    @media (min-width: 769px) {

    /* Grid-specific responsive sizing */
    /* 6-Grid Layout - Smaller text to fit 3 columns */
    .fullscreen-grid.grid-6 .fullscreen-team-logo {
      width: 45px !important;
      height: 45px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-header {
      gap: 6px !important;
      margin-bottom: 6px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-name {
      font-size: 1.6rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-score {
      font-size: 3rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-inning {
      font-size: 1.2rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-vs {
      font-size: 1rem !important;
      margin: 3px 0 !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-Outs-distance {
      font-size: 1.4rem !important;
      margin-top: 5px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-field-position {
      font-size: 1rem !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-possession {
      width: 16px !important;
      height: 16px !important;
      margin-left: 4px !important;
    }

    .fullscreen-grid.grid-6 .sport-logo-indicator {
      width: 70px !important;
      height: 70px !important;
      top: 10px !important;
      left: 10px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-game-card {
      padding: 15px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-baseball-status {
      gap: 12px !important;
      margin-top: 8px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-diamond-container svg {
      width: 28px !important;
      height: 28px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-count {
      font-size: 1.1rem !important;
      gap: 10px !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-game-title {
      font-size: 1.1rem !important;
    }

    /* 4-Grid Layout - Medium text */
    .fullscreen-grid.grid-4 .fullscreen-team-logo {
      width: 55px !important;
      height: 55px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-header {
      gap: 8px !important;
      margin-bottom: 8px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-name {
      font-size: 1.8rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-score {
      font-size: 3.5rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-inning {
      font-size: 1.3rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-vs {
      font-size: 1.1rem !important;
      margin: 3px 0 !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-Outs-distance {
      font-size: 1.6rem !important;
      margin-top: 6px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-field-position {
      font-size: 1.1rem !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-possession {
      width: 18px !important;
      height: 18px !important;
      margin-left: 5px !important;
    }

    .fullscreen-grid.grid-4 .sport-logo-indicator {
      width: 85px !important;
      height: 85px !important;
      top: 12px !important;
      left: 12px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-game-card {
      padding: 18px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-baseball-status {
      gap: 16px !important;
      margin-top: 12px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-diamond-container svg {
      width: 32px !important;
      height: 32px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-count {
      font-size: 1.3rem !important;
      gap: 12px !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-game-title {
      font-size: 1.3rem !important;
    }

    /* 2-Grid Layout - Keep large text (default) */
    .fullscreen-grid.grid-2 .fullscreen-team-name {
      font-size: 3.5rem !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-score {
      font-size: 6rem !important;
    }

    /* Responsive - Tablets and smaller */
    @media (max-width: 1200px) {
      .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }

      .fullscreen-grid.grid-6 .fullscreen-team-name {
        font-size: 2.5rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-score {
        font-size: 4.5rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-name {
        font-size: 2.5rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-score {
        font-size: 4rem !important;
      }

      /* TV Mode Override - Force 3x2 horizontal layout */
      body.tv-mode .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(3, 1fr) !important;
        grid-template-rows: repeat(2, 1fr) !important;
      }

      body.tv-mode .fullscreen-grid.grid-8 {
        grid-template-columns: repeat(4, 1fr) !important;
        grid-template-rows: repeat(2, 1fr) !important;
      }
    }

    } /* ◄ End @media (min-width: 769px) - Desktop/Tablet grid rules */

    /* ╔══════════════════════════════════════════════════════════════════════════════╗
       ║          FULLSCREEN CARD SIZING CONFIGURATION - MLB PAGE                      ║
       ╠══════════════════════════════════════════════════════════════════════════════╣
       ║  This section controls all element sizes in fullscreen cards.                ║
       ║  Organized by: SCREEN TYPE → GRID LAYOUT → ELEMENT                           ║
       ║                                                                              ║
       ║  SIZE FORMAT: clamp(MIN, PREFERRED, MAX)                                     ║
       ║    - MIN: Smallest the element will ever be                                  ║
       ║    - PREFERRED: Scales with viewport (vw = viewport width)                   ║
       ║    - MAX: Largest the element will ever be                                   ║
       ║                                                                              ║
       ║  ELEMENTS: Team Logo, Team Name, Team Record, Score, League Logo,            ║
       ║            Inning/Status, VS Text, Situation Info                            ║
       ╚══════════════════════════════════════════════════════════════════════════════╝ */

    /* ════════════════════════════════════════════════════════════════════════════════
       ███ MOBILE SCREENS (max-width: 768px) ███
       ════════════════════════════════════════════════════════════════════════════════ */
    @media (max-width: 768px) {
      /* Hide 6 game option on mobile - max 4 games */
      .layout-options label:has(input[value="6"]) {
        display: none;
      }

      /* Grid preview in modal */
      .grid-preview.grid-4,
      .grid-preview.grid-6 {
        grid-template-columns: 1fr;
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 1 - SINGLE GAME                                 │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 1: LAYOUT --- */
      .fullscreen-grid.grid-1 {
        grid-template-columns: 1fr !important;
        grid-template-rows: 1fr !important;
        height: 100dvh !important;
        padding: 10px !important;                 /* ◄ Grid padding */
        gap: 0 !important;                        /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-game-card {
        max-width: 100% !important;
        height: calc(100dvh - 20px) !important;
        padding: 15px !important;                 /* ◄ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 1vh !important;                      /* ◄ Content gap */
      }

      .fullscreen-grid.grid-1 .fullscreen-live-score-header {
        flex-direction: column !important;
        gap: 1vh !important;                      /* ◄ Header gap */
        width: 100% !important;
        align-items: center !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-team-stack {
        flex-direction: row !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        gap: 3vw !important;                      /* ◄ Team stack gap */
      }

      /* --- Grid 1: TEAM LOGO --- */
      .fullscreen-grid.grid-1 .fullscreen-team-logo {
        width: 15vw !important;                   /* ◄ Logo width */
        height: 15vw !important;                  /* ◄ Logo height */
        max-width: 80px !important;               /* ◄ Logo max width */
        max-height: 80px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 1: TEAM NAME --- */
      .fullscreen-grid.grid-1 .fullscreen-live-team-name {
        font-size: clamp(1.5rem, 8vw, 3rem) !important;   /* ◄ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 1: TEAM RECORD --- */
      .fullscreen-grid.grid-1 .fullscreen-team-record {
        font-size: clamp(0.8rem, 3vw, 1.2rem) !important; /* ◄ Record size */
      }

      /* --- Grid 1: SCORE --- */
      .fullscreen-grid.grid-1 .fullscreen-team-score {
        font-size: clamp(3rem, 15vw, 6rem) !important;    /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 1: LEAGUE LOGO --- */
      .fullscreen-grid.grid-1 .sport-logo-indicator {
        width: 18vw !important;                   /* ◄ League logo width */
        height: 18vw !important;                  /* ◄ League logo height */
        max-width: 90px !important;               /* ◄ League logo max width */
        max-height: 90px !important;              /* ◄ League logo max height */
        top: 15px !important;                     /* ◄ Position from top */
        left: 15px !important;                    /* ◄ Position from left */
      }

      /* --- Grid 1: INNING/STATUS --- */
      .fullscreen-grid.grid-1 .fullscreen-status-text {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;   /* ◄ Inning/status size */
      }

      .fullscreen-grid.grid-1 .fullscreen-upcoming-status-text {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;   /* ◄ Upcoming status size */
      }

      /* --- Grid 1: VS TEXT --- */
      .fullscreen-grid.grid-1 .fullscreen-vs-divider-live {
        display: block !important;
        font-size: clamp(1.5rem, 6vw, 2.5rem) !important; /* ◄ VS text size */
        color: rgba(255,255,255,0.7) !important;
        margin: 0.5vh 0 !important;
      }

      /* --- Grid 1: SITUATION INFO --- */
      .fullscreen-grid.grid-1 .fullscreen-situation-info {
        font-size: clamp(1rem, 4vw, 1.5rem) !important;   /* ◄ Situation info size */
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 2 - TWO GAMES                                   │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 2: LAYOUT --- */
      .fullscreen-grid.grid-2 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(2, 1fr) !important;
        height: 100dvh !important;
        padding: 8px !important;                  /* ◄ Grid padding */
        gap: 8px !important;                      /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-game-card {
        height: calc((100dvh - 24px) / 2) !important;
        padding: 8px !important;                  /* ◄ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 0.5vh !important;                    /* ◄ Content gap */
      }

      .fullscreen-grid.grid-2 .fullscreen-live-score-header {
        flex-direction: row !important;
        gap: 2vw !important;                      /* ◄ Header gap */
        width: 100% !important;
        align-items: center !important;
        justify-content: center !important;
        flex-wrap: nowrap !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team-stack {
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.3vh !important;                    /* ◄ Team stack gap */
        flex: 0 0 auto !important;
        min-width: 0 !important;
      }

      /* --- Grid 2: TEAM LOGO --- */
      .fullscreen-grid.grid-2 .fullscreen-team-logo {
        width: 14vw !important;                   /* ◄ Logo width */
        height: 14vw !important;                  /* ◄ Logo height */
        max-width: 70px !important;               /* ◄ Logo max width */
        max-height: 70px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 2: TEAM NAME --- */
      .fullscreen-grid.grid-2 .fullscreen-live-team-name {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;   /* ◄ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 2: TEAM RECORD --- */
      .fullscreen-grid.grid-2 .fullscreen-team-record {
        font-size: clamp(0.7rem, 2.5vw, 1rem) !important; /* ◄ Record size */
      }

      /* --- Grid 2: SCORE --- */
      .fullscreen-grid.grid-2 .fullscreen-team-score {
        font-size: clamp(2.5rem, 12vw, 5rem) !important;  /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 2: LEAGUE LOGO --- */
      .fullscreen-grid.grid-2 .sport-logo-indicator {
        width: 12vw !important;                   /* ◄ League logo width */
        height: 12vw !important;                  /* ◄ League logo height */
        max-width: 60px !important;               /* ◄ League logo max width */
        max-height: 60px !important;              /* ◄ League logo max height */
        top: 8px !important;                      /* ◄ Position from top */
        left: 8px !important;                     /* ◄ Position from left */
      }

      /* --- Grid 2: INNING/STATUS --- */
      .fullscreen-grid.grid-2 .fullscreen-status-text {
        font-size: clamp(1rem, 4.5vw, 1.6rem) !important; /* ◄ Inning/status size */
      }

      .fullscreen-grid.grid-2 .fullscreen-status-container {
        margin-bottom: 0.5vh !important;
      }

      /* --- Grid 2: VS TEXT --- */
      .fullscreen-grid.grid-2 .fullscreen-vs-divider-live {
        font-size: clamp(1rem, 4vw, 1.8rem) !important;   /* ◄ VS text size */
        flex-shrink: 0 !important;
      }

      /* --- Grid 2: SITUATION INFO --- */
      .fullscreen-grid.grid-2 .fullscreen-situation-info {
        font-size: clamp(1.1rem, 4.5vw, 1.6rem) !important; /* ◄ Situation info size */
        margin-top: 0.8vh !important;
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 3 - THREE GAMES                                 │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 3: LAYOUT --- */
      .fullscreen-grid.grid-3 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(3, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;                  /* ◄ Grid padding */
        gap: 6px !important;                      /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-game-card {
        height: calc((100dvh - 24px) / 3) !important;
        padding: 6px !important;                  /* ◄ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 0.3vh !important;                    /* ◄ Content gap */
      }

      .fullscreen-grid.grid-3 .fullscreen-live-score-header {
        flex-direction: row !important;
        gap: 2vw !important;                      /* ◄ Header gap */
        width: 100% !important;
        align-items: center !important;
        justify-content: center !important;
        flex-wrap: nowrap !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-team-stack {
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.2vh !important;                    /* ◄ Team stack gap */
        flex: 0 0 auto !important;
        min-width: 0 !important;
      }

      /* --- Grid 3: TEAM LOGO --- */
      .fullscreen-grid.grid-3 .fullscreen-team-logo {
        width: 10vw !important;                   /* ◄ Logo width */
        height: 10vw !important;                  /* ◄ Logo height */
        max-width: 50px !important;               /* ◄ Logo max width */
        max-height: 50px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 3: TEAM NAME --- */
      .fullscreen-grid.grid-3 .fullscreen-live-team-name {
        font-size: clamp(0.9rem, 4vw, 1.5rem) !important; /* ◄ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 3: TEAM RECORD --- */
      .fullscreen-grid.grid-3 .fullscreen-team-record {
        font-size: clamp(0.5rem, 2vw, 0.8rem) !important; /* ◄ Record size */
      }

      /* --- Grid 3: SCORE --- */
      .fullscreen-grid.grid-3 .fullscreen-team-score {
        font-size: clamp(1.8rem, 9vw, 3.5rem) !important; /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 3: LEAGUE LOGO --- */
      .fullscreen-grid.grid-3 .sport-logo-indicator {
        width: 10vw !important;                   /* ◄ League logo width */
        height: 10vw !important;                  /* ◄ League logo height */
        max-width: 50px !important;               /* ◄ League logo max width */
        max-height: 50px !important;              /* ◄ League logo max height */
        top: 6px !important;                      /* ◄ Position from top */
        left: 6px !important;                     /* ◄ Position from left */
      }

      /* --- Grid 3: INNING/STATUS --- */
      .fullscreen-grid.grid-3 .fullscreen-status-text {
        font-size: clamp(0.8rem, 3.5vw, 1.2rem) !important; /* ◄ Inning/status size */
      }

      .fullscreen-grid.grid-3 .fullscreen-status-container {
        margin-bottom: 0.3vh !important;
      }

      /* --- Grid 3: VS TEXT --- */
      .fullscreen-grid.grid-3 .fullscreen-vs-divider-live {
        font-size: clamp(0.8rem, 3vw, 1.4rem) !important; /* ◄ VS text size */
        flex-shrink: 0 !important;
      }

      /* --- Grid 3: SITUATION INFO --- */
      .fullscreen-grid.grid-3 .fullscreen-situation-info {
        font-size: clamp(0.7rem, 3vw, 1.1rem) !important; /* ◄ Situation info size */
        margin-top: 0.3vh !important;
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 4 - FOUR GAMES                                  │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 4: LAYOUT --- */
      .fullscreen-grid.grid-4 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(4, 1fr) !important;
        height: 100dvh !important;
        padding: 4px !important;                  /* ◄ Grid padding */
        gap: 4px !important;                      /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-game-card {
        padding: 3px !important;                  /* ◄ Card inner padding */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-stack {
        gap: 1px !important;                      /* ◄ Team stack gap */
        padding: 2px !important;
      }

      /* --- Grid 4: TEAM LOGO --- */
      .fullscreen-grid.grid-4 .fullscreen-team-logo {
        width: 6vw !important;                    /* ◄ Logo width */
        height: 6vw !important;                   /* ◄ Logo height */
        max-width: 30px !important;               /* ◄ Logo max width */
        max-height: 30px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 4: TEAM NAME --- */
      .fullscreen-grid.grid-4 .fullscreen-live-team-name {
        font-size: clamp(0.55rem, 2.5vw, 0.9rem) !important; /* ◄ Team name size */
      }

      /* --- Grid 4: TEAM RECORD --- */
      .fullscreen-grid.grid-4 .fullscreen-team-record {
        font-size: clamp(0.35rem, 1.2vw, 0.55rem) !important; /* ◄ Record size */
      }

      /* --- Grid 4: SCORE --- */
      .fullscreen-grid.grid-4 .fullscreen-team-score {
        font-size: clamp(1rem, 5vw, 1.6rem) !important;   /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 4: LEAGUE LOGO --- */
      .fullscreen-grid.grid-4 .sport-logo-indicator {
        width: 6vw !important;                    /* ◄ League logo width */
        height: 6vw !important;                   /* ◄ League logo height */
        max-width: 28px !important;               /* ◄ League logo max width */
        max-height: 28px !important;              /* ◄ League logo max height */
        top: 3px !important;                      /* ◄ Position from top */
        left: 3px !important;                     /* ◄ Position from left */
      }

      /* --- Grid 4: INNING/STATUS --- */
      .fullscreen-grid.grid-4 .fullscreen-status-text {
        font-size: clamp(0.5rem, 2vw, 0.75rem) !important; /* ◄ Inning/status size */
      }

      /* --- Grid 4: VS TEXT --- */
      .fullscreen-grid.grid-4 .fullscreen-vs-divider,
      .fullscreen-grid.grid-4 .fullscreen-vs-divider-live {
        font-size: clamp(0.5rem, 2vw, 0.8rem) !important; /* ◄ VS text size */
        padding: 0 3px !important;
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 6 - SIX GAMES                                   │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 6: LAYOUT --- */
      .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(2, 1fr) !important;
        grid-template-rows: repeat(3, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;                  /* ◄ Grid padding */
        gap: 6px !important;                      /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-game-card {
        padding: 5px !important;                  /* ◄ Card inner padding */
        overflow: hidden !important;
      }

      /* --- Grid 6: TEAM LOGO --- */
      .fullscreen-grid.grid-6 .fullscreen-team-logo {
        width: 7vw !important;                    /* ◄ Logo width */
        height: 7vw !important;                   /* ◄ Logo height */
        max-width: 35px !important;               /* ◄ Logo max width */
        max-height: 35px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 6: TEAM NAME --- */
      .fullscreen-grid.grid-6 .fullscreen-live-team-name {
        font-size: clamp(0.6rem, 3vw, 1rem) !important;   /* ◄ Team name size */
      }

      /* --- Grid 6: TEAM RECORD --- */
      .fullscreen-grid.grid-6 .fullscreen-team-record {
        font-size: clamp(0.4rem, 1.5vw, 0.7rem) !important; /* ◄ Record size */
      }

      /* --- Grid 6: SCORE --- */
      .fullscreen-grid.grid-6 .fullscreen-team-score {
        font-size: clamp(1.2rem, 6vw, 2rem) !important;   /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 6: LEAGUE LOGO --- */
      .fullscreen-grid.grid-6 .sport-logo-indicator {
        width: 6vw !important;                    /* ◄ League logo width */
        height: 6vw !important;                   /* ◄ League logo height */
        max-width: 28px !important;               /* ◄ League logo max width */
        max-height: 28px !important;              /* ◄ League logo max height */
      }

      /* --- Grid 6: INNING/STATUS --- */
      .fullscreen-grid.grid-6 .fullscreen-status-text {
        font-size: clamp(0.6rem, 2.5vw, 0.9rem) !important; /* ◄ Inning/status size */
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         GRID 8 - EIGHT GAMES                                 │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* --- Grid 8: LAYOUT --- */
      .fullscreen-grid.grid-8 {
        grid-template-columns: repeat(2, 1fr) !important;
        grid-template-rows: repeat(4, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;                  /* ◄ Grid padding */
        gap: 6px !important;                      /* ◄ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-8 .fullscreen-game-card {
        padding: 5px !important;                  /* ◄ Card inner padding */
        overflow: hidden !important;
      }

      /* --- Grid 8: TEAM LOGO --- */
      .fullscreen-grid.grid-8 .fullscreen-team-logo {
        width: 7vw !important;                    /* ◄ Logo width */
        height: 7vw !important;                   /* ◄ Logo height */
        max-width: 35px !important;               /* ◄ Logo max width */
        max-height: 35px !important;              /* ◄ Logo max height */
      }

      /* --- Grid 8: TEAM NAME --- */
      .fullscreen-grid.grid-8 .fullscreen-live-team-name {
        font-size: clamp(0.6rem, 3vw, 1rem) !important;   /* ◄ Team name size */
      }

      /* --- Grid 8: TEAM RECORD --- */
      .fullscreen-grid.grid-8 .fullscreen-team-record {
        font-size: clamp(0.4rem, 1.5vw, 0.7rem) !important; /* ◄ Record size */
      }

      /* --- Grid 8: SCORE --- */
      .fullscreen-grid.grid-8 .fullscreen-team-score {
        font-size: clamp(1.2rem, 6vw, 2rem) !important;   /* ◄ Score size */
        min-width: auto !important;
      }

      /* --- Grid 8: LEAGUE LOGO --- */
      .fullscreen-grid.grid-8 .sport-logo-indicator {
        width: 6vw !important;                    /* ◄ League logo width */
        height: 6vw !important;                   /* ◄ League logo height */
        max-width: 28px !important;               /* ◄ League logo max width */
        max-height: 28px !important;              /* ◄ League logo max height */
      }

      /* --- Grid 8: INNING/STATUS --- */
      .fullscreen-grid.grid-8 .fullscreen-status-text {
        font-size: clamp(0.6rem, 2.5vw, 0.9rem) !important; /* ◄ Inning/status size */
      }

      /* ┌──────────────────────────────────────────────────────────────────────────────┐
         │                         COMMON MOBILE STYLES                                 │
         └──────────────────────────────────────────────────────────────────────────────┘ */

      /* Game selector - responsive sizing for mobile (hidden by default, shown on tap) */
      .fs-game-selector-container {
        padding: 4px !important;
        margin-bottom: 4px !important;
      }
      .fs-game-selector {
        padding: 4px 8px !important;
        font-size: clamp(10px, 2.5vw, 14px) !important;
        border-radius: 6px !important;
      }
      /* Always show selector on empty slots */
      .fullscreen-game-card.empty-slot .fs-game-selector-container {
        display: block !important;
      }

      /* Common mobile styles */
      .fullscreen-game-card {
        border-radius: 8px !important;
        border-width: 2px !important;
      }
    }

    
                            /* HEIGHT-BASED RESPONSIVE - HORIZONTAL LAYOUT FOR SHORT SCREENS */
    @media (max-height: 900px) {
      .fullscreen-game-card {
        display: grid !important;
        grid-template-columns: 1fr auto 1fr !important;
        grid-template-rows: auto 1fr auto !important;
        padding: clamp(12px, 2vh, 24px) !important;
        gap: clamp(8px, 1.2vh, 14px) clamp(15px, 2.5vw, 30px) !important;
        align-items: center !important;
      }

      .fullscreen-quarter,
      .fullscreen-inning {
        grid-column: 1 / -1 !important;
        grid-row: 1 !important;
        font-size: clamp(15px, 2.5vh, 26px) !important;
        font-weight: 700 !important;
        padding-bottom: clamp(8px, 1.2vh, 12px) !important;
        border-bottom: 2px solid rgba(255, 255, 255, 0.15) !important;
        text-align: center !important;
      }

      .fullscreen-team:nth-of-type(1) {
        grid-column: 1 !important;
        grid-row: 2 !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        gap: clamp(5px, 1vh, 12px) !important;
      }

      .fullscreen-vs {
        grid-column: 2 !important;
        grid-row: 2 !important;
        font-size: clamp(14px, 2vh, 22px) !important;
        font-weight: 600 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        opacity: 0.5 !important;
        padding: 0 clamp(8px, 1.5vw, 20px) !important;
      }

      .fullscreen-team:nth-of-type(2) {
        grid-column: 3 !important;
        grid-row: 2 !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        gap: clamp(5px, 1vh, 12px) !important;
      }

      .fullscreen-team-header {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        justify-content: center !important;
        flex-wrap: wrap !important;
        gap: clamp(6px, 1vh, 10px) !important;
        margin-bottom: clamp(4px, 0.6vh, 8px) !important;
        width: 100% !important;
      }

      .fullscreen-team-record {
        font-size: clamp(11px, 1.6vh, 16px) !important;
        font-weight: 500 !important;
        opacity: 0.7 !important;
        width: 100% !important;
        text-align: center !important;
        order: -1 !important;
      }

      .fullscreen-team-logo {
        width: clamp(40px, 7vh, 70px) !important;
        height: clamp(40px, 7vh, 70px) !important;
        flex-shrink: 0 !important;
      }

      .fullscreen-team-name {
        font-size: clamp(16px, 3vh, 30px) !important;
        font-weight: 700 !important;
        text-align: center !important;
        line-height: 1.2 !important;
        display: inline-block !important;
        max-width: 100% !important;
        visibility: visible !important;
      }

      .fullscreen-possession {
        font-size: clamp(14px, 2.5vh, 24px) !important;
        margin-left: 6px !important;
        display: inline !important;
        visibility: visible !important;
      }

      .fullscreen-timeouts {
        display: flex !important;
        gap: clamp(5px, 0.8vh, 10px) !important;
        justify-content: center !important;
        width: 100% !important;
        margin: clamp(4px, 0.6vh, 8px) 0 !important;
      }

      .timeout-bar {
        width: clamp(20px, 3.5vh, 32px) !important;
        height: clamp(6px, 1vh, 10px) !important;
        border-radius: 2px !important;
      }

      .fullscreen-score {
        font-size: clamp(48px, 9vh, 90px) !important;
        font-weight: 800 !important;
        line-height: 1 !important;
        width: 100% !important;
        text-align: center !important;
        margin-top: clamp(6px, 1vh, 12px) !important;
      }

      .sport-logo-indicator {
        width: clamp(50px, 8vh, 80px) !important;
        height: clamp(50px, 8vh, 80px) !important;
        top: clamp(10px, 1.5vh, 18px) !important;
        left: clamp(10px, 1.5vh, 18px) !important;
      }

      .fullscreen-down-distance {
        grid-column: 1 / -1 !important;
        grid-row: 3 !important;
        padding-top: clamp(10px, 1.5vh, 14px) !important;
        border-top: 2px solid rgba(255, 255, 255, 0.15) !important;
        font-size: clamp(12px, 1.8vh, 18px) !important;
        font-weight: 600 !important;
        text-align: center !important;
      }

      /* TV Mode Override - Force 3x2 horizontal layout even on mobile viewport */
      body.tv-mode .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(3, 1fr) !important;
        grid-template-rows: repeat(2, 1fr) !important;
      }

      body.tv-mode .fullscreen-grid.grid-8 {
        grid-template-columns: repeat(4, 1fr) !important;
        grid-template-rows: repeat(2, 1fr) !important;
      }
    }

    /* Main Container */
    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Live Games List - Full Width Emphasis */
    .live-games-panel {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .panel-header {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .auto-refresh-info {
      font-size: 12px;
      color: #9ca3af;
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .refresh-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .refresh-btn:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    
    /* Sort Filter Buttons */
    .sort-filters {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .sort-filter-btn {
      background: var(--bg-tertiary, #334155);
      color: var(--text-secondary, #94a3b8);
      border: 2px solid transparent;
      padding: 6px 14px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .sort-filter-btn:hover {
      background: var(--border-hover, #475569);
      color: var(--text-primary, #fff);
    }

    .sort-filter-btn.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border-color: #818cf8;
    }

    .sort-filter-btn svg {
      width: 14px;
      height: 14px;
    }

    @media (max-width: 600px) {
      .sort-filters {
        gap: 6px;
      }

      .sort-filter-btn {
        padding: 5px 10px;
        font-size: 11px;
      }

      .sort-filter-btn svg {
        width: 12px;
        height: 12px;
      }
    }

    /* Games Grid */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(500px, 100%), 1fr));
      gap: 20px;
      padding-right: 8px;
      padding-top: 10px;
      padding-bottom: 40px;
      margin-top: 20px;
      justify-content: center;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    .game-card {
      min-width: 480px;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      overflow: visible;
      min-height: fit-content;
    }

    @media (max-width: 1100px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(480px, 1fr));
      }
      
      .game-card {
        min-width: 0;
      }
      
      .team-logo-large {
        width: 52px !important;
        height: 52px !important;
        display: block !important;
      }
    }

    @media (max-width: 768px) {
      .games-grid {
        grid-template-columns: 1fr;
        padding-left: 0;
        padding-right: 0;
        width: 100%;
      }
      
      .game-card {
        min-width: 0;
      }
    }

    @media (max-width: 600px) {
      .games-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 0;
        width: 100%;
        overflow-x: hidden;
      }
    }

    /* Scrollbar styling */
    .games-grid::-webkit-scrollbar {
      width: 8px;
    }

    .games-grid::-webkit-scrollbar-track {
      background: #0a0e1a;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb:hover {
      background: #2563eb;
    }

    /* Game Card - Prominent Display */
    .game-card {
      background: linear-gradient(135deg, #242b3d 0%, #2d3548 100%);
      border-radius: 12px;
      padding: 0;
      border: 2px solid transparent;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      overflow: visible;
      position: relative;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      min-height: fit-content;
    }

    /* Hover effect removed - cards are static */

    /* Game Start Time Badge for Upcoming Games */
    .game-start-time-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(99, 102, 241, 0.95);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      line-height: 1;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .game-start-date-badge {
      font-size: 0.75rem;
      opacity: 0.95;
    }
    /* Game Title/Series */
    .game-title {
      padding: 12px 20px;
      text-align: center;
      font-size: 13px;
      font-weight: 600;
      color: #9ca3af;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Score Container */
    .score-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 20px;
      gap: 20px;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.4));
    }

    .team-display {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .team-logo-large {
      width: 60px;
      height: 60px;
      object-fit: contain;
      flex-shrink: 0;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      /* Handle broken images - hide alt text overflow */
      overflow: hidden;
      text-indent: -9999px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }

    .team-info-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      gap: 8px;
    }

    .team-abbr {
      display: none; /* Hide abbreviation */
    }

    .team-full-name {
      font-size: 15px;
      font-weight: 600;
      color: #e0e0e0;
      text-align: center;
      line-height: 1.3;
    }

    .team-score {
      font-size: 56px;
      font-weight: 900;
      color: #e0e0e0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      min-width: 80px;
      text-align: center;
    }

    .team-score.winning {
      color: #10b981;
    }

    .score-divider {
      font-size: 40px;
      font-weight: 300;
      color: #64748b;
      margin: 0 12px;
    }

    /* Game Status Row */
    .game-status-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 16px 20px;
      background: rgba(0, 0, 0, 0.3);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .inning-display {
      font-size: 16px;
      font-weight: 600;
      color: #9ca3af;
      min-width: 80px;
      text-align: center;
    }

    .inning-display.live {
      color: #ef4444;
    }

    .diamond-bases {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
    }

    .count-display {
      display: flex;
      gap: 14px;
      font-size: 15px;
      font-weight: 600;
      color: #9ca3af;
      min-width: 140px;
      justify-content: center;
    }

    .count-display span {
      letter-spacing: 0.5px;
    }

    /* Old styles - keep for compatibility but override as needed */
    .team-row {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .team-row:last-of-type {
      border-bottom: none;
    }

    .team-row.winning {
      background: rgba(16, 185, 129, 0.05);
    }

    .team-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .team-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
      flex-shrink: 0;
      /* Handle broken images - hide alt text overflow */
      overflow: hidden;
      text-indent: -9999px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
    }

    .team-name {
      font-weight: 600;
      font-size: 15px;
      color: #e0e0e0;
      min-width: 150px;
    }

    .score-display {
      display: flex;
      align-items: center;
      margin-left: auto;
      padding-right: 16px;
    }

    .score-display .total-score {
      font-size: 28px;
      font-weight: 700;
      color: #e0e0e0;
      min-width: 40px;
      text-align: center;
    }

    .team-row.winning .total-score {
      color: #10b981;
    }

    .game-footer-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
    }

    .live-badge .live-dot {
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    .game-situation {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }

    .inning-clock {
      font-weight: 600;
      color: #e0e0e0;
    }

    .Outs-distance {
      color: #fbbf24;
      font-weight: 600;
      padding: 2px 8px;
      background: rgba(251, 191, 36, 0.1);
      border-radius: 4px;
    }

    .yard-line {
      color: #3b82f6;
      font-weight: 600;
    }

    /* Refresh indicator */
    .refresh-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #10b981;
      animation: pulse 2s infinite;
    }

    @keyframes refreshSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .refresh-indicator.active {
      animation: none;
    }

    .refresh-indicator.active .spin {
      animation: refreshSpin 1s linear;
    }

    /* No Games Message */
    .no-games-message {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
    }

    .no-games-message .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .no-games-message h3 {
      font-size: 20px;
      color: #e0e0e0;
      margin-bottom: 8px;
    }

    .no-games-message p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      backdrop-filter: blur(4px);
      overflow-y: auto;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    /* Game Detail Panel */
    .game-detail-panel {
      background: #1a1f2e;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      margin: 40px auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      animation: slideIn 0.3s ease;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
    }

    .close-detail-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .close-detail-btn:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }

    .detail-matchup {
      display: flex;
      align-items: center;
      justify-content: space-around;
      gap: 20px;
    }

    .detail-team {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .detail-team-logo {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }

    .detail-team-name {
      font-size: 14px;
      font-weight: 700;
      text-align: center;
      line-height: 1.2;
    }

    .detail-team-score {
      font-size: 32px;
      font-weight: 700;
      color: #10b981;
    }

    .detail-vs {
      font-size: 18px;
      color: #6b7280;
      font-weight: 600;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #3b82f6 #1a1f2e;
      position: relative;
    }

    .tabs::-webkit-scrollbar {
      height: 4px;
    }

    .tabs::-webkit-scrollbar-track {
      background: #1a1f2e;
    }

    .tabs::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 2px;
    }

    .tab {
      background: transparent;
      color: #9ca3af;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      border-radius: 8px 8px 0 0;
      position: relative;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .tab:hover {
      background: #242b3d;
      color: #e0e0e0;
    }

    .tab.active {
      background: #3b82f6;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .tab-content.active {
      display: block;
    }

    /* Stats Table */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
      background: #242b3d;
      border-radius: 10px;
      overflow: hidden;
    }

    .stats-table th {
      padding: 12px;
      font-size: 14px;
      font-weight: 600;
      background: #1a1f2e;
    }

    .stats-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #1a1f2e;
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    /* Win Probability */
    .win-prob-container {
      margin-top: 20px;
    }

    .prob-bar-container {
      display: flex;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .prob-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      transition: width 0.5s ease;
    }

    .prob-bar.away {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
    }

    .prob-bar.home {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    }

    .prob-legend {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #9ca3af;
    }

    /* Predictions */
    .prediction-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: #242b3d;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
    }

    .stat-label {
      color: #9ca3af;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
    }

    /* Clickable cards */
    /* Responsive Design */
    @media (max-width: 1200px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(480px, 1fr));
      }
      
      .team-logo-large {
        width: 56px !important;
        height: 56px !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
    }

    @media (max-width: 900px) {
      .games-grid {
        grid-template-columns: 1fr;
      }
      
      .team-logo-large {
        width: 48px !important;
        height: 48px !important;
        display: block !important;
      }
      
      .team-score {
        font-size: 44px;
        min-width: 70px;
      }
      
      .score-divider {
        font-size: 32px;
      }
      
      .team-full-name {
        font-size: 13px;
      }
      
      .diamond-bases svg {
        width: 32px;
        height: 32px;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 15px 10px;
      }

      .header-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .header h1 {
        font-size: 18px;
        justify-content: center;
      }

      .header h1 img {
        height: 35px !important;
      }

      .live-indicator {
        font-size: 10px;
        padding: 3px 8px;
      }

      .header-content > div {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
      }

      .theme-select {
        min-width: 140px;
        font-size: 12px;
        padding: 8px 12px;
      }

      .back-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 120px;
      }

      .sports-bar-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 140px;
      }
      
      .panel-header {
        font-size: 16px;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .refresh-btn {
        font-size: 12px;
        padding: 6px 12px;
      }
      
      .games-grid {
        grid-template-columns: 1fr;
        gap: 20px;
        padding-right: 0;
        padding-left: 0;
        max-height: none;
        width: 100%;
        overflow-x: hidden;
      }
      
      .game-card {
        padding: 0;
        border-radius: 12px;
        min-height: 200px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .score-container {
        padding: 16px 12px;
        gap: 12px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .team-display {
        gap: 8px;
      }

      .team-logo-large {
        width: 36px !important;
        height: 36px !important;
        display: block !important;
        flex-shrink: 0;
      }
      
      .team-score {
        font-size: 32px;
        min-width: 56px;
      }
      
      .score-divider {
        font-size: 24px;
        margin: 0 6px;
      }
      
      .team-info-block {
        min-width: 90px;
        max-width: 45%;
      }
      
      .team-full-name {
        font-size: 11px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .game-status-row {
        padding: 12px;
        gap: 10px;
        flex-wrap: wrap;
        width: 100%;
        box-sizing: border-box;
      }
      
      .inning-display {
        font-size: 14px;
        min-width: 70px;
      }
      
      .count-display {
        gap: 10px;
        font-size: 13px;
        min-width: 120px;
      }
      
      .diamond-bases svg {
        width: 28px;
        height: 28px;
      }
      
      .game-title {
        font-size: 11px;
        padding: 10px 16px;
      }
      
      .team-row {
        padding: 20px 16px;
        flex-wrap: nowrap;
      }

      .team-info {
        gap: 12px;
        flex-shrink: 1;
        min-width: 0;
      }

      .team-logo {
        width: 28px;
        height: 28px;
        flex-shrink: 0;
      }
      
      .team-name {
        font-size: 12px;
        min-width: 0;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .score-display {
        padding-right: 8px;
      }
      
      .score-display .total-score {
        font-size: 22px;
        min-width: 36px;
        font-weight: 700;
      }

      .game-footer-info {
        padding: 16px;
        flex-wrap: wrap;
        gap: 10px;
        min-height: 50px;
      }

      .live-badge {
        font-size: 10px;
        padding: 5px 10px;
      }
      
      .game-situation {
        flex-direction: row;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        font-size: 10px;
      }
      
      .inning-clock {
        font-size: 10px;
        font-weight: 600;
      }
      
      .Outs-distance,
      .yard-line {
        font-size: 9px;
      }

      /* Modal fixes for mobile */
      .modal-overlay {
        padding: 10px;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 400px) {
      .game-card {
        border-radius: 10px;
      }

      .score-container {
        padding: 12px 8px;
        gap: 10px;
      }

      .team-logo-large {
        width: 32px !important;
        height: 32px !important;
      }

      .team-score {
        font-size: 28px;
        min-width: 48px;
      }

      .score-divider {
        font-size: 20px;
        margin: 0 4px;
      }

      .team-info-block {
        min-width: 80px;
        max-width: 40%;
      }

      .team-full-name {
        font-size: 10px;
      }

      .game-status-row {
        padding: 10px 8px;
        gap: 8px;
      }

      .inning-display {
        font-size: 12px;
        min-width: 60px;
      }

      .live-badge {
        font-size: 8px;
        padding: 3px 6px;
      }

      .game-situation {
        font-size: 9px;
        gap: 6px;
      }
    }

    @media (max-width: 400px) {
      .game-detail-panel {
        margin: 20px auto;
        max-height: 95vh;
        width: calc(100% - 20px);
      }

      .detail-header {
        padding: 16px;
        flex-direction: column;
        gap: 12px;
      }

      .detail-matchup {
        flex-direction: row;
        gap: 8px;
        width: 100%;
        justify-content: space-between;
      }

      .detail-team {
        gap: 4px;
        flex: 1;
      }

      .detail-team-logo {
        width: 40px;
        height: 40px;
      }

      .detail-team-name {
        font-size: 11px;
        max-width: 100px;
      }

      .detail-team-score {
        font-size: 24px;
      }

      .detail-vs {
        font-size: 14px;
        align-self: center;
      }

      .close-detail-btn {
        width: 100%;
        padding: 10px;
      }

      /* Tabs container for mobile */
      .tabs {
        padding: 0 12px;
        gap: 4px;
      }

      .tab {
        padding: 10px 16px;
        font-size: 12px;
        min-width: auto;
      }

      .tab-content {
        padding: 16px;
      }

      /* Stats table responsive */
      .stats-table {
        font-size: 12px;
      }

      .stats-table th,
      .stats-table td {
        padding: 8px 4px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 24px;
      }
    }

    /* ============================================
       ORIENTATION LOCK OVERLAYS
       Mobile (phones) = Portrait only
       Tablet = Landscape only
       ============================================ */

    .orientation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 100000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      box-sizing: border-box;
    }

    .orientation-overlay .rotate-icon {
      font-size: 80px;
      margin-bottom: 30px;
      animation: rotateHint 2s ease-in-out infinite;
    }

    .orientation-overlay h2 {
      color: #ffffff;
      font-size: 28px;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .orientation-overlay p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 18px;
      max-width: 300px;
      line-height: 1.5;
    }

    @keyframes rotateHint {
      0%, 100% {
        transform: rotate(0deg);
      }
      25% {
        transform: rotate(-15deg);
      }
      75% {
        transform: rotate(15deg);
      }
    }

    /* TV Mode - hide orientation overlays */
    body.tv-mode .orientation-overlay {
      display: none !important;
    }

    /* TV Mode - Back to TV Home button */
    .tv-back-btn {
      display: none;
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #6366f1;
      color: white;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .tv-back-btn:hover,
    .tv-back-btn:focus {
      background: #6366f1;
      outline: none;
    }

    body.tv-mode .tv-back-btn {
      display: flex;
    }

    body.tv-mode .back-btn {
      display: none;
    }

    /* ================================ */
    /* TV MODE RESPONSIVE STYLES        */
    /* ================================ */

    /* TV Mode - Optimized grid layout for large screens */
    body.tv-mode .games-grid {
      grid-template-columns: repeat(auto-fill, minmax(clamp(280px, 18vw, 450px), 1fr));
      gap: clamp(15px, 1.5vw, 30px);
      padding: clamp(10px, 2vh, 30px) clamp(15px, 2vw, 40px);
    }

    body.tv-mode .game-card {
      border-radius: clamp(10px, 1vw, 20px);
    }

    body.tv-mode .team-row {
      padding: clamp(12px, 1.5vh, 24px) clamp(12px, 1.2vw, 24px);
    }

    body.tv-mode .team-logo {
      width: clamp(40px, 4vw, 70px);
      height: clamp(40px, 4vw, 70px);
    }

    body.tv-mode .team-name {
      font-size: clamp(14px, 1.3vw, 24px);
    }

    body.tv-mode .team-record {
      font-size: clamp(10px, 0.9vw, 16px);
    }

    body.tv-mode .team-score {
      font-size: clamp(24px, 2.5vw, 48px);
    }

    body.tv-mode .game-status-bar {
      padding: clamp(8px, 1vh, 16px) clamp(12px, 1.2vw, 24px);
    }

    body.tv-mode .game-status-bar .status-text {
      font-size: clamp(12px, 1.1vw, 20px);
    }

    body.tv-mode .game-status-bar .broadcast-info {
      font-size: clamp(11px, 1vw, 18px);
    }

    /* TV Mode - Header adjustments */
    body.tv-mode .games-header {
      padding: clamp(12px, 1.5vh, 24px) clamp(15px, 2vw, 40px);
    }

    body.tv-mode .games-header h1 {
      font-size: clamp(20px, 2vw, 36px);
    }

    body.tv-mode .nav-group button {
      font-size: clamp(14px, 1.2vw, 22px);
      padding: clamp(8px, 1vh, 16px) clamp(14px, 1.4vw, 28px);
    }

    body.tv-mode .nav-group {
      gap: clamp(8px, 0.8vw, 16px);
    }

    body.tv-mode .tv-back-btn {
      font-size: clamp(14px, 1.2vw, 22px);
      padding: clamp(10px, 1vh, 18px) clamp(18px, 1.5vw, 32px);
      border-radius: clamp(8px, 0.8vw, 14px);
    }

    /* TV Mode - 4K specific overrides */
    @media screen and (min-width: 3000px) {
      body.tv-mode .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
        gap: 40px;
        padding: 40px 60px;
      }

      body.tv-mode .game-card {
        border-radius: 24px;
      }

      body.tv-mode .team-logo {
        width: 90px;
        height: 90px;
      }

      body.tv-mode .team-name {
        font-size: 28px;
      }

      body.tv-mode .team-score {
        font-size: 56px;
      }
    }

    /* TV Mode - Fullscreen card optimizations */
    body.tv-mode .fullscreen-container {
      background: #0a0e1a;
    }

    body.tv-mode .fullscreen-game-card {
      border-radius: clamp(16px, 1.5vw, 30px);
    }

    body.tv-mode .fullscreen-team-logo {
      filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
    }

    body.tv-mode .fullscreen-live-team-name {
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
    }

    body.tv-mode .fullscreen-team-score {
      text-shadow: 0 4px 16px rgba(0, 0, 0, 0.8);
    }

    body.tv-mode .fullscreen-status-text,
    body.tv-mode .fullscreen-situation-info {
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.8);
    }

    /* TV Mode - 4K Fullscreen enhancements */
    @media screen and (min-width: 3000px) {
      body.tv-mode .fullscreen-game-card {
        border-radius: 40px;
      }

      body.tv-mode .fullscreen-team-logo {
        filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.6));
      }

      body.tv-mode .sport-logo-indicator {
        width: 100px !important;
        height: 100px !important;
      }
    }

    /* ================================ */
    /* ANDROID TV WEBVIEW VIEWPORT      */
    /* WebView uses CSS pixels (~960x540 for 4K TVs) */
    /* ================================ */
    @media screen and (min-width: 900px) and (max-width: 1100px) and (min-height: 480px) and (max-height: 600px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
        gap: 10px !important;
        padding: 8px 12px !important;
        overflow: hidden !important;
      }
      .game-card { border-radius: 8px !important; overflow: hidden !important; }
      .team-row { padding: 8px 10px !important; }
      .team-logo { width: 32px !important; height: 32px !important; min-width: 32px !important; }
      .team-name { font-size: 12px !important; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; max-width: 80px !important; }
      .team-record { display: none !important; }
      .team-score { font-size: 20px !important; }
      .game-status-bar { padding: 5px 10px !important; }
      .game-status-bar .status-text { font-size: 10px !important; }
      .scoring-breakdown, .inning-scores { display: none !important; }
      .games-header { padding: 8px 12px !important; }
      .games-header h1 { font-size: 16px !important; }
      .tv-back-btn { font-size: 11px !important; padding: 6px 12px !important; }
      .fullscreen-container { padding: 0 !important; overflow: hidden !important; }
      .fullscreen-game-card { border-radius: 6px !important; padding: 8px !important; overflow: hidden !important; }
      .fullscreen-teams { gap: 5px !important; overflow: hidden !important; }
      .fullscreen-team { gap: 3px !important; overflow: hidden !important; }
      .fullscreen-team-logo { width: 28px !important; height: 28px !important; min-width: 28px !important; }
      .fullscreen-live-team-name, .fullscreen-team-name { font-size: 0.75rem !important; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; max-width: 60px !important; }
      .fullscreen-team-score, .fullscreen-score { font-size: 1.8rem !important; }
      .fullscreen-team-record { display: none !important; }
      .fullscreen-status-text, .fullscreen-inning { font-size: 0.7rem !important; padding: 3px 8px !important; }
      .fullscreen-vs { font-size: 0.7rem !important; margin: 2px 0 !important; }
      .sport-logo-indicator { width: 24px !important; height: 24px !important; top: 4px !important; left: 4px !important; }
    }

    /* Mobile phones in landscape - show "rotate to portrait" overlay */
    /* Targets phones: landscape orientation with height under 600px (phone screens) */
    @media screen and (orientation: landscape) and (max-height: 600px) {
      body:not(.tv-mode) .orientation-overlay.portrait-required {
        display: flex !important;
      }
    }

    /* Tablets in portrait - show "rotate to landscape" overlay */
    /* Targets tablets (min-width 600px in portrait mode) */
    @media screen and (min-width: 600px) and (max-width: 1024px) and (orientation: portrait) {
      body:not(.tv-mode) .orientation-overlay.landscape-required {
        display: flex !important;
      }
    }

    /* Also catch larger tablets in portrait */
    @media screen and (min-width: 768px) and (max-width: 1366px) and (orientation: portrait) and (min-height: 900px) {
      body:not(.tv-mode) .orientation-overlay.landscape-required {
        display: flex !important;
      }
    }

    /* Fullscreen mode orientation overlay - for mobile phones in portrait */
    .fullscreen-orientation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 100001;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      box-sizing: border-box;
    }

    .fullscreen-orientation-overlay .rotate-icon {
      font-size: 80px;
      margin-bottom: 30px;
      animation: rotateHint 2s ease-in-out infinite;
    }

    .fullscreen-orientation-overlay h2 {
      color: #ffffff;
      font-size: 28px;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .fullscreen-orientation-overlay p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 18px;
      max-width: 300px;
      line-height: 1.5;
    }

    /* Show fullscreen orientation overlay on mobile phones in landscape when fullscreen is active */
    @media screen and (orientation: landscape) and (max-height: 500px) {
      .fullscreen-container.active .fullscreen-orientation-overlay {
        display: flex !important;
      }
    }
  </style>
  <!-- <link rel="stylesheet" href="/styles/themes.css"> -->
  <link rel="stylesheet" href="/styles/mobile-fullscreen.css">
  <!-- <script src="/scripts/theme-manager.js"></script> -->
  <link rel="stylesheet" href="/styles/responsive-grid.css?v=1761528533781">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  </head>
<body>
  <script>
    // Detect TV mode from URL parameter or user agent
    // Also store TV session token for authenticated API calls
    window.tvSessionToken = null;
    window.isTVMode = false;

    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const isTV = urlParams.get('tv') === '1' ||
                   navigator.userAgent.includes('AndroidTV') ||
                   navigator.userAgent.includes('GoogleTV') ||
                   navigator.userAgent.includes('FireTV') ||
                   navigator.userAgent.includes('BRAVIA') ||
                   navigator.userAgent.includes('SmartTV') ||
                   navigator.userAgent.includes('Web0S') ||
                   navigator.userAgent.includes('Tizen') ||
                   navigator.userAgent.includes('GridTVSports-AndroidTV');

      // Store TV session token for API authentication
      window.tvSessionToken = urlParams.get('tvSession') || localStorage.getItem('gridtv_session_token');
      window.isTVMode = isTV;

      if (isTV) {
        document.body.classList.add('tv-mode');

        // Add keyboard handler for TV mode - Back/Escape goes to TV home
        document.addEventListener('keydown', (e) => {
          // Only handle if not in fullscreen mode and not in a modal
          const fullscreenContainer = document.getElementById('fullscreen-container');
          const gameModal = document.getElementById('game-selection-modal');

          const isFullscreenActive = fullscreenContainer && fullscreenContainer.classList.contains('active');
          const isGameModalOpen = gameModal && gameModal.classList.contains('show');

          if (!isFullscreenActive && !isGameModalOpen) {
            if (e.key === 'Escape' || e.key === 'Backspace' || e.keyCode === 27 || e.keyCode === 8) {
              e.preventDefault();
              window.location.href = '/tv-home?menu=1';
            }
          }
        });
      }
    })();

    // TV-aware fetch wrapper - adds authentication header for TV mode
    window.tvFetch = function(url, options = {}) {
      if (window.isTVMode && window.tvSessionToken) {
        options.headers = options.headers || {};
        options.headers['x-tv-session'] = window.tvSessionToken;
      }
      return fetch(url, options);
    };
  </script>
  <!-- Orientation Lock Overlays -->
  <div class="orientation-overlay portrait-required">
    <div class="rotate-icon">📱</div>
    <h2>Please Rotate Your Device</h2>
    <p>This app works best in portrait mode on mobile phones</p>
  </div>
  <div class="orientation-overlay landscape-required">
    <div class="rotate-icon">📱</div>
    <h2>Please Rotate Your Device</h2>
    <p>This app works best in landscape mode on tablets</p>
  </div>

  <div class="header">
    <div class="header-content">
      <h1 style="display: flex; align-items: center; gap: 15px;">
        <img src="/assets/MLB-Logo.png" alt="MLB" style="height: 50px; width: auto; object-fit: contain;">
        MLB Live Games
        <span class="live-indicator">
          <span class="live-dot"></span>
          LIVE
        </span>
      </h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button class="sports-bar-btn" id="sports-bar-btn">
          📺 Sports Bar Mode
        </button>
        <button class="back-btn" onclick="window.location.href='/'">
          ← Back to Sports
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Live Games List -->
    <div class="live-games-panel">
      <div class="panel-header">
        <div>
          <span>⚾ All Games</span>
          <div class="auto-refresh-info">
            <span>●</span>
            <span>Auto-refreshing every 15 seconds</span>
          </div>
        </div>
        
        <div style="display: flex; gap: 12px; align-items: center;">
          <div class="sort-filters">
            <button class="sort-filter-btn" id="sort-favorites" title="Sort by Favorites First">
              <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
              <span>Favorites</span>
            </button>
            <button class="sort-filter-btn active" id="sort-time" title="Sort by Game Time">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span>Time</span>
            </button>
          </div>
          <button class="refresh-btn" onclick="manualRefresh()">
            <span>🔄</span>
            <span>Refresh Now</span>
          </button>
        </div>
      </div>
      <div class="games-grid" id="games-list"></div>
    </div>
  </div>

  <!-- Game Detail Modal -->
  <div class="modal-overlay" id="game-detail-modal">
    <div class="game-detail-panel">
      <div class="detail-header">
        <div class="detail-matchup" id="detail-matchup">
          <!-- Will be populated with game info -->
        </div>
        <button class="close-detail-btn" onclick="closeGameDetail()">✕ Close</button>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('boxscore')">📊 Box Score</button>
        <button class="tab" onclick="switchTab('stats')">📈 Game Stats</button>
        <button class="tab" onclick="switchTab('probability')">🎯 Win Probability</button>
        <button class="tab" onclick="switchTab('predictions')">🔮 Predictions</button>
      </div>

      <div class="tab-content active" id="tab-boxscore">
        <div class="loading">Loading box score...</div>
      </div>

      <div class="tab-content" id="tab-stats">
        <div class="loading">Loading game stats...</div>
      </div>

      <div class="tab-content" id="tab-probability">
        <div class="loading">Loading win probability...</div>
      </div>

      <div class="tab-content" id="tab-predictions">
        <div class="loading">Loading predictions...</div>
      </div>
    </div>
  </div>

  <script>
    let refreshInterval = null;
    let liveGames = [];
    let userFavoriteTeams = []; // Store user's favorite team IDs for this league
    let currentSortMode = 'time'; // 'favorites' or 'time' - default to time sort on page load

    // Fetch user's favorite teams
    async function fetchFavoriteTeams() {
      try {
        const response = await tvFetch('/api/favorites');
        if (response.ok) {
          const data = await response.json();
          // Filter for MLB teams and store team IDs
          userFavoriteTeams = (data.favorites || [])
            .filter(f => f.league === 'MLB')
            .map(f => f.team_id);
          console.log('⭐ Loaded favorite teams:', userFavoriteTeams);
        }
      } catch (error) {
        console.log('Could not load favorite teams:', error);
      }
    }

    // Check if a game involves a favorite team
    function gameInvolvesFavorite(game) {
      if (!userFavoriteTeams.length) return false;
      const comp = game.competitions?.[0];
      if (!comp) return false;

      const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
      const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');

      const homeId = homeTeam?.team?.id;
      const awayId = awayTeam?.team?.id;

      // Check if any favorite team is involved
      return userFavoriteTeams.some(favId => {
        const teamId = favId.replace('MLB-', '');
        return teamId === homeId || teamId === awayId;
      });
    }

    // Sort games prioritizing favorites within each category
    function sortByFavorites(games) {
      // If sorting by time, return games sorted by date
      if (currentSortMode === 'time') {
        return games.slice().sort((a, b) => new Date(a.date) - new Date(b.date));
      }
      if (!userFavoriteTeams.length) return games;

      const favoriteGames = games.filter(g => gameInvolvesFavorite(g));
      const otherGames = games.filter(g => !gameInvolvesFavorite(g));

      return [...favoriteGames, ...otherGames];
    }

    // Sort by favorites priority (used for auto-selection in Sports Bar Mode - always prioritizes favorites)
    function sortByFavoritesPriority(games) {
      if (!userFavoriteTeams.length) return games;

      const favoriteGames = games.filter(g => gameInvolvesFavorite(g));
      const otherGames = games.filter(g => !gameInvolvesFavorite(g));

      return [...favoriteGames, ...otherGames];
    }


    // Team data for logos (MLB - 30 teams)
    const teams = [
      { name: "Arizona Diamondbacks", abbreviation: "ARI", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/ari.png" },
      { name: "Atlanta Braves", abbreviation: "ATL", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/atl.png" },
      { name: "Baltimore Orioles", abbreviation: "BAL", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/bal.png" },
      { name: "Boston Red Sox", abbreviation: "BOS", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/bos.png" },
      { name: "Chicago Cubs", abbreviation: "CHC", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/chc.png" },
      { name: "Chicago White Sox", abbreviation: "CWS", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/chw.png" },
      { name: "Cincinnati Reds", abbreviation: "CIN", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/cin.png" },
      { name: "Cleveland Guardians", abbreviation: "CLE", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/cle.png" },
      { name: "Colorado Rockies", abbreviation: "COL", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/col.png" },
      { name: "Detroit Tigers", abbreviation: "DET", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/det.png" },
      { name: "Houston Astros", abbreviation: "HOU", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/hou.png" },
      { name: "Kansas City Royals", abbreviation: "KC", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/kc.png" },
      { name: "Los Angeles Angels", abbreviation: "LAA", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/laa.png" },
      { name: "Los Angeles Dodgers", abbreviation: "LAD", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/lad.png" },
      { name: "Miami Marlins", abbreviation: "MIA", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/mia.png" },
      { name: "Milwaukee Brewers", abbreviation: "MIL", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/mil.png" },
      { name: "Minnesota Twins", abbreviation: "MIN", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/min.png" },
      { name: "New York Mets", abbreviation: "NYM", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/nym.png" },
      { name: "New York Yankees", abbreviation: "NYY", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/nyy.png" },
      { name: "Oakland Athletics", abbreviation: "OAK", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/oak.png" },
      { name: "Philadelphia Phillies", abbreviation: "PHI", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/phi.png" },
      { name: "Pittsburgh Pirates", abbreviation: "PIT", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/pit.png" },
      { name: "San Diego Padres", abbreviation: "SD", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/sd.png" },
      { name: "San Francisco Giants", abbreviation: "SF", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/sf.png" },
      { name: "Seattle Mariners", abbreviation: "SEA", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/sea.png" },
      { name: "St. Louis Cardinals", abbreviation: "STL", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/stl.png" },
      { name: "Tampa Bay Rays", abbreviation: "TB", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/tb.png" },
      { name: "Texas Rangers", abbreviation: "TEX", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/tex.png" },
      { name: "Toronto Blue Jays", abbreviation: "TOR", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/tor.png" },
      { name: "Washington Nationals", abbreviation: "WSH", logo: "https://a.espncdn.com/i/teamlogos/mlb/500/wsh.png" }
    ];

    function getTeamLogo(teamName) {
      const team = teams.find(t => t.name === teamName || t.abbreviation === teamName);
      return team ? team.logo : '';
    }

    async function fetchLiveGames() {
      try {
        console.log(`⚾ Fetching MLB games...`);
        
        // Fetch FULL data from our backend which calls ESPN API
        const response = await tvFetch('/api/mlb/scoreboard');

        // Check for session expiration (401)
        if (response.status === 401) {
          console.log('Session expired, redirecting...');
          window.location.href = window.isTVMode ? '/tv-home' : '/login';
          return;
        }

        if (!response.ok) {
          let errorText = '';
          try {
            const errorData = await response.json();
            errorText = errorData.error || 'Unknown error';
          } catch (e) {
            errorText = await response.text();
          }
          console.error('Backend API error:', response.status, errorText);
          
          // If it's a 500 error, it might be temporary - show a retry message
          if (response.status === 500) {
            throw new Error(`Server error (500). The API might be temporarily unavailable. Retrying in 30 seconds...`);
          } else {
            throw new Error(`Failed to fetch from backend: ${response.status} - ${errorText}`);
          }
        }
        
        const rapidData = await response.json();
        
        console.log('📊 MLB API Full Response:', {
          totalEvents: rapidData.events?.length || 0,
          events: rapidData.events
        });

        // Use the FULL events data from ESPN API
        if (rapidData.events && rapidData.events.length > 0) {
          const allGames = rapidData.events.map(event => {
            // Get competition data
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');
            
            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });

          // CATEGORIZE ALL GAMES
          // Separate games into live, upcoming, and final categories
          let liveGamesList = [];
          let upcomingGamesList = [];
          let finalGamesList = [];

          allGames.forEach(game => {
            const comp = game.competitions[0];
            const isCompleted = comp.status.type.completed;
            const statusState = comp.status.type.state;
            const statusName = comp.status.type.name || '';
            const isFinal = statusName.includes('Final') || statusState === 'post';
            
            // Game is live if status state is 'in' OR if not completed/final and has started playing (period > 0)
            const isLive = statusState === 'in' || (comp.status.period > 0 && !isCompleted && !isFinal);
            
            // Game is upcoming if it's scheduled (pre)
            const isUpcoming = statusState === 'pre';
            const gameTime = new Date(game.date);
            const now = new Date();
            const hoursUntilGame = (gameTime - now) / (1000 * 60 * 60);
            const isWithin36Hours = hoursUntilGame <= 36; // Allow negative values (game time passed but not live yet)

            // Game is "about to start" - scheduled time passed but not live yet (transitioning state)
            const isAboutToStart = !isLive && !isFinal && !isUpcoming && hoursUntilGame <= 0 && hoursUntilGame >= -2;

            // Categorize the game - ensure no games fall through the cracks
            if (isLive) {
              liveGamesList.push(game);
            } else if (isAboutToStart) {
              // Games that should have started but API hasn't marked as live yet
              upcomingGamesList.unshift(game);
            } else if (isUpcoming && isWithin36Hours) {
              upcomingGamesList.push(game);
            } else if (isFinal || isCompleted) {
              finalGamesList.push(game);
            } else if (!isFinal && !isCompleted && isWithin36Hours) {
              // Catch-all for games in unknown status but within time window
              upcomingGamesList.push(game);
            }
          });

          // Combine all games in order: Live -> Upcoming -> Final
          // Apply favorites sorting within each category
          liveGames = [
            ...sortByFavorites(liveGamesList),
            ...sortByFavorites(upcomingGamesList),
            ...sortByFavorites(finalGamesList)
          ];

          console.log(`⚾ Found ${allGames.length} total games:`);
          console.log(`  🔴 ${liveGamesList.length} LIVE`);
          console.log(`  ⏰ ${upcomingGamesList.length} UPCOMING`);
          console.log(`  🏁 ${finalGamesList.length} FINAL`);

        } else {
          liveGames = [];
        }

        // Store in window for Sports Bar Mode
        window.liveGamesData = liveGames;

        renderGamesList();

      } catch (error) {
        console.error('Error fetching games:', error);
        document.getElementById('games-list').innerHTML = `
          <div style="padding: 20px; text-align: center; color: #ef4444;">
            <div style="font-size: 32px; margin-bottom: 12px;">⚠️</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Error Loading Games</div>
            <div style="font-size: 13px; color: #9ca3af; margin-top: 8px; max-width: 400px; margin-left: auto; margin-right: auto; line-height: 1.5;">
              ${error.message}
            </div>
            <button 
              onclick="fetchLiveGames()" 
              style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;"
              onmouseover="this.style.background='#2563eb'" 
              onmouseout="this.style.background='#3b82f6'">
              🔄 Retry Now
            </button>
            <div style="font-size: 11px; color: #6b7280; margin-top: 12px;">
              The page will automatically retry in 30 seconds
            </div>
          </div>
        `;
      }
    }

    function renderGamesList() {
      const container = document.getElementById('games-list');

      if (liveGames.length === 0) {
        container.innerHTML = `
          <div class="no-games-message">
            <div class="icon">🏈</div>
            <h3>No Games Available</h3>
            <p>There are no games to display right now.<br>Check back later!</p>
          </div>
        `;
        return;
      }

      // Build a map of existing cards by game ID
      const existingCards = new Map();
      container.querySelectorAll('.game-card[data-game-id]').forEach(card => {
        const gameId = card.getAttribute('data-game-id');
        if (gameId) existingCards.set(gameId, card);
      });

      // Separate games by status for proper ordering
      const liveGamesList = [];
      const upcomingGamesList = [];
      const finalGamesList = [];
      const liveUpdates = [];

      liveGames.forEach((game, index) => {
        const gameId = game.id;
        const comp = game.competitions[0];
        const statusType = comp.status.type.state;
        const isCompleted = comp.status.type.completed;
        const isFinal = isCompleted || statusType === 'post';
        const isLive = statusType === 'in';
        const isPregame = statusType === 'pre';

        const existingCard = existingCards.get(gameId);
        const existingStatus = existingCard?.dataset?.status;
        const currentStatus = isFinal ? 'post' : (isLive ? 'in' : 'pre');

        // If card exists and is final AND was created as final, keep it in place (never update final games)
        if (existingCard && isFinal && existingStatus === 'post') {
          finalGamesList.push({ game, existingCard });
          existingCards.delete(gameId);
          return;
        }

        // If card exists and is live AND was created as live, queue it for update after repositioning
        if (existingCard && isLive && existingStatus === 'in') {
          liveGamesList.push({ game, existingCard });
          liveUpdates.push({ card: existingCard, game });
          existingCards.delete(gameId);
          return;
        }

        // If card exists but status changed (pre->in, pre->post, in->post), recreate it
        if (existingCard) {
          existingCard.remove();
        }

        // Create new card for new games or status changes
        const newCard = createGameCardElement(game, index);
        if (isLive) {
          liveGamesList.push({ game, newCard });
        } else if (isPregame) {
          upcomingGamesList.push({ game, newCard });
        } else if (isFinal) {
          finalGamesList.push({ game, newCard });
        }
      });

      // Rebuild container in order: Live -> Upcoming -> Final
      const fragment = document.createDocumentFragment();

      liveGamesList.forEach(({ newCard, existingCard }) => {
        const card = newCard || existingCard;
        fragment.appendChild(card);
      });

      upcomingGamesList.forEach(({ newCard }) => {
        fragment.appendChild(newCard);
      });

      finalGamesList.forEach(({ newCard, existingCard }) => {
        const card = newCard || existingCard;
        fragment.appendChild(card);
      });

      container.innerHTML = '';
      container.appendChild(fragment);

      // Remove cards for games no longer in the list
      existingCards.forEach(card => card.remove());

      // Re-initialize sliders only for newly created cards
      initializeCardSliders();

      // Queue live game updates to happen after cards are repositioned
      liveUpdates.forEach(({ card, game }) => {
        updateLiveGameCard(card, game);
      });
    }

    function updateLiveGameCard(card, game) {
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      // Update scores
      const scoreElements = card.querySelectorAll('.team-score');
      if (scoreElements[0]) {
        scoreElements[0].textContent = awayScore;
        scoreElements[0].className = `team-score ${awayScore > homeScore ? 'winning' : ''}`;
      }
      if (scoreElements[1]) {
        scoreElements[1].textContent = homeScore;
        scoreElements[1].className = `team-score ${homeScore > awayScore ? 'winning' : ''}`;
      }

      // Update team name winning states
      const teamNames = card.querySelectorAll('.team-full-name');
      if (teamNames[0]) teamNames[0].className = `team-full-name ${awayScore > homeScore ? 'winning' : ''}`;
      if (teamNames[1]) teamNames[1].className = `team-full-name ${homeScore > awayScore ? 'winning' : ''}`;

      // Update inning/outs status text
      const inningState = comp.status.type.shortDetail || '';
      const inningDisplay = card.querySelector('.inning-display');
      if (inningDisplay) inningDisplay.textContent = inningState;

      // Update baseball diamond bases if present
      const situation = comp.situation || {};
      const balls = situation.balls || 0;
      const strikes = situation.strikes || 0;
      const outs = situation.outs || 0;
      const onFirst = situation.onFirst || false;
      const onSecond = situation.onSecond || false;
      const onThird = situation.onThird || false;

      const diamondSvg = card.querySelector('.fullscreen-diamond-container svg');
      if (diamondSvg) {
        const rects = diamondSvg.querySelectorAll('rect');
        if (rects[0]) {
          // Second base
          rects[0].setAttribute('fill', onSecond ? '#fbbf24' : 'rgba(255,255,255,0.2)');
        }
        if (rects[1]) {
          // First base
          rects[1].setAttribute('fill', onFirst ? '#fbbf24' : 'rgba(255,255,255,0.2)');
        }
        if (rects[2]) {
          // Third base
          rects[2].setAttribute('fill', onThird ? '#fbbf24' : 'rgba(255,255,255,0.2)');
        }
      }

      // Update count display
      const countDisplay = card.querySelector('.count-display');
      if (countDisplay) {
        const countSpans = countDisplay.querySelectorAll('span');
        if (countSpans[0]) countSpans[0].textContent = `B:${balls}`;
        if (countSpans[1]) countSpans[1].textContent = `S:${strikes}`;
        if (countSpans[2]) countSpans[2].textContent = `O:${outs}`;
      }

      // Update inning line scores on page 2 if present
      const awayLineScores = away.linescores || [];
      const homeLineScores = home.linescores || [];

      const page2 = card.querySelector('.page-2-content');
      if (page2) {
        const scoreCells = page2.querySelectorAll('.score-cell');
        // Away innings (indices 1-9) + total (10)
        if (scoreCells[1]) scoreCells[1].textContent = awayLineScores[0]?.value || 0;
        if (scoreCells[2]) scoreCells[2].textContent = awayLineScores[1]?.value || 0;
        if (scoreCells[3]) scoreCells[3].textContent = awayLineScores[2]?.value || 0;
        if (scoreCells[4]) scoreCells[4].textContent = awayLineScores[3]?.value || 0;
        if (scoreCells[5]) scoreCells[5].textContent = awayLineScores[4]?.value || 0;
        if (scoreCells[6]) scoreCells[6].textContent = awayLineScores[5]?.value || 0;
        if (scoreCells[7]) scoreCells[7].textContent = awayLineScores[6]?.value || 0;
        if (scoreCells[8]) scoreCells[8].textContent = awayLineScores[7]?.value || 0;
        if (scoreCells[9]) scoreCells[9].textContent = awayLineScores[8]?.value || 0;
        if (scoreCells[10]) scoreCells[10].textContent = awayScore;
        // Home innings (indices 12-20) + total (21)
        if (scoreCells[12]) scoreCells[12].textContent = homeLineScores[0]?.value || 0;
        if (scoreCells[13]) scoreCells[13].textContent = homeLineScores[1]?.value || 0;
        if (scoreCells[14]) scoreCells[14].textContent = homeLineScores[2]?.value || 0;
        if (scoreCells[15]) scoreCells[15].textContent = homeLineScores[3]?.value || 0;
        if (scoreCells[16]) scoreCells[16].textContent = homeLineScores[4]?.value || 0;
        if (scoreCells[17]) scoreCells[17].textContent = homeLineScores[5]?.value || 0;
        if (scoreCells[18]) scoreCells[18].textContent = homeLineScores[6]?.value || 0;
        if (scoreCells[19]) scoreCells[19].textContent = homeLineScores[7]?.value || 0;
        if (scoreCells[20]) scoreCells[20].textContent = homeLineScores[8]?.value || 0;
        if (scoreCells[21]) scoreCells[21].textContent = homeScore;
      }
    }

    function createGameCardElement(game, index) {
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      const statusType = comp.status.type.state;
      const statusName = comp.status.type.name;
      const isCompleted = comp.status.type.completed;

      // Simple live detection - trust the status state from ESPN API
      const isLive = statusType === 'in';

      const isFinal = isCompleted || statusType === 'post';
      const isPregame = statusType === 'pre';
      const isUpcoming = isPregame; // Add this for upcoming game detection

      // Get inning scores from linescores
      const awayLineScores = away.linescores || [];
      const homeLineScores = home.linescores || [];

      // Get current inning and inning state
      const inning = comp.status.period || 1;
      const inningState = comp.status.type.shortDetail || '';

      // Get baseball situation data
      const situation = comp.situation || {};
      const balls = situation.balls || 0;
      const strikes = situation.strikes || 0;
      const outs = situation.outs || 0;
      const onFirst = situation.onFirst || false;
      const onSecond = situation.onSecond || false;
      const onThird = situation.onThird || false;

      // Determine inning display (Top/Mid/Bottom/End)
      let inningDisplay = '';
      if (isLive) {
        // Use the shortDetail from ESPN which contains "Top 6th", "Mid 6th", "Bot 6th", etc.
        inningDisplay = inningState;
      } else if (isPregame) {
        inningDisplay = statusName;
      } else if (isFinal) {
        inningDisplay = ''; // Badge already shows FINAL, no need for duplicate text
      }

      // Get game description (e.g., "ALCS Game 7")
      const gameNote = comp.notes?.[0]?.headline || comp.series?.summary || '';

      // Format game start time for upcoming games
      let gameStartTimeBadgeHTML = '';
      if (isPregame && game.date) {
        const gameDate = new Date(game.date);
        const dateStr = gameDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const timeStr = gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        gameStartTimeBadgeHTML = `
          <div class="game-start-time-badge">
            <span class="game-start-date-badge">${dateStr}</span>
            <span>•</span>
            <span>${timeStr}</span>
          </div>
        `;
      }

      // Determine number of pages
      // Upcoming: 1 page
      // Live: 2 pages (live score + inning history)
      // Final: 1 page (final score with inning history combined)
      const numPages = isLive ? 2 : 1;

      // Create card HTML - include data-status to track state transitions
      const cardStatus = isPregame ? 'pre' : (isLive ? 'in' : 'post');
      let cardHtml = `
        <div class="game-card" data-game-id="${game.id}" data-status="${cardStatus}">
          <div class="card-slider-container">
            <div class="card-pages" data-current-page="0">
      `;

      // PAGE 1
      if (isPregame) {
        // Upcoming Game - Page 1 Only
        cardHtml += `
          <div class="card-page">
            <div class="page-1-upcoming">
              ${gameStartTimeBadgeHTML}
              ${gameNote ? `<div class="game-title">${gameNote}</div>` : ''}
              <div class="score-container">
                <div class="team-display away-team">
                  <div class="team-info-block">
                    <img src="${away.team.logo}" alt="${away.team.displayName}" class="team-logo-large" />
                    <div class="team-full-name">${away.team.displayName}</div>
                  </div>
                  <div class="team-score">-</div>
                </div>

                <div class="score-divider">-</div>

                <div class="team-display home-team">
                  <div class="team-score">-</div>
                  <div class="team-info-block">
                    <img src="${home.team.logo}" alt="${home.team.displayName}" class="team-logo-large" />
                    <div class="team-full-name">${home.team.displayName}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (isLive || isFinal) {
        // Live or Final Game - Page 1
        cardHtml += `
          <div class="card-page">
            <div class="page-1-live">
              <div style="text-align: center; margin-bottom: 8px;">
                <div style="display: inline-block; background: ${isLive ? '#ef4444' : '#6b7280'}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 9px; font-weight: 700; text-transform: uppercase;">
                  ${isLive ? '<span style="display: inline-block; width: 5px; height: 5px; background: white; border-radius: 50%; margin-right: 4px; animation: blink 1.5s infinite;"></span>LIVE' : 'FINAL'}
                </div>
                ${inningDisplay ? `<div style="color: #9ca3af; font-size: 10px; margin-top: 3px; font-weight: 600;">${inningDisplay}</div>` : ''}
              </div>

              ${gameNote ? `<div class="game-title">${gameNote}</div>` : ''}

              <div class="score-container">
                <div class="team-display away-team">
                  <div class="team-info-block">
                    <img src="${away.team.logo}" alt="${away.team.displayName}" class="team-logo-large" />
                    <div class="team-full-name ${awayScore > homeScore ? 'winning' : ''}">${away.team.displayName}</div>
                  </div>
                  <div class="team-score ${awayScore > homeScore ? 'winning' : ''}">${awayScore}</div>
                </div>

                <div class="score-divider">-</div>

                <div class="team-display home-team">
                  <div class="team-score ${homeScore > awayScore ? 'winning' : ''}">${homeScore}</div>
                  <div class="team-info-block">
                    <img src="${home.team.logo}" alt="${home.team.displayName}" class="team-logo-large" />
                    <div class="team-full-name ${homeScore > awayScore ? 'winning' : ''}">${home.team.displayName}</div>
                  </div>
                </div>
              </div>

              <div class="game-status-row">
                <div class="inning-display ${isLive ? 'live' : ''}">${inningDisplay}</div>
                ${isLive ? `
                 <div class="fullscreen-diamond-container">
                <svg width="40" height="40" viewBox="0 -8 42 50" style="transform: rotate(45deg);">
                  <!-- Second base (top) -->
                  <rect x="13" y="-4" width="12" height="12" fill="${onSecond ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                  <!-- First base (right) -->
                  <rect x="28" y="20" width="12" height="12" fill="${onFirst ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                  <!-- Third base (left) -->
                  <rect x="0" y="20" width="12" height="12" fill="${onThird ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                </svg>
              </div>
                  <div class="count-display">
                    <span>B:${balls}</span>
                    <span>S:${strikes}</span>
                    <span>O:${outs}</span>
                  </div>
                ` : ''}
              </div>

              ${isFinal ? `
                <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                  <div class="scoring-history-title">Scoring by Inning</div>
                  <div class="innings-grid">
                    <div class="inning-header-cell"></div>
                    <div class="inning-header-cell">1</div>
                    <div class="inning-header-cell">2</div>
                    <div class="inning-header-cell">3</div>
                    <div class="inning-header-cell">4</div>
                    <div class="inning-header-cell">5</div>
                    <div class="inning-header-cell">6</div>
                    <div class="inning-header-cell">7</div>
                    <div class="inning-header-cell">8</div>
                    <div class="inning-header-cell">9</div>
                    <div class="inning-header-cell">T</div>

                    <div class="team-label-cell">${away.team.abbreviation || away.team.shortDisplayName}</div>
                    <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[3] ? '' : 'empty'}">${awayLineScores[3]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[4] ? '' : 'empty'}">${awayLineScores[4]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[5] ? '' : 'empty'}">${awayLineScores[5]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[6] ? '' : 'empty'}">${awayLineScores[6]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[7] ? '' : 'empty'}">${awayLineScores[7]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[8] ? '' : 'empty'}">${awayLineScores[8]?.value || 0}</div>
                    <div class="score-cell total">${awayScore}</div>

                    <div class="team-label-cell">${home.team.abbreviation || home.team.shortDisplayName}</div>
                    <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[3] ? '' : 'empty'}">${homeLineScores[3]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[4] ? '' : 'empty'}">${homeLineScores[4]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[5] ? '' : 'empty'}">${homeLineScores[5]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[6] ? '' : 'empty'}">${homeLineScores[6]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[7] ? '' : 'empty'}">${homeLineScores[7]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[8] ? '' : 'empty'}">${homeLineScores[8]?.value || 0}</div>
                    <div class="score-cell total">${homeScore}</div>
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        `;

        // PAGE 2 - Scoring History (ONLY FOR LIVE GAMES)
        if (isLive) {
          cardHtml += `
            <div class="card-page">
              <div class="page-2-content">
                <div class="scoring-history-header">
                  <img src="${away.team.logo}" alt="${away.team.displayName}" class="scoring-team-logo">
                  <img src="${home.team.logo}" alt="${home.team.displayName}" class="scoring-team-logo">
                </div>

                <div class="scoring-history-title">Scoring by Inning</div>

                <div class="innings-grid">
                  <div class="inning-header-cell"></div>
                  <div class="inning-header-cell">1</div>
                  <div class="inning-header-cell">2</div>
                  <div class="inning-header-cell">3</div>
                  <div class="inning-header-cell">4</div>
                  <div class="inning-header-cell">5</div>
                  <div class="inning-header-cell">6</div>
                  <div class="inning-header-cell">7</div>
                  <div class="inning-header-cell">8</div>
                  <div class="inning-header-cell">9</div>
                  <div class="inning-header-cell">T</div>

                  <div class="team-label-cell">${away.team.abbreviation || away.team.shortDisplayName}</div>
                  <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[3] ? '' : 'empty'}">${awayLineScores[3]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[4] ? '' : 'empty'}">${awayLineScores[4]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[5] ? '' : 'empty'}">${awayLineScores[5]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[6] ? '' : 'empty'}">${awayLineScores[6]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[7] ? '' : 'empty'}">${awayLineScores[7]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[8] ? '' : 'empty'}">${awayLineScores[8]?.value || 0}</div>
                  <div class="score-cell total">${awayScore}</div>

                  <div class="team-label-cell">${home.team.abbreviation || home.team.shortDisplayName}</div>
                  <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[3] ? '' : 'empty'}">${homeLineScores[3]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[4] ? '' : 'empty'}">${homeLineScores[4]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[5] ? '' : 'empty'}">${homeLineScores[5]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[6] ? '' : 'empty'}">${homeLineScores[6]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[7] ? '' : 'empty'}">${homeLineScores[7]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[8] ? '' : 'empty'}">${homeLineScores[8]?.value || 0}</div>
                  <div class="score-cell total">${homeScore}</div>
                </div>
              </div>
            </div>
          `;
        }
      }

      // Close pages container
      cardHtml += `
            </div>

            ${numPages > 1 ? `
              <div class="page-indicators">
                <div class="page-dot active" data-page="0"></div>
                <div class="page-dot" data-page="1"></div>
              </div>
            ` : ''}
          </div>
        </div>
      `;

      // Create a temporary container to parse the HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = cardHtml;
      return tempDiv.firstElementChild;
    }

    async function loadWinProbability(gameId, awayTeam, homeTeam) {
      try {
        console.log('📊 Loading win probability for game:', gameId);
        // Use comprehensive game summary with win probability for every play
        const response = await tvFetch(`/api/nfl/summary/${gameId}`);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch game summary: ${response.status}`);
        }

        const gameSummary = await response.json();
        console.log('📊 Game Summary data:', gameSummary);

        // Get win probability data
        const winProbData = gameSummary.winprobability;
        
        if (!winProbData || winProbData.length === 0) {
          document.getElementById('tab-probability').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Win probability data not yet available
            </div>
          `;
          return;
        }

        // Get latest probability
        const latestProb = winProbData[winProbData.length - 1];
        const awayProb = Math.round((1 - latestProb.homeWinPercentage) * 100);
        const homeProb = Math.round(latestProb.homeWinPercentage * 100);

        document.getElementById('tab-probability').innerHTML = `
          <div class="win-prob-container">
            <h3 style="margin-bottom: 12px; font-size: 16px;">Win Probability Chart</h3>
            <div class="prob-bar-container">
              <div class="prob-bar away" style="width: ${awayProb}%">${awayProb > 15 ? awayProb + '%' : ''}</div>
              <div class="prob-bar home" style="width: ${homeProb}%">${homeProb > 15 ? homeProb + '%' : ''}</div>
            </div>
            <div class="prob-legend">
              <span>${awayTeam}: ${awayProb}%</span>
              <span>${homeTeam}: ${homeProb}%</span>
            </div>
            
            <div style="margin-top: 30px;">
              <canvas id="winProbChart" width="600" height="300" style="max-width: 100%; background: #1a1f2e; border-radius: 8px; padding: 10px;"></canvas>
            </div>
          </div>
        `;
        
        // Draw win probability chart
        const canvas = document.getElementById('winProbChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Chart styling
        const padding = 40;
        const chartWidth = width - 2 * padding;
        const chartHeight = height - 2 * padding;
        
        // Draw grid lines
        ctx.strokeStyle = '#2a3142';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i++) {
          const y = padding + (chartHeight * i / 4);
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(padding + chartWidth, y);
          ctx.stroke();
        }
        
        // Draw 50% line
        ctx.strokeStyle = '#4a5568';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(padding, padding + chartHeight / 2);
        ctx.lineTo(padding + chartWidth, padding + chartHeight / 2);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Draw probability line
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        const step = chartWidth / (winProbData.length - 1);
        
        winProbData.forEach((point, index) => {
          const x = padding + (index * step);
          const y = padding + chartHeight - (point.homeWinPercentage * chartHeight);
          
          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });
        
        ctx.stroke();
        
        // Draw labels
        ctx.fillStyle = '#9ca3af';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('100%', padding - 5, padding + 5);
        ctx.fillText('50%', padding - 5, padding + chartHeight / 2 + 5);
        ctx.fillText('0%', padding - 5, padding + chartHeight + 5);
        
        ctx.textAlign = 'center';
        ctx.fillText('Game Progress →', width / 2, height - 10);
        
        ctx.save();
        ctx.translate(15, height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText(`${homeTeam} Win %`, 0, 0);
        ctx.restore();
        
      } catch (error) {
        console.error('Error loading win probability:', error);
        document.getElementById('tab-probability').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load win probability: ${error.message}
          </div>
        `;
      }
    }

    async function loadGameStats(gameId, awayTeam, homeTeam) {
      try {
        console.log('📊 Loading game stats for:', gameId);
        
        // Fetch comprehensive game summary (includes leaders, team stats, everything)
        const summaryResponse = await tvFetch(`/api/nfl/summary/${gameId}`);
        const gameSummary = await summaryResponse.json();
        
        console.log('NFL Game Summary:', gameSummary);

        // Build stats HTML starting with Team Statistics
        let statsHtml = '';
        
        // Add Team Statistics first
        if (gameSummary.boxscore?.teams && gameSummary.boxscore.teams.length >= 2) {
          const teams = gameSummary.boxscore.teams;
          const awayStats = teams.find(t => t.homeAway === 'away')?.statistics || [];
          const homeStats = teams.find(t => t.homeAway === 'home')?.statistics || [];

          // Check if we have any stats
          if (awayStats.length > 0 && homeStats.length > 0) {
            const keyStats = [
              'firstOutss', 'totalYards', 'netPassingYards', 'completionAttempts',
              'rushingYards', 'rushingAttempts', 'thirdOutsEff', 'fourthOutsEff',
              'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
            ];

            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="background: #242b3d; border-radius: 10px; padding: 20px; margin-bottom: 30px; overflow-x: auto;">
                <table class="stats-table" style="width: 100%;">
                  <thead>
                    <tr>
                      <th style="text-align: left; color: #3b82f6;">${awayTeam}</th>
                      <th style="color: #9ca3af; text-align: center;">STAT</th>
                      <th style="text-align: right; color: #10b981;">${homeTeam}</th>
                    </tr>
                  </thead>
                  <tbody>
            `;

            keyStats.forEach(statName => {
              const awayStat = awayStats.find(s => s.name === statName);
              const homeStat = homeStats.find(s => s.name === statName);

              if (awayStat && homeStat) {
                const awayVal = awayStat.displayValue;
                const homeVal = homeStat.displayValue;
                const label = awayStat.label;

                let awayStyle = '';
                let homeStyle = '';
                if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
                  if (awayStat.value > homeStat.value) {
                    awayStyle = 'font-weight: 700; color: #3b82f6;';
                  } else if (homeStat.value > awayStat.value) {
                    homeStyle = 'font-weight: 700; color: #10b981;';
                  }
                }

                statsHtml += `
                  <tr>
                    <td style="text-align: left; padding: 8px; ${awayStyle}">${awayVal}</td>
                    <td style="color: #9ca3af; font-size: 12px; text-align: center; padding: 8px;">${label}</td>
                    <td style="text-align: right; padding: 8px; ${homeStyle}">${homeVal}</td>
                  </tr>
                `;
              }
            });

            statsHtml += `
                  </tbody>
                </table>
              </div>
            `;
          } else {
            // No team stats available yet
            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
                <div style="font-size: 36px; margin-bottom: 12px;">📊</div>
                <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
              </div>
            `;
          }
        } else {
          // No boxscore data available
          statsHtml += `
            <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
            <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
              <div style="font-size: 36px; margin-bottom: 12px;">📊</div>
              <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
            </div>
          `;
        }
        
        // Add Player Leaders section from game summary
        statsHtml += `<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Player Leaders</h3>`;

        // Use leaders from game summary (gameSummary.leaders)
        // The structure is: [ { team: {...}, leaders: [...] }, { team: {...}, leaders: [...] } ]
        const leadersData = gameSummary.leaders || [];
        
        console.log('🏈 Player Leaders RAW data:', JSON.stringify(leadersData, null, 2));
        console.log('🏈 Leaders array length:', leadersData.length);
        console.log('🏈 Full game summary keys:', Object.keys(gameSummary));

        // Check if we have leaders data and it's not empty
        let hasValidLeaders = false;
        
        if (leadersData && leadersData.length > 0) {
          // Each entry in leadersData is a team with their leaders
          leadersData.forEach((teamData, teamIdx) => {
            const team = teamData.team || {};
            const teamName = team.displayName || team.abbreviation || 'Team';
            const teamColor = team.color || '3b82f6';
            const teamLeaders = teamData.leaders || [];
            
            console.log(`Team ${teamIdx}: ${teamName}, Categories: ${teamLeaders.length}`);
            
            if (teamLeaders.length > 0) {
              // Add team header
              statsHtml += `
                <div style="background: #1a1f2e; padding: 12px 20px; border-radius: 10px 10px 0 0; margin-top: ${teamIdx > 0 ? '20px' : '0'};">
                  <h3 style="font-size: 16px; font-weight: 700; color: #e0e0e0; margin: 0;">${teamName}</h3>
                </div>
              `;
              
              // Process each category (passing, rushing, receiving, etc.)
              teamLeaders.forEach((category, catIdx) => {
                const categoryName = category.displayName || category.name || 'Statistics';
                const leaders = category.leaders || [];
                
                console.log(`  Category: ${categoryName}, Leaders: ${leaders.length}`);

                if (leaders.length > 0) {
                  hasValidLeaders = true;
                  
                  statsHtml += `
                    <div style="background: #242b3d; border-radius: ${catIdx === 0 ? '0' : '0'} ${catIdx === teamLeaders.length - 1 ? '0 0 10px 10px' : '0'}; padding: 16px 20px; ${catIdx < teamLeaders.length - 1 ? 'border-bottom: 1px solid #1a1f2e;' : ''}">
                      <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #9ca3af; text-transform: uppercase;">${categoryName}</h4>
                  `;

                  leaders.forEach((leader, leaderIdx) => {
                    console.log(`    Leader ${leaderIdx}:`, leader);
                    
                    // Extract athlete data
                    const athlete = leader.athlete || {};
                    const athleteName = athlete.displayName || athlete.fullName || athlete.shortName || 'Unknown Player';
                    const position = athlete.position?.abbreviation || '';
                    const displayValue = leader.displayValue || leader.value || 'N/A';
                    const headshot = athlete.headshot?.href || '';

                    console.log(`      Athlete: ${athleteName}, Position: ${position}, Value: ${displayValue}`);

                    // Only add if we have a valid athlete name
                    if (athleteName && athleteName !== 'Unknown Player') {
                      statsHtml += `
                        <div style="display: flex; align-items: center; padding: 10px; background: #1a1f2e; border-radius: 8px; margin-top: ${leaderIdx > 0 ? '8px' : '0'};">
                          ${headshot ? `
                            <img src="${headshot}" alt="${athleteName}" 
                                 style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px;" 
                                 onerror="this.style.display='none'" />
                          ` : `
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #2d3548; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 14px; font-weight: 600; color: #6b7280;">${athleteName.charAt(0)}</div>
                          `}
                          <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; color: #e0e0e0;">${athleteName}</div>
                            <div style="font-size: 11px; color: #9ca3af;">${position}</div>
                          </div>
                          <div style="font-size: 16px; font-weight: 700; color: #10b981;">${displayValue}</div>
                        </div>
                      `;
                    }
                  });

                  statsHtml += `</div>`;
                }
              });
            }
          });
        }
        
        if (!hasValidLeaders) {
          console.log('⚠️ No valid leaders data available');
          statsHtml += `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              <div style="font-size: 48px; margin-bottom: 16px;">📊</div>
              <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Player Statistics Loading...</div>
              <div style="font-size: 14px; color: #6b7280;">Player statistics will appear as the game progresses. Please refresh to see updated stats.</div>
            </div>
          `;
        }

        document.getElementById('tab-stats').innerHTML = statsHtml;
      } catch (error) {
        console.error('Error loading game stats:', error);
        document.getElementById('tab-stats').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">📊</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Statistics Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game statistics are not available at the moment.</div>
          </div>
        `;
      }
    }

    let playsRefreshInterval = null;
    let currentGameId = null;
    let isLiveGame = false;
    let autoPlayMode = true;

    async function loadPlays(gameId) {
      try {
        currentGameId = gameId;
        const response = await tvFetch(`/api/nfl/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch plays');

        const data = await response.json();
        console.log('📊 Plays API response:', data);
        
        // Handle different API response structures
        let plays = [];
        if (data.items && Array.isArray(data.items)) {
          // Generic structure: { items: [...] }
          plays = data.items;
        } else if (data.drives?.previous) {
          // ESPN structure: { drives: { previous: [{ plays: [...] }] } }
          const drives = data.drives.previous || [];
          plays = drives.flatMap(drive => drive.plays || []);
        } else if (Array.isArray(data)) {
          // Direct array of plays
          plays = data;
        }

        if (plays.length === 0) {
          document.getElementById('tab-plays').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              No play-by-play data available yet
            </div>
          `;
          return;
        }

        // Get recent plays (last 30) and REVERSE so latest appears first
        const recentPlays = plays.slice(-30).reverse();

        // Check if this is first load or update
        const isInitialLoad = !window.currentPlays;
        const previousPlayCount = window.currentPlays?.length || 0;
        const newPlayDetected = recentPlays.length > previousPlayCount;

        // Store plays data for animation
        window.currentPlays = recentPlays;

        // Only rebuild HTML on initial load
        if (isInitialLoad) {
          document.getElementById('tab-plays').innerHTML = `
            <div class="field-tracker-container">
              ${isLiveGame ? `
                <div class="live-update-indicator" id="liveIndicator">
                  <span class="live-dot"></span>
                  <span>Live Updates Active</span>
                  <button class="auto-play-toggle" id="autoPlayToggle" onclick="toggleAutoPlay()">
                    Auto-Play: ON
                  </button>
                </div>
              ` : ''}
            </div>
            <div class="plays-list" id="playsList">
            </div>
          `;

          window.currentPlayIndex = 0;
        }

        // Update plays list
        updatePlaysList(recentPlays);

        // ALWAYS show the latest play (first in reversed array) on the field
        if (recentPlays.length > 0) {
          window.currentPlayIndex = 0; // Index 0 is now the latest play (after reverse)
          selectPlay(0, false); // false = don't scroll list
        }

        // Start live refresh if game is live
        if (isLiveGame && !playsRefreshInterval) {
          startLivePlayUpdates();
        }
      } catch (error) {
        console.error('Error loading plays:', error);
        document.getElementById('tab-plays').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load play-by-play data
          </div>
        `;
      }
    }

    function updatePlaysList(plays) {
      const playsList = document.getElementById('playsList');
      if (!playsList) return;

      playsList.innerHTML = plays.map((play, idx) => `
        <div class="play-item ${play.scoringPlay ? 'scoring' : ''}" onclick="selectPlay(${idx}, true)" id="play-${idx}">
          <div class="play-header">
            <span>Q${play.period?.number || '?'} - ${play.clock?.displayValue || ''}</span>
            <span>${play.start?.Outs ? play.start.Outs + ' & ' + play.start.distance : ''}</span>
          </div>
          <div class="play-text">${play.text || 'No description'}</div>
          ${idx === 0 ? '<div class="latest-play-badge">LATEST</div>' : ''}
        </div>
      `).join('');

      // Remove play counter update since we removed the counter element
    }

    function startLivePlayUpdates() {
      if (playsRefreshInterval) return;

      // Refresh plays every 10 seconds during live games
      playsRefreshInterval = setInterval(() => {
        if (currentGameId && isLiveGame) {
          loadPlays(currentGameId);
        }
      }, 10000); // 10 seconds
    }

    function stopLivePlayUpdates() {
      if (playsRefreshInterval) {
        clearInterval(playsRefreshInterval);
        playsRefreshInterval = null;
      }
      window.currentPlays = null;
      window.currentPlayIndex = 0;
    }

    function toggleAutoPlay() {
      autoPlayMode = !autoPlayMode;
      const toggle = document.getElementById('autoPlayToggle');
      if (toggle) {
        toggle.textContent = `Auto-Play: ${autoPlayMode ? 'ON' : 'OFF'}`;
        toggle.style.background = autoPlayMode ? '#10b981' : '#6b7280';
      }
    }

    function selectPlay(index, shouldScroll = true) {
      if (!window.currentPlays || index < 0 || index >= window.currentPlays.length) return;

      window.currentPlayIndex = index;
      const play = window.currentPlays[index];

      // Save current scroll position
      const savedScrollTop = window.pageYOffset || document.documentElement.scrollTop;

      // Highlight selected play in list
      document.querySelectorAll('.play-item').forEach((el, i) => {
        el.style.background = i === index ? 'rgba(59, 130, 246, 0.2)' : '';
        el.style.borderLeft = i === index ? '3px solid #3b82f6' : '';
      });

      // Restore scroll position to prevent unwanted jumping
      window.scrollTo(0, savedScrollTop);

      // Scroll to play in list if requested (only scrolls the play list, not the page)
      if (shouldScroll) {
        const playElement = document.getElementById(`play-${index}`);
        if (playElement) {
          playElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    }

    async function loadBoxScore(gameId, awayTeam, homeTeam) {
      try {
        const response = await tvFetch(`/api/nfl/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch box score');

        const data = await response.json();
        const teams = data.boxscore?.teams || [];

        if (teams.length < 2) {
          document.getElementById('tab-boxscore').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Box score data not yet available
            </div>
          `;
          return;
        }

        // Teams are usually [away, home]
        const awayStats = teams[0].statistics;
        const homeStats = teams[1].statistics;

        // Key stats to display
        const keyStats = [
          'firstOutss', 'totalYards', 'netPassingYards', 'completionAttempts',
          'rushingYards', 'rushingAttempts', 'thirdOutsEff', 'fourthOutsEff',
          'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
        ];

        // Build comparison table
        let statsHtml = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
          <div style="background: #242b3d; border-radius: 10px; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #1a1f2e;">
                  <th style="padding: 12px; text-align: left; font-size: 14px; font-weight: 600; color: #3b82f6;">${awayTeam}</th>
                  <th style="padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #9ca3af;">STAT</th>
                  <th style="padding: 12px; text-align: right; font-size: 14px; font-weight: 600; color: #10b981;">${homeTeam}</th>
                </tr>
              </thead>
              <tbody>
        `;

        keyStats.forEach(statName => {
          const awayStat = awayStats.find(s => s.name === statName);
          const homeStat = homeStats.find(s => s.name === statName);

          if (awayStat && homeStat) {
            const awayVal = awayStat.displayValue;
            const homeVal = homeStat.displayValue;
            const label = awayStat.label;

            // Determine which value is "winning" for highlighting
            let awayStyle = '';
            let homeStyle = '';
            if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
              if (awayStat.value > homeStat.value) {
                awayStyle = 'font-weight: 700; color: #3b82f6;';
              } else if (homeStat.value > awayStat.value) {
                homeStyle = 'font-weight: 700; color: #10b981;';
              }
            }

            statsHtml += `
              <tr style="border-bottom: 1px solid #1a1f2e;">
                <td style="padding: 12px; ${awayStyle}">${awayVal}</td>
                <td style="padding: 12px; text-align: center; font-size: 12px; color: #9ca3af;">${label}</td>
                <td style="padding: 12px; text-align: right; ${homeStyle}">${homeVal}</td>
              </tr>
            `;
          }
        });

        statsHtml += `
              </tbody>
            </table>
          </div>
        `;

        // Add player stats if available
        if (data.boxscore.players && data.boxscore.players.length > 0) {
          statsHtml += `<h3 style="margin: 24px 0 16px; font-size: 18px; font-weight: 700;">Top Performers</h3>`;

          data.boxscore.players.slice(0, 2).forEach((teamData, idx) => {
            const teamName = idx === 0 ? awayTeam : homeTeam;
            const teamColor = idx === 0 ? '#3b82f6' : '#10b981';

            statsHtml += `
              <div style="background: #242b3d; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
                <h4 style="margin-bottom: 12px; color: ${teamColor}; font-size: 16px;">${teamName}</h4>
            `;

            // Passing
            const passing = teamData.statistics.find(cat => cat.name === 'passing');
            if (passing && passing.athletes.length > 0) {
              const qb = passing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Passing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${qb.athlete.displayName}: ${qb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Rushing
            const rushing = teamData.statistics.find(cat => cat.name === 'rushing');
            if (rushing && rushing.athletes.length > 0) {
              const rb = rushing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Rushing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${rb.athlete.displayName}: ${rb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Receiving
            const receiving = teamData.statistics.find(cat => cat.name === 'receiving');
            if (receiving && receiving.athletes.length > 0) {
              const wr = receiving.athletes[0];
              statsHtml += `
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px;">Receiving</div>
                  <div style="color: #9ca3af; font-size: 14px;">${wr.athlete.displayName}: ${wr.stats.join(', ')}</div>
                </div>
              `;
            }

            statsHtml += `</div>`;
          });
        }

        document.getElementById('tab-boxscore').innerHTML = statsHtml;

      } catch (error) {
        console.error('Error loading box score:', error);
        document.getElementById('tab-boxscore').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load box score data
          </div>
        `;
      }
    }

    async function loadPredictions(gameId, awayTeam, homeTeam) {
      try {
        console.log('📊 Loading predictions for game:', gameId, 'Home:', homeTeam, 'Away:', awayTeam);
        
        // Fetch predictor data from ESPN API
        const response = await tvFetch(`/api/nfl/summary/${gameId}`);
        
        if (!response.ok) {
          throw new Error('Predictor data not available');
        }

        const data = await response.json();
        console.log('NFL Predictor response received');

        // Helper function to extract stat values from statistics array
        const getStat = (team, statName) => {
          if (!team || !team.statistics) return null;
          const stat = team.statistics.find(s => s.name === statName);
          return stat ? stat.displayValue : null;
        };

        // Extract prediction information from statistics arrays
        const homeWinProb = getStat(data.homeTeam, 'gameProjection') || 'N/A';
        const awayWinProb = getStat(data.awayTeam, 'gameProjection') || 'N/A';
        const homePointDiff = getStat(data.homeTeam, 'teamPredPtDiff') || 'N/A';
        const awayPointDiff = getStat(data.awayTeam, 'teamPredPtDiff') || 'N/A';
        const matchupQuality = getStat(data.homeTeam, 'matchupQuality') || getStat(data.awayTeam, 'matchupQuality') || 'N/A';
        
        // Additional stats
        const homeChanceLoss = getStat(data.homeTeam, 'teamChanceLoss') || 'N/A';
        const awayChanceLoss = getStat(data.awayTeam, 'teamChanceLoss') || 'N/A';
        const homeOppStrength = getStat(data.homeTeam, 'oppSeasonStrengthRating') || 'N/A';
        const awayOppStrength = getStat(data.awayTeam, 'oppSeasonStrengthRating') || 'N/A';

        document.getElementById('tab-predictions').innerHTML = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Game Predictions</h3>
          <div class="prediction-grid">
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Win Probability</div>
              <div class="stat-value" style="color: #10b981;">${homeWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Win Probability</div>
              <div class="stat-value" style="color: #3b82f6;">${awayWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Point Differential</div>
              <div class="stat-value" style="color: #f59e0b;">${homePointDiff}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Point Differential</div>
              <div class="stat-value" style="color: #8b5cf6;">${awayPointDiff}</div>
            </div>
          </div>
          <div style="margin-top: 24px; padding: 16px; background: #242b3d; border-radius: 10px;">
            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #9ca3af;">Additional Statistics</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${awayTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">
                  ${awayOppStrength}
                </div>
              </div>
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${homeTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #10b981;">
                  ${homeOppStrength}
                </div>
              </div>
            </div>
          </div>
          ${matchupQuality !== 'N/A' ? `
            <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 4px;">
              <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Matchup Quality (0-100 scale)</div>
              <div style="font-size: 16px; font-weight: 600; color: #60a5fa;">${matchupQuality}/100</div>
            </div>
          ` : ''}
        `;
      } catch (error) {
        console.error('Error loading predictions:', error);
        document.getElementById('tab-predictions').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">�</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Predictions Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game prediction data is not available for this game at the moment.</div>
          </div>
        `;
      }
    }

    // Game Detail Modal Functions
    let selectedGame = null;
    let currentActiveTab = 'boxscore';
    let modalRefreshInterval = null;

    function showGameDetail(game) {
      selectedGame = game;
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      // Check if game is live
      const statusState = comp.status.type.state;
      const isLive = statusState === 'in' || comp.status.period > 0;

      // Populate modal header with matchup info
      document.getElementById('detail-matchup').innerHTML = `
        <div class="detail-team">
          <img src="${away.team.logo}" alt="${away.team.displayName}" class="detail-team-logo" />
          <div class="detail-team-name">${away.team.displayName}</div>
          <div class="detail-team-score">${awayScore}</div>
        </div>
        <div class="detail-vs">
          VS
          ${isLive ? '<div class="refresh-indicator" id="modal-refresh-indicator"><span class="spin">🔄</span> Auto-updating</div>' : ''}
        </div>
        <div class="detail-team">
          <img src="${home.team.logo}" alt="${home.team.displayName}" class="detail-team-logo" />
          <div class="detail-team-name">${home.team.displayName}</div>
          <div class="detail-team-score">${homeScore}</div>
        </div>
      `;

      // Show modal
      document.getElementById('game-detail-modal').classList.add('active');

      // Load initial tab content
      loadBoxScore(game.id, away.team.displayName, home.team.displayName);
      loadGameStats(game.id, away.team.displayName, home.team.displayName);
      loadWinProbability(game.id, away.team.displayName, home.team.displayName);
      loadPredictions(game.id, away.team.displayName, home.team.displayName);

      // Start auto-refresh for live games
      if (isLive) {
        console.log('🔴 LIVE GAME - Starting auto-refresh for modal stats');
        startModalRefresh(game.id, away.team.displayName, home.team.displayName);
      } else {
        console.log('⏰ UPCOMING/FINAL GAME - No auto-refresh needed');
        stopModalRefresh();
      }
    }

    function startModalRefresh(gameId, awayTeam, homeTeam) {
      // Clear any existing interval
      stopModalRefresh();
      
      // Refresh every 15 seconds for live games
      modalRefreshInterval = setInterval(() => {
        console.log('🔄 Auto-refreshing modal stats for game:', gameId);
        
        // Show refresh animation
        const indicator = document.getElementById('modal-refresh-indicator');
        if (indicator) {
          indicator.classList.add('active');
          setTimeout(() => indicator.classList.remove('active'), 1000);
        }
        
        // Refresh ALL tabs (not just active one) to keep data fresh
        loadBoxScore(gameId, awayTeam, homeTeam);
        loadGameStats(gameId, awayTeam, homeTeam);
        loadWinProbability(gameId, awayTeam, homeTeam);
        
        // Also update the modal header scores
        updateModalHeader(gameId);
      }, 15000); // 15 seconds
    }

    function stopModalRefresh() {
      if (modalRefreshInterval) {
        clearInterval(modalRefreshInterval);
        modalRefreshInterval = null;
        console.log('⏹️ Stopped modal auto-refresh');
      }
    }

    async function updateModalHeader(gameId) {
      try {
        // Fetch fresh game data from the API
        const response = await tvFetch(`/api/mlb/scoreboard`);
        
        if (!response.ok) {
          console.warn('Failed to fetch updated game data for modal');
          return;
        }
        
        const espnData = await response.json();
        const updatedGame = espnData.events?.find(event => event.id === gameId);
        
        if (!updatedGame) {
          console.warn('Game not found in updated data');
          return;
        }

        const comp = updatedGame.competitions[0];
        const home = comp.competitors.find(c => c.homeAway === 'home');
        const away = comp.competitors.find(c => c.homeAway === 'away');

        // Update scores in the header
        const awayScoreEl = document.querySelector('.detail-team:first-child .detail-team-score');
        const homeScoreEl = document.querySelector('.detail-team:last-child .detail-team-score');
        
        if (awayScoreEl) {
          const newAwayScore = parseInt(away.score) || 0;
          awayScoreEl.textContent = newAwayScore;
          console.log(`✅ Updated away score: ${newAwayScore}`);
        }
        if (homeScoreEl) {
          const newHomeScore = parseInt(home.score) || 0;
          homeScoreEl.textContent = newHomeScore;
          console.log(`✅ Updated home score: ${newHomeScore}`);
        }
      } catch (error) {
        console.error('Error updating modal header:', error);
      }
    }

    function closeGameDetail() {
      document.getElementById('game-detail-modal').classList.remove('active');
      selectedGame = null;
      stopModalRefresh(); // Stop auto-refresh when closing modal
    }

    // Close modal when clicking outside
    document.getElementById('game-detail-modal').addEventListener('click', (e) => {
      if (e.target.id === 'game-detail-modal') {
        closeGameDetail();
      }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
      if (modalRefreshInterval) clearInterval(modalRefreshInterval);
    });

    async function loadBoxScore(gameId, awayTeam, homeTeam) {
      try {
        console.log('📊 Loading box score for game:', gameId);
        
        // Fetch comprehensive game summary with detailed boxscore
        const response = await tvFetch(`/api/nfl-gamesummary/${gameId}`);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch game summary: ${response.status}`);
        }
        
        const gameSummary = await response.json();
        console.log('📊 Game Summary boxscore:', gameSummary.boxscore);
        
        // Use the selectedGame data for basic info
        if (!selectedGame) {
          document.getElementById('tab-boxscore').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Box score data not yet available
            </div>
          `;
          return;
        }

        const comp = selectedGame.competitions[0];
        const home = comp.competitors.find(c => c.homeAway === 'home');
        const away = comp.competitors.find(c => c.homeAway === 'away');
        
        const homeLineScores = home.linescores || [];
        const awayLineScores = away.linescores || [];
        
        // Start building HTML
        let html = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Scoring Summary</h3>
          <div style="background: #242b3d; border-radius: 10px; padding: 20px;">
            <div style="margin-bottom: 20px;">
              <div style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #3b82f6;">${awayTeam}</div>
              <div style="display: flex; gap: 16px; align-items: center;">
                ${awayLineScores.map((score, idx) => `
                  <div style="text-align: center;">
                    <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Q${idx + 1}</div>
                    <div style="font-size: 20px; font-weight: 700;">${score.value}</div>
                  </div>
                `).join('')}
                <div style="text-align: center; margin-left: 16px; padding-left: 16px; border-left: 2px solid #2d3548;">
                  <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Total</div>
                  <div style="font-size: 24px; font-weight: 700; color: #10b981;">${away.score || 0}</div>
                </div>
              </div>
            </div>
            
            <div style="border-top: 1px solid #2d3548; padding-top: 20px;">
              <div style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #10b981;">${homeTeam}</div>
              <div style="display: flex; gap: 16px; align-items: center;">
                ${homeLineScores.map((score, idx) => `
                  <div style="text-align: center;">
                    <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Q${idx + 1}</div>
                    <div style="font-size: 20px; font-weight: 700;">${score.value}</div>
                  </div>
                `).join('')}
                <div style="text-align: center; margin-left: 16px; padding-left: 16px; border-left: 2px solid #2d3548;">
                  <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Total</div>
                  <div style="font-size: 24px; font-weight: 700; color: #10b981;">${home.score || 0}</div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('tab-boxscore').innerHTML = html;
      } catch (error) {
        console.error('Error loading box score:', error);
        document.getElementById('tab-boxscore').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            Error loading box score data
          </div>
        `;
      }
    }

    function switchTab(tabName) {
      // Store the active tab
      currentActiveTab = tabName;

      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    function refreshLiveGames() {
      fetchLiveGames();
    }

    function manualRefresh() {
      console.log('🔄 Manual refresh triggered');
      fetchLiveGames();
      
      // Visual feedback
      const btn = event.target.closest('.refresh-btn');
      const originalBg = btn.style.background;
      btn.style.background = '#059669';
      btn.style.transform = 'rotate(360deg)';
      btn.style.transition = 'transform 0.5s ease';
      
      setTimeout(() => {
        btn.style.background = originalBg;
        btn.style.transform = 'rotate(0deg)';
      }, 500);
    }

    // Initialize - load favorites first, then fetch games
    (async function init() {
      await fetchFavoriteTeams();
      fetchLiveGames();

      // Sort filter button event listeners
      document.getElementById('sort-favorites').addEventListener('click', function() {
        if (currentSortMode !== 'favorites') {
          currentSortMode = 'favorites';
          document.getElementById('sort-favorites').classList.add('active');
          document.getElementById('sort-time').classList.remove('active');
          renderGamesList();
        }
      });

      document.getElementById('sort-time').addEventListener('click', function() {
        if (currentSortMode !== 'time') {
          currentSortMode = 'time';
          document.getElementById('sort-time').classList.add('active');
          document.getElementById('sort-favorites').classList.remove('active');
          renderGamesList();
        }
      });
    })();

    // Auto-refresh every 15 seconds for live updates
    refreshInterval = setInterval(() => {
      console.log('🔄 Auto-refreshing games...');
      fetchLiveGames();
    }, 15000);

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
    });
  </script>

  <!-- Game Selection Modal -->
  <div id="game-selection-modal" class="modal">
    <div class="modal-content">
      <h2>📺 Sports Bar Mode - Select Grid Layout</h2>
      
      <!-- Layout Selection -->
      <div class="layout-options">
        <label>
          <input type="radio" name="layout" value="1"> 1 Game
        </label>
        <label>
          <input type="radio" name="layout" value="2"> 2 Games
        </label>
        <label>
          <input type="radio" name="layout" value="3"> 3 Games
        </label>
        <label>
          <input type="radio" name="layout" value="4" checked> 4 Games
        </label>
        <label>
          <input type="radio" name="layout" value="6"> 6 Games
        </label>
      </div>

      <p style="text-align: center; color: #94a3b8; margin: 20px 0;">
        Select your grid layout, then choose games for each position
      </p>
      
      <!-- Grid Preview with Game Selectors -->
      <div id="grid-preview" class="grid-preview">
        <!-- Dynamically populated with grid slots -->
      </div>
      
      <div class="modal-buttons">
        <button id="enter-fullscreen">Enter Sports Bar Mode</button>
        <button id="cancel-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Full Screen Container -->
  <div id="fullscreen-container" class="fullscreen-container">
    <!-- Fullscreen Orientation Overlay - for mobile phones in landscape -->
    <div class="fullscreen-orientation-overlay">
      <div class="rotate-icon">📱</div>
      <h2>Please Rotate Your Device</h2>
      <p>Sports Bar Mode works best in portrait orientation</p>
    </div>
    <!-- Hover trigger zone at top -->
    <div class="fullscreen-hover-trigger"></div>
    
    <div class="fullscreen-controls" id="fullscreen-controls">
      <button id="change-layout-fs">Change Layout</button>
      <button id="exit-fullscreen">Exit Sports Bar Mode</button>
    </div>
    <div id="fullscreen-grid" class="fullscreen-grid grid-4">
      <!-- Dynamically populated game cards -->
    </div>
  </div>

  <script>
    // ============================================
    // SPORTS BAR MODE - FULL SCREEN FUNCTIONALITY
    // ============================================

    let gridGames = {}; // { 0: gameId, 1: gameId, ... } - Maps slot index to game ID
    let currentLayout = 4;
    let fullscreenRefreshInterval = null;
    let sessionKeepAliveInterval = null; // Keep session alive during fullscreen
    let fullscreenEnteredAt = null; // Timestamp when fullscreen mode was entered - animations only show for plays after this time

    // Open game selection modal
    function openGameSelectionModal() {
      const modal = document.getElementById('game-selection-modal');
      modal.classList.add('show');
      renderGridPreview();
    }

    // Render grid preview with game selectors
    function renderGridPreview() {
      const container = document.getElementById('grid-preview');
      const layout = parseInt(document.querySelector('input[name="layout"]:checked').value);
      currentLayout = layout;
      
      container.innerHTML = '';
      container.className = `grid-preview grid-${layout}`;

      const liveGames = window.liveGamesData || [];
      
      console.log('🎮 Sports Bar Mode - Live games check:', {
        windowData: window.liveGamesData?.length || 0,
        totalGames: liveGames.length
      });
      
      if (liveGames.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; color: #ef4444; padding: 40px; grid-column: 1/-1;">
            ❌ No live games detected<br>
            <span style="font-size: 14px; color: #94a3b8; margin-top: 10px; display: block;">
              If you see games on the main page, try refreshing the page and opening Sports Bar Mode again.
            </span>
          </p>`;
        document.getElementById('enter-fullscreen').disabled = true;
        return;
      }

      for (let i = 0; i < layout; i++) {
        const slot = document.createElement('div');
        slot.className = 'grid-slot';
        slot.innerHTML = `
          <div class="slot-label">Position ${i + 1}</div>
          <select class="game-selector" data-slot="${i}">
            <option value="">-- Select Game --</option>
          </select>
        `;
        container.appendChild(slot);
      }

      updateAllGameSelectors();
      
      // Enable/disable enter button based on selections
      checkAllSlotsSelected();
    }

    // Update all game selectors with available games
    function updateAllGameSelectors() {
      const selectors = document.querySelectorAll('.game-selector');
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now stores game IDs

      selectors.forEach(selector => {
        const slotIndex = parseInt(selector.dataset.slot);
        const currentSelection = gridGames[slotIndex]; // Game ID
        
        // Clear existing options except first
        selector.innerHTML = '<option value="">-- Select Game --</option>';

        liveGames.forEach((game, gameIndex) => {
          const gameId = game.id;
          // Show game if: it's not used OR it's the current selection for this slot
          if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
            const comp = game.competitions?.[0];
            const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
            const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';
            const awayScore = comp?.competitors?.[1]?.score || '0';
            const homeScore = comp?.competitors?.[0]?.score || '0';
            
            // Determine status - LIVE or UPCOMING
            const statusState = comp?.status?.type?.state;
            const isLive = statusState === 'in' || comp?.status?.period > 0;
            const isUpcoming = statusState === 'pre';
            
            let statusLabel;
            if (isUpcoming) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
              statusLabel = `UPCOMING (${hoursUntil}h)`;
            } else if (isLive) {
              const inning = comp?.status?.type?.shortDetail || 'Live';
              statusLabel = `LIVE - ${inning}`;
            } else {
              statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
            }

            const option = document.createElement('option');
            option.value = gameId; // Store game ID instead of index
            option.textContent = `${awayTeam} (${awayScore}) @ ${homeTeam} (${homeScore}) - ${statusLabel}`;
            
            if (currentSelection === gameId) {
              option.selected = true;
            }
            
            selector.appendChild(option);
          }
        });

        // Add change event listener
        selector.removeEventListener('change', handleGameSelection);
        selector.addEventListener('change', handleGameSelection);
      });
    }

    // Handle game selection change
    function handleGameSelection(e) {
      const slotIndex = parseInt(e.target.dataset.slot);
      const gameId = e.target.value === '' ? null : e.target.value; // Now uses game ID string

      if (gameId === null) {
        delete gridGames[slotIndex];
      } else {
        gridGames[slotIndex] = gameId; // Store game ID
      }

      // Update all selectors to reflect new availability
      updateAllGameSelectors();
      checkAllSlotsSelected();
    }

    // Check if all slots have games selected (NOW OPTIONAL - allow empty slots)
    function checkAllSlotsSelected() {
      // Always enable button - allow entering with empty slots
      document.getElementById('enter-fullscreen').disabled = false;
    }

    // Layout change handler
    document.querySelectorAll('input[name="layout"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        gridGames = {}; // Reset selections when layout changes
        renderGridPreview();
      });
    });

    // Enter full screen mode
    function enterFullScreenMode() {
      // No validation - allow empty slots

      const modal = document.getElementById('game-selection-modal');
      const container = document.getElementById('fullscreen-container');
      const controls = document.getElementById('fullscreen-controls');

      // Record when fullscreen mode was entered - only show animations for plays AFTER this time
      fullscreenEnteredAt = Date.now();

      modal.classList.remove('show');
      container.classList.add('active');
      
      // Show controls briefly when entering full screen
      controls.classList.add('visible');
      setTimeout(() => {
        controls.classList.remove('visible');
      }, 3000); // Hide after 3 seconds
      
      renderFullScreenGames();
      
      // Start auto-refresh
      fullscreenRefreshInterval = setInterval(() => {
        updateFullScreenScores();
      }, 15000);

      // Start session keep-alive every 2 minutes to prevent session expiration
      sessionKeepAliveInterval = setInterval(async () => {
        try {
          const response = await tvFetch('/api/auth/check');
          if (!response.ok) {
            console.log('Session expired during fullscreen, redirecting...');
            window.location.href = window.isTVMode ? '/tv-home' : '/login';
          }
        } catch (error) {
          console.error('Session keep-alive failed:', error);
        }
      }, 2 * 60 * 1000); // Every 2 minutes

      // Request browser fullscreen (with safety check)
      try {
        if (container.requestFullscreen) {
          container.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        } else if (container.webkitRequestFullscreen) {
          container.webkitRequestFullscreen();
        } else if (container.msRequestFullscreen) {
          container.msRequestFullscreen();
        }
      } catch (err) {
        console.log('Fullscreen not supported or failed:', err);
      }
    }

    // Render full screen games
    function renderFullScreenGames() {
      const grid = document.getElementById('fullscreen-grid');
      grid.className = `fullscreen-grid grid-${currentLayout}`;
      grid.innerHTML = '';

      const liveGames = window.liveGamesData || [];

      // Render in slot order (0, 1, 2, ...)
      for (let slotIndex = 0; slotIndex < currentLayout; slotIndex++) {
        const gameId = gridGames[slotIndex]; // Now uses game ID
        const game = liveGames.find(g => g.id === gameId); // Find game by ID
        
        if (game) {
          const card = createFullScreenGameCard(game, slotIndex);
          grid.appendChild(card);
        } else {
          // Empty slot - show logo and game selector
          const card = createEmptySlotCard(slotIndex);
          grid.appendChild(card);
        }
      }
    }

    // Create empty slot card with logo
    function createEmptySlotCard(slotIndex) {
      const div = document.createElement('div');
      div.className = 'fullscreen-game-card empty-slot';
      div.dataset.slotIndex = slotIndex;
      
      // Determine logo and text size based on current grid layout
      const logoSize = currentLayout === 6 ? '50%' : currentLayout === 4 ? '55%' : '60%';
      const textSize = currentLayout === 6 ? '1.2rem' : currentLayout === 4 ? '1.4rem' : '1.5rem';
      
      div.innerHTML = `
        <!-- Game Selector DropOuts -->
        <div class="fs-game-selector-container" style="display: block;">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <option value="">-- Select Game --</option>
          </select>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; opacity: 0.6;">
          <img src="/assets/logo.png" alt="GridTV Sports" style="max-width: ${logoSize}; max-height: 35%; object-fit: contain; margin-bottom: 15px;">
          <div style="font-size: ${textSize}; color: #64748b; text-align: center; line-height: 1.4;">
            Select a game above<br>to display
          </div>
        </div>
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      return div;
    }

    // Create full screen game card with game selector
    function createFullScreenGameCard(game, slotIndex) {
      const div = document.createElement('div');
      
      const comp = game.competitions?.[0];
      const awayTeam = comp?.competitors?.[1];
      const homeTeam = comp?.competitors?.[0];
      const awayScore = parseInt(awayTeam?.score || 0);
      const homeScore = parseInt(homeTeam?.score || 0);
      
      // Determine if game is live or upcoming
      const statusState = comp?.status?.type?.state;
      const isLive = statusState === 'in' || comp?.status?.period > 0;
      const isUpcoming = statusState === 'pre';
      const isPregame = isUpcoming;
      const isFinal = comp?.status?.type?.completed;
      
      // Baseball-specific data
      const inning = comp?.status?.period;
      const inningState = comp?.status?.type?.shortDetail; // "Top 6th", "Mid 6th", "Bot 6th"
      const situation = comp?.situation || {};
      const balls = situation.balls || 0;
      const strikes = situation.strikes || 0;
      const outs = situation.outs || 0;
      const onFirst = situation.onFirst || false;
      const onSecond = situation.onSecond || false;
      const onThird = situation.onThird || false;
      
      // Game title (series info)
      const gameNote = comp?.notes?.[0]?.headline || comp?.series?.summary || '';
      
      // Inning display
      let inningDisplay;
      if (isLive) {
        inningDisplay = inningState || `Inning ${inning}`;
      } else if (isPregame) {
        const gameDate = new Date(game.date);
        inningDisplay = gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
      } else {
        inningDisplay = ''; // Badge already shows FINAL, no need for duplicate text
      }
      
      console.log('🎮 Creating MLB fullscreen card:', {
        gameName: game.name,
        statusState: statusState,
        isLive: isLive,
        isUpcoming: isUpcoming,
        inningDisplay: inningDisplay,
        balls, strikes, outs,
        bases: { onFirst, onSecond, onThird }
      });
      
      let cardClass = 'fullscreen-game-card';
      
      // Add upcoming class for different styling
      if (isUpcoming) {
        cardClass += ' upcoming-game';
      } else {
        // Only show winning/losing colors for live games
        if (awayScore > homeScore) cardClass += ' winning-away';
        else if (homeScore > awayScore) cardClass += ' winning-home';
        else cardClass += ' tied';
      }

      div.className = cardClass;
      div.dataset.slotIndex = slotIndex;
      div.dataset.isLive = isLive ? 'true' : 'false';
      div.dataset.gameId = game.id;

      div.innerHTML = `
        <img src="/assets/MLB-logo.png" alt="MLB" class="sport-logo-indicator">
        <div class="fullscreen-refresh-indicator"></div>
        
        <!-- Game Selector Dropdown (hidden initially) -->
        <div class="fs-game-selector-container">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <!-- Populated dynamically -->
          </select>
        </div>

        ${gameNote ? `<div class="fullscreen-game-title">${gameNote}</div>` : ''}

        <div class="fullscreen-inning ${isLive ? 'live' : ''}">${inningDisplay}</div>
        
        <div class="fullscreen-team ${!isUpcoming && awayScore > homeScore ? 'winning' : !isUpcoming && awayScore < homeScore ? 'losing' : ''}">
          <div class="fullscreen-team-header">
            ${awayTeam?.team?.logo ? `<img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
            <div class="fullscreen-team-name">
              ${awayTeam?.team?.abbreviation || awayTeam?.team?.displayName || 'AWAY'}
            </div>
          </div>
          <div class="fullscreen-score">${isUpcoming ? '-' : awayScore}</div>
        </div>

        <div class="fullscreen-vs">VS</div>

        <div class="fullscreen-team ${!isUpcoming && homeScore > awayScore ? 'winning' : !isUpcoming && homeScore < awayScore ? 'losing' : ''}">
          <div class="fullscreen-team-header">
            ${homeTeam?.team?.logo ? `<img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
            <div class="fullscreen-team-name">
              ${homeTeam?.team?.abbreviation || homeTeam?.team?.displayName || 'HOME'}
            </div>
          </div>
          <div class="fullscreen-score">${isUpcoming ? '-' : homeScore}</div>
        </div>

        ${isLive ? `
          <div class="fullscreen-baseball-status">
            <div class="fullscreen-diamond-container">
              <svg width="50" height="50" viewBox="0 -8 42 50" style="transform: rotate(45deg);">
                <!-- Second base (top) -->
                <rect x="13" y="-4" width="16" height="16" fill="${onSecond ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                <!-- First base (right) -->
                <rect x="28" y="20" width="16" height="16" fill="${onFirst ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                <!-- Third base (left) -->
                <rect x="0" y="20" width="16" height="16" fill="${onThird ? '#fbbf24' : 'rgba(255,255,255,0.2)'}" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
              </svg>
            </div>
            <div class="fullscreen-count">
              <span>B:${balls}</span>
              <span>S:${strikes}</span>
              <span>O:${outs}</span>
            </div>
          </div>
        ` : ''}
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      // Show selector on card hover
      div.addEventListener('mouseenter', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'block';
      });
      div.addEventListener('mouseleave', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'none';
      });

      return div;
    }

    // Populate full screen game selector
    function populateFullScreenGameSelector(selector, slotIndex) {
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now uses game IDs
      const currentSelection = gridGames[slotIndex]; // Game ID

      selector.innerHTML = '<option value="">-- Select Game --</option>';

      liveGames.forEach((game, gameIndex) => {
        const gameId = game.id;
        if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
          const comp = game.competitions?.[0];
          const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
          const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';

          // Determine status - LIVE or UPCOMING
          const statusState = comp?.status?.type?.state;
          const isLive = statusState === 'in' || comp?.status?.period > 0;
          const isUpcoming = statusState === 'pre';
          
          let statusLabel;
          if (isUpcoming) {
            statusLabel = '🕒 UPCOMING';
          } else if (isLive) {
            const inning = comp?.status?.type?.shortDetail || 'Live';
            statusLabel = `🔴 ${inning}`;
          } else {
            statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
          }

          const option = document.createElement('option');
          option.value = gameId; // Store game ID
          option.textContent = `${awayTeam} @ ${homeTeam} - ${statusLabel}`;
          
          if (currentSelection === gameId) {
            option.selected = true;
          }
          
          selector.appendChild(option);
        }
      });

      // Handle game change in full screen
      selector.addEventListener('change', (e) => {
        const newGameId = e.target.value; // Game ID
        const card = document.querySelector(`[data-slot-index="${slotIndex}"]`);
        
        if (newGameId === '') {
          // User deselected - show empty slot
          delete gridGames[slotIndex];
          if (card) {
            const emptyCard = createEmptySlotCard(slotIndex);
            card.replaceWith(emptyCard);
          }
        } else {
          // User selected a game
          gridGames[slotIndex] = newGameId; // Store game ID
          
          const liveGames = window.liveGamesData || [];
          const newGame = liveGames.find(g => g.id === newGameId); // Find by ID
          
          if (newGame && card) {
            const newCard = createFullScreenGameCard(newGame, slotIndex);
            card.replaceWith(newCard);
          }
        }

        // Update all other selectors to reflect new availability
        document.querySelectorAll('.fs-game-selector').forEach(sel => {
          const slot = parseInt(sel.dataset.slot);
          populateFullScreenGameSelector(sel, slot);
        });
      });
    }

    // Detect play type based on score change and show animation
    function detectAndAnimatePlay(card, scoreChange, teamName) {
      let playType, playText;
      
      // MLB scoring: typically 1-4 runs at a time
      if (scoreChange === 4) {
        // Grand Slam or 4 runs scored
        playType = 'grandslam';
        playText = 'GRAND SLAM!';
      } else if (scoreChange >= 2) {
        // Multiple runs (could be home run)
        playType = 'homerun';
        playText = 'HOME RUN!';
      } else if (scoreChange === 1) {
        // Single run scored
        playType = 'homerun';
        playText = 'RUN SCORED!';
      } else {
        return; // Unknown score change
      }
      
      showPlayAnimation(card, playType, playText, teamName);
    }

    // Show play animation overlay
    function showPlayAnimation(card, playType, playText, teamName = '') {
      // Skip animations during the first update cycle after entering fullscreen mode
      // This prevents showing animations for past plays that already happened
      if (fullscreenEnteredAt && (Date.now() - fullscreenEnteredAt) < 6000) {
        return; // Don't show animations for the first 6 seconds (first update cycle + buffer)
      }

      // Remove any existing animation
      const existingAnimation = card.querySelector('.play-animation');
      if (existingAnimation) {
        existingAnimation.remove();
      }

      // Create animation overlay
      const animationDiv = document.createElement('div');
      animationDiv.className = `play-animation ${playType}`;
      
      // Choose icon based on play type
      let icon;
      switch(playType) {
        case 'homerun':
          icon = '⚾';
          break;
        case 'strikeout':
          icon = 'K';
          break;
        case 'stolenbase':
          icon = '�';
          break;
        case 'doubleplay':
          icon = '2️⃣';
          break;
        case 'grandslam':
          icon = '�';
          break;
        default:
          icon = '⚾';
      }
      
      animationDiv.innerHTML = `
        <div class="play-animation-icon">${icon}</div>
        <div class="play-animation-text">${playText}</div>
        ${teamName ? `<div class="play-animation-text" style="font-size: 2.5rem; margin-top: 10px;">${teamName}</div>` : ''}
      `;
      
      card.style.position = 'relative';
      card.appendChild(animationDiv);
      
      // Remove after animation completes (3 seconds)
      setTimeout(() => {
        animationDiv.remove();
      }, 3000);
    }

    // Update full screen scores
    async function updateFullScreenScores() {
      try {
        // Fetch updated game data from the same endpoint
        const response = await tvFetch(`/api/mlb/scoreboard`);
        if (!response.ok) {
          throw new Error(`Failed to fetch scores: ${response.status}`);
        }
        
        const espnData = await response.json();
        
        // Update the global games data
        if (espnData.events && espnData.events.length > 0) {
          const allGames = espnData.events.map(event => {
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');
            
            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });
          
          window.liveGamesData = allGames;
        }

        const grid = document.getElementById('fullscreen-grid');
        const cards = grid.querySelectorAll('.fullscreen-game-card');

        cards.forEach((card, index) => {
          const slotIndex = parseInt(card.dataset.slotIndex);
          const gameId = gridGames[slotIndex]; // Now uses game ID
          const game = window.liveGamesData.find(g => g.id === gameId); // Find by ID
          
          if (!game || card.classList.contains('empty-slot')) return;

          const comp = game.competitions?.[0];
          const statusState = comp?.status?.type?.state;
          const wasUpcoming = card.dataset.isLive === 'false';
          const isNowLive = statusState === 'in' || comp?.status?.period > 0;

          // If game transitioned from upcoming to live, recreate the card
          if (wasUpcoming && isNowLive) {
            console.log(`🏈 Game started! Transitioning to live view:`, game.name);
            const newCard = createFullScreenGameCard(game, slotIndex);
            card.replaceWith(newCard);
            return;
          }

          // For upcoming games, update countOuts
          if (statusState === 'pre') {
            const inningEl = card.querySelector('.fullscreen-inning');
            if (inningEl) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const minutesUntil = Math.round((gameDate - now) / (1000 * 60));
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
              
              if (minutesUntil < 60) {
                inningEl.textContent = `⏰ STARTS IN ${minutesUntil} MIN`;
              } else if (hoursUntil < 24) {
                inningEl.textContent = `⏰ STARTS IN ${hoursUntil}H`;
              } else {
                inningEl.textContent = `⏰ ${gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
              }
            }
            return; // Don't update scores for upcoming games
          }

          // Update live game data
          const indicator = card.querySelector('.fullscreen-refresh-indicator');
          if (indicator) {
            indicator.classList.add('active');
            setTimeout(() => indicator.classList.remove('active'), 1000);
          }

          const awayTeam = comp?.competitors?.[1];
          const homeTeam = comp?.competitors?.[0];
          const awayScore = parseInt(awayTeam?.score || 0);
          const homeScore = parseInt(homeTeam?.score || 0);

          // Get previous scores from card data attributes
          const prevAwayScore = parseInt(card.dataset.prevAwayScore || 0);
          const prevHomeScore = parseInt(card.dataset.prevHomeScore || 0);

          // Detect score changes and determine play type
          const awayScoreChange = awayScore - prevAwayScore;
          const homeScoreChange = homeScore - prevHomeScore;

          if (awayScoreChange > 0) {
            detectAndAnimatePlay(card, awayScoreChange, awayTeam?.team?.displayName || 'Away');
          } else if (homeScoreChange > 0) {
            detectAndAnimatePlay(card, homeScoreChange, homeTeam?.team?.displayName || 'Home');
          }

          // Check for turnovers (interceptions/fumbles) from play description
          const lastPlay = comp?.situation?.lastPlay?.text || '';
          if (lastPlay.toLowerCase().includes('interception') || lastPlay.toLowerCase().includes('intercepted')) {
            if (!card.dataset.lastInterception || card.dataset.lastInterception !== lastPlay) {
              showPlayAnimation(card, 'interception', 'INTERCEPTION!');
              card.dataset.lastInterception = lastPlay;
            }
          } else if (lastPlay.toLowerCase().includes('fumble')) {
            if (!card.dataset.lastFumble || card.dataset.lastFumble !== lastPlay) {
              showPlayAnimation(card, 'fumble', 'FUMBLE!');
              card.dataset.lastFumble = lastPlay;
            }
          }

          // Store current scores for next update
          card.dataset.prevAwayScore = awayScore;
          card.dataset.prevHomeScore = homeScore;

          // Update scores with animation
          const scores = card.querySelectorAll('.fullscreen-score');
          const awayScoreEl = scores[0];
          const homeScoreEl = scores[1];
          
          if (awayScoreEl && awayScoreEl.textContent !== awayScore.toString()) {
            awayScoreEl.textContent = awayScore;
            awayScoreEl.style.animation = 'none';
            awayScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              awayScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              awayScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }
          
          if (homeScoreEl && homeScoreEl.textContent !== homeScore.toString()) {
            homeScoreEl.textContent = homeScore;
            homeScoreEl.style.animation = 'none';
            homeScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              homeScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              homeScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }

          // Update status
          const inningEl = card.querySelector('.fullscreen-inning');
          if (inningEl) {
            const inningState = comp?.status?.type?.shortDetail || 'Live';
            inningEl.textContent = inningState;
          }

          // Update baseball-specific elements (diamond and count)
          const diamondContainer = card.querySelector('.fullscreen-diamond-container');
          if (diamondContainer) {
            const situation = comp?.situation || {};
            const onFirst = situation.onFirst || false;
            const onSecond = situation.onSecond || false;
            const onThird = situation.onThird || false;
            
            const svg = diamondContainer.querySelector('svg');
            if (svg) {
              const rects = svg.querySelectorAll('rect');
              if (rects[0]) rects[0].setAttribute('fill', onSecond ? '#fbbf24' : 'rgba(255,255,255,0.2)');
              if (rects[1]) rects[1].setAttribute('fill', onFirst ? '#fbbf24' : 'rgba(255,255,255,0.2)');
              if (rects[2]) rects[2].setAttribute('fill', onThird ? '#fbbf24' : 'rgba(255,255,255,0.2)');
            }
          }

          const countEl = card.querySelector('.fullscreen-count');
          if (countEl) {
            const situation = comp?.situation || {};
            const balls = situation.balls || 0;
            const strikes = situation.strikes || 0;
            const outs = situation.outs || 0;
            
            const spans = countEl.querySelectorAll('span');
            if (spans[0]) spans[0].textContent = `B:${balls}`;
            if (spans[1]) spans[1].textContent = `S:${strikes}`;
            if (spans[2]) spans[2].textContent = `O:${outs}`;
          }

          // Update card class for winner
          card.className = 'fullscreen-game-card';
          card.dataset.slotIndex = slotIndex;
          card.dataset.isLive = 'true';
          card.dataset.gameId = game.id;
          
          if (awayScore > homeScore) card.classList.add('winning-away');
          else if (homeScore > awayScore) card.classList.add('winning-home');
          else card.classList.add('tied');

          // Update Outs/distance (already includes field position from API)
          const OutsDistanceEl = card.querySelector('.fullscreen-Outs-distance');
          const fieldPositionEl = card.querySelector('.fullscreen-field-position');
          const OutsDistance = comp?.situation?.OutsDistanceText || '';
          
          // Remove old field position element if it exists (no longer needed)
          if (fieldPositionEl) fieldPositionEl.remove();
          
          if (OutsDistanceEl) {
            if (OutsDistance) {
              OutsDistanceEl.textContent = OutsDistance;
              OutsDistanceEl.style.display = 'block';
            } else {
              OutsDistanceEl.style.display = 'none';
            }
          } else if (OutsDistance) {
            // Create Outs/distance element if it doesn't exist - add after home team (last team div)
            const teamDivs = card.querySelectorAll('.fullscreen-team');
            const homeTeamDiv = teamDivs[teamDivs.length - 1]; // Get the last team (home team)
            if (homeTeamDiv) {
              homeTeamDiv.insertAdjacentHTML('afterend', `<div class="fullscreen-Outs-distance">${OutsDistance}</div>`);
            }
          }

          // Update possession
          const possession = comp?.situation?.possession;
          const teamNames = card.querySelectorAll('.fullscreen-team-name');
          teamNames.forEach(name => {
            const existingPossession = name.querySelector('.fullscreen-possession');
            if (existingPossession) existingPossession.remove();
          });
          
          if (possession === awayTeam?.id && teamNames[0]) {
            teamNames[0].insertAdjacentHTML('beforeend', '<span class="fullscreen-possession"></span>');
          } else if (possession === homeTeam?.id && teamNames[1]) {
            teamNames[1].insertAdjacentHTML('beforeend', '<span class="fullscreen-possession"></span>');
          }
        });

      } catch (error) {
        console.error('Error updating full screen scores:', error);
      }
    }

    // Exit full screen mode
    function exitFullScreenMode() {
      const container = document.getElementById('fullscreen-container');
      container.classList.remove('active');
      
      if (fullscreenRefreshInterval) {
        clearInterval(fullscreenRefreshInterval);
        fullscreenRefreshInterval = null;
      }

      // Clear session keep-alive interval
      if (sessionKeepAliveInterval) {
        clearInterval(sessionKeepAliveInterval);
        sessionKeepAliveInterval = null;
      }

      // Exit browser fullscreen
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    // Event Listeners
    document.getElementById('sports-bar-btn').addEventListener('click', openGameSelectionModal);
    
    document.getElementById('cancel-modal').addEventListener('click', () => {
      document.getElementById('game-selection-modal').classList.remove('show');
    });
    
    document.getElementById('enter-fullscreen').addEventListener('click', enterFullScreenMode);
    document.getElementById('exit-fullscreen').addEventListener('click', exitFullScreenMode);
    
    document.getElementById('change-layout-fs').addEventListener('click', () => {
      exitFullScreenMode();
      gridGames = {}; // Reset selections
      setTimeout(() => openGameSelectionModal(), 100);
    });

    // ESC key to exit
    document.addEventListener('keyOuts', (e) => {
      if (e.key === 'Escape') {
        const container = document.getElementById('fullscreen-container');
        if (container.classList.contains('active')) {
          exitFullScreenMode();
        }
      }
    });

    // Close modal on outside click
    document.getElementById('game-selection-modal').addEventListener('click', (e) => {
      if (e.target.id === 'game-selection-modal') {
        document.getElementById('game-selection-modal').classList.remove('show');
      }
    });

  </script>

</body>
</html>

