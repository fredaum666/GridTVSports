<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Favorite Teams - GridTV Sports</title>
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
      min-height: 100vh;
      color: #ffffff;
    }

    .header {
      background: rgba(26, 26, 46, 0.95);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: #ffffff;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .favorites-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 40px;
    }

    .favorite-card {
      background: rgba(26, 26, 46, 0.95);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      position: relative;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .favorite-card:hover {
      border-color: rgba(99, 102, 241, 0.5);
    }

    .favorite-card.empty {
      border-style: dashed;
      min-height: 180px;
      justify-content: center;
      opacity: 0.5;
    }

    .rank-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }

    .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 28px;
      height: 28px;
      background: rgba(239, 68, 68, 0.2);
      border: none;
      border-radius: 50%;
      color: #f87171;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      opacity: 0;
    }

    .favorite-card:hover .remove-btn {
      opacity: 1;
    }

    .remove-btn:hover {
      background: rgba(239, 68, 68, 0.4);
    }

    .team-logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
    }

    .team-name {
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      color: #ffffff;
    }

    .team-league {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
    }

    .empty-icon {
      width: 50px;
      height: 50px;
      color: rgba(255, 255, 255, 0.3);
    }

    .empty-text {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.4);
    }

    /* League Tabs */
    .league-tabs {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .league-tab {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .league-tab:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
    }

    .league-tab.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-color: transparent;
      color: #ffffff;
    }

    /* Search */
    .search-container {
      position: relative;
      margin-bottom: 20px;
    }

    .search-input {
      width: 100%;
      padding: 14px 16px 14px 45px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: #ffffff;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      border-color: #6366f1;
      background: rgba(99, 102, 241, 0.1);
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 255, 255, 0.4);
    }

    /* Teams Grid */
    .teams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .teams-grid::-webkit-scrollbar {
      width: 6px;
    }

    .teams-grid::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .teams-grid::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    .team-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .team-card:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(99, 102, 241, 0.3);
    }

    .team-card.selected {
      background: rgba(99, 102, 241, 0.2);
      border-color: #6366f1;
    }

    .team-card .team-logo {
      width: 60px;
      height: 60px;
    }

    .team-card .team-name {
      font-size: 12px;
    }

    .no-teams {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.5);
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.6);
    }

    .loading-spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #6366f1;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Messages */
    .message {
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .message.success {
      background: rgba(34, 197, 94, 0.2);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .page-title {
        font-size: 20px;
      }

      .favorites-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .teams-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .header {
        padding: 12px 15px;
      }

      .favorites-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .favorite-card {
        padding: 15px;
      }

      .team-logo {
        width: 60px;
        height: 60px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-left">
      <a href="/" class="back-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </a>
      <h1 class="page-title">Favorite Teams</h1>
    </div>
  </header>

  <div class="container">
    <div class="message error" id="errorMessage"></div>
    <div class="message success" id="successMessage"></div>

    <!-- League Tabs (moved above favorites) -->
    <div class="league-tabs" id="leagueTabs">
      <button class="league-tab active" data-league="NFL">NFL</button>
      <button class="league-tab" data-league="NBA">NBA</button>
      <button class="league-tab" data-league="MLB">MLB</button>
      <button class="league-tab" data-league="NHL">NHL</button>
      <button class="league-tab" data-league="NCAAF">NCAAF</button>
      <button class="league-tab" data-league="NCAAB">NCAAB</button>
    </div>

    <!-- Current Favorites for Selected League -->
    <div class="section-title" id="favoritesTitle">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
      </svg>
      Your Top 6 NFL Favorites
    </div>

    <div class="favorites-grid" id="favoritesGrid">
      <!-- Favorites will be rendered here -->
    </div>

    <!-- Select Teams -->
    <div class="section-title" id="teamsTitle">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      Select NFL Teams
    </div>

    <div class="search-container">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input type="text" class="search-input" id="searchInput" placeholder="Search teams...">
    </div>

    <div class="teams-grid" id="teamsGrid">
      <div class="loading">
        <span class="loading-spinner"></span>
        <p>Loading teams...</p>
      </div>
    </div>
  </div>

  <script>
    // State
    let favorites = [];
    let allTeams = {};
    let currentLeague = 'NFL';
    let searchQuery = '';

    // DOM Elements
    const favoritesGrid = document.getElementById('favoritesGrid');
    const teamsGrid = document.getElementById('teamsGrid');
    const leagueTabs = document.getElementById('leagueTabs');
    const searchInput = document.getElementById('searchInput');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const favoritesTitle = document.getElementById('favoritesTitle');
    const teamsTitle = document.getElementById('teamsTitle');

    // Team data for each league (ESPN team IDs and info)
    const teamsByLeague = {
      NFL: [
        { id: '1', name: 'Atlanta Falcons', abbreviation: 'ATL', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/atl.png' },
        { id: '2', name: 'Buffalo Bills', abbreviation: 'BUF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png' },
        { id: '3', name: 'Chicago Bears', abbreviation: 'CHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png' },
        { id: '4', name: 'Cincinnati Bengals', abbreviation: 'CIN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/cin.png' },
        { id: '5', name: 'Cleveland Browns', abbreviation: 'CLE', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/cle.png' },
        { id: '6', name: 'Dallas Cowboys', abbreviation: 'DAL', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/dal.png' },
        { id: '7', name: 'Denver Broncos', abbreviation: 'DEN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png' },
        { id: '8', name: 'Detroit Lions', abbreviation: 'DET', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/det.png' },
        { id: '9', name: 'Green Bay Packers', abbreviation: 'GB', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png' },
        { id: '10', name: 'Tennessee Titans', abbreviation: 'TEN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ten.png' },
        { id: '11', name: 'Indianapolis Colts', abbreviation: 'IND', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ind.png' },
        { id: '12', name: 'Kansas City Chiefs', abbreviation: 'KC', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/kc.png' },
        { id: '13', name: 'Las Vegas Raiders', abbreviation: 'LV', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lv.png' },
        { id: '14', name: 'Los Angeles Rams', abbreviation: 'LAR', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png' },
        { id: '15', name: 'Miami Dolphins', abbreviation: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/mia.png' },
        { id: '16', name: 'Minnesota Vikings', abbreviation: 'MIN', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/min.png' },
        { id: '17', name: 'New England Patriots', abbreviation: 'NE', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ne.png' },
        { id: '18', name: 'New Orleans Saints', abbreviation: 'NO', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/no.png' },
        { id: '19', name: 'New York Giants', abbreviation: 'NYG', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png' },
        { id: '20', name: 'New York Jets', abbreviation: 'NYJ', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png' },
        { id: '21', name: 'Philadelphia Eagles', abbreviation: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png' },
        { id: '22', name: 'Arizona Cardinals', abbreviation: 'ARI', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ari.png' },
        { id: '23', name: 'Pittsburgh Steelers', abbreviation: 'PIT', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/pit.png' },
        { id: '24', name: 'Los Angeles Chargers', abbreviation: 'LAC', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lac.png' },
        { id: '25', name: 'San Francisco 49ers', abbreviation: 'SF', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png' },
        { id: '26', name: 'Seattle Seahawks', abbreviation: 'SEA', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png' },
        { id: '27', name: 'Tampa Bay Buccaneers', abbreviation: 'TB', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/tb.png' },
        { id: '28', name: 'Washington Commanders', abbreviation: 'WAS', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png' },
        { id: '29', name: 'Carolina Panthers', abbreviation: 'CAR', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png' },
        { id: '30', name: 'Jacksonville Jaguars', abbreviation: 'JAX', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png' },
        { id: '33', name: 'Baltimore Ravens', abbreviation: 'BAL', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/bal.png' },
        { id: '34', name: 'Houston Texans', abbreviation: 'HOU', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/hou.png' }
      ],
      NBA: [
        { id: '1', name: 'Atlanta Hawks', abbreviation: 'ATL', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/atl.png' },
        { id: '2', name: 'Boston Celtics', abbreviation: 'BOS', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/bos.png' },
        { id: '3', name: 'Brooklyn Nets', abbreviation: 'BKN', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/bkn.png' },
        { id: '4', name: 'Charlotte Hornets', abbreviation: 'CHA', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/cha.png' },
        { id: '5', name: 'Chicago Bulls', abbreviation: 'CHI', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/chi.png' },
        { id: '6', name: 'Cleveland Cavaliers', abbreviation: 'CLE', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/cle.png' },
        { id: '7', name: 'Dallas Mavericks', abbreviation: 'DAL', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/dal.png' },
        { id: '8', name: 'Denver Nuggets', abbreviation: 'DEN', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/den.png' },
        { id: '9', name: 'Detroit Pistons', abbreviation: 'DET', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/det.png' },
        { id: '10', name: 'Golden State Warriors', abbreviation: 'GSW', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/gs.png' },
        { id: '11', name: 'Houston Rockets', abbreviation: 'HOU', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/hou.png' },
        { id: '12', name: 'Indiana Pacers', abbreviation: 'IND', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/ind.png' },
        { id: '13', name: 'LA Clippers', abbreviation: 'LAC', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/lac.png' },
        { id: '14', name: 'Los Angeles Lakers', abbreviation: 'LAL', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/lal.png' },
        { id: '15', name: 'Memphis Grizzlies', abbreviation: 'MEM', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/mem.png' },
        { id: '16', name: 'Miami Heat', abbreviation: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/mia.png' },
        { id: '17', name: 'Milwaukee Bucks', abbreviation: 'MIL', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/mil.png' },
        { id: '18', name: 'Minnesota Timberwolves', abbreviation: 'MIN', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/min.png' },
        { id: '19', name: 'New Orleans Pelicans', abbreviation: 'NOP', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/no.png' },
        { id: '20', name: 'New York Knicks', abbreviation: 'NYK', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/ny.png' },
        { id: '21', name: 'Oklahoma City Thunder', abbreviation: 'OKC', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/okc.png' },
        { id: '22', name: 'Orlando Magic', abbreviation: 'ORL', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/orl.png' },
        { id: '23', name: 'Philadelphia 76ers', abbreviation: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/phi.png' },
        { id: '24', name: 'Phoenix Suns', abbreviation: 'PHX', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/phx.png' },
        { id: '25', name: 'Portland Trail Blazers', abbreviation: 'POR', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/por.png' },
        { id: '26', name: 'Sacramento Kings', abbreviation: 'SAC', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/sac.png' },
        { id: '27', name: 'San Antonio Spurs', abbreviation: 'SAS', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/sa.png' },
        { id: '28', name: 'Toronto Raptors', abbreviation: 'TOR', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/tor.png' },
        { id: '29', name: 'Utah Jazz', abbreviation: 'UTA', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/utah.png' },
        { id: '30', name: 'Washington Wizards', abbreviation: 'WAS', logo: 'https://a.espncdn.com/i/teamlogos/nba/500/wsh.png' }
      ],
      MLB: [
        { id: '1', name: 'Baltimore Orioles', abbreviation: 'BAL', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/bal.png' },
        { id: '2', name: 'Boston Red Sox', abbreviation: 'BOS', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/bos.png' },
        { id: '3', name: 'New York Yankees', abbreviation: 'NYY', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/nyy.png' },
        { id: '4', name: 'Tampa Bay Rays', abbreviation: 'TB', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/tb.png' },
        { id: '5', name: 'Toronto Blue Jays', abbreviation: 'TOR', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/tor.png' },
        { id: '6', name: 'Chicago White Sox', abbreviation: 'CHW', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/chw.png' },
        { id: '7', name: 'Cleveland Guardians', abbreviation: 'CLE', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/cle.png' },
        { id: '8', name: 'Detroit Tigers', abbreviation: 'DET', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/det.png' },
        { id: '9', name: 'Kansas City Royals', abbreviation: 'KC', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/kc.png' },
        { id: '10', name: 'Minnesota Twins', abbreviation: 'MIN', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/min.png' },
        { id: '11', name: 'Houston Astros', abbreviation: 'HOU', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/hou.png' },
        { id: '12', name: 'Los Angeles Angels', abbreviation: 'LAA', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/laa.png' },
        { id: '13', name: 'Oakland Athletics', abbreviation: 'OAK', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/oak.png' },
        { id: '14', name: 'Seattle Mariners', abbreviation: 'SEA', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/sea.png' },
        { id: '15', name: 'Texas Rangers', abbreviation: 'TEX', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/tex.png' },
        { id: '16', name: 'Atlanta Braves', abbreviation: 'ATL', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/atl.png' },
        { id: '17', name: 'Miami Marlins', abbreviation: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/mia.png' },
        { id: '18', name: 'New York Mets', abbreviation: 'NYM', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/nym.png' },
        { id: '19', name: 'Philadelphia Phillies', abbreviation: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/phi.png' },
        { id: '20', name: 'Washington Nationals', abbreviation: 'WSH', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/wsh.png' },
        { id: '21', name: 'Chicago Cubs', abbreviation: 'CHC', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/chc.png' },
        { id: '22', name: 'Cincinnati Reds', abbreviation: 'CIN', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/cin.png' },
        { id: '23', name: 'Milwaukee Brewers', abbreviation: 'MIL', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/mil.png' },
        { id: '24', name: 'Pittsburgh Pirates', abbreviation: 'PIT', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/pit.png' },
        { id: '25', name: 'St. Louis Cardinals', abbreviation: 'STL', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/stl.png' },
        { id: '26', name: 'Arizona Diamondbacks', abbreviation: 'ARI', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/ari.png' },
        { id: '27', name: 'Colorado Rockies', abbreviation: 'COL', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/col.png' },
        { id: '28', name: 'Los Angeles Dodgers', abbreviation: 'LAD', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/lad.png' },
        { id: '29', name: 'San Diego Padres', abbreviation: 'SD', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/sd.png' },
        { id: '30', name: 'San Francisco Giants', abbreviation: 'SF', logo: 'https://a.espncdn.com/i/teamlogos/mlb/500/sf.png' }
      ],
      NHL: [
        { id: '1', name: 'New Jersey Devils', abbreviation: 'NJD', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/nj.png' },
        { id: '2', name: 'New York Islanders', abbreviation: 'NYI', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/nyi.png' },
        { id: '3', name: 'New York Rangers', abbreviation: 'NYR', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/nyr.png' },
        { id: '4', name: 'Philadelphia Flyers', abbreviation: 'PHI', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/phi.png' },
        { id: '5', name: 'Pittsburgh Penguins', abbreviation: 'PIT', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/pit.png' },
        { id: '6', name: 'Boston Bruins', abbreviation: 'BOS', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/bos.png' },
        { id: '7', name: 'Buffalo Sabres', abbreviation: 'BUF', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/buf.png' },
        { id: '8', name: 'Montreal Canadiens', abbreviation: 'MTL', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/mtl.png' },
        { id: '9', name: 'Ottawa Senators', abbreviation: 'OTT', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/ott.png' },
        { id: '10', name: 'Toronto Maple Leafs', abbreviation: 'TOR', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/tor.png' },
        { id: '12', name: 'Carolina Hurricanes', abbreviation: 'CAR', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/car.png' },
        { id: '13', name: 'Florida Panthers', abbreviation: 'FLA', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/fla.png' },
        { id: '14', name: 'Tampa Bay Lightning', abbreviation: 'TBL', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/tb.png' },
        { id: '15', name: 'Washington Capitals', abbreviation: 'WSH', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/wsh.png' },
        { id: '16', name: 'Chicago Blackhawks', abbreviation: 'CHI', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/chi.png' },
        { id: '17', name: 'Detroit Red Wings', abbreviation: 'DET', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/det.png' },
        { id: '18', name: 'Nashville Predators', abbreviation: 'NSH', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/nsh.png' },
        { id: '19', name: 'St. Louis Blues', abbreviation: 'STL', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/stl.png' },
        { id: '20', name: 'Calgary Flames', abbreviation: 'CGY', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/cgy.png' },
        { id: '21', name: 'Colorado Avalanche', abbreviation: 'COL', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/col.png' },
        { id: '22', name: 'Edmonton Oilers', abbreviation: 'EDM', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/edm.png' },
        { id: '23', name: 'Vancouver Canucks', abbreviation: 'VAN', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/van.png' },
        { id: '24', name: 'Anaheim Ducks', abbreviation: 'ANA', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/ana.png' },
        { id: '25', name: 'Dallas Stars', abbreviation: 'DAL', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/dal.png' },
        { id: '26', name: 'Los Angeles Kings', abbreviation: 'LAK', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/la.png' },
        { id: '28', name: 'San Jose Sharks', abbreviation: 'SJS', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/sj.png' },
        { id: '29', name: 'Columbus Blue Jackets', abbreviation: 'CBJ', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/cbj.png' },
        { id: '30', name: 'Minnesota Wild', abbreviation: 'MIN', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/min.png' },
        { id: '52', name: 'Winnipeg Jets', abbreviation: 'WPG', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/wpg.png' },
        { id: '53', name: 'Arizona Coyotes', abbreviation: 'ARI', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/ari.png' },
        { id: '54', name: 'Vegas Golden Knights', abbreviation: 'VGK', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/vgk.png' },
        { id: '55', name: 'Seattle Kraken', abbreviation: 'SEA', logo: 'https://a.espncdn.com/i/teamlogos/nhl/500/sea.png' }
      ],
      NCAAF: [
        { id: '333', name: 'Alabama Crimson Tide', abbreviation: 'ALA', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/333.png' },
        { id: '130', name: 'Michigan Wolverines', abbreviation: 'MICH', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/130.png' },
        { id: '61', name: 'Ohio State Buckeyes', abbreviation: 'OSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/194.png' },
        { id: '228', name: 'Clemson Tigers', abbreviation: 'CLEM', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/228.png' },
        { id: '57', name: 'Florida Gators', abbreviation: 'UF', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/57.png' },
        { id: '251', name: 'Texas Longhorns', abbreviation: 'TEX', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/251.png' },
        { id: '87', name: 'USC Trojans', abbreviation: 'USC', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/30.png' },
        { id: '2', name: 'Auburn Tigers', abbreviation: 'AUB', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2.png' },
        { id: '52', name: 'Florida State Seminoles', abbreviation: 'FSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/52.png' },
        { id: '98', name: 'Georgia Bulldogs', abbreviation: 'UGA', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/61.png' },
        { id: '99', name: 'LSU Tigers', abbreviation: 'LSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/99.png' },
        { id: '87', name: 'Notre Dame Fighting Irish', abbreviation: 'ND', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/87.png' },
        { id: '145', name: 'Oklahoma Sooners', abbreviation: 'OU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/201.png' },
        { id: '264', name: 'Oregon Ducks', abbreviation: 'ORE', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2483.png' },
        { id: '213', name: 'Penn State Nittany Lions', abbreviation: 'PSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/213.png' },
        { id: '275', name: 'Tennessee Volunteers', abbreviation: 'TENN', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2633.png' },
        { id: '344', name: 'Wisconsin Badgers', abbreviation: 'WIS', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/275.png' },
        { id: '8', name: 'Miami Hurricanes', abbreviation: 'MIA', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2390.png' },
        { id: '12', name: 'Arizona State Sun Devils', abbreviation: 'ASU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/9.png' },
        { id: '2229', name: 'Colorado Buffaloes', abbreviation: 'COL', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/38.png' }
      ],
      NCAAB: [
        { id: '2250', name: 'Duke Blue Devils', abbreviation: 'DUKE', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/150.png' },
        { id: '153', name: 'North Carolina Tar Heels', abbreviation: 'UNC', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/153.png' },
        { id: '2305', name: 'Kentucky Wildcats', abbreviation: 'UK', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/96.png' },
        { id: '127', name: 'Kansas Jayhawks', abbreviation: 'KU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2305.png' },
        { id: '2294', name: 'Gonzaga Bulldogs', abbreviation: 'GONZ', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2250.png' },
        { id: '21', name: 'Villanova Wildcats', abbreviation: 'NOVA', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/222.png' },
        { id: '2294', name: 'UCLA Bruins', abbreviation: 'UCLA', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/26.png' },
        { id: '84', name: 'Michigan State Spartans', abbreviation: 'MSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/127.png' },
        { id: '2509', name: 'Louisville Cardinals', abbreviation: 'LOU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/97.png' },
        { id: '12', name: 'Arizona Wildcats', abbreviation: 'ARIZ', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/12.png' },
        { id: '2390', name: 'Connecticut Huskies', abbreviation: 'CONN', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/41.png' },
        { id: '356', name: 'Indiana Hoosiers', abbreviation: 'IND', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/84.png' },
        { id: '239', name: 'Syracuse Orange', abbreviation: 'SYR', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/183.png' },
        { id: '2628', name: 'Texas Tech Red Raiders', abbreviation: 'TTU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2641.png' },
        { id: '2509', name: 'Purdue Boilermakers', abbreviation: 'PUR', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2509.png' },
        { id: '2', name: 'Auburn Tigers', abbreviation: 'AUB', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/2.png' },
        { id: '2294', name: 'Baylor Bears', abbreviation: 'BAY', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/239.png' },
        { id: '2168', name: 'Creighton Bluejays', abbreviation: 'CREI', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/156.png' },
        { id: '2628', name: 'Houston Cougars', abbreviation: 'HOU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/248.png' },
        { id: '52', name: 'Florida State Seminoles', abbreviation: 'FSU', logo: 'https://a.espncdn.com/i/teamlogos/ncaa/500/52.png' }
      ]
    };

    // Helper functions
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      successMessage.classList.remove('show');
      setTimeout(() => errorMessage.classList.remove('show'), 5000);
    }

    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.classList.add('show');
      errorMessage.classList.remove('show');
      setTimeout(() => successMessage.classList.remove('show'), 3000);
    }

    // Fetch user's favorites
    async function fetchFavorites() {
      try {
        const response = await fetch('/api/favorites');
        if (!response.ok) {
          if (response.status === 401) {
            window.location.href = '/login.html';
            return;
          }
          throw new Error('Failed to fetch favorites');
        }
        const data = await response.json();
        favorites = data.favorites || [];
        renderFavorites();
        renderTeams();
      } catch (error) {
        console.error('Error fetching favorites:', error);
        showError('Failed to load favorites');
      }
    }

    // Update titles based on current league
    function updateTitles() {
      favoritesTitle.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
        Your Top 6 ${currentLeague} Favorites
      `;
      teamsTitle.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        Select ${currentLeague} Teams
      `;
    }

    // Get favorites for current league
    function getLeagueFavorites() {
      return favorites.filter(f => f.league === currentLeague).sort((a, b) => a.rank - b.rank);
    }

    // Render favorites grid for current league
    function renderFavorites() {
      const leagueFavorites = getLeagueFavorites();
      let html = '';

      // Render existing favorites for this league
      leagueFavorites.forEach((fav) => {
        html += `
          <div class="favorite-card" data-team-id="${fav.team_id}">
            <span class="rank-badge">${fav.rank}</span>
            <button class="remove-btn" onclick="removeFavorite('${fav.team_id}')" title="Remove from favorites">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
            <img src="${fav.team_logo}" alt="${fav.team_name}" class="team-logo" onerror="this.src='/assets/logo.png'">
            <span class="team-name">${fav.team_name}</span>
          </div>
        `;
      });

      // Render empty slots
      for (let i = leagueFavorites.length; i < 6; i++) {
        html += `
          <div class="favorite-card empty">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            <span class="empty-text">Slot ${i + 1}</span>
          </div>
        `;
      }

      favoritesGrid.innerHTML = html;
    }

    // Render teams grid for current league
    function renderTeams() {
      const teams = teamsByLeague[currentLeague] || [];
      const query = searchQuery.toLowerCase();

      const filteredTeams = teams.filter(team =>
        team.name.toLowerCase().includes(query) ||
        team.abbreviation.toLowerCase().includes(query)
      );

      if (filteredTeams.length === 0) {
        teamsGrid.innerHTML = '<div class="no-teams">No teams found</div>';
        return;
      }

      let html = '';
      filteredTeams.forEach(team => {
        const isFavorite = favorites.some(f => f.team_id === `${currentLeague}-${team.id}`);
        html += `
          <div class="team-card ${isFavorite ? 'selected' : ''}" onclick="toggleFavorite('${team.id}', '${team.name}', '${team.abbreviation}', '${team.logo}')">
            <img src="${team.logo}" alt="${team.name}" class="team-logo" onerror="this.src='/assets/logo.png'">
            <span class="team-name">${team.name}</span>
          </div>
        `;
      });

      teamsGrid.innerHTML = html;
    }

    // Toggle favorite
    async function toggleFavorite(id, name, abbreviation, logo) {
      const teamId = `${currentLeague}-${id}`;
      const existingFavorite = favorites.find(f => f.team_id === teamId);

      if (existingFavorite) {
        await removeFavorite(teamId);
      } else {
        await addFavorite(teamId, name, abbreviation, logo);
      }
    }

    // Add favorite
    async function addFavorite(teamId, teamName, teamAbbreviation, teamLogo) {
      const leagueFavorites = getLeagueFavorites();
      if (leagueFavorites.length >= 6) {
        showError(`Maximum 6 favorite teams allowed per league. Remove one to add another.`);
        return;
      }

      try {
        const response = await fetch('/api/favorites', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            teamId,
            teamName,
            teamAbbreviation,
            teamLogo,
            league: currentLeague
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to add favorite');
        }

        favorites.push(data.favorite);
        renderFavorites();
        renderTeams();
        showSuccess(`${teamName} added to favorites!`);
      } catch (error) {
        console.error('Error adding favorite:', error);
        showError(error.message);
      }
    }

    // Remove favorite
    async function removeFavorite(teamId) {
      try {
        const response = await fetch(`/api/favorites/${encodeURIComponent(teamId)}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to remove favorite');
        }

        const removedTeam = favorites.find(f => f.team_id === teamId);
        const removedLeague = removedTeam?.league;
        favorites = favorites.filter(f => f.team_id !== teamId);

        // Re-index ranks for the affected league only
        if (removedLeague) {
          const leagueFavs = favorites.filter(f => f.league === removedLeague).sort((a, b) => a.rank - b.rank);
          leagueFavs.forEach((f, i) => f.rank = i + 1);
        }

        renderFavorites();
        renderTeams();
        showSuccess(`${removedTeam?.team_name || 'Team'} removed from favorites`);
      } catch (error) {
        console.error('Error removing favorite:', error);
        showError(error.message);
      }
    }

    // Event listeners
    leagueTabs.addEventListener('click', (e) => {
      if (e.target.classList.contains('league-tab')) {
        document.querySelectorAll('.league-tab').forEach(tab => tab.classList.remove('active'));
        e.target.classList.add('active');
        currentLeague = e.target.dataset.league;
        searchInput.value = '';
        searchQuery = '';
        updateTitles();
        renderFavorites();
        renderTeams();
      }
    });

    searchInput.addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTeams();
    });

    // Check authentication and load favorites
    async function init() {
      try {
        const response = await fetch('/api/auth/check');
        if (!response.ok) {
          window.location.href = '/login.html';
          return;
        }
        await fetchFavorites();
      } catch (error) {
        window.location.href = '/login.html';
      }
    }

    init();
  </script>
</body>
</html>
