(()=>{class SportsBarMode{constructor(e={}){this.mode=e.mode||"mixed",this.sport=e.sport||null,this.games=[],this.gridLayout=1,this.gridGames={},this.fullscreenActive=!1,this.updateInterval=null,this.isTrial=!1,this.allowedGrids=[1,2,4,6],this.mobilePaging=null,this.MAX_GAMES=8}getStyles(){return"\n            .sports-bar-button {\n                background: var(--accent-blue);\n                color: white;\n                border: none;\n                padding: 15px 30px;\n                border-radius: 12px;\n                font-size: 18px;\n                font-weight: 600;\n                cursor: pointer;\n                box-shadow: var(--shadow-md);\n                transition: all 0.3s ease;\n                margin: 20px auto;\n                display: block;\n            }\n\n            .sports-bar-button:hover {\n                background: var(--btn-sports-bar-hover);\n                transform: translateY(-2px);\n                box-shadow: var(--shadow-lg);\n            }\n\n            .sports-bar-modal {\n                display: none;\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.8);\n                z-index: 1000;\n                justify-content: center;\n                align-items: center;\n            }\n\n            .sports-bar-modal.active {\n                display: flex;\n            }\n\n            .modal-content {\n                background: var(--bg-secondary);\n                border: 1px solid var(--border-primary);\n                border-radius: 20px;\n                padding: 40px;\n                max-width: 90%;\n                max-height: 90vh;\n                overflow-y: auto;\n                position: relative;\n            }\n\n            .modal-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 30px;\n            }\n\n            .modal-header h2 {\n                margin: 0;\n                color: var(--text-primary);\n                font-size: 28px;\n            }\n\n            .close-modal {\n                background: none;\n                border: none;\n                font-size: 32px;\n                cursor: pointer;\n                color: var(--text-secondary);\n                transition: color 0.3s;\n            }\n\n            .close-modal:hover {\n                color: var(--text-primary);\n            }\n\n            .layout-options {\n                display: flex;\n                gap: 15px;\n                margin-bottom: 30px;\n                flex-wrap: wrap;\n            }\n\n            .layout-option {\n                flex: 1;\n                min-width: 100px;\n            }\n\n            .layout-option input[type=\"radio\"] {\n                display: none;\n            }\n\n            .layout-option label {\n                display: block;\n                padding: 15px;\n                border: 2px solid var(--border-primary);\n                border-radius: 10px;\n                text-align: center;\n                cursor: pointer;\n                transition: all 0.3s;\n                font-weight: 600;\n                background: var(--bg-tertiary);\n                color: var(--text-primary);\n            }\n\n            .layout-option input[type=\"radio\"]:checked + label {\n                background: var(--accent-blue);\n                color: white;\n                border-color: var(--accent-blue);\n            }\n\n            .layout-option.locked label {\n                opacity: 0.5;\n                cursor: not-allowed;\n                position: relative;\n            }\n\n            .layout-option.locked input[type=\"radio\"] {\n                pointer-events: none;\n            }\n\n            .layout-option.locked label::after {\n                content: 'ðŸ”’';\n                position: absolute;\n                top: 50%;\n                right: 10px;\n                transform: translateY(-50%);\n                font-size: 16px;\n            }\n\n            .layout-option.locked:hover label::before {\n                content: 'Subscribe to Unlock';\n                position: absolute;\n                bottom: -30px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0, 0, 0, 0.8);\n                color: white;\n                padding: 5px 10px;\n                border-radius: 5px;\n                font-size: 11px;\n                white-space: nowrap;\n                z-index: 10;\n            }\n\n            .grid-preview {\n                display: grid;\n                gap: 20px;\n                margin-bottom: 30px;\n                min-height: 200px;\n            }\n\n            .grid-preview.layout-1 {\n                grid-template-columns: 1fr;\n            }\n\n            .grid-preview.layout-2 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .grid-preview.layout-4 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .grid-preview.layout-6 {\n                grid-template-columns: repeat(3, 1fr);\n            }\n\n            .grid-slot {\n                border: 2px dashed var(--border-primary);\n                border-radius: 10px;\n                padding: 20px;\n                min-height: 100px;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                background: var(--bg-tertiary);\n            }\n\n            .game-selector {\n                width: 100%;\n                padding: 10px;\n                border: 2px solid var(--border-primary);\n                border-radius: 8px;\n                font-size: 14px;\n                cursor: pointer;\n                transition: border-color 0.3s;\n                background: var(--bg-secondary);\n                color: var(--text-primary);\n            }\n\n            .game-selector:focus {\n                outline: none;\n                border-color: var(--accent-blue);\n            }\n\n            .enter-fullscreen-btn {\n                background: var(--accent-blue);\n                color: white;\n                border: none;\n                padding: 15px 40px;\n                border-radius: 10px;\n                font-size: 18px;\n                font-weight: 600;\n                cursor: pointer;\n                width: 100%;\n                transition: all 0.3s;\n            }\n\n            .enter-fullscreen-btn:hover:not(:disabled) {\n                background: var(--btn-modal-primary-hover);\n                transform: translateY(-2px);\n                box-shadow: var(--shadow-lg);\n            }\n\n            .enter-fullscreen-btn:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n\n            .fullscreen-grid {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100vw;\n                height: 100vh;\n                background: var(--bg-primary);\n                z-index: 2000;\n                display: none;\n                padding: 20px;\n                box-sizing: border-box;\n            }\n\n            .fullscreen-grid.active {\n                display: grid;\n                gap: 20px;\n            }\n\n            .fullscreen-grid.layout-1 {\n                grid-template-columns: 1fr;\n            }\n\n            .fullscreen-grid.layout-2 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .fullscreen-grid.layout-4 {\n                grid-template-columns: repeat(2, 1fr);\n                grid-template-rows: repeat(2, 1fr);\n            }\n\n            .fullscreen-grid.layout-6 {\n                grid-template-columns: repeat(3, 1fr);\n                grid-template-rows: repeat(2, 1fr);\n            }\n\n            .game-card {\n                background: var(--fullscreen-card-bg);\n                border: 2px solid var(--fullscreen-card-border);\n                border-radius: 15px;\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n                color: var(--text-primary);\n                position: relative;\n                overflow: hidden;\n                box-shadow: var(--fullscreen-card-shadow);\n            }\n\n            .game-card::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                height: 4px;\n                background: var(--accent-blue);\n            }\n\n            .game-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 20px;\n            }\n\n            .game-status {\n                font-size: 14px;\n                font-weight: 600;\n                padding: 6px 12px;\n                border-radius: 20px;\n                background: var(--bg-tertiary);\n                color: var(--fullscreen-status);\n            }\n\n            .game-status.live {\n                background: var(--card-live-indicator);\n                color: white;\n                animation: pulse 2s infinite;\n            }\n\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n\n            .teams-container {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                gap: 15px;\n            }\n\n            .team-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px;\n                background: var(--bg-tertiary);\n                border-radius: 10px;\n            }\n\n            .team-info {\n                display: flex;\n                align-items: center;\n                gap: 15px;\n            }\n\n            .team-logo {\n                width: 40px;\n                height: 40px;\n                object-fit: contain;\n            }\n\n            .team-name {\n                font-size: 18px;\n                font-weight: 600;\n                color: var(--fullscreen-team-name);\n            }\n\n            .team-row.winning .team-name {\n                color: var(--fullscreen-winning-name);\n            }\n\n            .team-score {\n                font-size: 32px;\n                font-weight: 700;\n                min-width: 60px;\n                text-align: right;\n                color: var(--fullscreen-score);\n            }\n\n            .team-row.winning .team-score {\n                color: var(--fullscreen-winning-score);\n            }\n\n            .game-footer {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-top: 15px;\n                padding-top: 15px;\n                border-top: 1px solid var(--border-primary);\n            }\n\n            .game-time {\n                font-size: 14px;\n                opacity: 0.8;\n                color: var(--fullscreen-status);\n            }\n\n            .sport-badge {\n                font-size: 12px;\n                font-weight: 600;\n                padding: 4px 10px;\n                border-radius: 12px;\n                background: var(--accent-blue);\n                color: white;\n                text-transform: uppercase;\n            }\n\n            .empty-slot {\n                background: var(--bg-tertiary);\n                border: 2px dashed var(--border-primary);\n                border-radius: 15px;\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                gap: 20px;\n            }\n\n            .empty-slot-logo {\n                width: 80px;\n                height: 80px;\n                opacity: 0.3;\n            }\n\n            .exit-fullscreen {\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                background: var(--accent-red);\n                color: white;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 8px;\n                font-size: 16px;\n                font-weight: 600;\n                cursor: pointer;\n                z-index: 2001;\n                transition: all 0.3s;\n            }\n\n            .exit-fullscreen:hover {\n                opacity: 0.9;\n                transform: scale(1.05);\n            }\n\n            @media (max-width: 768px) {\n                .fullscreen-grid.layout-2,\n                .fullscreen-grid.layout-4,\n                .fullscreen-grid.layout-6 {\n                    grid-template-columns: 1fr;\n                }\n\n                .grid-preview.layout-2,\n                .grid-preview.layout-4,\n                .grid-preview.layout-6 {\n                    grid-template-columns: 1fr;\n                }\n            }\n        "}getModalHTML(){return'\n            <div id="sportsBarModal" class="sports-bar-modal">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>âš¡ Sports Bar Mode</h2>\n                        <button class="close-modal" onclick="sportsBarMode.closeModal()">&times;</button>\n                    </div>\n\n                    <div class="layout-options">\n                        <div class="layout-option">\n                            <input type="radio" id="layout1" name="layout" value="1" checked>\n                            <label for="layout1">1 Game</label>\n                        </div>\n                        <div class="layout-option">\n                            <input type="radio" id="layout2" name="layout" value="2">\n                            <label for="layout2">2 Games</label>\n                        </div>\n                        <div class="layout-option">\n                            <input type="radio" id="layout4" name="layout" value="4">\n                            <label for="layout4">4 Games</label>\n                        </div>\n                        <div class="layout-option">\n                            <input type="radio" id="layout6" name="layout" value="6">\n                            <label for="layout6">6 Games</label>\n                        </div>\n                    </div>\n\n                    <div id="gridPreview" class="grid-preview layout-1"></div>\n\n                    <button id="enterFullscreen" class="enter-fullscreen-btn" disabled>\n                        Enter Sports Bar Mode\n                    </button>\n                </div>\n            </div>\n\n            <div id="fullscreenGrid" class="fullscreen-grid layout-1"></div>\n        '}setAccessPermissions(e){this.isTrial=e.isTrial||!1,this.allowedGrids=e.allowedGrids||[1,2,4,6]}async fetchAccessPermissions(){try{const e=await fetch("/api/subscription/access");if(e.ok){const n=await e.json();this.setAccessPermissions(n)}}catch(e){}}applyLayoutLocks(){const e=void 0;document.querySelectorAll(".layout-option").forEach(e=>{const n=e.querySelector('input[type="radio"]'),t=parseInt(n.value);this.allowedGrids.includes(t)?(e.classList.remove("locked"),n.disabled=!1):(e.classList.add("locked"),n.disabled=!0,e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),window.location.href="/pricing"}))})}init(){const e=document.createElement("style");e.textContent=this.getStyles(),document.head.appendChild(e);const n=document.createElement("div");n.innerHTML=this.getModalHTML(),document.body.appendChild(n),this.fetchAccessPermissions().then(()=>{this.applyLayoutLocks()}),this.attachEventListeners()}attachEventListeners(){document.querySelectorAll('input[name="layout"]').forEach(e=>{e.addEventListener("change",e=>{this.gridLayout=parseInt(e.target.value),this.renderGridPreview()})}),document.getElementById("enterFullscreen")?.addEventListener("click",()=>{this.enterFullscreen()})}setGames(e){this.games=e}async openModal(){this.gridGames={},this.gridLayout=1,await this.fetchAccessPermissions(),this.applyLayoutLocks();const e=this.allowedGrids[0]||1;this.gridLayout=e,document.querySelector(`input[name="layout"][value="${e}"]`).checked=!0,document.getElementById("sportsBarModal").classList.add("active"),this.renderGridPreview()}closeModal(){document.getElementById("sportsBarModal").classList.remove("active")}renderGridPreview(){const e=document.getElementById("gridPreview");e.className=`grid-preview layout-${this.gridLayout}`,e.innerHTML="";const n=Math.min(this.gridLayout,this.MAX_GAMES);for(let t=0;t<n;t++){const n=document.createElement("div");n.className="grid-slot";const a=document.createElement("div");a.textContent=`Slot ${t+1}`,a.style.marginBottom="10px",a.style.fontWeight="600";const o=document.createElement("select");o.className="game-selector",o.dataset.slot=t;const i=document.createElement("option");i.value="",i.textContent="-- Select Game --",o.appendChild(i),this.games.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=this.getGameDisplayText(e),o.appendChild(n)}),o.addEventListener("change",e=>{const n=parseInt(e.target.dataset.slot),t=e.target.value;t?this.gridGames[n]=t:delete this.gridGames[n],this.updateAllGameSelectors(),this.checkAllSlotsSelected()}),this.gridGames[t]&&(o.value=this.gridGames[t]),n.appendChild(a),n.appendChild(o),e.appendChild(n)}this.checkAllSlotsSelected()}getGameDisplayText(e){const n=e.competitions?.[0]?.competitors?.find(e=>"away"===e.homeAway),t=e.competitions?.[0]?.competitors?.find(e=>"home"===e.homeAway),a=void 0,o=void 0;let i=`${n?.team?.abbreviation||"TBD"} @ ${t?.team?.abbreviation||"TBD"}`;return"mixed"===this.mode&&e.sport&&(i+=` (${e.sport.toUpperCase()})`),i}updateAllGameSelectors(){const e=Object.values(this.gridGames);document.querySelectorAll(".game-selector").forEach(n=>{const t=n.value;Array.from(n.options).forEach(n=>{n.value&&n.value!==t&&(n.disabled=e.includes(n.value))})})}checkAllSlotsSelected(){const e=Math.min(this.gridLayout,this.MAX_GAMES),n=Object.keys(this.gridGames).length===e;document.getElementById("enterFullscreen").disabled=!n}async enterFullscreen(){try{const e=await fetch("/api/subscription/validate-grid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gridSize:this.gridLayout})}),n=await e.json();if(!n.allowed)return alert(n.message||"This grid size requires a subscription upgrade."),void(window.location.href="/pricing")}catch(e){return void alert("Unable to verify subscription status. Please try again.")}this.closeModal();const e=document.getElementById("fullscreenGrid");e.className=`fullscreen-grid layout-${this.gridLayout} active`;let n=document.querySelector(".exit-fullscreen");if(n||(n=document.createElement("button"),n.className="exit-fullscreen",n.textContent="âœ• Exit",n.onclick=()=>this.exitFullscreen(),document.body.appendChild(n)),n.style.display="block",this.fullscreenActive=!0,this.renderFullscreenGames(),window.innerWidth<=768&&"undefined"!=typeof MobileFullscreenPaging){this.mobilePaging=new MobileFullscreenPaging;const n=[];for(let e=0;e<Math.min(this.gridLayout,this.MAX_GAMES);e++){const t=this.gridGames[e],a=this.games.find(e=>e.id===t);a&&n.push(a)}const t=e.closest(".fullscreen-container")||document.querySelector(".fullscreen-container")||e.parentElement;this.mobilePaging.setup(n,t)}this.startAutoUpdate()}exitFullscreen(){this.mobilePaging&&(this.mobilePaging.destroy(),this.mobilePaging=null),document.getElementById("fullscreenGrid").classList.remove("active"),document.querySelector(".exit-fullscreen").style.display="none",this.fullscreenActive=!1,this.stopAutoUpdate()}renderFullscreenGames(){const e=document.getElementById("fullscreenGrid");e.innerHTML="";for(let n=0;n<this.gridLayout;n++){const t=this.gridGames[n],a=this.games.find(e=>e.id===t);if(a){const t=this.createGameCard(a,n);e.appendChild(t)}else{const t=this.createEmptySlot(n);e.appendChild(t)}}}createGameCard(e,n){const t=document.createElement("div");t.className="game-card",t.dataset.slot=n;const a=e.competitions?.[0],o=a?.status,i=a?.competitors||[],r=i.find(e=>"away"===e.homeAway),s=i.find(e=>"home"===e.homeAway),l="in"===o?.type?.state,d=l?"live":"",c=l?`${o.type.shortDetail}`:o?.type?.shortDetail||"Scheduled",p=document.createElement("div");p.className="game-header",p.innerHTML=`\n            <div class="game-status ${d}">${c}</div>\n            ${"mixed"===this.mode&&e.sport?`<div class="sport-badge">${e.sport}</div>`:""}\n        `,t.appendChild(p);const u=document.createElement("div");u.className="teams-container";const m=parseInt(r?.score)||0,g=parseInt(s?.score)||0,h=m>g,y=g>m,v=document.createElement("div");v.className="team-row "+(h?"winning":""),v.innerHTML=`\n            <div class="team-info">\n                <img src="${r?.team?.logo}" alt="${r?.team?.abbreviation}" class="team-logo">\n                <div class="team-name">${r?.team?.abbreviation||"TBD"}</div>\n            </div>\n            <div class="team-score">${r?.score||"0"}</div>\n        `,u.appendChild(v);const b=document.createElement("div");b.className="team-row "+(y?"winning":""),b.innerHTML=`\n            <div class="team-info">\n                <img src="${s?.team?.logo}" alt="${s?.team?.abbreviation}" class="team-logo">\n                <div class="team-name">${s?.team?.abbreviation||"TBD"}</div>\n            </div>\n            <div class="team-score">${s?.score||"0"}</div>\n        `,u.appendChild(b),t.appendChild(u);const f=document.createElement("div");return f.className="game-footer",f.innerHTML=`\n            <div class="game-time">${this.formatGameTime(e)}</div>\n        `,t.appendChild(f),t}createEmptySlot(e){const n=document.createElement("div");n.className="empty-slot",n.dataset.slot=e;let t="/images/logo.png";if("league"===this.mode&&this.sport){const e=void 0;t={nfl:"/images/nfl-logo.png",nba:"/images/nba-logo.png",mlb:"/images/mlb-logo.png",nhl:"/images/nhl-logo.png"}[this.sport]||t}n.innerHTML=`\n            <img src="${t}" alt="Logo" class="empty-slot-logo">\n            <select class="game-selector" data-slot="${e}">\n                <option value="">-- Select Game --</option>\n            </select>\n        `;const a=n.querySelector(".game-selector");return this.games.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=this.getGameDisplayText(e),a.appendChild(n)}),a.addEventListener("change",n=>{const t=n.target.value;t&&(this.gridGames[e]=t,this.renderFullscreenGames())}),n}formatGameTime(e){const n=void 0;return new Date(e.date).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}async updateScores(){this.fullscreenActive&&this.renderFullscreenGames()}startAutoUpdate(){this.stopAutoUpdate(),this.updateInterval=setInterval(()=>{this.fullscreenActive&&window.dispatchEvent(new CustomEvent("sportsBarUpdateNeeded"))},15e3)}stopAutoUpdate(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}}let sportsBarMode=null;function initSportsBarMode(e={}){return sportsBarMode=new SportsBarMode(e),sportsBarMode.init(),sportsBarMode}})();