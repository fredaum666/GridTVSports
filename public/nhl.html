<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NHL Live Games - GridTV Sports</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’</text></svg>">
  <style>
    :root {
      /* ========== REGULAR CARD SIZES ========== */
      /* Regular Card - Team Logos */
      --regular-team-logo-large: 60px;
      --regular-team-logo-live: 45px;

      /* Regular Card - Team Names */
      --regular-team-name-large: 14px;
      --regular-team-name-live: 13px;

      /* Regular Card - Scores */
      --regular-score-size: 48px;

      /* Regular Card - Records */
      --regular-team-record: 11px;

      /* Regular Card - Period Grid */
      --regular-period-header: 10px;
      --regular-period-score: 12px;
      --regular-period-total: 14px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      overflow-x: hidden;
      width: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0a0e1a;
      color: #e0e0e0;
      min-height: 100vh;
      overflow-x: hidden;
      width: 100%;
      max-width: 100vw;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.8;
      }
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }
    }

    .back-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }

    .sports-bar-btn {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
    }

    .sports-bar-btn:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.5);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 30px;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      border: 1px solid #334155;
    }

    .modal-content h2 {
      margin-bottom: 24px;
      color: #fff;
      font-size: 24px;
      text-align: center;
    }

    .layout-options {
      display: flex;
      gap: 15px;
      margin-bottom: 24px;
      justify-content: center;
    }

    .layout-options label {
      background: #334155;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .layout-options label:hover {
      background: #475569;
      border-color: #17a2b8;
    }

    .layout-options input[type="radio"] {
      margin-right: 8px;
    }

    .layout-options input[type="radio"]:checked+label,
    .layout-options label:has(input[type="radio"]:checked) {
      background: #17a2b8;
      border-color: #17a2b8;
      font-weight: 700;
    }

    /* Grid Preview in Modal */
    .grid-preview {
      margin-bottom: 24px;
      display: grid;
      gap: 15px;
      padding: 20px;
      background: #0a0e1a;
      border-radius: 8px;
      max-height: 500px;
      overflow-y: auto;
    }

    .grid-preview.grid-1 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-3 {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto 24px;
    }

    .grid-preview.grid-4 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-preview.grid-6 {
      grid-template-columns: repeat(3, 1fr);
    }

    .grid-slot {
      background: #1a1f2e;
      border: 2px solid #334155;
      border-radius: 8px;
      padding: 15px;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .slot-label {
      font-size: 12px;
      font-weight: 700;
      color: #17a2b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .game-selector {
      width: 100%;
      padding: 10px;
      background: #334155;
      color: #fff;
      border: 2px solid #475569;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .game-selector:hover {
      border-color: #17a2b8;
      background: #3d4d63;
    }

    .game-selector:focus {
      outline: none;
      border-color: #17a2b8;
      box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.2);
    }

    .game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
    }

    /* Full Screen Game Selector */
    .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      display: none;
      z-index: 1100;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fs-game-selector {
      width: 100%;
      padding: 8px 12px;
      background: rgba(26, 31, 46, 0.95);
      color: #fff;
      border: 2px solid #17a2b8;
      border-radius: 6px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .fs-game-selector:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }

    .fs-game-selector option {
      background: #1a1f2e;
      color: #fff;
      padding: 10px;
      font-size: 1rem;
    }

    .game-checkboxes {
      margin-bottom: 24px;
      max-height: 400px;
      overflow-y: auto;
    }

    .game-checkbox-item {
      background: #334155;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
    }

    .game-checkbox-item:hover {
      background: #475569;
      border-color: #17a2b8;
    }

    .game-checkbox-item.selected {
      background: #17a2b8;
      border-color: #17a2b8;
    }

    .game-checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .game-checkbox-info {
      flex: 1;
    }

    .game-checkbox-teams {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .game-checkbox-score {
      font-size: 14px;
      color: #94a3b8;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-buttons button {
      padding: 12px 32px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #enter-fullscreen {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
    }

    #enter-fullscreen:hover {
      background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
      transform: translateY(-1px);
    }

    #enter-fullscreen:disabled {
      background: #475569;
      cursor: not-allowed;
      opacity: 0.5;
    }

    #cancel-modal {
      background: #64748b;
      color: white;
    }

    #cancel-modal:hover {
      background: #475569;
    }

    .selection-counter {
      text-align: center;
      margin-bottom: 16px;
      font-size: 14px;
      color: #94a3b8;
    }

    .selection-counter.error {
      color: #ef4444;
      font-weight: 700;
    }

    /* Full Screen Container */
    .fullscreen-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #0a0e1a;
      z-index: 99999;
      overflow: hidden;
    }

    .fullscreen-container.active {
      display: flex;
      flex-direction: column;
    }

    /* Hover trigger zone at top of screen */
    .fullscreen-hover-trigger {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 999;
      pointer-events: auto;
    }

    .fullscreen-hover-trigger:hover~.fullscreen-controls {
      transform: translateY(0);
    }

    .fullscreen-controls {
      background: rgba(26, 31, 46, 0.95);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #334155;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      transform: translateY(-100%);
      transition: transform 0.3s ease-in-out;
    }

    .fullscreen-controls.visible {
      transform: translateY(0);
    }

    /* Show controls only on hover at top zone or on controls themselves */
    .fullscreen-controls:hover {
      transform: translateY(0);
    }

    .fullscreen-controls button {
      background: #334155;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
    }

    .fullscreen-controls button:hover {
      background: #475569;
    }

    #exit-fullscreen {
      background: #ef4444;
    }

    #exit-fullscreen:hover {
      background: #dc2626;
    }

    .fullscreen-grid {
      flex: 1;
      display: grid;
      gap: clamp(10px, 1.5vh, 20px);
      padding: clamp(10px, 1.5vh, 20px);
      overflow-y: auto;
      overflow-x: hidden;
      height: calc(100vh - 80px);
      box-sizing: border-box;
    }

    /* Custom scrollbar for fullscreen grid */
    .fullscreen-grid::-webkit-scrollbar {
      width: 12px;
    }

    .fullscreen-grid::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 6px;
    }

    .fullscreen-grid::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.6);
      border-radius: 6px;
      border: 2px solid rgba(15, 23, 42, 0.5);
    }

    .fullscreen-grid::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.8);
    }

    .fullscreen-grid.grid-1 {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr;
      place-items: center;
      padding: clamp(20px, 3vh, 40px);
    }

    .fullscreen-grid.grid-1 .fullscreen-game-card {
      max-width: min(900px, 90vw);
      max-height: 90vh;
      width: 100%;
      height: 100%;
    }

    .fullscreen-grid.grid-2 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 1fr;
      gap: clamp(10px, 1.5vw, 20px);
      height: calc(100vh - 80px);
    }

    .fullscreen-grid.grid-2 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-grid.grid-4 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(8px, 1.2vh, 15px);
      height: calc(100vh - 80px);
      overflow: hidden;
    }

    .fullscreen-grid.grid-4 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-grid.grid-6 {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: clamp(6px, 1vh, 12px);
      height: calc(100vh - 80px);
      overflow: hidden;
    }

    .fullscreen-grid.grid-6 .fullscreen-game-card {
      width: 100%;
      height: 100%;
      min-height: 0;
      max-height: 100%;
    }

    .fullscreen-game-card {
      background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
      border-radius: clamp(8px, 1.2vh, 16px);
      padding: clamp(15px, 2.5vh, 30px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      border: 3px solid #334155;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      position: relative;
      width: 100%;
      height: 100%;
      min-height: 0;
      box-sizing: border-box;
      overflow: hidden;
    }

    /* Sport Logo in Top Left */
    .sport-logo-indicator {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 120px;
      height: 120px;
      object-fit: contain;
      opacity: 0.9;
      filter: drop-shadow(0 2px 12px rgba(0, 0, 0, 0.6));
    }

    .fullscreen-game-card.empty-slot {
      border-style: dashed;
      border-color: #475569;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .fullscreen-game-card.empty-slot .fs-game-selector-container {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
    }

    .fullscreen-game-card.winning-home {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.winning-away {
      border-color: #22c55e;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e3a2e 100%);
    }

    .fullscreen-game-card.tied {
      border-color: #fbbf24;
      background: linear-gradient(135deg, #1a1f2e 0%, #3a2e1e 100%);
    }

    /* Upcoming game styling */

    /* Final game styling */
    .fullscreen-game-card.final-game {
      border-color: #64748b;
      background: linear-gradient(135deg, #1a1f2e 0%, #2a2e3a 100%);
      opacity: 0.92;
    }

    .fullscreen-final-status {
      font-size: 2rem;
      font-weight: 900;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .fullscreen-game-card.upcoming-game {
      border-color: #6366f1;
      background: linear-gradient(135deg, #1a1f2e 0%, #1e2a3a 100%);
      opacity: 0.95;
    }

    .fullscreen-game-card.upcoming-game .fullscreen-period {
      color: #818cf8;
      font-size: 1.8rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    .fullscreen-game-card.upcoming-game .fullscreen-score {
      color: #6366f1;
      font-size: 5rem;
      opacity: 0.6;
    }

    .fullscreen-period {
      font-size: 2rem;
      font-weight: 700;
      color: #17a2b8;
      margin-bottom: 20px;
      text-transform: uppercase;
    }

    .fullscreen-team {
      width: 100%;
      margin-bottom: 15px;
    }

    .fullscreen-team-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .fullscreen-team-logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .fullscreen-team-name {
      font-size: 3.5rem;
      font-weight: 900;
      line-height: 1.1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .fullscreen-score {
      font-size: 6rem;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      animation: scoreUpdate 0.5s ease-out;
      min-width: fit-content;
      flex-shrink: 0;
    }

    @keyframes scoreUpdate {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
        color: #22c55e;
      }

      100% {
        transform: scale(1);
      }
    }

    .fullscreen-team.winning .fullscreen-team-name {
      color: #22c55e;
    }

    .fullscreen-team.losing .fullscreen-team-name {
      color: #ef4444;
    }

    .fullscreen-vs {
      font-size: 2rem;
      color: #64748b;
      margin: 10px 0;
      font-weight: 700;
    }

    .fullscreen-possession {
      position: absolute;
      top: -5px;
      right: -5px;
      font-size: clamp(1rem, 2.5vmin, 1.8rem);
      line-height: 1;
      animation: possessionBlink 1s infinite;
      filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.9));
    }

    @keyframes possessionBlink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.4;
      }
    }

    .fullscreen-Shots-distance {
      font-size: 2.8rem;
      color: #94a3b8;
      margin-top: 15px;
      font-weight: 600;
    }

    /* Horizontal Layout (NBA-style) */
    .fullscreen-card-content {
      width: 100%;
      height: 100%;
      min-height: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      /*gap: clamp(12px, 2.5vh, 40px);*/
      padding: clamp(10px, 2vmin, 30px);
      box-sizing: border-box;
      overflow: hidden;
    }

    .fullscreen-live-score-header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: clamp(15px, 3vw, 50px);
      width: 100%;
      max-width: 95%;
      margin: 0 auto;
      flex-shrink: 1;
      min-height: 0;
    }

    .fullscreen-team-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(5px, 1vh, 12px);
      position: relative;
      flex-shrink: 1;
      min-height: 0;
    }

    .fullscreen-team-stack .fullscreen-team-logo {
      width: clamp(50px, 10vmin, 100px);
      height: clamp(50px, 10vmin, 100px);
      object-fit: contain;
      flex-shrink: 1;
    }

    .fullscreen-team-score {
      font-size: clamp(3rem, 10vmin, 7rem);
      font-weight: 900;
      color: #fff;
      min-width: clamp(70px, 15vw, 150px);
      text-align: center;
      flex-shrink: 0;
      line-height: 1;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }

    .fullscreen-team-score.winning {
      color: #22c55e;
    }

    .fullscreen-team-score.losing {
      color: #9ca3af;
    }

    .fullscreen-live-team-name {
      font-size: clamp(1.2rem, 3vmin, 2.5rem);
      font-weight: 900;
      color: #e5e7eb;
      text-align: center;
      white-space: nowrap;
    }

    .fullscreen-live-team-name.winning {
      color: #22c55e;
    }

    .fullscreen-team-record {
      font-size: clamp(0.8rem, 2.8vmin, 1.4rem);
      color: #9ca3b8;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
    }

    .fullscreen-vs-divider-live {
      font-size: clamp(1.2rem, 2.5vmin, 2rem);
      font-weight: 700;
      color: #64748b;
      flex-shrink: 0;
    }

    .fullscreen-status-container {
      margin-bottom: clamp(15px, 3vh, 30px);
      width: 100%;
      text-align: center;
    }

    .fullscreen-status-text {
      font-size: clamp(1.2rem, 3vmin, 2.5rem);
      font-weight: 700;
      color: #22c55e;
      text-transform: uppercase;
    }

    .fullscreen-upcoming-status-text {
      font-size: clamp(1.2rem, 3vmin, 2rem);
      font-weight: 700;
      color: #818cf8;
      margin-bottom: clamp(15px, 3vh, 25px);
      text-align: center;
      width: 100%;
    }

    .fullscreen-situation-info {
      font-size: clamp(1.2rem, 3vmin, 2rem);
      color: #fbbf24;
      font-weight: 700;
      text-align: center;
      margin-top: clamp(10px, 2vh, 20px);
      width: 100%;
    }

    /* Grid-specific sizing for horizontal layout */
    .fullscreen-grid.grid-1 .fullscreen-team-stack .fullscreen-team-logo {
      width: clamp(80px, 12vmin, 120px) !important;
      height: clamp(80px, 12vmin, 120px) !important;
    }

    .fullscreen-grid.grid-1 .fullscreen-live-team-name {
      font-size: clamp(1.8rem, 4vmin, 3rem) !important;
    }

    .fullscreen-grid.grid-1 .fullscreen-team-score {
      font-size: clamp(5rem, 12vmin, 9rem) !important;
    }

    .fullscreen-grid.grid-1 .fullscreen-team-record {
      font-size: clamp(1rem, 2vmin, 1.5rem) !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-team-stack .fullscreen-team-logo {
      width: clamp(60px, 10vmin, 100px) !important;
      height: clamp(60px, 10vmin, 100px) !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-live-team-name {
      font-size: clamp(1.4rem, 3vmin, 2.5rem) !important;
    }

    .fullscreen-grid.grid-2 .fullscreen-team-score {
      font-size: clamp(4rem, 10vmin, 7rem) !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-stack .fullscreen-team-logo {
      width: clamp(45px, 8vmin, 70px) !important;
      height: clamp(45px, 8vmin, 70px) !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-live-team-name {
      font-size: clamp(1rem, 2.5vmin, 1.8rem) !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-team-score {
      /*font-size: clamp(2.5rem, 7vmin, 5rem) !important;*/
      min-width: clamp(50px, 10vw, 100px) !important;
    }

    .fullscreen-grid.grid-4 .fullscreen-live-score-header {
      gap: clamp(10px, 2vw, 30px) !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-stack .fullscreen-team-logo {
      width: clamp(35px, 6vmin, 55px) !important;
      height: clamp(35px, 6vmin, 55px) !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-live-team-name {
      font-size: clamp(0.9rem, 2vmin, 1.4rem) !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-team-score {
      /*font-size: clamp(2rem, 5vmin, 3.5rem) !important;*/
      min-width: clamp(40px, 8vw, 70px) !important;
    }



    .fullscreen-grid.grid-6 .fullscreen-live-score-header {
      gap: clamp(8px, 1.5vw, 15px) !important;
    }

    .fullscreen-grid.grid-6 .fullscreen-status-text {
      font-size: clamp(0.9rem, 2vmin, 1.4rem) !important;
    }

    .fullscreen-field-position {
      font-size: 2rem;
      color: #64748b;
      margin-top: 10px;
    }

    .fullscreen-refresh-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      background: #22c55e;
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .fullscreen-refresh-indicator.active {
      opacity: 1;
      animation: pulse 1s;
    }

    /* Play Animations */
    .play-animation {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      z-index: 100;
      pointer-events: none;
      animation: fadeOut 3s forwards;
    }

    .play-animation-icon {
      font-size: clamp(3rem, 8vh, 8rem);
      margin-bottom: clamp(10px, 2vh, 20px);
      animation: playIconBounce 0.8s ease-out;
    }

    .play-animation-text {
      font-size: clamp(1.5rem, 4vh, 4rem);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: clamp(1px, 0.3vh, 3px);
      animation: playTextSlide 0.8s ease-out;
      text-align: center;
      padding: 0 10px;
      line-height: 1.2;
    }

    .play-animation-subtext {
      font-size: clamp(1rem, 2.5vh, 2.5rem);
      font-weight: 700;
      margin-top: clamp(5px, 1vh, 10px);
      text-align: center;
      padding: 0 10px;
      line-height: 1.2;
    }

    /* Goal Animation - Red/White (NHL Standard) */
    .play-animation.goal .play-animation-icon {
      color: #dc2626;
      text-shadow: 0 0 30px #dc2626, 0 0 60px #dc2626;
    }

    .play-animation.goal .play-animation-text {
      background: linear-gradient(90deg, #dc2626, #ffffff, #dc2626);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: playTextSlide 0.8s ease-out, gradientShift 2s linear infinite;
    }

    /* Save Animation - Blue */
    .play-animation.save .play-animation-icon {
      color: #3b82f6;
      text-shadow: 0 0 30px #3b82f6, 0 0 60px #3b82f6;
    }

    .play-animation.save .play-animation-text {
      color: #3b82f6;
      text-shadow: 0 0 20px #3b82f6;
    }

    /* Power Play Goal Animation - Yellow/Gold */
    .play-animation.powerplay .play-animation-icon {
      color: #fbbf24;
      text-shadow: 0 0 30px #fbbf24, 0 0 60px #fbbf24;
    }

    .play-animation.powerplay .play-animation-text {
      color: #fbbf24;
      text-shadow: 0 0 20px #fbbf24;
    }

    /* Hat Trick Animation - Purple/Gold */
    .play-animation.hattrick .play-animation-icon {
      color: #a855f7;
      text-shadow: 0 0 30px #a855f7, 0 0 60px #a855f7;
    }

    .play-animation.hattrick .play-animation-text {
      background: linear-gradient(90deg, #a855f7, #fbbf24, #a855f7);
      background-size: 200% auto;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: playTextSlide 0.8s ease-out, gradientShift 2s linear infinite;
    }

    /* Penalty Animation - Orange/Red */
    .play-animation.penalty .play-animation-icon {
      color: #f97316;
      text-shadow: 0 0 30px #f97316, 0 0 60px #f97316;
    }

    .play-animation.penalty .play-animation-text {
      color: #f97316;
      text-shadow: 0 0 20px #f97316;
    }

    /* Shootout Animation - Cyan/White */
    .play-animation.shootout .play-animation-icon {
      color: #06b6d4;
      text-shadow: 0 0 30px #06b6d4, 0 0 60px #06b6d4;
    }

    .play-animation.shootout .play-animation-text {
      color: #06b6d4;
      text-shadow: 0 0 20px #06b6d4;
    }

    @keyframes fadeOut {
      0% {
        opacity: 1;
      }

      70% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    @keyframes playIconBounce {
      0% {
        transform: scale(0) rotate(0deg);
      }

      50% {
        transform: scale(1.2) rotate(180deg);
      }

      100% {
        transform: scale(1) rotate(360deg);
      }
    }

    @keyframes playTextSlide {
      0% {
        transform: translateY(50px);
        opacity: 0;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% center;
      }

      100% {
        background-position: 200% center;
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â–ˆâ–ˆâ–ˆ DESKTOP/TABLET SCREENS (min-width: 769px) â–ˆâ–ˆâ–ˆ
       Grid-specific responsive sizing - Only applies to larger screens
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (min-width: 769px) {

      /* Grid-specific responsive sizing */
      /* 6-Grid Layout - Smaller text to fit 3 columns */
      .fullscreen-grid.grid-6 .fullscreen-team-logo {
        width: 45px !important;
        height: 45px !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team-header {
        gap: 6px !important;
        margin-bottom: 6px !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-team-name {
        font-size: 1.6rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-score {
        font-size: 3rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-period {
        font-size: 1.2rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-vs {
        font-size: 1rem !important;
        margin: 3px 0 !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-Shots-distance {
        font-size: 1.4rem !important;
        margin-top: 5px !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-field-position {
        font-size: 1rem !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-possession {
        width: 16px !important;
        height: 16px !important;
        margin-left: 4px !important;
      }

      .fullscreen-grid.grid-6 .sport-logo-indicator {
        width: 70px !important;
        height: 70px !important;
        top: 10px !important;
        left: 10px !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-game-card {
        padding: 15px !important;
      }

      /* 4-Grid Layout - Medium text */
      .fullscreen-grid.grid-4 .fullscreen-team-logo {
        width: 55px !important;
        height: 55px !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-header {
        gap: 8px !important;
        margin-bottom: 8px !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-name {
        font-size: 1.8rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-score {
        font-size: 3.5rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-period {
        font-size: 1.3rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-vs {
        font-size: 1.1rem !important;
        margin: 3px 0 !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-Shots-distance {
        font-size: 1.6rem !important;
        margin-top: 6px !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-field-position {
        font-size: 1.1rem !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-possession {
        width: 18px !important;
        height: 18px !important;
        margin-left: 5px !important;
      }

      .fullscreen-grid.grid-4 .sport-logo-indicator {
        width: 85px !important;
        height: 85px !important;
        top: 12px !important;
        left: 12px !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-game-card {
        padding: 18px !important;
      }

      /* 2-Grid Layout - Keep large text (default) */
      .fullscreen-grid.grid-2 .fullscreen-team-name {
        font-size: 3.5rem !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-score {
        font-size: 6rem !important;
      }

      /* Responsive - Tablets and smaller */
      @media (max-width: 1200px) {
        .fullscreen-grid.grid-6 {
          grid-template-columns: repeat(2, 1fr);
          grid-template-rows: repeat(3, 1fr);
        }

        .fullscreen-grid.grid-6 .fullscreen-team-name {
          font-size: 2.5rem !important;
        }

        .fullscreen-grid.grid-6 .fullscreen-score {
          font-size: 4.5rem !important;
        }

        .fullscreen-grid.grid-4 .fullscreen-team-name {
          font-size: 2.5rem !important;
        }

        .fullscreen-grid.grid-4 .fullscreen-score {
          font-size: 4rem !important;
        }
      }

    }

    /* â—„ End @media (min-width: 769px) - Desktop/Tablet grid rules */

    /* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
       â•‘          FULLSCREEN CARD SIZING CONFIGURATION - NHL PAGE                      â•‘
       â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
       â•‘  This section controls all element sizes in fullscreen cards.                â•‘
       â•‘  Organized by: SCREEN TYPE â†’ GRID LAYOUT â†’ ELEMENT                           â•‘
       â•‘                                                                              â•‘
       â•‘  SIZE FORMAT: clamp(MIN, PREFERRED, MAX)                                     â•‘
       â•‘    - MIN: Smallest the element will ever be                                  â•‘
       â•‘    - PREFERRED: Scales with viewport (vw = viewport width)                   â•‘
       â•‘    - MAX: Largest the element will ever be                                   â•‘
       â•‘                                                                              â•‘
       â•‘  ELEMENTS: Team Logo, Team Name, Team Record, Score, League Logo,            â•‘
       â•‘            Period/Status, VS Text, Situation Info                            â•‘
       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â–ˆâ–ˆâ–ˆ MOBILE SCREENS (max-width: 768px) â–ˆâ–ˆâ–ˆ
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 768px) {

      /* Grid preview in modal */
      .grid-preview.grid-4,
      .grid-preview.grid-6 {
        grid-template-columns: 1fr;
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 1 - SINGLE GAME                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 1: LAYOUT --- */
      .fullscreen-grid.grid-1 {
        grid-template-columns: 1fr !important;
        grid-template-rows: 1fr !important;
        height: 100dvh !important;
        padding: 10px !important;
        /* â—„ Grid padding */
        gap: 0 !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-game-card {
        max-width: 100% !important;
        height: calc(100dvh - 20px) !important;
        padding: 15px !important;
        /* â—„ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 1vh !important;
        /* â—„ Content gap */
      }

      .fullscreen-grid.grid-1 .fullscreen-live-score-header {
        flex-direction: column !important;
        gap: 1vh !important;
        /* â—„ Header gap */
        width: 100% !important;
        align-items: center !important;
      }

      .fullscreen-grid.grid-1 .fullscreen-team-stack {
        flex-direction: row !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        gap: 3vw !important;
        /* â—„ Team stack gap */
      }

      /* --- Grid 1: TEAM LOGO --- */
      .fullscreen-grid.grid-1 .fullscreen-team-logo {
        width: 15vw !important;
        /* â—„ Logo width */
        height: 15vw !important;
        /* â—„ Logo height */
        max-width: 80px !important;
        /* â—„ Logo max width */
        max-height: 80px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 1: TEAM NAME --- */
      .fullscreen-grid.grid-1 .fullscreen-live-team-name {
        font-size: clamp(1.5rem, 8vw, 3rem) !important;
        /* â—„ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 1: TEAM RECORD --- */
      .fullscreen-grid.grid-1 .fullscreen-team-record {
        font-size: clamp(0.8rem, 3vw, 1.2rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 1: SCORE --- */
      .fullscreen-grid.grid-1 .fullscreen-team-score {
        font-size: clamp(3rem, 15vw, 6rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 1: LEAGUE LOGO --- */
      .fullscreen-grid.grid-1 .sport-logo-indicator {
        width: 18vw !important;
        /* â—„ League logo width */
        height: 18vw !important;
        /* â—„ League logo height */
        max-width: 90px !important;
        /* â—„ League logo max width */
        max-height: 90px !important;
        /* â—„ League logo max height */
        top: 15px !important;
        /* â—„ Position from top */
        left: 15px !important;
        /* â—„ Position from left */
      }

      /* --- Grid 1: PERIOD/STATUS --- */
      .fullscreen-grid.grid-1 .fullscreen-status-text {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;
        /* â—„ Period/status size */
      }

      .fullscreen-grid.grid-1 .fullscreen-upcoming-status-text {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;
        /* â—„ Upcoming status size */
      }

      /* --- Grid 1: VS TEXT --- */
      .fullscreen-grid.grid-1 .fullscreen-vs-divider-live {
        display: block !important;
        font-size: clamp(1.5rem, 6vw, 2.5rem) !important;
        /* â—„ VS text size */
        color: rgba(255, 255, 255, 0.7) !important;
        margin: 0.5vh 0 !important;
      }

      /* --- Grid 1: SITUATION INFO --- */
      .fullscreen-grid.grid-1 .fullscreen-situation-info {
        font-size: clamp(1rem, 4vw, 1.5rem) !important;
        /* â—„ Situation info size */
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 2 - TWO GAMES                                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 2: LAYOUT --- */
      .fullscreen-grid.grid-2 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(2, 1fr) !important;
        height: 100dvh !important;
        padding: 8px !important;
        /* â—„ Grid padding */
        gap: 8px !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-game-card {
        height: calc((100dvh - 24px) / 2) !important;
        padding: 8px !important;
        /* â—„ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 0.5vh !important;
        /* â—„ Content gap */
      }

      .fullscreen-grid.grid-2 .fullscreen-live-score-header {
        flex-direction: row !important;
        gap: 2vw !important;
        /* â—„ Header gap */
        width: 100% !important;
        align-items: center !important;
        justify-content: center !important;
        flex-wrap: nowrap !important;
      }

      .fullscreen-grid.grid-2 .fullscreen-team-stack {
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.3vh !important;
        /* â—„ Team stack gap */
        flex: 0 0 auto !important;
        min-width: 0 !important;
      }

      /* --- Grid 2: TEAM LOGO --- */
      .fullscreen-grid.grid-2 .fullscreen-team-logo {
        width: 14vw !important;
        /* â—„ Logo width */
        height: 14vw !important;
        /* â—„ Logo height */
        max-width: 70px !important;
        /* â—„ Logo max width */
        max-height: 70px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 2: TEAM NAME --- */
      .fullscreen-grid.grid-2 .fullscreen-live-team-name {
        font-size: clamp(1.2rem, 5vw, 2rem) !important;
        /* â—„ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 2: TEAM RECORD --- */
      .fullscreen-grid.grid-2 .fullscreen-team-record {
        font-size: clamp(0.7rem, 2.5vw, 1rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 2: SCORE --- */
      .fullscreen-grid.grid-2 .fullscreen-team-score {
        font-size: clamp(2.5rem, 12vw, 5rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 2: LEAGUE LOGO --- */
      .fullscreen-grid.grid-2 .sport-logo-indicator {
        width: 12vw !important;
        /* â—„ League logo width */
        height: 12vw !important;
        /* â—„ League logo height */
        max-width: 60px !important;
        /* â—„ League logo max width */
        max-height: 60px !important;
        /* â—„ League logo max height */
        top: 8px !important;
        /* â—„ Position from top */
        left: 8px !important;
        /* â—„ Position from left */
      }

      /* --- Grid 2: PERIOD/STATUS --- */
      .fullscreen-grid.grid-2 .fullscreen-status-text {
        font-size: clamp(1rem, 4.5vw, 1.6rem) !important;
        /* â—„ Period/status size */
      }

      .fullscreen-grid.grid-2 .fullscreen-status-container {
        margin-bottom: 0.5vh !important;
      }

      /* --- Grid 2: VS TEXT --- */
      .fullscreen-grid.grid-2 .fullscreen-vs-divider-live {
        font-size: clamp(1rem, 4vw, 1.8rem) !important;
        /* â—„ VS text size */
        flex-shrink: 0 !important;
      }

      /* --- Grid 2: SITUATION INFO --- */
      .fullscreen-grid.grid-2 .fullscreen-situation-info {
        font-size: clamp(1.1rem, 4.5vw, 1.6rem) !important;
        /* â—„ Situation info size */
        margin-top: 0.8vh !important;
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 3 - THREE GAMES                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 3: LAYOUT --- */
      .fullscreen-grid.grid-3 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(3, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;
        /* â—„ Grid padding */
        gap: 6px !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-game-card {
        height: calc((100dvh - 24px) / 3) !important;
        padding: 6px !important;
        /* â—„ Card inner padding */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-card-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        width: 100% !important;
        gap: 0.3vh !important;
        /* â—„ Content gap */
      }

      .fullscreen-grid.grid-3 .fullscreen-live-score-header {
        flex-direction: row !important;
        gap: 2vw !important;
        /* â—„ Header gap */
        width: 100% !important;
        align-items: center !important;
        justify-content: center !important;
        flex-wrap: nowrap !important;
      }

      .fullscreen-grid.grid-3 .fullscreen-team-stack {
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.2vh !important;
        /* â—„ Team stack gap */
        flex: 0 0 auto !important;
        min-width: 0 !important;
      }

      /* --- Grid 3: TEAM LOGO --- */
      .fullscreen-grid.grid-3 .fullscreen-team-logo {
        width: 10vw !important;
        /* â—„ Logo width */
        height: 10vw !important;
        /* â—„ Logo height */
        max-width: 50px !important;
        /* â—„ Logo max width */
        max-height: 50px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 3: TEAM NAME --- */
      .fullscreen-grid.grid-3 .fullscreen-live-team-name {
        font-size: clamp(0.9rem, 4vw, 1.5rem) !important;
        /* â—„ Team name size */
        white-space: nowrap !important;
      }

      /* --- Grid 3: TEAM RECORD --- */
      .fullscreen-grid.grid-3 .fullscreen-team-record {
        font-size: clamp(0.5rem, 2vw, 0.8rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 3: SCORE --- */
      .fullscreen-grid.grid-3 .fullscreen-team-score {
        font-size: clamp(1.8rem, 9vw, 3.5rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 3: LEAGUE LOGO --- */
      .fullscreen-grid.grid-3 .sport-logo-indicator {
        width: 10vw !important;
        /* â—„ League logo width */
        height: 10vw !important;
        /* â—„ League logo height */
        max-width: 50px !important;
        /* â—„ League logo max width */
        max-height: 50px !important;
        /* â—„ League logo max height */
        top: 6px !important;
        /* â—„ Position from top */
        left: 6px !important;
        /* â—„ Position from left */
      }

      /* --- Grid 3: PERIOD/STATUS --- */
      .fullscreen-grid.grid-3 .fullscreen-status-text {
        font-size: clamp(0.8rem, 3.5vw, 1.2rem) !important;
        /* â—„ Period/status size */
      }

      .fullscreen-grid.grid-3 .fullscreen-status-container {
        margin-bottom: 0.3vh !important;
      }

      /* --- Grid 3: VS TEXT --- */
      .fullscreen-grid.grid-3 .fullscreen-vs-divider-live {
        font-size: clamp(0.8rem, 3vw, 1.4rem) !important;
        /* â—„ VS text size */
        flex-shrink: 0 !important;
      }

      /* --- Grid 3: SITUATION INFO --- */
      .fullscreen-grid.grid-3 .fullscreen-situation-info {
        font-size: clamp(0.7rem, 3vw, 1.1rem) !important;
        /* â—„ Situation info size */
        margin-top: 0.3vh !important;
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 4 - FOUR GAMES                                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 4: LAYOUT --- */
      .fullscreen-grid.grid-4 {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(4, 1fr) !important;
        height: 100dvh !important;
        padding: 4px !important;
        /* â—„ Grid padding */
        gap: 4px !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-game-card {
        padding: 3px !important;
        /* â—„ Card inner padding */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-4 .fullscreen-team-stack {
        gap: 1px !important;
        /* â—„ Team stack gap */
        padding: 2px !important;
      }

      /* --- Grid 4: TEAM LOGO --- */
      .fullscreen-grid.grid-4 .fullscreen-team-logo {
        width: 6vw !important;
        /* â—„ Logo width */
        height: 6vw !important;
        /* â—„ Logo height */
        max-width: 50px !important;
        /* â—„ Logo max width */
        max-height: 50px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 4: TEAM NAME --- */
      .fullscreen-grid.grid-4 .fullscreen-live-team-name {
        font-size: clamp(1.2rem, 3vmin, 2.5rem) !important;
        /* â—„ Team name size */
      }

      /* --- Grid 4: TEAM RECORD --- */
      .fullscreen-grid.grid-4 .fullscreen-team-record {
        font-size: clamp(0.8rem, 1.8vmin, 1.2rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 4: SCORE --- */
      .fullscreen-grid.grid-4 .fullscreen-team-score {
        font-size: clamp(1rem, 12vw, 1.6rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 4: LEAGUE LOGO --- */
      .fullscreen-grid.grid-4 .sport-logo-indicator {
        width: 100vw !important;
        /* â—„ League logo width */
        height: 100vw !important;
        /* â—„ League logo height */
        max-width: 50px !important;
        /* â—„ League logo max width */
        max-height: 50px !important;
        /* â—„ League logo max height */

      }

      /* --- Grid 4: PERIOD/STATUS --- */
      .fullscreen-grid.grid-4 .fullscreen-status-text {
        font-size: clamp(1.2rem, 3vmin, 2.5rem) !important;
        /* â—„ Period/status size */
      }

      /* --- Grid 4: VS TEXT --- */
      .fullscreen-grid.grid-4 .fullscreen-vs-divider,
      .fullscreen-grid.grid-4 .fullscreen-vs-divider-live {
        font-size: clamp(0.5rem, 2vw, 0.8rem) !important;
        /* â—„ VS text size */
        padding: 0 3px !important;
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 6 - SIX GAMES                                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 6: LAYOUT --- */
      .fullscreen-grid.grid-6 {
        grid-template-columns: repeat(2, 1fr) !important;
        grid-template-rows: repeat(3, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;
        /* â—„ Grid padding */
        gap: 6px !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-6 .fullscreen-game-card {
        padding: 5px !important;
        /* â—„ Card inner padding */
        overflow: hidden !important;
      }

      /* --- Grid 6: TEAM LOGO --- */
      .fullscreen-grid.grid-6 .fullscreen-team-logo {
        width: 12vw !important;
        /* â—„ Logo width */
        height: 12vw !important;
        /* â—„ Logo height */
        max-width: 90px !important;
        /* â—„ Logo max width */
        max-height: 90px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 6: TEAM NAME --- */
      .fullscreen-grid.grid-6 .fullscreen-live-team-name {
        font-size: clamp(1rem, 5vw, 1.8rem) !important;
        /* â—„ Team name size */
      }

      /* --- Grid 6: TEAM RECORD --- */
      .fullscreen-grid.grid-6 .fullscreen-team-record {
        font-size: clamp(0.6rem, 2vw, 1.1rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 6: SCORE --- */
      .fullscreen-grid.grid-6 .fullscreen-team-score {
        font-size: clamp(2rem, 12vw, 5rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 6: LEAGUE LOGO --- */
      .fullscreen-grid.grid-6 .sport-logo-indicator {
        width: 10vw !important;
        /* â—„ League logo width */
        height: 10vw !important;
        /* â—„ League logo height */
        max-width: 60px !important;
        /* â—„ League logo max width */
        max-height: 60px !important;
        /* â—„ League logo max height */
      }

      /* --- Grid 6: PERIOD/STATUS --- */
      .fullscreen-grid.grid-6 .fullscreen-status-text {
        font-size: clamp(0.9rem, 3.5vw, 1.4rem) !important;
        /* â—„ Period/status size */
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         GRID 8 - EIGHT GAMES                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* --- Grid 8: LAYOUT --- */
      .fullscreen-grid.grid-8 {
        grid-template-columns: repeat(2, 1fr) !important;
        grid-template-rows: repeat(4, 1fr) !important;
        height: 100dvh !important;
        padding: 6px !important;
        /* â—„ Grid padding */
        gap: 6px !important;
        /* â—„ Gap between cards */
        overflow: hidden !important;
      }

      .fullscreen-grid.grid-8 .fullscreen-game-card {
        padding: 5px !important;
        /* â—„ Card inner padding */
        overflow: hidden !important;
      }

      /* --- Grid 8: TEAM LOGO --- */
      .fullscreen-grid.grid-8 .fullscreen-team-logo {
        width: 7vw !important;
        /* â—„ Logo width */
        height: 7vw !important;
        /* â—„ Logo height */
        max-width: 35px !important;
        /* â—„ Logo max width */
        max-height: 35px !important;
        /* â—„ Logo max height */
      }

      /* --- Grid 8: TEAM NAME --- */
      .fullscreen-grid.grid-8 .fullscreen-live-team-name {
        font-size: clamp(0.6rem, 3vw, 1rem) !important;
        /* â—„ Team name size */
      }

      /* --- Grid 8: TEAM RECORD --- */
      .fullscreen-grid.grid-8 .fullscreen-team-record {
        font-size: clamp(0.4rem, 1.5vw, 0.7rem) !important;
        /* â—„ Record size */
      }

      /* --- Grid 8: SCORE --- */
      .fullscreen-grid.grid-8 .fullscreen-team-score {
        font-size: clamp(1.2rem, 6vw, 2rem) !important;
        /* â—„ Score size */
        min-width: auto !important;
      }

      /* --- Grid 8: LEAGUE LOGO --- */
      .fullscreen-grid.grid-8 .sport-logo-indicator {
        width: 6vw !important;
        /* â—„ League logo width */
        height: 6vw !important;
        /* â—„ League logo height */
        max-width: 28px !important;
        /* â—„ League logo max width */
        max-height: 28px !important;
        /* â—„ League logo max height */
      }

      /* --- Grid 8: PERIOD/STATUS --- */
      .fullscreen-grid.grid-8 .fullscreen-status-text {
        font-size: clamp(0.6rem, 2.5vw, 0.9rem) !important;
        /* â—„ Period/status size */
      }

      /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         COMMON MOBILE STYLES                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

      /* Game selector - responsive sizing for mobile (hidden by default, shown on tap) */
      .fs-game-selector-container {
        padding: 4px !important;
        margin-bottom: 4px !important;
      }

      .fs-game-selector {
        padding: 4px 8px !important;
        font-size: clamp(10px, 2.5vw, 14px) !important;
        border-radius: 6px !important;
      }

      /* Always show selector on empty slots */
      .fullscreen-game-card.empty-slot .fs-game-selector-container {
        display: block !important;
      }

      /* Common mobile styles */
      .fullscreen-game-card {
        border-radius: 8px !important;
        border-width: 2px !important;
      }
    }

    /* Main Container */
    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 10px;
    }

    /* Live Games List - Full Width Emphasis */
    .live-games-panel {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .panel-header {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .auto-refresh-info {
      font-size: 12px;
      color: #9ca3af;
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .refresh-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .refresh-btn:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }


    /* Sort Filter Buttons */
    .sort-filters {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .sort-filter-btn {
      background: var(--bg-tertiary, #334155);
      color: var(--text-secondary, #94a3b8);
      border: 2px solid transparent;
      padding: 6px 14px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .sort-filter-btn:hover {
      background: var(--border-hover, #475569);
      color: var(--text-primary, #fff);
    }

    .sort-filter-btn.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border-color: #818cf8;
    }

    .sort-filter-btn svg {
      width: 14px;
      height: 14px;
    }

    @media (max-width: 600px) {
      .sort-filters {
        gap: 6px;
      }

      .sort-filter-btn {
        padding: 5px 10px;
        font-size: 11px;
      }

      .sort-filter-btn svg {
        width: 12px;
        height: 12px;
      }
    }

    /* Games Grid - Fully Responsive */
    .games-grid {
      display: grid;
      /* Auto-fill creates responsive columns - smaller min width allows more columns */
      grid-template-columns: repeat(auto-fill, minmax(min(300px, 100%), 1fr));
      gap: 15px;
      padding: 5px 10px 20px 10px;
      margin-top: 10px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      justify-content: start;
    }

    /* Large Desktop: 4+ cards per row (1600px+) */
    @media (min-width: 1600px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 18px;
        padding: 5px 15px 20px 15px;
      }
    }

    /* Desktop: 3-4 cards per row (1200px - 1599px) */
    @media (min-width: 1200px) and (max-width: 1599px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 15px;
      }
    }

    /* Tablet Landscape: 3 cards per row (900px - 1199px) */
    @media (min-width: 900px) and (max-width: 1199px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 12px;
      }
    }

    /* Tablet Portrait: 2-3 cards (650px - 899px) */
    @media (min-width: 650px) and (max-width: 899px) {
      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 12px;
        padding: 5px 8px 20px 8px;
      }
    }

    /* Small Tablet / Large Mobile: 2 cards (500px - 649px) */
    @media (min-width: 500px) and (max-width: 649px) {
      .games-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 5px 5px 20px 5px;
      }
    }

    /* Mobile: 1 card per row (< 500px) */
    @media (max-width: 499px) {
      .games-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 5px 5px 20px 5px;
        overflow-x: hidden;
      }
    }

    /* Scrollbar styling */
    .games-grid::-webkit-scrollbar {
      width: 8px;
    }

    .games-grid::-webkit-scrollbar-track {
      background: #0a0e1a;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 4px;
    }

    .games-grid::-webkit-scrollbar-thumb:hover {
      background: #2563eb;
    }

    /* Game Card - NFL-style Layout */
    .game-card {
      background: linear-gradient(135deg, #242b3d 0%, #2d3548 100%);
      border-radius: 12px;
      padding: 0;
      border: 2px solid transparent;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      position: relative;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      min-height: fit-content;
    }

    /* Card Slider Container */
    .card-slider-container {
      position: relative;
      width: 100%;
      overflow: hidden;
    }

    .card-pages {
      display: flex;
      transition: transform 0.3s ease;
      width: 100%;
    }

    .card-page {
      flex: 0 0 100%;
      width: 100%;
      padding: 10px;
      padding-bottom: 36px;
      min-height: 100%;
      box-sizing: border-box;
    }

    /* Page Indicators */
    .page-indicators {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 10;
    }

    .page-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.2s;
    }

    .page-dot.active {
      background: #3b82f6;
      transform: scale(1.2);
    }

    .page-dot:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Page 1 - Upcoming Games */
    .page-1-upcoming {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      height: 100%;
      min-height: 200px;
    }

    .page-1-upcoming .team-display {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 400px;
    }

    .page-1-upcoming .team-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .page-1-upcoming .team-logo-large {
      width: var(--regular-team-logo-large, 60px);
      height: var(--regular-team-logo-large, 60px);
      object-fit: contain;
      flex-shrink: 0;
      /* Handle broken images - hide alt text overflow */
      overflow: hidden;
      text-indent: -9999px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .page-1-upcoming .team-name-large {
      font-size: var(--regular-team-name-large, 14px);
      font-weight: 700;
      text-align: center;
      color: #e5e7eb;
      line-height: 1.2;
    }

    .page-1-upcoming .team-standing {
      font-size: var(--regular-team-record, 11px);
      color: #9ca3af;
      font-weight: 600;
    }

    .page-1-upcoming .vs-divider {
      font-size: 14px;
      font-weight: 700;
      color: #6b7280;
    }

    /* Page 1 - Live/Final with Horizontal Layout */
    .page-1-live {
      padding: 10px;
      padding-bottom: 36px;
      min-height: fit-content;
      box-sizing: border-box;
      overflow: visible;
    }

    .live-score-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .team-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .live-team-logo {
      width: var(--regular-team-logo-live, 45px);
      height: var(--regular-team-logo-live, 45px);
      object-fit: contain;
      flex-shrink: 0;
      max-width: 100%;
      /* Handle broken images - hide alt text overflow */
      overflow: hidden;
      text-indent: -9999px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .possession-icon {
      position: absolute;
      top: -5px;
      right: -5px;
      font-size: 18px;
      line-height: 1;
      animation: blink 1.5s infinite;
      filter: drop-shadow(0 0 3px rgba(251, 191, 36, 0.8));
    }

    .live-team-name {
      font-size: var(--regular-team-name-live, 13px);
      font-weight: 700;
      color: #e5e7eb;
      line-height: 1.1;
      text-align: center;
    }

    .live-team-name.winning {
      color: #10b981;
    }

    .live-team-standing {
      font-size: var(--regular-team-record, 11px);
      color: #9ca3af;
      font-weight: 600;
      text-align: center;
    }

    .live-team-score {
      font-size: var(--regular-score-size, 48px);
      font-weight: 700;
      color: #e5e7eb;
      min-width: 60px;
      text-align: center;
      line-height: 1;
    }

    .live-team-score.winning {
      color: #10b981;
    }

    .live-team-score.losing {
      color: #9ca3af;
    }

    .vs-divider-live {
      font-size: 14px;
      font-weight: 700;
      color: #6b7280;
      padding: 0 4px;
    }

    /* Page 2 - Scoring History */
    .page-2-content {
      padding: 16px;
      padding-bottom: 36px;
      min-height: 200px;
      box-sizing: border-box;
    }

    .scoring-history-header {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .scoring-team-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .scoring-history-title {
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: #9ca3af;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* NHL uses 3 periods - 4 columns + team label */
    .periods-grid {
      display: grid;
      grid-template-columns: auto repeat(4, 1fr);
      gap: 5px;
      align-items: center;
    }

    .period-header-cell {
      font-size: var(--regular-period-header, 10px);
      font-weight: 700;
      color: #9ca3af;
      text-align: center;
      padding: 4px 2px;
    }

    .team-label-cell {
      font-size: var(--regular-team-record, 11px);
      font-weight: 600;
      color: #e5e7eb;
      padding: 6px 8px;
    }

    .score-cell {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      padding: 6px 3px;
      text-align: center;
      font-size: var(--regular-period-score, 12px);
      font-weight: 700;
      color: #e5e7eb;
    }

    .score-cell.total {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      font-size: var(--regular-period-total, 14px);
    }

    .score-cell.empty {
      opacity: 0.3;
    }

    /* Live Badge */
    .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #dc2626;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
    }

    .live-badge .live-dot {
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    /* Refresh indicator */
    .refresh-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #10b981;
      animation: pulse 2s infinite;
    }

    @keyframes refreshSpin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .refresh-indicator.active {
      animation: none;
    }

    .refresh-indicator.active .spin {
      animation: refreshSpin 1s linear;
    }

    /* No Games Message */
    .no-games-message {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
    }

    .no-games-message .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .no-games-message h3 {
      font-size: 20px;
      color: #e0e0e0;
      margin-bottom: 8px;
    }

    .no-games-message p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      backdrop-filter: blur(4px);
      overflow-y: auto;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    /* Game Detail Panel */
    .game-detail-panel {
      background: #1a1f2e;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      margin: 40px auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      animation: slideIn 0.3s ease;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
    }

    .close-detail-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .close-detail-btn:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }

    .detail-matchup {
      display: flex;
      align-items: center;
      justify-content: space-around;
      gap: 20px;
    }

    .detail-team {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .detail-team-logo {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }

    .detail-team-name {
      font-size: 14px;
      font-weight: 700;
      text-align: center;
      line-height: 1.2;
    }

    .detail-team-score {
      font-size: 32px;
      font-weight: 700;
      color: #10b981;
    }

    .detail-vs {
      font-size: 18px;
      color: #6b7280;
      font-weight: 600;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      border-bottom: 2px solid #2d3548;
      flex-shrink: 0;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #3b82f6 #1a1f2e;
      position: relative;
    }

    .tabs::-webkit-scrollbar {
      height: 4px;
    }

    .tabs::-webkit-scrollbar-track {
      background: #1a1f2e;
    }

    .tabs::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 2px;
    }

    .tab {
      background: transparent;
      color: #9ca3af;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      border-radius: 8px 8px 0 0;
      position: relative;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .tab:hover {
      background: #242b3d;
      color: #e0e0e0;
    }

    .tab.active {
      background: #3b82f6;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .tab-content.active {
      display: block;
    }

    /* Stats Table */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
      background: #242b3d;
      border-radius: 10px;
      overflow: hidden;
    }

    .stats-table th {
      padding: 12px;
      font-size: 14px;
      font-weight: 600;
      background: #1a1f2e;
    }

    .stats-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #1a1f2e;
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    /* Win Probability */
    .win-prob-container {
      margin-top: 20px;
    }

    .prob-bar-container {
      display: flex;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .prob-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      transition: width 0.5s ease;
    }

    .prob-bar.away {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
    }

    .prob-bar.home {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    }

    .prob-legend {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #9ca3af;
    }

    /* Predictions */
    .prediction-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: #242b3d;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
    }

    .stat-label {
      color: #9ca3af;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
    }

    /* Clickable cards */
    /* Responsive Design */
    @media (max-width: 1200px) {
      .games-grid {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      }
    }

    @media (max-width: 900px) {
      .games-grid {
        grid-template-columns: 1fr;
      }

      .period-scores {
        gap: 12px;
      }

      .period-score {
        font-size: 13px;
        min-width: 20px;
      }

      .period-score.total-score {
        font-size: 22px;
      }

      .team-name {
        font-size: 14px;
        min-width: 120px;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 15px 10px;
      }

      .header-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .header h1 {
        font-size: 18px;
        justify-content: center;
      }

      .header h1 img {
        height: 35px !important;
      }

      .live-indicator {
        font-size: 10px;
        padding: 3px 8px;
      }

      .header-content>div {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
      }

      .theme-select {
        min-width: 140px;
        font-size: 12px;
        padding: 8px 12px;
      }

      .back-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 120px;
      }

      .sports-bar-btn {
        font-size: 12px;
        padding: 8px 12px;
        flex: 1;
        min-width: 140px;
      }

      .panel-header {
        font-size: 16px;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .refresh-btn {
        font-size: 12px;
        padding: 6px 12px;
      }

      .games-grid {
        grid-template-columns: 1fr;
        gap: 20px;
        padding-right: 0;
        padding-left: 0;
        max-height: none;
        width: 100%;
        overflow-x: hidden;
      }

      .game-card {
        padding: 0;
        border-radius: 12px;
        min-height: 200px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }

      .team-row {
        padding: 16px 12px;
        flex-wrap: nowrap;
        width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }

      .team-info {
        gap: 10px;
        flex-shrink: 1;
        min-width: 0;
        max-width: 50%;
      }

      .team-logo {
        width: 28px;
        height: 28px;
        flex-shrink: 0;
      }

      .team-name {
        font-size: 12px;
        min-width: 0;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }

      .period-scores {
        gap: 8px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
      }

      .period-score {
        font-size: 11px;
        min-width: 18px;
        max-width: 24px;
        text-align: center;
      }

      .period-score.total-score {
        font-size: 20px;
        min-width: 32px;
        max-width: 40px;
        font-weight: 700;
        margin-left: 4px;
      }

      .period-header {
        padding: 10px 12px;
        width: 100%;
        box-sizing: border-box;
      }

      .scores-header {
        gap: 8px;
      }

      .period-label {
        font-size: 9px;
        min-width: 18px;
        max-width: 24px;
        text-align: center;
      }

      .period-label:last-child {
        min-width: 32px;
        max-width: 40px;
        margin-left: 4px;
      }

      .game-footer-info {
        padding: 12px;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 50px;
        width: 100%;
        box-sizing: border-box;
      }

      .live-badge {
        font-size: 9px;
        padding: 4px 8px;
      }

      .game-situation {
        flex-direction: row;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        font-size: 10px;
      }

      .period-clock {
        font-size: 10px;
        font-weight: 600;
      }

      .Shots-distance,
      .yard-line {
        font-size: 9px;
      }

      /* Modal fixes for mobile */
      .modal-overlay {
        padding: 10px;
      }

      .modal-content {
        padding: 15px;
        width: 98%;
        max-height: 98vh;
      }

      .modal-content h2 {
        font-size: 16px;
        margin-bottom: 12px;
      }

      .layout-options {
        gap: 6px;
        margin-bottom: 12px;
      }

      .layout-options label {
        padding: 8px 12px;
        font-size: 12px;
      }

      /* Hide 6 game option on mobile - max 4 games */
      .layout-options label:has(input[value="6"]) {
        display: none;
      }

      .grid-preview {
        padding: 8px;
        gap: 8px;
        max-height: 50vh;
      }

      .grid-preview.grid-2,
      .grid-preview.grid-4,
      .grid-preview.grid-6 {
        grid-template-columns: 1fr;
      }

      .grid-slot {
        padding: 10px;
        min-height: 70px;
      }

      .slot-label {
        font-size: 11px;
      }

      .game-selector {
        padding: 8px;
        font-size: 12px;
      }

      .modal-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .modal-buttons button {
        width: 100%;
        padding: 10px 16px;
        font-size: 14px;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 400px) {
      .game-card {
        border-radius: 10px;
      }

      .team-row {
        padding: 12px 8px;
      }

      .team-info {
        gap: 8px;
        max-width: 45%;
      }

      .team-logo {
        width: 24px;
        height: 24px;
      }

      .team-name {
        font-size: 11px;
      }

      .period-scores {
        gap: 6px;
      }

      .period-score {
        font-size: 10px;
        min-width: 16px;
        max-width: 20px;
      }

      .period-score.total-score {
        font-size: 18px;
        min-width: 28px;
        max-width: 36px;
      }

      .period-header {
        padding: 8px;
      }

      .period-label {
        font-size: 8px;
        min-width: 16px;
        max-width: 20px;
      }

      .period-label:last-child {
        min-width: 28px;
        max-width: 36px;
      }

      .game-footer-info {
        padding: 10px 8px;
        gap: 6px;
      }

      .live-badge {
        font-size: 8px;
        padding: 3px 6px;
      }

      .game-situation {
        font-size: 9px;
        gap: 6px;
      }

      .period-clock {
        font-size: 9px;
      }

      /* Modal fixes for mobile */
      .modal-overlay {
        padding: 10px;
      }

      .modal-content {
        padding: 12px;
        width: 100%;
      }

      .modal-content h2 {
        font-size: 14px;
      }

      .layout-options label {
        padding: 6px 10px;
        font-size: 11px;
      }

      .grid-preview {
        padding: 6px;
        gap: 6px;
        max-height: 45vh;
      }

      .grid-slot {
        padding: 8px;
        min-height: 60px;
      }

      .slot-label {
        font-size: 10px;
      }

      .game-selector {
        padding: 6px;
        font-size: 11px;
      }

      .game-detail-panel {
        margin: 20px auto;
        max-height: 95vh;
        width: calc(100% - 20px);
      }

      .detail-header {
        padding: 16px;
        flex-direction: column;
        gap: 12px;
      }

      .detail-matchup {
        flex-direction: row;
        gap: 8px;
        width: 100%;
        justify-content: space-between;
      }

      .detail-team {
        gap: 4px;
        flex: 1;
      }

      .detail-team-logo {
        width: 40px;
        height: 40px;
      }

      .detail-team-name {
        font-size: 11px;
        max-width: 100px;
      }

      .detail-team-score {
        font-size: 24px;
      }

      .detail-vs {
        font-size: 14px;
        align-self: center;
      }

      .close-detail-btn {
        width: 100%;
        padding: 10px;
      }

      /* Tabs container for mobile */
      .tabs {
        padding: 0 12px;
        gap: 4px;
      }

      .tab {
        padding: 10px 16px;
        font-size: 12px;
        min-width: auto;
      }

      .tab-content {
        padding: 16px;
      }

      /* Stats table responsive */
      .stats-table {
        font-size: 12px;
      }

      .stats-table th,
      .stats-table td {
        padding: 8px 4px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 24px;
      }
    }

    /* ============================================
       ORIENTATION LOCK OVERLAYS
       Mobile (phones) = Portrait only
       Tablet = Landscape only
       ============================================ */

    .orientation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 100000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      box-sizing: border-box;
    }

    .orientation-overlay .rotate-icon {
      font-size: 80px;
      margin-bottom: 30px;
      animation: rotateHint 2s ease-in-out infinite;
    }

    .orientation-overlay h2 {
      color: #ffffff;
      font-size: 28px;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .orientation-overlay p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 18px;
      max-width: 300px;
      line-height: 1.5;
    }

    @keyframes rotateHint {

      0%,
      100% {
        transform: rotate(0deg);
      }

      25% {
        transform: rotate(-15deg);
      }

      75% {
        transform: rotate(15deg);
      }
    }

    /* TV Mode - hide orientation overlays */
    body.tv-mode .orientation-overlay {
      display: none !important;
    }

    /* TV Mode - Back to TV Home button */
    .tv-back-btn {
      display: none;
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #6366f1;
      color: white;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .tv-back-btn:hover,
    .tv-back-btn:focus {
      background: #6366f1;
      outline: none;
    }

    body.tv-mode .tv-back-btn {
      display: flex;
    }

    body.tv-mode .back-btn {
      display: none;
    }



    /* Mobile phones in landscape - show "rotate to portrait" overlay */
    /* Targets phones: landscape orientation with height under 600px (phone screens) */
    @media screen and (orientation: landscape) and (max-height: 600px) {
      body:not(.tv-mode) .orientation-overlay.portrait-required {
        display: flex !important;
      }
    }

    /* Tablets in portrait - show "rotate to landscape" overlay */
    /* Targets tablets (min-width 600px in portrait mode) */
    @media screen and (min-width: 600px) and (max-width: 1024px) and (orientation: portrait) {
      body:not(.tv-mode) .orientation-overlay.landscape-required {
        display: flex !important;
      }
    }

    /* Also catch larger tablets in portrait */
    @media screen and (min-width: 768px) and (max-width: 1366px) and (orientation: portrait) and (min-height: 900px) {
      body:not(.tv-mode) .orientation-overlay.landscape-required {
        display: flex !important;
      }
    }

    /* Fullscreen mode orientation overlay - for mobile phones in portrait */
    .fullscreen-orientation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 100001;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      box-sizing: border-box;
    }

    .fullscreen-orientation-overlay .rotate-icon {
      font-size: 80px;
      margin-bottom: 30px;
      animation: rotateHint 2s ease-in-out infinite;
    }

    .fullscreen-orientation-overlay h2 {
      color: #ffffff;
      font-size: 28px;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .fullscreen-orientation-overlay p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 18px;
      max-width: 300px;
      line-height: 1.5;
    }

    /* Show fullscreen orientation overlay on mobile phones in landscape when fullscreen is active */
    @media screen and (orientation: landscape) and (max-height: 500px) {
      .fullscreen-container.active .fullscreen-orientation-overlay {
        display: flex !important;
      }
    }
  </style>
  <!-- <link rel="stylesheet" href="/styles/themes.css"> -->
  <link rel="stylesheet" href="/styles/mobile-fullscreen.css">
  <!-- <script src="/scripts/theme-manager.js"></script> -->
  <link rel="stylesheet" href="/styles/responsive-grid.css?v=1761528533781">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
</head>

<body>
  <script>
    // Detect TV mode from URL parameter or user agent
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const isTV = urlParams.get('tv') === '1' ||
                   navigator.userAgent.includes('AndroidTV') ||
                   navigator.userAgent.includes('GoogleTV') ||
                   navigator.userAgent.includes('FireTV') ||
                   navigator.userAgent.includes('BRAVIA') ||
                   navigator.userAgent.includes('SmartTV') ||
                   navigator.userAgent.includes('Web0S') ||
                   navigator.userAgent.includes('Tizen') ||
                   navigator.userAgent.includes('GridTVSports-AndroidTV');
      if (isTV) {
        document.body.classList.add('tv-mode');

        // Add keyboard handler for TV mode - Back/Escape goes to TV home
        document.addEventListener('keydown', (e) => {
          // Only handle if not in fullscreen mode and not in a modal
          const fullscreenContainer = document.getElementById('fullscreen-container');
          const gameModal = document.getElementById('game-selection-modal');

          const isFullscreenActive = fullscreenContainer && fullscreenContainer.classList.contains('active');
          const isGameModalOpen = gameModal && gameModal.classList.contains('show');

          if (!isFullscreenActive && !isGameModalOpen) {
            if (e.key === 'Escape' || e.key === 'Backspace' || e.keyCode === 27 || e.keyCode === 8) {
              e.preventDefault();
              window.location.href = '/tv-home';
            }
          }
        });
      }
    })();
  </script>
  <!-- Orientation Lock Overlays -->
  <div class="orientation-overlay portrait-required">
    <div class="rotate-icon">ğŸ“±</div>
    <h2>Please Rotate Your Device</h2>
    <p>This app works best in portrait mode on mobile phones</p>
  </div>
  <div class="orientation-overlay landscape-required">
    <div class="rotate-icon">ğŸ“±</div>
    <h2>Please Rotate Your Device</h2>
    <p>This app works best in landscape mode on tablets</p>
  </div>

  <div class="header">
    <div class="header-content">
      <h1 style="display: flex; align-items: center; gap: 15px;">
        <img src="/assets/NHL-Logo.png" alt="NHL" style="height: 50px; width: auto; object-fit: contain;">
        NHL Live Games
        <span class="live-indicator">
          <span class="live-dot"></span>
          LIVE
        </span>
      </h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button class="sports-bar-btn" id="sports-bar-btn">
          ğŸ“º Sports Bar Mode
        </button>
        <button class="back-btn" onclick="window.location.href='/'">
          â† Back to Sports
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Live Games List -->
    <div class="live-games-panel">
      <div class="panel-header">
        <div>
          <span>ğŸ’ All Games</span>
          <div class="auto-refresh-info">
            <span>â—</span>
            <span>Auto-refreshing every 15 seconds</span>
          </div>
        </div>

        <div style="display: flex; gap: 12px; align-items: center;">
          <div class="sort-filters">
            <button class="sort-filter-btn" id="sort-favorites" title="Sort by Favorites First">
              <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
              </svg>
              <span>Favorites</span>
            </button>
            <button class="sort-filter-btn active" id="sort-time" title="Sort by Game Time">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              <span>Time</span>
            </button>
          </div>
          <button class="refresh-btn" onclick="manualRefresh()">
            <span>ğŸ”„</span>
            <span>Refresh Now</span>
          </button>
        </div>
      </div>
      <div class="games-grid" id="games-list"></div>
    </div>
  </div>

  <!-- Game Detail Modal -->
  <div class="modal-overlay" id="game-detail-modal">
    <div class="game-detail-panel">
      <div class="detail-header">
        <div class="detail-matchup" id="detail-matchup">
          <!-- Will be populated with game info -->
        </div>
        <button class="close-detail-btn" onclick="closeGameDetail()">âœ• Close</button>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('boxscore')">ğŸ“Š Box Score</button>
        <button class="tab" onclick="switchTab('stats')">ğŸ“ˆ Game Stats</button>
        <button class="tab" onclick="switchTab('probability')">ğŸ¯ Win Probability</button>
        <button class="tab" onclick="switchTab('predictions')">ğŸ”® Predictions</button>
      </div>

      <div class="tab-content active" id="tab-boxscore">
        <div class="loading">Loading box score...</div>
      </div>

      <div class="tab-content" id="tab-stats">
        <div class="loading">Loading game stats...</div>
      </div>

      <div class="tab-content" id="tab-probability">
        <div class="loading">Loading win probability...</div>
      </div>

      <div class="tab-content" id="tab-predictions">
        <div class="loading">Loading predictions...</div>
      </div>
    </div>
  </div>

  <script>
    let refreshInterval = null;
    let liveGames = [];
    let currentWeek = 1; // Will be fetched from server
    let userFavoriteTeams = []; // Store user's favorite team IDs for this league
    let currentSortMode = 'time'; // 'favorites' or 'time' - default to time sort on page load

    // Fetch user's favorite teams
    async function fetchFavoriteTeams() {
      try {
        const response = await fetch('/api/favorites');
        if (response.ok) {
          const data = await response.json();
          // Filter for NHL teams and store team IDs
          userFavoriteTeams = (data.favorites || [])
            .filter(f => f.league === 'NHL')
            .map(f => f.team_id);
          console.log('â­ Loaded favorite teams:', userFavoriteTeams);
        }
      } catch (error) {
        console.log('Could not load favorite teams:', error);
      }
    }

    // Check if a game involves a favorite team
    function gameInvolvesFavorite(game) {
      if (!userFavoriteTeams.length) return false;
      const comp = game.competitions?.[0];
      if (!comp) return false;

      const homeTeam = comp.competitors?.find(c => c.homeAway === 'home');
      const awayTeam = comp.competitors?.find(c => c.homeAway === 'away');

      const homeId = homeTeam?.team?.id;
      const awayId = awayTeam?.team?.id;

      // Check if any favorite team is involved
      return userFavoriteTeams.some(favId => {
        const teamId = favId.replace('NHL-', '');
        return teamId === homeId || teamId === awayId;
      });
    }

    // Sort games prioritizing favorites within each category
    function sortByFavorites(games) {
      // If sorting by time, return games sorted by date
      if (currentSortMode === 'time') {
        return games.slice().sort((a, b) => new Date(a.date) - new Date(b.date));
      }
      if (!userFavoriteTeams.length) return games;

      const favoriteGames = games.filter(g => gameInvolvesFavorite(g));
      const otherGames = games.filter(g => !gameInvolvesFavorite(g));

      return [...favoriteGames, ...otherGames];
    }

    // Sort by favorites priority (used for auto-selection in Sports Bar Mode - always prioritizes favorites)
    function sortByFavoritesPriority(games) {
      if (!userFavoriteTeams.length) return games;

      const favoriteGames = games.filter(g => gameInvolvesFavorite(g));
      const otherGames = games.filter(g => !gameInvolvesFavorite(g));

      return [...favoriteGames, ...otherGames];
    }

    // Sort games by live status first (for fullscreen grid modal default)
    function sortByLiveFirst(games) {
      const liveGames = games.filter(g => {
        const comp = g.competitions?.[0];
        const statusType = comp?.status?.type?.state;
        return statusType === 'in';
      });
      const otherGames = games.filter(g => {
        const comp = g.competitions?.[0];
        const statusType = comp?.status?.type?.state;
        return statusType !== 'in';
      });
      return [...liveGames, ...otherGames];
    }

    // Team data for logos
    const teams = [
      { name: "Anaheim Ducks", abbreviation: "ANA", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/ana.png" },
      { name: "Arizona Coyotes", abbreviation: "ARI", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/ari.png" },
      { name: "Boston Bruins", abbreviation: "BOS", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/bos.png" },
      { name: "Buffalo Sabres", abbreviation: "BUF", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/buf.png" },
      { name: "Calgary Flames", abbreviation: "CGY", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/cgy.png" },
      { name: "Carolina Hurricanes", abbreviation: "CAR", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/car.png" },
      { name: "Chicago Blackhawks", abbreviation: "CHI", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/chi.png" },
      { name: "Colorado Avalanche", abbreviation: "COL", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/col.png" },
      { name: "Columbus Blue Jackets", abbreviation: "CBJ", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/cbj.png" },
      { name: "Dallas Stars", abbreviation: "DAL", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/dal.png" },
      { name: "Detroit Red Wings", abbreviation: "DET", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/det.png" },
      { name: "Edmonton Oilers", abbreviation: "EDM", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/edm.png" },
      { name: "Florida Panthers", abbreviation: "FLA", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/fla.png" },
      { name: "Los Angeles Kings", abbreviation: "LAK", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/lak.png" },
      { name: "Minnesota Wild", abbreviation: "MIN", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/min.png" },
      { name: "MontrÃ©al Canadiens", abbreviation: "MTL", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/mtl.png" },
      { name: "Nashville Predators", abbreviation: "NSH", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/nsh.png" },
      { name: "New Jersey Devils", abbreviation: "NJD", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/njd.png" },
      { name: "New York Islanders", abbreviation: "NYI", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/nyi.png" },
      { name: "New York Rangers", abbreviation: "NYR", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/nyr.png" },
      { name: "Ottawa Senators", abbreviation: "OTT", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/ott.png" },
      { name: "Philadelphia Flyers", abbreviation: "PHI", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/phi.png" },
      { name: "Pittsburgh Penguins", abbreviation: "PIT", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/pit.png" },
      { name: "San Jose Sharks", abbreviation: "SJS", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/sj.png" },
      { name: "Seattle Kraken", abbreviation: "SEA", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/sea.png" },
      { name: "St. Louis Blues", abbreviation: "STL", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/stl.png" },
      { name: "Tampa Bay Lightning", abbreviation: "TBL", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/tb.png" },
      { name: "Toronto Maple Leafs", abbreviation: "TOR", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/tor.png" },
      { name: "Vancouver Canucks", abbreviation: "VAN", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/van.png" },
      { name: "Vegas Golden Knights", abbreviation: "VGK", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/vgk.png" },
      { name: "Washington Capitals", abbreviation: "WSH", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/wsh.png" },
      { name: "Winnipeg Jets", abbreviation: "WPG", logo: "https://a.espncdn.com/i/teamlogos/nhl/500/wpg.png" }
    ];

    function getTeamLogo(teamName) {
      const team = teams.find(t => t.name === teamName);
      return team ? team.logo : '';
    }

    async function fetchLiveGames() {
      try {
        console.log(` Fetching NHL games...`);

        // Fetch FULL data from our backend which calls ESPN API
        const response = await fetch(`/api/nhl/scoreboard`);

        // Check for session expiration (401)
        if (response.status === 401) {
          console.log('Session expired, redirecting to login...');
          window.location.href = '/login';
          return;
        }

        if (!response.ok) {
          let errorText = '';
          try {
            const errorData = await response.json();
            errorText = errorData.error || 'Unknown error';
          } catch (e) {
            errorText = await response.text();
          }
          console.error('Backend API error:', response.status, errorText);

          // If it's a 500 error, it might be temporary - show a retry message
          if (response.status === 500) {
            throw new Error(`Server error (500). The API might be temporarily unavailable. Retrying in 30 seconds...`);
          } else {
            throw new Error(`Failed to fetch from backend: ${response.status} - ${errorText}`);
          }
        }

        const espnData = await response.json();

        console.log('ğŸ“Š ESPN API Response:', {
          totalEvents: espnData.events?.length || 0,
          events: espnData.events
        });

        // Use the FULL events data from ESPN API (has period, clock, etc.)
        if (espnData.events && espnData.events.length > 0) {
          const allGames = espnData.events.map(event => {
            // Get competition data
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');

            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });

          // CATEGORIZE ALL GAMES
          // Separate games into live, upcoming, and final categories
          let liveGamesList = [];
          let upcomingGamesList = [];
          let finalGamesList = [];

          allGames.forEach(game => {
            const comp = game.competitions[0];
            const isCompleted = comp.status.type.completed;
            const statusState = comp.status.type.state;
            const statusName = comp.status.type.name || '';
            const isFinal = statusName.includes('Final') || statusState === 'post';

            // Game is live if status state is 'in'
            const isLive = statusState === 'in';

            // Game is upcoming if it's scheduled (pre)
            const isUpcoming = statusState === 'pre';
            const gameTime = new Date(game.date);
            const now = new Date();
            const hoursUntilGame = (gameTime - now) / (1000 * 60 * 60);
            const isWithin36Hours = hoursUntilGame <= 36; // Allow negative values (game time passed but not live yet)

            // Game is "about to start" - scheduled time passed but not live yet (transitioning state)
            const isAboutToStart = !isLive && !isFinal && !isUpcoming && hoursUntilGame <= 0 && hoursUntilGame >= -2;

            // Categorize the game - ensure no games fall through the cracks
            if (isLive) {
              liveGamesList.push(game);
            } else if (isAboutToStart) {
              // Games that should have started but API hasn't marked as live yet
              upcomingGamesList.unshift(game);
            } else if (isUpcoming && isWithin36Hours) {
              upcomingGamesList.push(game);
            } else if (isFinal || isCompleted) {
              finalGamesList.push(game);
            } else if (!isFinal && !isCompleted && isWithin36Hours) {
              // Catch-all for games in unknown status but within time window
              upcomingGamesList.push(game);
            }
          });

          // Combine all games in order: Live -> Upcoming -> Final
          // Apply favorites sorting within each category
          liveGames = [
            ...sortByFavorites(liveGamesList),
            ...sortByFavorites(upcomingGamesList),
            ...sortByFavorites(finalGamesList)
          ];

          console.log(`ğŸ’ Found ${allGames.length} total games:`);
          console.log(`  ğŸ”´ ${liveGamesList.length} LIVE`);
          console.log(`  â° ${upcomingGamesList.length} UPCOMING`);
          console.log(`  ğŸ ${finalGamesList.length} FINAL`);

        } else {
          liveGames = [];
        }

        // Store in window for Sports Bar Mode
        window.liveGamesData = liveGames;

        renderGamesList();

      } catch (error) {
        console.error('Error fetching games:', error);
        document.getElementById('games-list').innerHTML = `
          <div style="padding: 20px; text-align: center; color: #ef4444;">
            <div style="font-size: 32px; margin-bottom: 12px;">âš ï¸</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Error Loading Games</div>
            <div style="font-size: 13px; color: #9ca3af; margin-top: 8px; max-width: 400px; margin-left: auto; margin-right: auto; line-height: 1.5;">
              ${error.message}
            </div>
            <button 
              onclick="fetchLiveGames()" 
              style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;"
              onmouseover="this.style.background='#2563eb'" 
              onmouseout="this.style.background='#3b82f6'">
              ğŸ”„ Retry Now
            </button>
            <div style="font-size: 11px; color: #6b7280; margin-top: 12px;">
              The page will automatically retry in 30 seconds
            </div>
          </div>
        `;
      }
    }

    function renderGamesList() {
      const container = document.getElementById('games-list');

      if (liveGames.length === 0) {
        container.innerHTML = `
          <div class="no-games-message">
            <div class="icon">ğŸ’</div>
            <h3>No Games Available</h3>
            <p>There are no games to display right now.<br>Check back later!</p>
          </div>
        `;
        return;
      }

      // Build a map of existing cards by game ID
      const existingCards = new Map();
      container.querySelectorAll('.game-card[data-game-id]').forEach(card => {
        const gameId = card.getAttribute('data-game-id');
        if (gameId) existingCards.set(gameId, card);
      });

      // Separate games by status
      const liveGamesData = [];
      const upcomingGamesData = [];
      const finalGamesData = [];
      const cardsToUpdate = [];

      liveGames.forEach((game, index) => {
        const gameId = game.id;
        const comp = game.competitions[0];
        const statusType = comp.status.type.state;
        const isCompleted = comp.status.type.completed;
        const isFinal = isCompleted || statusType === 'post';
        const isLive = statusType === 'in' ||
          (comp.status.period && comp.status.period > 0 && !isCompleted);
        const isPregame = statusType === 'pre';

        const existingCard = existingCards.get(gameId);
        const existingStatus = existingCard?.dataset?.status;
        const currentStatus = isFinal ? 'post' : (isLive ? 'in' : 'pre');

        // If card exists and is final AND was created as final, skip it entirely (never update final games)
        if (existingCard && isFinal && existingStatus === 'post') {
          existingCards.delete(gameId); // Mark as still valid
          finalGamesData.push(game);
          return;
        }

        // If card exists and is live AND was created as live, queue for update after repositioning
        if (existingCard && isLive && existingStatus === 'in') {
          existingCards.delete(gameId); // Mark as still valid
          cardsToUpdate.push({ card: existingCard, game });
          liveGamesData.push(game);
          return;
        }

        // If card exists but status changed (pre->in, pre->post, in->post), recreate it
        if (existingCard) {
          existingCard.remove();
        }

        // Create new card for new games or status changes
        if (isFinal) {
          finalGamesData.push(game);
        } else if (isLive) {
          liveGamesData.push(game);
        } else if (isPregame) {
          upcomingGamesData.push(game);
        }
      });

      // Remove cards for games no longer in the list
      existingCards.forEach(card => card.remove());

      // Clear container and rebuild with proper ordering
      container.innerHTML = '';
      const fragment = document.createDocumentFragment();

      // Add live games first
      liveGamesData.forEach((game, index) => {
        const card = createGameCardElement(game, index);
        if (card) fragment.appendChild(card);
      });

      // Add upcoming games
      upcomingGamesData.forEach((game, index) => {
        const card = createGameCardElement(game, index);
        if (card) fragment.appendChild(card);
      });

      // Add final games last
      finalGamesData.forEach((game, index) => {
        const card = createGameCardElement(game, index);
        if (card) fragment.appendChild(card);
      });

      container.appendChild(fragment);

      // Re-initialize sliders only for newly created cards
      initializeCardSliders();

      // Queue live game updates to happen after cards are repositioned
      cardsToUpdate.forEach(({ card, game }) => {
        setTimeout(() => {
          updateLiveGameCard(card, game);
        }, 0);
      });
    }

    function updateLiveGameCard(card, game) {
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      // Update scores
      const awayScoreEls = card.querySelectorAll('.live-team-score');
      if (awayScoreEls[0]) awayScoreEls[0].textContent = awayScore;
      if (awayScoreEls[1]) awayScoreEls[1].textContent = homeScore;

      // Update winning/losing classes
      if (awayScoreEls[0]) {
        awayScoreEls[0].className = `live-team-score ${awayScore > homeScore ? 'winning' : 'losing'}`;
      }
      if (awayScoreEls[1]) {
        awayScoreEls[1].className = `live-team-score ${homeScore > awayScore ? 'winning' : 'losing'}`;
      }

      // Update team name winning states
      const teamNames = card.querySelectorAll('.live-team-name');
      if (teamNames[0]) teamNames[0].className = `live-team-name ${awayScore > homeScore ? 'winning' : ''}`;
      if (teamNames[1]) teamNames[1].className = `live-team-name ${homeScore > awayScore ? 'winning' : ''}`;

      // Update period/clock (NHL uses periods instead of quarters)
      const period = comp.status.period || 1;
      const clock = comp.status.displayClock || '20:00';
      const statusText = `${period === 1 ? '1st' : period === 2 ? '2nd' : period === 3 ? '3rd' : 'OT'} - ${clock}`;
      const statusTextEl = card.querySelector('.page-1-live > div:nth-child(2) > div:nth-child(2)');
      if (statusTextEl) statusTextEl.textContent = statusText;

      // Update puck possession indicators
      const possession = comp.situation?.possession || null;
      const awayHasPossession = possession === away.id;
      const homeHasPossession = possession === home.id;

      const possessionIcons = card.querySelectorAll('.possession-icon');
      possessionIcons.forEach(icon => icon.remove());

      const teamLogos = card.querySelectorAll('.page-1-live .live-team-logo');
      if (teamLogos[0] && awayHasPossession) {
        teamLogos[0].parentElement.insertAdjacentHTML('beforeend', '<span class="possession-icon">ğŸ’</span>');
      }
      if (teamLogos[1] && homeHasPossession) {
        teamLogos[1].parentElement.insertAdjacentHTML('beforeend', '<span class="possession-icon">ğŸ’</span>');
      }

      // Update period line scores (Page 2)
      const awayLineScores = away.linescores || [];
      const homeLineScores = home.linescores || [];

      const page2 = card.querySelector('.page-2-content');
      if (page2) {
        const scoreCells = page2.querySelectorAll('.score-cell');
        // Away periods (indices 1-3) + total (4)
        if (scoreCells[1]) scoreCells[1].textContent = awayLineScores[0]?.value || 0;
        if (scoreCells[2]) scoreCells[2].textContent = awayLineScores[1]?.value || 0;
        if (scoreCells[3]) scoreCells[3].textContent = awayLineScores[2]?.value || 0;
        if (scoreCells[4]) scoreCells[4].textContent = parseInt(home.score) || 0;
        // Home periods (indices 6-8) + total (9)
        if (scoreCells[6]) scoreCells[6].textContent = homeLineScores[0]?.value || 0;
        if (scoreCells[7]) scoreCells[7].textContent = homeLineScores[1]?.value || 0;
        if (scoreCells[8]) scoreCells[8].textContent = homeLineScores[2]?.value || 0;
        if (scoreCells[9]) scoreCells[9].textContent = homeScore;
      }
    }

    function createGameCardElement(game, index) {
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      const statusType = comp.status.type.state;
      const statusName = comp.status.type.name;
      const isCompleted = comp.status.type.completed;

      // Enhanced live detection
      const isLive = statusType === 'in' ||
        (comp.status.period && comp.status.period > 0 && !isCompleted) ||
        statusName.toLowerCase().includes('progress') ||
        statusName.toLowerCase().includes('halftime') ||
        statusName.toLowerCase().includes('period');

      const isFinal = isCompleted || statusType === 'post';
      const isPregame = statusType === 'pre';

      // Get team standings
      const awayRecord = away.records?.[0]?.summary || '';
      const homeRecord = home.records?.[0]?.summary || '';

      // Get line scores (period by period) - NHL has 3 periods
      const awayLineScores = away.linescores || [];
      const homeLineScores = home.linescores || [];

      // Get current period and clock
      const period = comp.status.period || 1;
      const clock = comp.status.displayClock || '20:00';

      // Get possession info (puck possession)
      const possession = comp.situation?.possession || null;
      const awayHasPossession = possession === away.id;
      const homeHasPossession = possession === home.id;

      let statusText = '';
      if (isLive) {
        statusText = `${period === 1 ? '1st' : period === 2 ? '2nd' : period === 3 ? '3rd' : 'OT'} - ${clock}`;
      } else if (isFinal) {
        statusText = ''; // Badge already shows FINAL, no need for duplicate text
      } else {
        const gameDate = new Date(game.date);
        const dateStr = gameDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const timeStr = gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        statusText = `${dateStr} â€¢ ${timeStr}`;
      }

      // Determine number of pages
      // Upcoming: 1 page
      // Live: 2 pages (live score + period history)
      // Final: 1 page (final score with period history combined)
      const numPages = isLive ? 2 : 1;

      // Build the card HTML - include data-status to track state transitions
      const cardStatus = isPregame ? 'pre' : (isLive ? 'in' : 'post');
      let cardHtml = `
        <div class="game-card" data-game-id="${game.id}" data-status="${cardStatus}">
          <div class="card-slider-container">
            <div class="card-pages" data-current-page="0">
      `;

      // PAGE 1
      if (isPregame) {
        // Upcoming Game - Page 1 Only
        cardHtml += `
          <div class="card-page">
            <div class="page-1-upcoming">
              <div style="text-align: center; color: #9ca3af; font-size: 11px; font-weight: 600; margin-bottom: 4px;">
                ${statusText}
              </div>
              <div class="team-display">
                <div class="team-block">
                  <img src="${away.team.logo}" alt="${away.team.displayName}" class="team-logo-large">
                  <div class="team-name-large">${away.team.shortDisplayName || away.team.displayName}</div>
                  <div class="team-standing">${awayRecord}</div>
                </div>
                <div class="vs-divider">VS</div>
                <div class="team-block">
                  <img src="${home.team.logo}" alt="${home.team.displayName}" class="team-logo-large">
                  <div class="team-name-large">${home.team.shortDisplayName || home.team.displayName}</div>
                  <div class="team-standing">${homeRecord}</div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (isLive || isFinal) {
        // Live or Final Game - Page 1
        cardHtml += `
          <div class="card-page">
            <div class="page-1-live">
              <div style="text-align: center; margin-bottom: 8px;">
                <div style="display: inline-block; background: ${isLive ? '#ef4444' : '#6b7280'}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 9px; font-weight: 700; text-transform: uppercase;">
                  ${isLive ? '<span style="display: inline-block; width: 5px; height: 5px; background: white; border-radius: 50%; margin-right: 4px; animation: blink 1.5s infinite;"></span>LIVE' : 'FINAL'}
                </div>
                ${statusText ? `<div style="color: #9ca3af; font-size: 10px; margin-top: 3px; font-weight: 600;">${statusText}</div>` : ''}
              </div>

              <div class="live-score-header">
                <div class="team-stack">
                  <div style="position: relative;">
                    <img src="${away.team.logo}" alt="${away.team.displayName}" class="live-team-logo">
                    ${isLive && awayHasPossession ? '<span class="possession-icon">ğŸ’</span>' : ''}
                  </div>
                  <div class="live-team-name ${awayScore > homeScore ? 'winning' : ''}">${away.team.abbreviation}</div>
                  <div class="live-team-standing">${awayRecord}</div>
                </div>
                <div class="live-team-score ${awayScore > homeScore ? 'winning' : 'losing'}">${awayScore}</div>
                <div class="vs-divider-live">VS</div>
                <div class="live-team-score ${homeScore > awayScore ? 'winning' : 'losing'}">${homeScore}</div>
                <div class="team-stack">
                  <div style="position: relative;">
                    <img src="${home.team.logo}" alt="${home.team.displayName}" class="live-team-logo">
                    ${isLive && homeHasPossession ? '<span class="possession-icon">ğŸ’</span>' : ''}
                  </div>
                  <div class="live-team-name ${homeScore > awayScore ? 'winning' : ''}">${home.team.abbreviation}</div>
                  <div class="live-team-standing">${homeRecord}</div>
                </div>
              </div>

              ${isFinal ? `
                <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                  <div class="scoring-history-title">Scoring by Period</div>
                  <div class="periods-grid">
                    <div class="period-header-cell"></div>
                    <div class="period-header-cell">1</div>
                    <div class="period-header-cell">2</div>
                    <div class="period-header-cell">3</div>
                    <div class="period-header-cell">T</div>

                    <div class="team-label-cell">${away.team.abbreviation}</div>
                    <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                    <div class="score-cell total">${awayScore}</div>

                    <div class="team-label-cell">${home.team.abbreviation}</div>
                    <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                    <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                    <div class="score-cell total">${homeScore}</div>
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        `;

        // PAGE 2 - Scoring History (ONLY FOR LIVE GAMES)
        if (isLive) {
          cardHtml += `
            <div class="card-page">
              <div class="page-2-content">
                <div class="scoring-history-header">
                  <img src="${away.team.logo}" alt="${away.team.displayName}" class="scoring-team-logo">
                  <img src="${home.team.logo}" alt="${home.team.displayName}" class="scoring-team-logo">
                </div>

                <div class="scoring-history-title">Scoring by Period</div>

                <div class="periods-grid">
                  <div class="period-header-cell"></div>
                  <div class="period-header-cell">1</div>
                  <div class="period-header-cell">2</div>
                  <div class="period-header-cell">3</div>
                  <div class="period-header-cell">T</div>

                  <div class="team-label-cell">${away.team.abbreviation}</div>
                  <div class="score-cell ${awayLineScores[0] ? '' : 'empty'}">${awayLineScores[0]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[1] ? '' : 'empty'}">${awayLineScores[1]?.value || 0}</div>
                  <div class="score-cell ${awayLineScores[2] ? '' : 'empty'}">${awayLineScores[2]?.value || 0}</div>
                  <div class="score-cell total">${awayScore}</div>

                  <div class="team-label-cell">${home.team.abbreviation}</div>
                  <div class="score-cell ${homeLineScores[0] ? '' : 'empty'}">${homeLineScores[0]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[1] ? '' : 'empty'}">${homeLineScores[1]?.value || 0}</div>
                  <div class="score-cell ${homeLineScores[2] ? '' : 'empty'}">${homeLineScores[2]?.value || 0}</div>
                  <div class="score-cell total">${homeScore}</div>
                </div>
              </div>
            </div>
          `;
        }
      }

      // Close pages container
      cardHtml += `
            </div>

            ${numPages > 1 ? `
              <div class="page-indicators">
                <div class="page-dot active" data-page="0"></div>
                <div class="page-dot" data-page="1"></div>
              </div>
            ` : ''}
          </div>
        </div>
      `;

      // Create element from HTML string
      const temp = document.createElement('div');
      temp.innerHTML = cardHtml;
      return temp.firstElementChild;
    }

    function initializeCardSliders() {
      const cards = document.querySelectorAll('.game-card');

      cards.forEach(card => {
        const pagesContainer = card.querySelector('.card-pages');
        const dots = card.querySelectorAll('.page-dot');

        if (!pagesContainer || dots.length === 0) return; // Skip cards with only 1 page

        let currentPage = 0;
        const maxPage = dots.length - 1;

        const updatePage = (newPage) => {
          currentPage = Math.max(0, Math.min(newPage, maxPage));
          pagesContainer.style.transform = `translateX(-${currentPage * 100}%)`;
          pagesContainer.dataset.currentPage = currentPage;

          dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentPage);
          });
        };

        // Touch/swipe handling
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        pagesContainer.addEventListener('mousedown', (e) => {
          startX = e.clientX;
          isDragging = true;
          pagesContainer.style.transition = 'none';
        });

        pagesContainer.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          isDragging = true;
          pagesContainer.style.transition = 'none';
        });

        pagesContainer.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          currentX = e.clientX;
          const diff = startX - currentX;
          const percentMoved = (diff / pagesContainer.offsetWidth) * 100;
          pagesContainer.style.transform = `translateX(calc(-${currentPage * 100}% + ${-percentMoved}%))`;
        });

        pagesContainer.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          currentX = e.touches[0].clientX;
          const diff = startX - currentX;
          const percentMoved = (diff / pagesContainer.offsetWidth) * 100;
          pagesContainer.style.transform = `translateX(calc(-${currentPage * 100}% + ${-percentMoved}%))`;
        });

        const endDrag = () => {
          if (!isDragging) return;
          isDragging = false;
          pagesContainer.style.transition = 'transform 0.3s ease';

          const diff = startX - currentX;
          const threshold = pagesContainer.offsetWidth * 0.2;

          if (diff > threshold) {
            updatePage(currentPage + 1);
          } else if (diff < -threshold) {
            updatePage(currentPage - 1);
          } else {
            updatePage(currentPage);
          }
        };

        pagesContainer.addEventListener('mouseup', endDrag);
        pagesContainer.addEventListener('mouseleave', endDrag);
        pagesContainer.addEventListener('touchend', endDrag);

        // Dot click handlers
        dots.forEach((dot, index) => {
          dot.addEventListener('click', () => {
            pagesContainer.style.transition = 'transform 0.3s ease';
            updatePage(index);
          });
        });
      });
    }

    async function loadWinProbability(gameId, awayTeam, homeTeam) {
      try {
        console.log('ğŸ“Š Loading win probability for game:', gameId);
        // Use comprehensive game summary with win probability for every play
        const response = await fetch(`/api/nfl/summary/${gameId}`);

        if (!response.ok) {
          throw new Error(`Failed to fetch game summary: ${response.status}`);
        }

        const gameSummary = await response.json();
        console.log('ğŸ“Š Game Summary data:', gameSummary);

        // Get win probability data
        const winProbData = gameSummary.winprobability;

        if (!winProbData || winProbData.length === 0) {
          document.getElementById('tab-probability').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Win probability data not yet available
            </div>
          `;
          return;
        }

        // Get latest probability
        const latestProb = winProbData[winProbData.length - 1];
        const awayProb = Math.round((1 - latestProb.homeWinPercentage) * 100);
        const homeProb = Math.round(latestProb.homeWinPercentage * 100);

        document.getElementById('tab-probability').innerHTML = `
          <div class="win-prob-container">
            <h3 style="margin-bottom: 12px; font-size: 16px;">Win Probability Chart</h3>
            <div class="prob-bar-container">
              <div class="prob-bar away" style="width: ${awayProb}%">${awayProb > 15 ? awayProb + '%' : ''}</div>
              <div class="prob-bar home" style="width: ${homeProb}%">${homeProb > 15 ? homeProb + '%' : ''}</div>
            </div>
            <div class="prob-legend">
              <span>${awayTeam}: ${awayProb}%</span>
              <span>${homeTeam}: ${homeProb}%</span>
            </div>
            
            <div style="margin-top: 30px;">
              <canvas id="winProbChart" width="600" height="300" style="max-width: 100%; background: #1a1f2e; border-radius: 8px; padding: 10px;"></canvas>
            </div>
          </div>
        `;

        // Draw win probability chart
        const canvas = document.getElementById('winProbChart');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // Clear canvas
        ctx.clearRect(0, 0, width, height);

        // Chart styling
        const padding = 40;
        const chartWidth = width - 2 * padding;
        const chartHeight = height - 2 * padding;

        // Draw grid lines
        ctx.strokeStyle = '#2a3142';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i++) {
          const y = padding + (chartHeight * i / 4);
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(padding + chartWidth, y);
          ctx.stroke();
        }

        // Draw 50% line
        ctx.strokeStyle = '#4a5568';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(padding, padding + chartHeight / 2);
        ctx.lineTo(padding + chartWidth, padding + chartHeight / 2);
        ctx.stroke();
        ctx.setLineDash([]);

        // Draw probability line
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 3;
        ctx.beginPath();

        const step = chartWidth / (winProbData.length - 1);

        winProbData.forEach((point, index) => {
          const x = padding + (index * step);
          const y = padding + chartHeight - (point.homeWinPercentage * chartHeight);

          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });

        ctx.stroke();

        // Draw labels
        ctx.fillStyle = '#9ca3af';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('100%', padding - 5, padding + 5);
        ctx.fillText('50%', padding - 5, padding + chartHeight / 2 + 5);
        ctx.fillText('0%', padding - 5, padding + chartHeight + 5);

        ctx.textAlign = 'center';
        ctx.fillText('Game Progress â†’', width / 2, height - 10);

        ctx.save();
        ctx.translate(15, height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText(`${homeTeam} Win %`, 0, 0);
        ctx.restore();

      } catch (error) {
        console.error('Error loading win probability:', error);
        document.getElementById('tab-probability').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load win probability: ${error.message}
          </div>
        `;
      }
    }

    async function loadGameStats(gameId, awayTeam, homeTeam) {
      try {
        console.log('ğŸ“Š Loading game stats for:', gameId);

        // Fetch comprehensive game summary (includes leaders, team stats, everything)
        const summaryResponse = await fetch(`/api/nfl/summary/${gameId}`);
        const gameSummary = await summaryResponse.json();

        console.log('NFL Game Summary:', gameSummary);

        // Build stats HTML starting with Team Statistics
        let statsHtml = '';

        // Add Team Statistics first
        if (gameSummary.boxscore?.teams && gameSummary.boxscore.teams.length >= 2) {
          const teams = gameSummary.boxscore.teams;
          const awayStats = teams.find(t => t.homeAway === 'away')?.statistics || [];
          const homeStats = teams.find(t => t.homeAway === 'home')?.statistics || [];

          // Check if we have any stats
          if (awayStats.length > 0 && homeStats.length > 0) {
            const keyStats = [
              'firstDowns', 'totalYards', 'netPassingYards', 'completionAttempts',
              'rushingYards', 'rushingAttempts', 'thirdDownEff', 'fourthDownEff',
              'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
            ];

            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="background: #242b3d; border-radius: 10px; padding: 20px; margin-bottom: 30px; overflow-x: auto;">
                <table class="stats-table" style="width: 100%;">
                  <thead>
                    <tr>
                      <th style="text-align: left; color: #3b82f6;">${awayTeam}</th>
                      <th style="color: #9ca3af; text-align: center;">STAT</th>
                      <th style="text-align: right; color: #10b981;">${homeTeam}</th>
                    </tr>
                  </thead>
                  <tbody>
            `;

            keyStats.forEach(statName => {
              const awayStat = awayStats.find(s => s.name === statName);
              const homeStat = homeStats.find(s => s.name === statName);

              if (awayStat && homeStat) {
                const awayVal = awayStat.displayValue;
                const homeVal = homeStat.displayValue;
                const label = awayStat.label;

                let awayStyle = '';
                let homeStyle = '';
                if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
                  if (awayStat.value > homeStat.value) {
                    awayStyle = 'font-weight: 700; color: #3b82f6;';
                  } else if (homeStat.value > awayStat.value) {
                    homeStyle = 'font-weight: 700; color: #10b981;';
                  }
                }

                statsHtml += `
                  <tr>
                    <td style="text-align: left; padding: 8px; ${awayStyle}">${awayVal}</td>
                    <td style="color: #9ca3af; font-size: 12px; text-align: center; padding: 8px;">${label}</td>
                    <td style="text-align: right; padding: 8px; ${homeStyle}">${homeVal}</td>
                  </tr>
                `;
              }
            });

            statsHtml += `
                  </tbody>
                </table>
              </div>
            `;
          } else {
            // No team stats available yet
            statsHtml += `
              <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
              <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
                <div style="font-size: 36px; margin-bottom: 12px;">ğŸ“Š</div>
                <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
              </div>
            `;
          }
        } else {
          // No boxscore data available
          statsHtml += `
            <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
            <div style="text-align: center; padding: 30px; background: #242b3d; border-radius: 10px; margin-bottom: 30px;">
              <div style="font-size: 36px; margin-bottom: 12px;">ğŸ“Š</div>
              <div style="font-size: 14px; font-weight: 500; color: #9ca3af;">Team statistics will be available once the game starts</div>
            </div>
          `;
        }

        // Add Player Leaders section from game summary
        statsHtml += `<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Player Leaders</h3>`;

        // Use leaders from game summary (gameSummary.leaders)
        // The structure is: [ { team: {...}, leaders: [...] }, { team: {...}, leaders: [...] } ]
        const leadersData = gameSummary.leaders || [];

        console.log('ğŸˆ Player Leaders RAW data:', JSON.stringify(leadersData, null, 2));
        console.log('ğŸˆ Leaders array length:', leadersData.length);
        console.log('ğŸˆ Full game summary keys:', Object.keys(gameSummary));

        // Check if we have leaders data and it's not empty
        let hasValidLeaders = false;

        if (leadersData && leadersData.length > 0) {
          // Each entry in leadersData is a team with their leaders
          leadersData.forEach((teamData, teamIdx) => {
            const team = teamData.team || {};
            const teamName = team.displayName || team.abbreviation || 'Team';
            const teamColor = team.color || '3b82f6';
            const teamLeaders = teamData.leaders || [];

            console.log(`Team ${teamIdx}: ${teamName}, Categories: ${teamLeaders.length}`);

            if (teamLeaders.length > 0) {
              // Add team header
              statsHtml += `
                <div style="background: #1a1f2e; padding: 12px 20px; border-radius: 10px 10px 0 0; margin-top: ${teamIdx > 0 ? '20px' : '0'};">
                  <h3 style="font-size: 16px; font-weight: 700; color: #e0e0e0; margin: 0;">${teamName}</h3>
                </div>
              `;

              // Process each category (passing, rushing, receiving, etc.)
              teamLeaders.forEach((category, catIdx) => {
                const categoryName = category.displayName || category.name || 'Statistics';
                const leaders = category.leaders || [];

                console.log(`  Category: ${categoryName}, Leaders: ${leaders.length}`);

                if (leaders.length > 0) {
                  hasValidLeaders = true;

                  statsHtml += `
                    <div style="background: #242b3d; border-radius: ${catIdx === 0 ? '0' : '0'} ${catIdx === teamLeaders.length - 1 ? '0 0 10px 10px' : '0'}; padding: 16px 20px; ${catIdx < teamLeaders.length - 1 ? 'border-bottom: 1px solid #1a1f2e;' : ''}">
                      <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #9ca3af; text-transform: uppercase;">${categoryName}</h4>
                  `;

                  leaders.forEach((leader, leaderIdx) => {
                    console.log(`    Leader ${leaderIdx}:`, leader);

                    // Extract athlete data
                    const athlete = leader.athlete || {};
                    const athleteName = athlete.displayName || athlete.fullName || athlete.shortName || 'Unknown Player';
                    const position = athlete.position?.abbreviation || '';
                    const displayValue = leader.displayValue || leader.value || 'N/A';
                    const headshot = athlete.headshot?.href || '';

                    console.log(`      Athlete: ${athleteName}, Position: ${position}, Value: ${displayValue}`);

                    // Only add if we have a valid athlete name
                    if (athleteName && athleteName !== 'Unknown Player') {
                      statsHtml += `
                        <div style="display: flex; align-items: center; padding: 10px; background: #1a1f2e; border-radius: 8px; margin-top: ${leaderIdx > 0 ? '8px' : '0'};">
                          ${headshot ? `
                            <img src="${headshot}" alt="${athleteName}" 
                                 style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px;" 
                                 onerror="this.style.display='none'" />
                          ` : `
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #2d3548; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 14px; font-weight: 600; color: #6b7280;">${athleteName.charAt(0)}</div>
                          `}
                          <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; color: #e0e0e0;">${athleteName}</div>
                            <div style="font-size: 11px; color: #9ca3af;">${position}</div>
                          </div>
                          <div style="font-size: 16px; font-weight: 700; color: #10b981;">${displayValue}</div>
                        </div>
                      `;
                    }
                  });

                  statsHtml += `</div>`;
                }
              });
            }
          });
        }

        if (!hasValidLeaders) {
          console.log('âš ï¸ No valid leaders data available');
          statsHtml += `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“Š</div>
              <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Player Statistics Loading...</div>
              <div style="font-size: 14px; color: #6b7280;">Player statistics will appear as the game progresses. Please refresh to see updated stats.</div>
            </div>
          `;
        }

        document.getElementById('tab-stats').innerHTML = statsHtml;
      } catch (error) {
        console.error('Error loading game stats:', error);
        document.getElementById('tab-stats').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“Š</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Statistics Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game statistics are not available at the moment.</div>
          </div>
        `;
      }
    }

    let playsRefreshInterval = null;
    let currentGameId = null;
    let isLiveGame = false;
    let autoPlayMode = true;

    async function loadPlays(gameId) {
      try {
        currentGameId = gameId;
        const response = await fetch(`/api/nfl/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch plays');

        const data = await response.json();
        console.log('ğŸ“Š Plays API response:', data);

        // Handle different API response structures
        let plays = [];
        if (data.items && Array.isArray(data.items)) {
          // RapidAPI structure: { items: [...] }
          plays = data.items;
        } else if (data.drives?.previous) {
          // ESPN structure: { drives: { previous: [{ plays: [...] }] } }
          const drives = data.drives.previous || [];
          plays = drives.flatMap(drive => drive.plays || []);
        } else if (Array.isArray(data)) {
          // Direct array of plays
          plays = data;
        }

        if (plays.length === 0) {
          document.getElementById('tab-plays').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              No play-by-play data available yet
            </div>
          `;
          return;
        }

        // Get recent plays (last 30) and REVERSE so latest appears first
        const recentPlays = plays.slice(-30).reverse();

        // Check if this is first load or update
        const isInitialLoad = !window.currentPlays;
        const previousPlayCount = window.currentPlays?.length || 0;
        const newPlayDetected = recentPlays.length > previousPlayCount;

        // Store plays data for animation
        window.currentPlays = recentPlays;

        // Only rebuild HTML on initial load
        if (isInitialLoad) {
          document.getElementById('tab-plays').innerHTML = `
            <div class="field-tracker-container">
              ${isLiveGame ? `
                <div class="live-update-indicator" id="liveIndicator">
                  <span class="live-dot"></span>
                  <span>Live Updates Active</span>
                  <button class="auto-play-toggle" id="autoPlayToggle" onclick="toggleAutoPlay()">
                    Auto-Play: ON
                  </button>
                </div>
              ` : ''}
            </div>
            <div class="plays-list" id="playsList">
            </div>
          `;

          window.currentPlayIndex = 0;
        }

        // Update plays list
        updatePlaysList(recentPlays);

        // ALWAYS show the latest play (first in reversed array) on the field
        if (recentPlays.length > 0) {
          window.currentPlayIndex = 0; // Index 0 is now the latest play (after reverse)
          selectPlay(0, false); // false = don't scroll list
        }

        // Start live refresh if game is live
        if (isLiveGame && !playsRefreshInterval) {
          startLivePlayUpdates();
        }
      } catch (error) {
        console.error('Error loading plays:', error);
        document.getElementById('tab-plays').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load play-by-play data
          </div>
        `;
      }
    }

    function updatePlaysList(plays) {
      const playsList = document.getElementById('playsList');
      if (!playsList) return;

      playsList.innerHTML = plays.map((play, idx) => `
        <div class="play-item ${play.scoringPlay ? 'scoring' : ''}" onclick="selectPlay(${idx}, true)" id="play-${idx}">
          <div class="play-header">
            <span>Q${play.period?.number || '?'} - ${play.clock?.displayValue || ''}</span>
            <span>${play.start?.Shots ? play.start.Shots + ' & ' + play.start.distance : ''}</span>
          </div>
          <div class="play-text">${play.text || 'No description'}</div>
          ${idx === 0 ? '<div class="latest-play-badge">LATEST</div>' : ''}
        </div>
      `).join('');

      // Remove play counter update since we removed the counter element
    }

    function startLivePlayUpdates() {
      if (playsRefreshInterval) return;

      // Refresh plays every 10 seconds during live games
      playsRefreshInterval = setInterval(() => {
        if (currentGameId && isLiveGame) {
          loadPlays(currentGameId);
        }
      }, 10000); // 10 seconds
    }

    function stopLivePlayUpdates() {
      if (playsRefreshInterval) {
        clearInterval(playsRefreshInterval);
        playsRefreshInterval = null;
      }
      window.currentPlays = null;
      window.currentPlayIndex = 0;
    }

    function toggleAutoPlay() {
      autoPlayMode = !autoPlayMode;
      const toggle = document.getElementById('autoPlayToggle');
      if (toggle) {
        toggle.textContent = `Auto-Play: ${autoPlayMode ? 'ON' : 'OFF'}`;
        toggle.style.background = autoPlayMode ? '#10b981' : '#6b7280';
      }
    }

    function selectPlay(index, shouldScroll = true) {
      if (!window.currentPlays || index < 0 || index >= window.currentPlays.length) return;

      window.currentPlayIndex = index;
      const play = window.currentPlays[index];

      // Save current scroll position
      const savedScrollTop = window.pageYOffset || document.documentElement.scrollTop;

      // Highlight selected play in list
      document.querySelectorAll('.play-item').forEach((el, i) => {
        el.style.background = i === index ? 'rgba(59, 130, 246, 0.2)' : '';
        el.style.borderLeft = i === index ? '3px solid #3b82f6' : '';
      });

      // Restore scroll position to prevent unwanted jumping
      window.scrollTo(0, savedScrollTop);

      // Scroll to play in list if requested (only scrolls the play list, not the page)
      if (shouldScroll) {
        const playElement = document.getElementById(`play-${index}`);
        if (playElement) {
          playElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    }

    async function loadBoxScore(gameId, awayTeam, homeTeam) {
      try {
        const response = await fetch(`/api/nfl/summary/${gameId}`);
        if (!response.ok) throw new Error('Failed to fetch box score');

        const data = await response.json();
        const teams = data.boxscore?.teams || [];

        if (teams.length < 2) {
          document.getElementById('tab-boxscore').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Box score data not yet available
            </div>
          `;
          return;
        }

        // Teams are usually [away, home]
        const awayStats = teams[0].statistics;
        const homeStats = teams[1].statistics;

        // Key stats to display
        const keyStats = [
          'firstDowns', 'totalYards', 'netPassingYards', 'completionAttempts',
          'rushingYards', 'rushingAttempts', 'thirdDownEff', 'fourthDownEff',
          'totalOffensivePlays', 'yardsPerPlay', 'turnovers', 'possessionTime'
        ];

        // Build comparison table
        let statsHtml = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Team Statistics</h3>
          <div style="background: #242b3d; border-radius: 10px; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #1a1f2e;">
                  <th style="padding: 12px; text-align: left; font-size: 14px; font-weight: 600; color: #3b82f6;">${awayTeam}</th>
                  <th style="padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #9ca3af;">STAT</th>
                  <th style="padding: 12px; text-align: right; font-size: 14px; font-weight: 600; color: #10b981;">${homeTeam}</th>
                </tr>
              </thead>
              <tbody>
        `;

        keyStats.forEach(statName => {
          const awayStat = awayStats.find(s => s.name === statName);
          const homeStat = homeStats.find(s => s.name === statName);

          if (awayStat && homeStat) {
            const awayVal = awayStat.displayValue;
            const homeVal = homeStat.displayValue;
            const label = awayStat.label;

            // Determine which value is "winning" for highlighting
            let awayStyle = '';
            let homeStyle = '';
            if (awayStat.value && homeStat.value && typeof awayStat.value === 'number' && typeof homeStat.value === 'number') {
              if (awayStat.value > homeStat.value) {
                awayStyle = 'font-weight: 700; color: #3b82f6;';
              } else if (homeStat.value > awayStat.value) {
                homeStyle = 'font-weight: 700; color: #10b981;';
              }
            }

            statsHtml += `
              <tr style="border-bottom: 1px solid #1a1f2e;">
                <td style="padding: 12px; ${awayStyle}">${awayVal}</td>
                <td style="padding: 12px; text-align: center; font-size: 12px; color: #9ca3af;">${label}</td>
                <td style="padding: 12px; text-align: right; ${homeStyle}">${homeVal}</td>
              </tr>
            `;
          }
        });

        statsHtml += `
              </tbody>
            </table>
          </div>
        `;

        // Add player stats if available
        if (data.boxscore.players && data.boxscore.players.length > 0) {
          statsHtml += `<h3 style="margin: 24px 0 16px; font-size: 18px; font-weight: 700;">Top Performers</h3>`;

          data.boxscore.players.slice(0, 2).forEach((teamData, idx) => {
            const teamName = idx === 0 ? awayTeam : homeTeam;
            const teamColor = idx === 0 ? '#3b82f6' : '#10b981';

            statsHtml += `
              <div style="background: #242b3d; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
                <h4 style="margin-bottom: 12px; color: ${teamColor}; font-size: 16px;">${teamName}</h4>
            `;

            // Passing
            const passing = teamData.statistics.find(cat => cat.name === 'passing');
            if (passing && passing.athletes.length > 0) {
              const qb = passing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Passing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${qb.athlete.displayName}: ${qb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Rushing
            const rushing = teamData.statistics.find(cat => cat.name === 'rushing');
            if (rushing && rushing.athletes.length > 0) {
              const rb = rushing.athletes[0];
              statsHtml += `
                <div style="margin-bottom: 12px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Rushing</div>
                  <div style="color: #9ca3af; font-size: 14px;">${rb.athlete.displayName}: ${rb.stats.join(', ')}</div>
                </div>
              `;
            }

            // Receiving
            const receiving = teamData.statistics.find(cat => cat.name === 'receiving');
            if (receiving && receiving.athletes.length > 0) {
              const wr = receiving.athletes[0];
              statsHtml += `
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px;">Receiving</div>
                  <div style="color: #9ca3af; font-size: 14px;">${wr.athlete.displayName}: ${wr.stats.join(', ')}</div>
                </div>
              `;
            }

            statsHtml += `</div>`;
          });
        }

        document.getElementById('tab-boxscore').innerHTML = statsHtml;

      } catch (error) {
        console.error('Error loading box score:', error);
        document.getElementById('tab-boxscore').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ef4444;">
            Failed to load box score data
          </div>
        `;
      }
    }

    async function loadPredictions(gameId, awayTeam, homeTeam) {
      try {
        console.log('ğŸ“Š Loading predictions for game:', gameId, 'Home:', homeTeam, 'Away:', awayTeam);

        // Fetch predictor data from ESPN API
        const response = await fetch(`/api/nfl/summary/${gameId}`);

        if (!response.ok) {
          throw new Error('Predictor data not available');
        }

        const data = await response.json();
        console.log('NFL Predictor response received');

        // Helper function to extract stat values from statistics array
        const getStat = (team, statName) => {
          if (!team || !team.statistics) return null;
          const stat = team.statistics.find(s => s.name === statName);
          return stat ? stat.displayValue : null;
        };

        // Extract prediction information from statistics arrays
        const homeWinProb = getStat(data.homeTeam, 'gameProjection') || 'N/A';
        const awayWinProb = getStat(data.awayTeam, 'gameProjection') || 'N/A';
        const homePointDiff = getStat(data.homeTeam, 'teamPredPtDiff') || 'N/A';
        const awayPointDiff = getStat(data.awayTeam, 'teamPredPtDiff') || 'N/A';
        const matchupQuality = getStat(data.homeTeam, 'matchupQuality') || getStat(data.awayTeam, 'matchupQuality') || 'N/A';

        // Additional stats
        const homeChanceLoss = getStat(data.homeTeam, 'teamChanceLoss') || 'N/A';
        const awayChanceLoss = getStat(data.awayTeam, 'teamChanceLoss') || 'N/A';
        const homeOppStrength = getStat(data.homeTeam, 'oppSeasonStrengthRating') || 'N/A';
        const awayOppStrength = getStat(data.awayTeam, 'oppSeasonStrengthRating') || 'N/A';

        document.getElementById('tab-predictions').innerHTML = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Game Predictions</h3>
          <div class="prediction-grid">
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Win Probability</div>
              <div class="stat-value" style="color: #10b981;">${homeWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Win Probability</div>
              <div class="stat-value" style="color: #3b82f6;">${awayWinProb}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${homeTeam} Point Differential</div>
              <div class="stat-value" style="color: #f59e0b;">${homePointDiff}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">${awayTeam} Point Differential</div>
              <div class="stat-value" style="color: #8b5cf6;">${awayPointDiff}</div>
            </div>
          </div>
          <div style="margin-top: 24px; padding: 16px; background: #242b3d; border-radius: 10px;">
            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #9ca3af;">Additional Statistics</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${awayTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">
                  ${awayOppStrength}
                </div>
              </div>
              <div style="text-align: center; padding: 12px; background: #1a1f2e; border-radius: 8px;">
                <div style="font-size: 13px; color: #9ca3af; margin-bottom: 4px;">${homeTeam} Opponent Strength</div>
                <div style="font-size: 20px; font-weight: 700; color: #10b981;">
                  ${homeOppStrength}
                </div>
              </div>
            </div>
          </div>
          ${matchupQuality !== 'N/A' ? `
            <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 4px;">
              <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Matchup Quality (0-100 scale)</div>
              <div style="font-size: 16px; font-weight: 600; color: #60a5fa;">${matchupQuality}/100</div>
            </div>
          ` : ''}
        `;
      } catch (error) {
        console.error('Error loading predictions:', error);
        document.getElementById('tab-predictions').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">ï¿½</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">Predictions Not Available</div>
            <div style="font-size: 14px; color: #6b7280;">Game prediction data is not available for this game at the moment.</div>
          </div>
        `;
      }
    }

    // Game Detail Modal Functions
    let selectedGame = null;
    let currentActiveTab = 'boxscore';
    let modalRefreshInterval = null;

    function showGameDetail(game) {
      selectedGame = game;
      const comp = game.competitions[0];
      const home = comp.competitors.find(c => c.homeAway === 'home');
      const away = comp.competitors.find(c => c.homeAway === 'away');

      const homeScore = parseInt(home.score) || 0;
      const awayScore = parseInt(away.score) || 0;

      // Check if game is live
      const statusState = comp.status.type.state;
      const isLive = statusState === 'in' || comp.status.period > 0;

      // Populate modal header with matchup info
      document.getElementById('detail-matchup').innerHTML = `
        <div class="detail-team">
          <img src="${away.team.logo}" alt="${away.team.displayName}" class="detail-team-logo" />
          <div class="detail-team-name">${away.team.displayName}</div>
          <div class="detail-team-score">${awayScore}</div>
        </div>
        <div class="detail-vs">
          VS
          ${isLive ? '<div class="refresh-indicator" id="modal-refresh-indicator"><span class="spin">ğŸ”„</span> Auto-updating</div>' : ''}
        </div>
        <div class="detail-team">
          <img src="${home.team.logo}" alt="${home.team.displayName}" class="detail-team-logo" />
          <div class="detail-team-name">${home.team.displayName}</div>
          <div class="detail-team-score">${homeScore}</div>
        </div>
      `;

      // Show modal
      document.getElementById('game-detail-modal').classList.add('active');

      // Load initial tab content
      loadBoxScore(game.id, away.team.displayName, home.team.displayName);
      loadGameStats(game.id, away.team.displayName, home.team.displayName);
      loadWinProbability(game.id, away.team.displayName, home.team.displayName);
      loadPredictions(game.id, away.team.displayName, home.team.displayName);

      // Start auto-refresh for live games
      if (isLive) {
        console.log('ğŸ”´ LIVE GAME - Starting auto-refresh for modal stats');
        startModalRefresh(game.id, away.team.displayName, home.team.displayName);
      } else {
        console.log('â° UPCOMING/FINAL GAME - No auto-refresh needed');
        stopModalRefresh();
      }
    }

    function startModalRefresh(gameId, awayTeam, homeTeam) {
      // Clear any existing interval
      stopModalRefresh();

      // Refresh every 15 seconds for live games
      modalRefreshInterval = setInterval(() => {
        console.log('ğŸ”„ Auto-refreshing modal stats for game:', gameId);

        // Show refresh animation
        const indicator = document.getElementById('modal-refresh-indicator');
        if (indicator) {
          indicator.classList.add('active');
          setTimeout(() => indicator.classList.remove('active'), 1000);
        }

        // Refresh ALL tabs (not just active one) to keep data fresh
        loadBoxScore(gameId, awayTeam, homeTeam);
        loadGameStats(gameId, awayTeam, homeTeam);
        loadWinProbability(gameId, awayTeam, homeTeam);

        // Also update the modal header scores
        updateModalHeader(gameId);
      }, 15000); // 15 seconds
    }

    function stopModalRefresh() {
      if (modalRefreshInterval) {
        clearInterval(modalRefreshInterval);
        modalRefreshInterval = null;
        console.log('â¹ï¸ Stopped modal auto-refresh');
      }
    }

    async function updateModalHeader(gameId) {
      try {
        // Fetch fresh game data from the API
        const response = await fetch(`/api/nhl/scoreboard`);

        if (!response.ok) {
          console.warn('Failed to fetch updated game data for modal');
          return;
        }

        const espnData = await response.json();
        const updatedGame = espnData.events?.find(event => event.id === gameId);

        if (!updatedGame) {
          console.warn('Game not found in updated data');
          return;
        }

        const comp = updatedGame.competitions[0];
        const home = comp.competitors.find(c => c.homeAway === 'home');
        const away = comp.competitors.find(c => c.homeAway === 'away');

        // Update scores in the header
        const awayScoreEl = document.querySelector('.detail-team:first-child .detail-team-score');
        const homeScoreEl = document.querySelector('.detail-team:last-child .detail-team-score');

        if (awayScoreEl) {
          const newAwayScore = parseInt(away.score) || 0;
          awayScoreEl.textContent = newAwayScore;
          console.log(`âœ… Updated away score: ${newAwayScore}`);
        }
        if (homeScoreEl) {
          const newHomeScore = parseInt(home.score) || 0;
          homeScoreEl.textContent = newHomeScore;
          console.log(`âœ… Updated home score: ${newHomeScore}`);
        }
      } catch (error) {
        console.error('Error updating modal header:', error);
      }
    }

    function closeGameDetail() {
      document.getElementById('game-detail-modal').classList.remove('active');
      selectedGame = null;
      stopModalRefresh(); // Stop auto-refresh when closing modal
    }

    // Close modal when clicking outside
    document.getElementById('game-detail-modal').addEventListener('click', (e) => {
      if (e.target.id === 'game-detail-modal') {
        closeGameDetail();
      }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
      if (modalRefreshInterval) clearInterval(modalRefreshInterval);
    });

    async function loadBoxScore(gameId, awayTeam, homeTeam) {
      try {
        console.log('ğŸ“Š Loading box score for game:', gameId);

        // Fetch comprehensive game summary with detailed boxscore
        const response = await fetch(`/api/nfl-gamesummary/${gameId}`);

        if (!response.ok) {
          throw new Error(`Failed to fetch game summary: ${response.status}`);
        }

        const gameSummary = await response.json();
        console.log('ğŸ“Š Game Summary boxscore:', gameSummary.boxscore);

        // Use the selectedGame data for basic info
        if (!selectedGame) {
          document.getElementById('tab-boxscore').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #9ca3af;">
              Box score data not yet available
            </div>
          `;
          return;
        }

        const comp = selectedGame.competitions[0];
        const home = comp.competitors.find(c => c.homeAway === 'home');
        const away = comp.competitors.find(c => c.homeAway === 'away');

        const homeLineScores = home.linescores || [];
        const awayLineScores = away.linescores || [];

        // Start building HTML
        let html = `
          <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 700;">Scoring Summary</h3>
          <div style="background: #242b3d; border-radius: 10px; padding: 20px;">
            <div style="margin-bottom: 20px;">
              <div style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #3b82f6;">${awayTeam}</div>
              <div style="display: flex; gap: 16px; align-items: center;">
                ${awayLineScores.map((score, idx) => `
                  <div style="text-align: center;">
                    <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Q${idx + 1}</div>
                    <div style="font-size: 20px; font-weight: 700;">${score.value}</div>
                  </div>
                `).join('')}
                <div style="text-align: center; margin-left: 16px; padding-left: 16px; border-left: 2px solid #2d3548;">
                  <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Total</div>
                  <div style="font-size: 24px; font-weight: 700; color: #10b981;">${away.score || 0}</div>
                </div>
              </div>
            </div>
            
            <div style="border-top: 1px solid #2d3548; padding-top: 20px;">
              <div style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #10b981;">${homeTeam}</div>
              <div style="display: flex; gap: 16px; align-items: center;">
                ${homeLineScores.map((score, idx) => `
                  <div style="text-align: center;">
                    <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Q${idx + 1}</div>
                    <div style="font-size: 20px; font-weight: 700;">${score.value}</div>
                  </div>
                `).join('')}
                <div style="text-align: center; margin-left: 16px; padding-left: 16px; border-left: 2px solid #2d3548;">
                  <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Total</div>
                  <div style="font-size: 24px; font-weight: 700; color: #10b981;">${home.score || 0}</div>
                </div>
              </div>
            </div>
          </div>
        `;

        document.getElementById('tab-boxscore').innerHTML = html;
      } catch (error) {
        console.error('Error loading box score:', error);
        document.getElementById('tab-boxscore').innerHTML = `
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            Error loading box score data
          </div>
        `;
      }
    }

    function switchTab(tabName) {
      // Store the active tab
      currentActiveTab = tabName;

      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    function refreshLiveGames() {
      fetchLiveGames();
    }

    function manualRefresh() {
      console.log('ğŸ”„ Manual refresh triggered');
      fetchLiveGames();

      // Visual feedback
      const btn = event.target.closest('.refresh-btn');
      const originalBg = btn.style.background;
      btn.style.background = '#059669';
      btn.style.transform = 'rotate(360deg)';
      btn.style.transition = 'transform 0.5s ease';

      setTimeout(() => {
        btn.style.background = originalBg;
        btn.style.transform = 'rotate(0deg)';
      }, 500);
    }

    // Initialize - load favorites first, then fetch games
    (async function init() {
      await fetchFavoriteTeams();
      fetchLiveGames();

      // Sort filter button event listeners
      document.getElementById('sort-favorites').addEventListener('click', function () {
        if (currentSortMode !== 'favorites') {
          currentSortMode = 'favorites';
          document.getElementById('sort-favorites').classList.add('active');
          document.getElementById('sort-time').classList.remove('active');
          renderGamesList();
        }
      });

      document.getElementById('sort-time').addEventListener('click', function () {
        if (currentSortMode !== 'time') {
          currentSortMode = 'time';
          document.getElementById('sort-time').classList.add('active');
          document.getElementById('sort-favorites').classList.remove('active');
          renderGamesList();
        }
      });
    })();

    // Auto-refresh every 15 seconds for live updates
    refreshInterval = setInterval(() => {
      console.log('ğŸ”„ Auto-refreshing games...');
      fetchLiveGames();
    }, 15000);

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (refreshInterval) clearInterval(refreshInterval);
    });
  </script>

  <!-- Game Selection Modal -->
  <div id="game-selection-modal" class="modal">
    <div class="modal-content">
      <h2>ğŸ“º Sports Bar Mode - Select Grid Layout</h2>

      <!-- Layout Selection -->
      <div class="layout-options">
        <label>
          <input type="radio" name="layout" value="1"> 1 Game
        </label>
        <label>
          <input type="radio" name="layout" value="2"> 2 Games
        </label>
        <label>
          <input type="radio" name="layout" value="3"> 3 Games
        </label>
        <label>
          <input type="radio" name="layout" value="4" checked> 4 Games
        </label>
        <label>
          <input type="radio" name="layout" value="6"> 6 Games
        </label>
      </div>

      <p style="text-align: center; color: #94a3b8; margin: 20px 0;">
        Select your grid layout, then choose games for each position
      </p>

      <!-- Grid Preview with Game Selectors -->
      <div id="grid-preview" class="grid-preview">
        <!-- Dynamically populated with grid slots -->
      </div>

      <div class="modal-buttons">
        <button id="enter-fullscreen">Enter Sports Bar Mode</button>
        <button id="cancel-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Full Screen Container -->
  <div id="fullscreen-container" class="fullscreen-container">
    <!-- Fullscreen Orientation Overlay - for mobile phones in landscape -->
    <div class="fullscreen-orientation-overlay">
      <div class="rotate-icon">ğŸ“±</div>
      <h2>Please Rotate Your Device</h2>
      <p>Sports Bar Mode works best in portrait orientation</p>
    </div>
    <!-- Hover trigger zone at top -->
    <div class="fullscreen-hover-trigger"></div>

    <div class="fullscreen-controls" id="fullscreen-controls">
      <button id="change-layout-fs">Change Layout</button>
      <button id="exit-fullscreen">Exit Sports Bar Mode</button>
    </div>
    <div id="fullscreen-grid" class="fullscreen-grid grid-4">
      <!-- Dynamically populated game cards -->
    </div>
  </div>

  <script>
    // ============================================
    // SPORTS BAR MODE - FULL SCREEN FUNCTIONALITY
    // ============================================

    let gridGames = {}; // { 0: gameId, 1: gameId, ... } - Maps slot index to game ID
    let currentLayout = 4;
    let fullscreenRefreshInterval = null;
    let sessionKeepAliveInterval = null; // Keep session alive during fullscreen
    let fullscreenEnteredAt = null; // Timestamp when fullscreen mode was entered - animations only show for plays after this time

    // Open game selection modal
    function openGameSelectionModal() {
      const modal = document.getElementById('game-selection-modal');
      modal.classList.add('show');

      // Auto-select 4-grid layout
      const fourGridRadio = document.querySelector('input[name="layout"][value="4"]');
      if (fourGridRadio) {
        fourGridRadio.checked = true;
      }

      // Reset game selections and render
      gridGames = {};
      renderGridPreview();

      // Auto-select first 4 games
      autoSelectFirstGames();
    }

    // Auto-select the first N games based on current layout
    function autoSelectFirstGames() {
      const liveGames = window.liveGamesData || [];
      // Sort games to prioritize live events first for auto-selection
      const sortedGames = sortByLiveFirst(liveGames);
      const layout = parseInt(document.querySelector('input[name="layout"]:checked').value);
      const selectors = document.querySelectorAll('.game-selector');

      // Reset gridGames
      gridGames = {};

      // Select first N games (up to available games) - live games will be selected first
      const gamesToSelect = Math.min(layout, sortedGames.length);

      selectors.forEach((selector, index) => {
        if (index < gamesToSelect && sortedGames[index]) {
          const gameId = sortedGames[index].id;
          gridGames[index] = gameId;
        }
      });

      // Update selectors to reflect the auto-selection
      updateAllGameSelectors();
      checkAllSlotsSelected();
    }

    // Render grid preview with game selectors
    function renderGridPreview() {
      const container = document.getElementById('grid-preview');
      const layout = parseInt(document.querySelector('input[name="layout"]:checked').value);
      currentLayout = layout;

      container.innerHTML = '';
      container.className = `grid-preview grid-${layout}`;

      const liveGames = window.liveGamesData || [];

      console.log('ğŸ® Sports Bar Mode - Live games check:', {
        windowData: window.liveGamesData?.length || 0,
        totalGames: liveGames.length
      });

      if (liveGames.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; color: #ef4444; padding: 40px; grid-column: 1/-1;">
            âŒ No live games detected<br>
            <span style="font-size: 14px; color: #94a3b8; margin-top: 10px; display: block;">
              If you see games on the main page, try refreshing the page and opening Sports Bar Mode again.
            </span>
          </p>`;
        document.getElementById('enter-fullscreen').disabled = true;
        return;
      }

      for (let i = 0; i < layout; i++) {
        const slot = document.createElement('div');
        slot.className = 'grid-slot';
        slot.innerHTML = `
          <div class="slot-label">Position ${i + 1}</div>
          <select class="game-selector" data-slot="${i}">
            <option value="">-- Select Game --</option>
          </select>
        `;
        container.appendChild(slot);
      }

      updateAllGameSelectors();

      // Enable/disable enter button based on selections
      checkAllSlotsSelected();
    }

    // Update all game selectors with available games
    function updateAllGameSelectors() {
      const selectors = document.querySelectorAll('.game-selector');
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now stores game IDs

      selectors.forEach(selector => {
        const slotIndex = parseInt(selector.dataset.slot);
        const currentSelection = gridGames[slotIndex]; // Game ID

        // Clear existing options except first
        selector.innerHTML = '<option value="">-- Select Game --</option>';

        liveGames.forEach((game, gameIndex) => {
          const gameId = game.id;
          // Show game if: it's not used OR it's the current selection for this slot
          if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
            const comp = game.competitions?.[0];
            const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
            const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';
            const awayScore = comp?.competitors?.[1]?.score || '0';
            const homeScore = comp?.competitors?.[0]?.score || '0';

            // Determine status - LIVE or UPCOMING
            const statusState = comp?.status?.type?.state;
            const isLive = statusState === 'in' || comp?.status?.period > 0;
            const isUpcoming = statusState === 'pre';
            const isFinal = statusState === 'post';

            let statusLabel;
            if (isUpcoming) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
              statusLabel = `UPCOMING (${hoursUntil}h)`;
            } else if (isLive) {
              const period = comp?.status?.type?.shortDetail || 'Live';
              statusLabel = `LIVE - ${period}`;
            } else {
              statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
            }

            const option = document.createElement('option');
            option.value = gameId; // Store game ID instead of index
            option.textContent = `${awayTeam} (${awayScore}) @ ${homeTeam} (${homeScore}) - ${statusLabel}`;

            if (currentSelection === gameId) {
              option.selected = true;
            }

            selector.appendChild(option);
          }
        });

        // Add change event listener
        selector.removeEventListener('change', handleGameSelection);
        selector.addEventListener('change', handleGameSelection);
      });
    }

    // Handle game selection change
    function handleGameSelection(e) {
      const slotIndex = parseInt(e.target.dataset.slot);
      const gameId = e.target.value === '' ? null : e.target.value; // Now uses game ID string

      if (gameId === null) {
        delete gridGames[slotIndex];
      } else {
        gridGames[slotIndex] = gameId; // Store game ID
      }

      // Update all selectors to reflect new availability
      updateAllGameSelectors();
      checkAllSlotsSelected();
    }

    // Check if all slots have games selected (NOW OPTIONAL - allow empty slots)
    function checkAllSlotsSelected() {
      // Always enable button - allow entering with empty slots
      document.getElementById('enter-fullscreen').disabled = false;
    }

    // Layout change handler
    document.querySelectorAll('input[name="layout"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        gridGames = {}; // Reset selections when layout changes
        renderGridPreview();
        autoSelectFirstGames(); // Auto-select first N games for new layout
      });
    });

    // Enter full screen mode
    function enterFullScreenMode() {
      // No validation - allow empty slots

      const modal = document.getElementById('game-selection-modal');
      const container = document.getElementById('fullscreen-container');
      const controls = document.getElementById('fullscreen-controls');

      // Record when fullscreen mode was entered - only show animations for plays AFTER this time
      fullscreenEnteredAt = Date.now();

      modal.classList.remove('show');
      container.classList.add('active');

      // Show controls briefly when entering full screen
      controls.classList.add('visible');
      setTimeout(() => {
        controls.classList.remove('visible');
      }, 3000); // Hide after 3 seconds

      renderFullScreenGames();

      // Start auto-refresh
      fullscreenRefreshInterval = setInterval(() => {
        updateFullScreenScores();
      }, 15000);

      // Start session keep-alive every 2 minutes to prevent session expiration
      sessionKeepAliveInterval = setInterval(async () => {
        try {
          const response = await fetch('/api/auth/check');
          if (!response.ok) {
            console.log('Session expired during fullscreen, redirecting to login...');
            window.location.href = '/login';
          }
        } catch (error) {
          console.error('Session keep-alive failed:', error);
        }
      }, 2 * 60 * 1000); // Every 2 minutes

      // Request browser fullscreen (with safety check)
      try {
        if (container.requestFullscreen) {
          container.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        } else if (container.webkitRequestFullscreen) {
          container.webkitRequestFullscreen();
        } else if (container.msRequestFullscreen) {
          container.msRequestFullscreen();
        }
      } catch (err) {
        console.log('Fullscreen not supported or failed:', err);
      }
    }

    // Render full screen games
    function renderFullScreenGames() {
      const grid = document.getElementById('fullscreen-grid');
      grid.className = `fullscreen-grid grid-${currentLayout}`;
      grid.innerHTML = '';

      const liveGames = window.liveGamesData || [];

      // Render in slot order (0, 1, 2, ...)
      for (let slotIndex = 0; slotIndex < currentLayout; slotIndex++) {
        const gameId = gridGames[slotIndex]; // Now uses game ID
        const game = liveGames.find(g => g.id === gameId); // Find game by ID

        if (game) {
          const card = createFullScreenGameCard(game, slotIndex);
          grid.appendChild(card);
        } else {
          // Empty slot - show logo and game selector
          const card = createEmptySlotCard(slotIndex);
          grid.appendChild(card);
        }
      }
    }

    // Create empty slot card with logo
    function createEmptySlotCard(slotIndex) {
      const div = document.createElement('div');
      div.className = 'fullscreen-game-card empty-slot';
      div.dataset.slotIndex = slotIndex;

      // Determine logo and text size based on current grid layout
      const logoSize = currentLayout === 6 ? '50%' : currentLayout === 4 ? '55%' : '60%';
      const textSize = currentLayout === 6 ? '1.2rem' : currentLayout === 4 ? '1.4rem' : '1.5rem';

      div.innerHTML = `
        <!-- Game Selector Dropdown -->
        <div class="fs-game-selector-container" style="display: block;">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <option value="">-- Select Game --</option>
          </select>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; opacity: 0.6;">
          <img src="/assets/logo.png" alt="GridTV Sports" style="max-width: ${logoSize}; max-height: 35%; object-fit: contain; margin-bottom: 15px;">
          <div style="font-size: ${textSize}; color: #64748b; text-align: center; line-height: 1.4;">
            Select a game above<br>to display
          </div>
        </div>
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      return div;
    }

    // Create full screen game card with game selector

    function calculateDynamicScaling() {
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const layout = currentLayout;

      console.log('ğŸ¨ Dynamic Scaling Calculation:', {
        viewport: `${vw}x${vh}`,
        layout: `grid-${layout}`,
        aspectRatio: (vw / vh).toFixed(2)
      });

      // Calculate available space per card
      const controlsHeight = 80; // Top controls bar
      const availableHeight = vh - controlsHeight;
      const availableWidth = vw;

      // Grid configurations
      let cols, rows, padding, gap;

      switch (layout) {
        case 1:
          cols = 1; rows = 1;
          padding = Math.min(40, vh * 0.03);
          gap = 0;
          break;
        case 2:
          cols = 2; rows = 1;
          padding = Math.min(25, vh * 0.025);
          gap = Math.min(20, vw * 0.015);
          break;
        case 4:
          cols = 2; rows = 2;
          padding = Math.min(20, vh * 0.02);
          gap = Math.min(15, vh * 0.012);
          break;
        case 6:
          cols = 3; rows = 2;
          padding = Math.min(15, vh * 0.015);
          gap = Math.min(12, vh * 0.01);
          break;
        default:
          cols = 2; rows = 2;
          padding = 20;
          gap = 15;
      }

      // Calculate card dimensions
      const cardWidth = (availableWidth - (padding * 2) - (gap * (cols - 1))) / cols;
      const cardHeight = (availableHeight - (padding * 2) - (gap * (rows - 1))) / rows;

      console.log('ğŸ“ Card Dimensions:', {
        cardWidth: cardWidth.toFixed(0),
        cardHeight: cardHeight.toFixed(0),
        padding,
        gap
      });

      // Calculate optimal font sizes based on card height
      // Use card height as the primary scaling factor
      const baseScale = cardHeight / 500; // 500px is reference height
      const heightScale = Math.max(0.4, Math.min(1.5, baseScale)); // Limit scale range

      // Calculate element sizes based on available card space
      const sizes = {
        // Quarter/Status text
        quarterFontSize: Math.max(12, Math.min(28, cardHeight * 0.038)),
        quarterMargin: Math.max(6, Math.min(20, cardHeight * 0.025)),

        // Clock text
        clockFontSize: Math.max(14, Math.min(32, cardHeight * 0.048)),

        // Game status container
        statusMargin: Math.max(8, Math.min(20, cardHeight * 0.028)),
        statusGap: Math.max(4, Math.min(8, cardHeight * 0.012)),

        // Team logo
        logoSize: Math.max(35, Math.min(90, cardHeight * 0.15)),

        // Team name
        teamNameFontSize: Math.max(14, Math.min(56, cardHeight * 0.075)),

        // Score
        scoreFontSize: Math.max(24, Math.min(96, cardHeight * 0.14)),
        scoreMinWidth: Math.max(50, Math.min(150, cardWidth * 0.15)),

        // Team record
        recordFontSize: Math.max(10, Math.min(18, cardHeight * 0.022)),

        // VS text
        vsFontSize: Math.max(12, Math.min(32, cardHeight * 0.04)),
        vsMargin: Math.max(3, Math.min(12, cardHeight * 0.015)),

        // Team spacing
        teamMargin: Math.max(6, Math.min(20, cardHeight * 0.025)),
        teamGap: Math.max(8, Math.min(25, cardWidth * 0.025)),
        teamInfoGap: Math.max(6, Math.min(15, cardWidth * 0.015)),

        // Down/Distance
        downDistanceFontSize: Math.max(12, Math.min(32, cardHeight * 0.042)),
        downDistanceMargin: Math.max(8, Math.min(15, cardHeight * 0.022)),
        downDistanceGap: Math.max(4, Math.min(8, cardHeight * 0.012)),
        fieldPositionFontSize: Math.max(10, Math.min(20, cardHeight * 0.028)),

        // Sport logo indicator
        sportLogoSize: Math.max(40, Math.min(120, cardHeight * 0.18)),
        sportLogoTop: Math.max(8, Math.min(15, cardHeight * 0.025)),
        sportLogoLeft: Math.max(8, Math.min(15, cardWidth * 0.015)),

        // Card padding and border
        cardPadding: Math.max(10, Math.min(30, cardHeight * 0.04)),
        cardBorderRadius: Math.max(6, Math.min(16, cardHeight * 0.025)),
        cardBorderWidth: cardHeight < 300 ? 2 : 3,

        // Timeouts
        timeoutWidth: Math.max(12, Math.min(24, cardWidth * 0.025)),
        timeoutHeight: Math.max(4, Math.min(8, cardHeight * 0.012)),
        timeoutGap: Math.max(3, Math.min(6, cardWidth * 0.006)),
        timeoutMargin: Math.max(3, Math.min(8, cardHeight * 0.012)),

        // Possession indicator
        possessionSize: Math.max(16, Math.min(30, cardHeight * 0.05))
      };

      console.log('ğŸ“Š Calculated Sizes:', {
        teamName: sizes.teamNameFontSize.toFixed(1) + 'px',
        score: sizes.scoreFontSize.toFixed(1) + 'px',
        logo: sizes.logoSize.toFixed(1) + 'px',
        cardPadding: sizes.cardPadding.toFixed(1) + 'px'
      });

      return { sizes, padding, gap };
    }


    function applyDynamicScaling() {
      const { sizes, padding, gap } = calculateDynamicScaling();
      const layout = currentLayout;

      // Remove existing dynamic styles
      if (dynamicStyles) {
        dynamicStyles.remove();
      }

      // Create new style element
      dynamicStyles = document.createElement('style');
      dynamicStyles.id = 'dynamic-fullscreen-styles';
      dynamicStyles.textContent = `
        /* Dynamic Responsive Scaling - Generated based on ${window.innerWidth}x${window.innerHeight} for grid-${layout} */
        
        .fullscreen-grid.grid-${layout} {
          padding: ${padding}px !important;
          gap: ${gap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-game-card {
          padding: ${sizes.cardPadding}px !important;
          border-radius: ${sizes.cardBorderRadius}px !important;
          border-width: ${sizes.cardBorderWidth}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-game-status {
          margin-bottom: ${sizes.statusMargin}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-quarter-clock {
          gap: ${sizes.statusGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-quarter-text,
        .fullscreen-grid.grid-${layout} .fullscreen-upcoming-status,
        .fullscreen-grid.grid-${layout} .fullscreen-final-status {
          font-size: ${sizes.quarterFontSize}px !important;
          line-height: 1.1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-clock {
          font-size: ${sizes.clockFontSize}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-quarter {
          font-size: ${sizes.quarterFontSize}px !important;
          margin-bottom: ${sizes.quarterMargin}px !important;
          line-height: 1.2 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-logo {
          width: ${sizes.logoSize}px !important;
          height: ${sizes.logoSize}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-name {
          font-size: ${sizes.teamNameFontSize}px !important;
          line-height: 1.1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-score {
          font-size: ${sizes.scoreFontSize}px !important;
          min-width: ${sizes.scoreMinWidth}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-record {
          font-size: ${sizes.recordFontSize}px !important;
          line-height: 1.2 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-vs {
          font-size: ${sizes.vsFontSize}px !important;
          margin: ${sizes.vsMargin}px 0 !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team {
          margin-bottom: ${sizes.teamMargin}px !important;
          gap: ${sizes.teamGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-info {
          gap: ${sizes.teamInfoGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-down-distance-container {
          margin-top: ${sizes.downDistanceMargin}px !important;
          gap: ${sizes.downDistanceGap}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-down-distance {
          font-size: ${sizes.downDistanceFontSize}px !important;
          line-height: 1.1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-field-position {
          font-size: ${sizes.fieldPositionFontSize}px !important;
          line-height: 1 !important;
        }
        
        .fullscreen-grid.grid-${layout} .sport-logo-indicator {
          width: ${sizes.sportLogoSize}px !important;
          height: ${sizes.sportLogoSize}px !important;
          top: ${sizes.sportLogoTop}px !important;
          left: ${sizes.sportLogoLeft}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .timeout-bar {
          width: ${sizes.timeoutWidth}px !important;
          height: ${sizes.timeoutHeight}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-timeouts {
          gap: ${sizes.timeoutGap}px !important;
          margin-top: ${sizes.timeoutMargin}px !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-possession {
          font-size: ${sizes.possessionSize}px !important;
          margin-left: ${Math.max(4, sizes.possessionSize * 0.3)}px !important;
        }
        
        /* Ensure cards fit perfectly in grid */
        .fullscreen-grid.grid-${layout} .fullscreen-game-card {
          overflow: hidden !important;
        }
        
        .fullscreen-grid.grid-${layout} .fullscreen-team-header {
          gap: ${Math.max(2, sizes.recordFontSize * 0.3)}px !important;
        }
      `;

      document.head.appendChild(dynamicStyles);

      console.log('âœ… Dynamic styles applied for grid-' + layout);
    }

    /**
     * Handle window resize - recalculate and apply scaling
     */
    let resizeTimeout;

    function createFullScreenGameCard(game, slotIndex) {
      const div = document.createElement('div');

      const comp = game.competitions?.[0];
      const awayTeam = comp?.competitors?.[1];
      const homeTeam = comp?.competitors?.[0];
      const awayScore = parseInt(awayTeam?.score || 0);
      const homeScore = parseInt(homeTeam?.score || 0);

      // Determine if game is live or upcoming
      const statusState = comp?.status?.type?.state;
      const isLive = statusState === 'in' || comp?.status?.period > 0;
      const isUpcoming = statusState === 'pre';
      const isFinal = statusState === 'post';

      console.log('ğŸ® Creating game card:', {
        gameName: game.name,
        statusState: statusState,
        statusName: comp?.status?.type?.name,
        period: comp?.status?.period,
        isLive: isLive,
        isUpcoming: isUpcoming,
        gameDate: game.date
      });

      let cardClass = 'fullscreen-game-card';

      // Add upcoming class for different styling
      if (isUpcoming) {
        cardClass += ' upcoming-game';
      } else {
        // Only show winning/losing colors for live games
        if (awayScore > homeScore) cardClass += ' winning-away';
        else if (homeScore > awayScore) cardClass += ' winning-home';
        else cardClass += ' tied';
      }

      // Get status display text
      let statusDisplay = comp?.status?.type?.shortDetail || 'Live';

      // For upcoming games, show scheduled time
      if (isUpcoming) {
        const gameDate = new Date(game.date);
        const now = new Date();
        const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));
        const minutesUntil = Math.round((gameDate - now) / (1000 * 60));

        console.log('â° Upcoming game countdown:', {
          gameDate: gameDate.toLocaleString(),
          now: now.toLocaleString(),
          minutesUntil: minutesUntil,
          hoursUntil: hoursUntil
        });

        if (minutesUntil < 60) {
          statusDisplay = `â° STARTS IN ${minutesUntil} MIN`;
        } else if (hoursUntil < 24) {
          statusDisplay = `â° STARTS IN ${hoursUntil}H`;
        } else {
          statusDisplay = `â° ${gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
        }

        console.log('â° Status display:', statusDisplay);
      }

      const possession = comp?.situation?.possession;
      const quarterText = comp?.status?.type?.shortDetail || '';
      const downDistance = comp?.situation?.downDistanceText || '';
      const fieldPosition = comp?.situation?.possessionText || '';

      // Get team records
      const awayRecord = awayTeam?.records?.[0]?.summary || awayTeam?.record?.displayValue || '';
      const homeRecord = homeTeam?.records?.[0]?.summary || homeTeam?.record?.displayValue || '';

      div.className = cardClass;
      div.dataset.slotIndex = slotIndex;
      div.dataset.isLive = isLive ? 'true' : 'false';
      div.dataset.isFinal = isFinal ? 'true' : 'false';
      div.dataset.gameId = game.id;

      div.innerHTML = `
        <img src="/assets/NHL-logo.png" alt="NHL" class="sport-logo-indicator">
        <div class="fullscreen-refresh-indicator"></div>

        <!-- Game Selector Dropdown (hidden initially) -->
        <div class="fs-game-selector-container">
          <select class="fs-game-selector" data-slot="${slotIndex}">
            <!-- Populated dynamically -->
          </select>
        </div>

        <div class="fullscreen-card-content">
          ${isUpcoming ? `
            <!-- Upcoming Game -->
            <div class="fullscreen-upcoming-status-text">${statusDisplay}</div>
            <div class="fullscreen-live-score-header">
              <div class="fullscreen-team-stack">
                ${awayTeam?.team?.logo ? `<img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                <div class="fullscreen-live-team-name">${awayTeam?.team?.abbreviation || awayTeam?.team?.shortDisplayName || awayTeam?.team?.displayName || 'AWAY'}</div>
                ${awayRecord ? `<div class="fullscreen-team-record">${awayRecord}</div>` : ''}
              </div>
              <div class="fullscreen-team-score">-</div>
              <div class="fullscreen-vs-divider-live">VS</div>
              <div class="fullscreen-team-score">-</div>
              <div class="fullscreen-team-stack">
                ${homeTeam?.team?.logo ? `<img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                <div class="fullscreen-live-team-name">${homeTeam?.team?.abbreviation || homeTeam?.team?.shortDisplayName || homeTeam?.team?.displayName || 'HOME'}</div>
                ${homeRecord ? `<div class="fullscreen-team-record">${homeRecord}</div>` : ''}
              </div>
            </div>
          ` : `
            <!-- Live or Final Game -->
            <div class="fullscreen-status-container">
              <div class="fullscreen-status-text">${quarterText}</div>
            </div>

            <div class="fullscreen-live-score-header">
              <div class="fullscreen-team-stack">
                <div style="position: relative;">
                  ${awayTeam?.team?.logo ? `<img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                  ${isLive && possession === awayTeam?.id ? '<span class="fullscreen-possession">ğŸ’</span>' : ''}
                </div>
                <div class="fullscreen-live-team-name ${awayScore > homeScore ? 'winning' : ''}">${awayTeam?.team?.abbreviation || awayTeam?.team?.shortDisplayName || awayTeam?.team?.displayName || 'AWAY'}</div>
                ${awayRecord ? `<div class="fullscreen-team-record">${awayRecord}</div>` : ''}
              </div>
              <div class="fullscreen-team-score ${awayScore > homeScore ? 'winning' : 'losing'}">${awayScore}</div>
              <div class="fullscreen-vs-divider-live">VS</div>
              <div class="fullscreen-team-score ${homeScore > awayScore ? 'winning' : 'losing'}">${homeScore}</div>
              <div class="fullscreen-team-stack">
                <div style="position: relative;">
                  ${homeTeam?.team?.logo ? `<img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="fullscreen-team-logo">` : ''}
                  ${isLive && possession === homeTeam?.id ? '<span class="fullscreen-possession">ğŸ’</span>' : ''}
                </div>
                <div class="fullscreen-live-team-name ${homeScore > awayScore ? 'winning' : ''}">${homeTeam?.team?.abbreviation || homeTeam?.team?.shortDisplayName || homeTeam?.team?.displayName || 'HOME'}</div>
                ${homeRecord ? `<div class="fullscreen-team-record">${homeRecord}</div>` : ''}
              </div>
            </div>

            ${isLive && downDistance ? `<div class="fullscreen-situation-info">${downDistance}</div>` : ''}
          `}
        </div>
      `;

      // Populate game selector
      const selector = div.querySelector('.fs-game-selector');
      populateFullScreenGameSelector(selector, slotIndex);

      // Show selector on card hover
      div.addEventListener('mouseenter', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'block';
      });
      div.addEventListener('mouseleave', () => {
        div.querySelector('.fs-game-selector-container').style.display = 'none';
      });

      return div;
    }

    // Populate full screen game selector
    function populateFullScreenGameSelector(selector, slotIndex) {
      const liveGames = window.liveGamesData || [];
      const usedGameIds = Object.values(gridGames); // Now uses game IDs
      const currentSelection = gridGames[slotIndex]; // Game ID

      selector.innerHTML = '<option value="">-- Select Game --</option>';

      liveGames.forEach((game, gameIndex) => {
        const gameId = game.id;
        if (!usedGameIds.includes(gameId) || currentSelection === gameId) {
          const comp = game.competitions?.[0];
          const awayTeam = comp?.competitors?.[1]?.team?.shortDisplayName || 'Away';
          const homeTeam = comp?.competitors?.[0]?.team?.shortDisplayName || 'Home';

          // Determine status - LIVE or UPCOMING
          const statusState = comp?.status?.type?.state;
          const isLive = statusState === 'in' || comp?.status?.period > 0;
          const isUpcoming = statusState === 'pre';
          const isFinal = statusState === 'post';

          let statusLabel;
          if (isUpcoming) {
            statusLabel = 'ğŸ•’ UPCOMING';
          } else if (isLive) {
            const period = comp?.status?.type?.shortDetail || 'Live';
            statusLabel = `ğŸ”´ ${period}`;
          } else {
            statusLabel = comp?.status?.type?.shortDetail || 'Scheduled';
          }

          const option = document.createElement('option');
          option.value = gameId; // Store game ID
          option.textContent = `${awayTeam} @ ${homeTeam} - ${statusLabel}`;

          if (currentSelection === gameId) {
            option.selected = true;
          }

          selector.appendChild(option);
        }
      });

      // Handle game change in full screen
      selector.addEventListener('change', (e) => {
        const newGameId = e.target.value; // Game ID
        const card = document.querySelector(`[data-slot-index="${slotIndex}"]`);

        if (newGameId === '') {
          // User deselected - show empty slot
          delete gridGames[slotIndex];
          if (card) {
            const emptyCard = createEmptySlotCard(slotIndex);
            card.replaceWith(emptyCard);
          }
        } else {
          // User selected a game
          gridGames[slotIndex] = newGameId; // Store game ID

          const liveGames = window.liveGamesData || [];
          const newGame = liveGames.find(g => g.id === newGameId); // Find by ID

          if (newGame && card) {
            const newCard = createFullScreenGameCard(newGame, slotIndex);
            card.replaceWith(newCard);
          }
        }

        // Update all other selectors to reflect new availability
        document.querySelectorAll('.fs-game-selector').forEach(sel => {
          const slot = parseInt(sel.dataset.slot);
          populateFullScreenGameSelector(sel, slot);
        });
      });
    }

    // Detect play type based on score change and show animation
    function detectAndAnimatePlay(card, scoreChange, teamName) {
      let playType, playText;

      // NHL scoring: 1 point per goal
      if (scoreChange === 1) {
        playType = 'goal';
        playText = 'GOAL!';
      } else if (scoreChange === 3) {
        // Hat trick (3 goals in one update - rare but possible)
        playType = 'hattrick';
        playText = 'HAT TRICK!';
      } else {
        return; // Unknown score change
      }

      showPlayAnimation(card, playType, playText, teamName);
    }

    // Show play animation overlay
    function showPlayAnimation(card, playType, playText, teamName = '', recoveryInfo = '') {
      // Skip animations during the first update cycle after entering fullscreen mode
      // This prevents showing animations for past plays that already happened
      if (fullscreenEnteredAt && (Date.now() - fullscreenEnteredAt) < 6000) {
        return; // Don't show animations for the first 6 seconds (first update cycle + buffer)
      }

      // Remove any existing animation
      const existingAnimation = card.querySelector('.play-animation');
      if (existingAnimation) {
        existingAnimation.remove();
      }

      // Create animation overlay
      const animationDiv = document.createElement('div');
      animationDiv.className = `play-animation ${playType}`;

      // Choose icon based on play type
      let icon;
      switch (playType) {
        case 'goal':
          icon = 'ğŸš¨';
          break;
        case 'save':
          icon = 'ğŸ§¤';
          break;
        case 'powerplay':
          icon = 'âš¡';
          break;
        case 'hattrick':
          icon = 'ğŸ©';
          break;
        case 'penalty':
          icon = 'âš ï¸';
          break;
        case 'shootout':
          icon = 'ğŸ¥…';
          break;
        default:
          icon = 'ğŸ’';
      }

      animationDiv.innerHTML = `
        <div class="play-animation-icon">${icon}</div>
        <div class="play-animation-text">${playText}</div>
        ${teamName || recoveryInfo ? `
        <div class="play-animation-subtext">${teamName}${recoveryInfo ? ` - ${recoveryInfo}` : ''}</div>
      ` : ''}
      `;

      card.style.position = 'relative';
      card.appendChild(animationDiv);

      // Remove after animation completes (3 seconds)
      setTimeout(() => {
        animationDiv.remove();
      }, 3000);
    }

    // Update full screen scores
    async function updateFullScreenScores() {
      try {
        // Fetch updated game data from the same endpoint
        const response = await fetch(`/api/nhl/scoreboard`);
        if (!response.ok) {
          throw new Error(`Failed to fetch scores: ${response.status}`);
        }

        const espnData = await response.json();

        // Update the global games data
        if (espnData.events && espnData.events.length > 0) {
          const allGames = espnData.events.map(event => {
            const comp = event.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home');
            const away = comp.competitors.find(c => c.homeAway === 'away');

            return {
              id: event.id,
              date: event.date,
              name: event.name || `${away?.team?.displayName} @ ${home?.team?.displayName}`,
              competitions: event.competitions
            };
          });

          window.liveGamesData = allGames;
        }

        const grid = document.getElementById('fullscreen-grid');
        const cards = grid.querySelectorAll('.fullscreen-game-card');

        cards.forEach((card, index) => {
          const slotIndex = parseInt(card.dataset.slotIndex);
          const gameId = gridGames[slotIndex]; // Now uses game ID
          const game = window.liveGamesData.find(g => g.id === gameId); // Find by ID

          if (!game || card.classList.contains('empty-slot')) return;

          const comp = game.competitions?.[0];
          const statusState = comp?.status?.type?.state;
          const wasUpcoming = card.dataset.isLive === 'false';
          const isNowLive = statusState === 'in' || comp?.status?.period > 0;

          // If game transitioned from upcoming to live, recreate the card
          if (wasUpcoming && isNowLive) {
            console.log(`ğŸˆ Game started! Transitioning to live view:`, game.name);
            const newCard = createFullScreenGameCard(game, slotIndex);
            card.replaceWith(newCard);
            return;
          }

          // For upcoming games, update countdown
          if (statusState === 'pre') {
            const quarterEl = card.querySelector('.fullscreen-period');
            if (quarterEl) {
              const gameDate = new Date(game.date);
              const now = new Date();
              const minutesUntil = Math.round((gameDate - now) / (1000 * 60));
              const hoursUntil = Math.round((gameDate - now) / (1000 * 60 * 60));

              if (minutesUntil < 60) {
                quarterEl.textContent = `â° STARTS IN ${minutesUntil} MIN`;
              } else if (hoursUntil < 24) {
                quarterEl.textContent = `â° STARTS IN ${hoursUntil}H`;
              } else {
                quarterEl.textContent = `â° ${gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
              }
            }
            return; // Don't update scores for upcoming games
          }

          // Update live game data
          const indicator = card.querySelector('.fullscreen-refresh-indicator');
          if (indicator) {
            indicator.classList.add('active');
            setTimeout(() => indicator.classList.remove('active'), 1000);
          }

          const awayTeam = comp?.competitors?.[1];
          const homeTeam = comp?.competitors?.[0];
          const awayScore = parseInt(awayTeam?.score || 0);
          const homeScore = parseInt(homeTeam?.score || 0);

          // Get previous scores from card data attributes
          const prevAwayScore = parseInt(card.dataset.prevAwayScore || 0);
          const prevHomeScore = parseInt(card.dataset.prevHomeScore || 0);

          // Detect score changes and determine play type
          const awayScoreChange = awayScore - prevAwayScore;
          const homeScoreChange = homeScore - prevHomeScore;

          if (awayScoreChange > 0) {
            detectAndAnimatePlay(card, awayScoreChange, awayTeam?.team?.displayName || 'Away');
          } else if (homeScoreChange > 0) {
            detectAndAnimatePlay(card, homeScoreChange, homeTeam?.team?.displayName || 'Home');
          }

          // Check for turnovers (interceptions/fumbles) from play description
          const lastPlay = comp?.situation?.lastPlay?.text || '';
          if (lastPlay.toLowerCase().includes('interception') || lastPlay.toLowerCase().includes('intercepted')) {
            if (!card.dataset.lastInterception || card.dataset.lastInterception !== lastPlay) {
              showPlayAnimation(card, 'interception', 'INTERCEPTION!');
              card.dataset.lastInterception = lastPlay;
            }
          } else if (lastPlay.toLowerCase().includes('fumble')) {
            if (!card.dataset.lastFumble || card.dataset.lastFumble !== lastPlay) {
              // Extract recovery information from play text
              let recoveryInfo = '';
              const lowerPlay = lastPlay.toLowerCase();

              // Try to find who recovered
              if (lowerPlay.includes('recovered by')) {
                const recoveredIndex = lowerPlay.indexOf('recovered by');
                const afterRecovered = lastPlay.substring(recoveredIndex + 13); // Skip 'recovered by '
                const teamMatch = afterRecovered.match(/^([A-Z]{2,3}|[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/); // Match team abbreviation or name
                if (teamMatch) {
                  recoveryInfo = `Recovered by ${teamMatch[1]}`;
                }
              } else if (lowerPlay.includes(awayTeam?.team?.abbreviation?.toLowerCase())) {
                recoveryInfo = `Recovered by ${awayTeam.team.abbreviation}`;
              } else if (lowerPlay.includes(homeTeam?.team?.abbreviation?.toLowerCase())) {
                recoveryInfo = `Recovered by ${homeTeam.team.abbreviation}`;
              }

              showPlayAnimation(card, 'fumble', 'FUMBLE!', '', recoveryInfo);
              card.dataset.lastFumble = lastPlay;
            }
          }

          // Store current scores for next update
          card.dataset.prevAwayScore = awayScore;
          card.dataset.prevHomeScore = homeScore;

          // Update scores with animation (uses .fullscreen-team-score for horizontal layout)
          const scores = card.querySelectorAll('.fullscreen-team-score');
          const awayScoreEl = scores[0];
          const homeScoreEl = scores[1];

          if (awayScoreEl && awayScoreEl.textContent !== awayScore.toString()) {
            awayScoreEl.textContent = awayScore;
            awayScoreEl.style.animation = 'none';
            awayScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              awayScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              awayScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }

          if (homeScoreEl && homeScoreEl.textContent !== homeScore.toString()) {
            homeScoreEl.textContent = homeScore;
            homeScoreEl.style.animation = 'none';
            homeScoreEl.style.webkitAnimation = 'none';
            setTimeout(() => {
              homeScoreEl.style.animation = 'scoreUpdate 0.5s ease-out';
              homeScoreEl.style.webkitAnimation = 'scoreUpdate 0.5s ease-out';
            }, 10);
          }

          // Update status (uses .fullscreen-status-text for horizontal layout)
          const statusEl = card.querySelector('.fullscreen-status-text');
          if (statusEl) {
            statusEl.textContent = comp?.status?.type?.shortDetail || 'Live';
          }

          // Update card class for winner
          card.className = 'fullscreen-game-card';
          card.dataset.slotIndex = slotIndex;
          card.dataset.isLive = 'true';
          card.dataset.gameId = game.id;

          if (awayScore > homeScore) card.classList.add('winning-away');
          else if (homeScore > awayScore) card.classList.add('winning-home');
          else card.classList.add('tied');

          // Update Shots/distance (already includes field position from API)
          const downDistanceEl = card.querySelector('.fullscreen-Shots-distance');
          const fieldPositionEl = card.querySelector('.fullscreen-field-position');
          const downDistance = comp?.situation?.downDistanceText || '';

          // Remove old field position element if it exists (no longer needed)
          if (fieldPositionEl) fieldPositionEl.remove();

          if (downDistanceEl) {
            if (downDistance) {
              downDistanceEl.textContent = downDistance;
              downDistanceEl.style.display = 'block';
            } else {
              downDistanceEl.style.display = 'none';
            }
          } else if (downDistance) {
            // Create Shots/distance element if it doesn't exist - add after home team (last team div)
            const teamDivs = card.querySelectorAll('.fullscreen-team');
            const homeTeamDiv = teamDivs[teamDivs.length - 1]; // Get the last team (home team)
            if (homeTeamDiv) {
              homeTeamDiv.insertAdjacentHTML('afterend', `<div class="fullscreen-Shots-distance">${downDistance}</div>`);
            }
          }

          // Update possession
          const possession = comp?.situation?.possession;
          const teamNames = card.querySelectorAll('.fullscreen-team-name');
          teamNames.forEach(name => {
            const existingPossession = name.querySelector('.fullscreen-possession');
            if (existingPossession) existingPossession.remove();
          });

          if (possession === awayTeam?.id && teamNames[0]) {
            teamNames[0].insertAdjacentHTML('beforeend', '<span class="fullscreen-possession"></span>');
          } else if (possession === homeTeam?.id && teamNames[1]) {
            teamNames[1].insertAdjacentHTML('beforeend', '<span class="fullscreen-possession"></span>');
          }
        });

      } catch (error) {
        console.error('Error updating full screen scores:', error);
      }
    }

    // Exit full screen mode
    function exitFullScreenMode() {
      const container = document.getElementById('fullscreen-container');
      container.classList.remove('active');

      if (fullscreenRefreshInterval) {
        clearInterval(fullscreenRefreshInterval);
        fullscreenRefreshInterval = null;
      }

      // Clear session keep-alive interval
      if (sessionKeepAliveInterval) {
        clearInterval(sessionKeepAliveInterval);
        sessionKeepAliveInterval = null;
      }

      // Exit browser fullscreen
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    // Event Listeners
    document.getElementById('sports-bar-btn').addEventListener('click', openGameSelectionModal);

    document.getElementById('cancel-modal').addEventListener('click', () => {
      document.getElementById('game-selection-modal').classList.remove('show');
    });

    document.getElementById('enter-fullscreen').addEventListener('click', enterFullScreenMode);
    document.getElementById('exit-fullscreen').addEventListener('click', exitFullScreenMode);

    document.getElementById('change-layout-fs').addEventListener('click', () => {
      exitFullScreenMode();
      gridGames = {}; // Reset selections
      setTimeout(() => openGameSelectionModal(), 100);
    });

    // ESC key to exit
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const container = document.getElementById('fullscreen-container');
        if (container.classList.contains('active')) {
          exitFullScreenMode();
        }
      }
    });

    // Close modal on outside click
    document.getElementById('game-selection-modal').addEventListener('click', (e) => {
      if (e.target.id === 'game-selection-modal') {
        document.getElementById('game-selection-modal').classList.remove('show');
      }
    });

  </script>

</body>

</html>