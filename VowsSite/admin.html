<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Unlock Vows</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíç</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            max-width: 900px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #d4a574;
        }

        .btn-unlock {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #d4a574 0%, #b8935e 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-unlock:hover {
            transform: translateY(-2px);
        }

        .btn-lock {
            width: 100%;
            padding: 14px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.locked {
            background: #ffe6e6;
            color: #c0392b;
        }

        .status.unlocked {
            background: #e8f8f5;
            color: #27ae60;
        }

        .error {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        .success {
            color: #27ae60;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        .info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        .editor-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .editor-section h2 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
        }

        .vows-editor {
            margin-bottom: 30px;
        }

        .vows-editor label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 16px;
        }

        .vows-editor input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-family: 'Georgia', serif;
        }

        .vows-editor textarea {
            display: none;
        }

        .rich-editor {
            width: 100%;
            min-height: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 0 0 8px 8px;
            border-top: none;
            font-size: 16px;
            box-sizing: border-box;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            overflow-y: auto;
            background: white;
        }

        .rich-editor:focus {
            outline: none;
            border-color: #d4a574;
        }

        .rich-editor:empty:before {
            content: attr(data-placeholder);
            color: #999;
            font-style: italic;
        }

        .rich-editor p {
            margin: 0 0 15px 0;
        }

        .rich-editor p:last-child {
            margin-bottom: 0;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-top: 10px;
            transition: border-color 0.2s;
        }

        .editor-wrapper:focus-within .toolbar {
            border-color: #d4a574;
        }

        .editor-wrapper:focus-within .rich-editor {
            border-color: #d4a574;
        }

        .toolbar button {
            padding: 8px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toolbar button:hover {
            background: #e9ecef;
            border-color: #d4a574;
        }

        .toolbar button.active {
            background: #d4a574;
            color: white;
            border-color: #d4a574;
        }

        .toolbar select,
        .toolbar input[type="color"] {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            background: white;
        }

        .toolbar input[type="color"] {
            width: 40px;
            height: 34px;
            padding: 2px;
        }

        .toolbar .separator {
            width: 1px;
            background: #ddd;
            margin: 0 5px;
        }

        .vows-editor input:focus {
            outline: none;
            border-color: #d4a574;
        }

        .btn-save {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn-save:hover {
            transform: translateY(-2px);
        }

        .formatting-help {
            background: #fff9e6;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .formatting-help strong {
            color: #d4a574;
        }

        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .lang-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lang-btn .flag {
            font-size: 20px;
        }

        .lang-btn:hover {
            border-color: #d4a574;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 165, 116, 0.2);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #d4a574 0%, #b8935e 100%);
            color: white;
            border-color: #d4a574;
        }

        @media (max-width: 600px) {
            .toolbar {
                gap: 3px;
                padding: 8px;
            }

            .toolbar button {
                padding: 6px 8px;
                font-size: 12px;
            }

            .toolbar select {
                font-size: 12px;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            color: #d4a574;
            border-bottom-color: #d4a574;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .admin-container {
                max-width: 100%;
                margin: 20px auto;
                padding: 20px;
            }

            .tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab {
                text-align: left;
                padding: 10px 16px;
                font-size: 14px;
            }

            .admin-header h1 {
                font-size: 20px;
            }

            .rich-editor {
                min-height: 180px;
                font-size: 15px;
            }

            .info {
                padding: 12px;
                font-size: 13px;
            }

            .formatting-help {
                padding: 10px;
                font-size: 12px;
            }

            .editor-section h2 {
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .admin-container {
                margin: 10px auto;
                padding: 15px;
                border-radius: 10px;
            }

            .admin-header {
                margin-bottom: 20px;
            }

            .admin-header h1 {
                font-size: 18px;
            }

            .admin-header p {
                font-size: 13px;
            }

            .form-group input {
                padding: 10px;
                font-size: 15px;
            }

            .btn-unlock,
            .btn-lock,
            .btn-save {
                padding: 12px;
                font-size: 15px;
            }

            .rich-editor {
                min-height: 150px;
                padding: 12px;
                font-size: 14px;
            }

            .vows-editor input[type="text"] {
                padding: 10px;
                font-size: 15px;
            }

            .vows-editor label {
                font-size: 15px;
            }

            .editor-section {
                margin-top: 20px;
                padding-top: 20px;
            }

            .editor-section h2 {
                font-size: 16px;
                margin-bottom: 15px;
            }

            .vows-editor {
                margin-bottom: 20px;
            }

            .status {
                padding: 12px;
                font-size: 13px;
            }

            .info {
                padding: 10px;
                font-size: 12px;
            }

            .formatting-help {
                padding: 8px;
                font-size: 11px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 13px;
            }

            .lock-icon {
                font-size: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>üîê Admin Control Panel</h1>
            <p>Manage vows visibility and content</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('unlock')">üîì Unlock Control</button>
            <button class="tab" onclick="switchTab('editor')">‚úçÔ∏è Edit Vows</button>
        </div>

        <!-- Unlock Tab -->
        <div id="unlock-tab" class="tab-content active">
            <div id="status-display" class="status locked">
                üîí Vows are currently LOCKED
            </div>

            <div id="login-form">
                <div class="form-group">
                    <label for="password">Admin Password</label>
                    <input type="password" id="password" placeholder="Enter password">
                </div>
                <button class="btn-unlock" onclick="unlockVows()">üîì Unlock Vows</button>
                <div id="message"></div>
            </div>

            <div id="admin-controls" style="display: none;">
                <button class="btn-lock" onclick="lockVows()">üîí Lock Vows Again</button>
            </div>

            <div class="info">
                <strong>Instructions:</strong><br>
                - Default password: <code>wedding2024</code><br>
                - Change password in script.js<br>
                - Unlock when ceremony begins<br>
                - Guests will see vows immediately
            </div>
        </div>

        <!-- Editor Tab -->
        <div id="editor-tab" class="tab-content">
            <div class="editor-section">
                <h2>Edit Wedding Vows</h2>

                <div class="formatting-help">
                    <strong>Formatting Tips:</strong> Use the toolbar buttons to format your text. Select text and click the formatting buttons to apply styles.
                </div>

                <!-- Language selector for Groom -->
                <div class="language-selector">
                    <button type="button" class="lang-btn active" onclick="switchLanguage('groom', 'en')">
                        üá∫üá∏
                    </button>
                    <button type="button" class="lang-btn" onclick="switchLanguage('groom', 'pt')">
                        üáßüá∑
                    </button>
                </div>

                <div class="vows-editor">
                    <label for="groom-name-en">Groom's Name (English)</label>
                    <input type="text" id="groom-name-en" class="groom-lang-en" placeholder="Enter groom's name in English">

                    <label for="groom-name-pt" style="display: none;">Groom's Name (Portugu√™s)</label>
                    <input type="text" id="groom-name-pt" class="groom-lang-pt" style="display: none;" placeholder="Digite o nome do noivo em portugu√™s">

                    <label for="groom-vows-en" class="groom-lang-en">Groom's Vows (English)</label>
                    <label for="groom-vows-pt" class="groom-lang-pt" style="display: none;">Groom's Vows (Portugu√™s)</label>

                    <!-- English Editor -->
                    <div class="editor-wrapper groom-lang-en">
                        <div class="toolbar">
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'bold')" title="Bold"><b>B</b></button>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'italic')" title="Italic"><i>I</i></button>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'underline')" title="Underline"><u>U</u></button>
                            <div class="separator"></div>
                            <select onchange="changeFontSize('groom-vows-editor-en', this.value)" title="Font Size">
                                <option value="">Size</option>
                                <option value="1">Small</option>
                                <option value="3">Normal</option>
                                <option value="5">Large</option>
                                <option value="7">Extra Large</option>
                            </select>
                            <input type="color" onchange="changeTextColor('groom-vows-editor-en', this.value)" title="Text Color" value="#000000">
                            <div class="separator"></div>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'justifyLeft')" title="Align Left">‚¨Ö</button>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'justifyCenter')" title="Align Center">‚Üî</button>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'justifyRight')" title="Align Right">‚û°</button>
                            <button type="button" onclick="formatText('groom-vows-editor-en', 'justifyFull')" title="Justify">‚â°</button>
                        </div>
                        <div id="groom-vows-editor-en" class="rich-editor" contenteditable="true" data-placeholder="Start writing the groom's vows in English..."></div>
                    </div>

                    <!-- Portuguese Editor -->
                    <div class="editor-wrapper groom-lang-pt" style="display: none;">
                        <div class="toolbar">
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'bold')" title="Negrito"><b>N</b></button>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'italic')" title="It√°lico"><i>I</i></button>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'underline')" title="Sublinhado"><u>S</u></button>
                            <div class="separator"></div>
                            <select onchange="changeFontSize('groom-vows-editor-pt', this.value)" title="Tamanho">
                                <option value="">Tamanho</option>
                                <option value="1">Pequeno</option>
                                <option value="3">Normal</option>
                                <option value="5">Grande</option>
                                <option value="7">Extra Grande</option>
                            </select>
                            <input type="color" onchange="changeTextColor('groom-vows-editor-pt', this.value)" title="Cor do texto" value="#000000">
                            <div class="separator"></div>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'justifyLeft')" title="Alinhar √† esquerda">‚¨Ö</button>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'justifyCenter')" title="Centralizar">‚Üî</button>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'justifyRight')" title="Alinhar √† direita">‚û°</button>
                            <button type="button" onclick="formatText('groom-vows-editor-pt', 'justifyFull')" title="Justificar">‚â°</button>
                        </div>
                        <div id="groom-vows-editor-pt" class="rich-editor" contenteditable="true" data-placeholder="Comece a escrever os votos do noivo em portugu√™s..."></div>
                    </div>
                </div>

                <!-- Language selector for Bride -->
                <div class="language-selector">
                    <button type="button" class="lang-btn active" onclick="switchLanguage('bride', 'en')">
                        üá∫üá∏
                    </button>
                    <button type="button" class="lang-btn" onclick="switchLanguage('bride', 'pt')">
                        üáßüá∑
                    </button>
                </div>

                <div class="vows-editor">
                    <label for="bride-name-en">Bride's Name (English)</label>
                    <input type="text" id="bride-name-en" class="bride-lang-en" placeholder="Enter bride's name in English">

                    <label for="bride-name-pt" style="display: none;">Bride's Name (Portugu√™s)</label>
                    <input type="text" id="bride-name-pt" class="bride-lang-pt" style="display: none;" placeholder="Digite o nome da noiva em portugu√™s">

                    <label for="bride-vows-en" class="bride-lang-en">Bride's Vows (English)</label>
                    <label for="bride-vows-pt" class="bride-lang-pt" style="display: none;">Bride's Vows (Portugu√™s)</label>

                    <!-- English Editor -->
                    <div class="editor-wrapper bride-lang-en">
                        <div class="toolbar">
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'bold')" title="Bold"><b>B</b></button>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'italic')" title="Italic"><i>I</i></button>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'underline')" title="Underline"><u>U</u></button>
                            <div class="separator"></div>
                            <select onchange="changeFontSize('bride-vows-editor-en', this.value)" title="Font Size">
                                <option value="">Size</option>
                                <option value="1">Small</option>
                                <option value="3">Normal</option>
                                <option value="5">Large</option>
                                <option value="7">Extra Large</option>
                            </select>
                            <input type="color" onchange="changeTextColor('bride-vows-editor-en', this.value)" title="Text Color" value="#000000">
                            <div class="separator"></div>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'justifyLeft')" title="Align Left">‚¨Ö</button>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'justifyCenter')" title="Align Center">‚Üî</button>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'justifyRight')" title="Align Right">‚û°</button>
                            <button type="button" onclick="formatText('bride-vows-editor-en', 'justifyFull')" title="Justify">‚â°</button>
                        </div>
                        <div id="bride-vows-editor-en" class="rich-editor" contenteditable="true" data-placeholder="Start writing the bride's vows in English..."></div>
                    </div>

                    <!-- Portuguese Editor -->
                    <div class="editor-wrapper bride-lang-pt" style="display: none;">
                        <div class="toolbar">
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'bold')" title="Negrito"><b>N</b></button>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'italic')" title="It√°lico"><i>I</i></button>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'underline')" title="Sublinhado"><u>S</u></button>
                            <div class="separator"></div>
                            <select onchange="changeFontSize('bride-vows-editor-pt', this.value)" title="Tamanho">
                                <option value="">Tamanho</option>
                                <option value="1">Pequeno</option>
                                <option value="3">Normal</option>
                                <option value="5">Grande</option>
                                <option value="7">Extra Grande</option>
                            </select>
                            <input type="color" onchange="changeTextColor('bride-vows-editor-pt', this.value)" title="Cor do texto" value="#000000">
                            <div class="separator"></div>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'justifyLeft')" title="Alinhar √† esquerda">‚¨Ö</button>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'justifyCenter')" title="Centralizar">‚Üî</button>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'justifyRight')" title="Alinhar √† direita">‚û°</button>
                            <button type="button" onclick="formatText('bride-vows-editor-pt', 'justifyFull')" title="Justificar">‚â°</button>
                        </div>
                        <div id="bride-vows-editor-pt" class="rich-editor" contenteditable="true" data-placeholder="Comece a escrever os votos da noiva em portugu√™s..."></div>
                    </div>
                </div>

                <button class="btn-save" onclick="saveVows()">üíæ Save Vows</button>
                <div id="save-message"></div>

                <div class="info" style="margin-top: 20px;">
                    <strong>Note:</strong> Your vows are saved in your browser's storage. Make sure to save your changes before the ceremony!
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration (must be defined first)
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3001/api' : '/api';

        // CHANGE THIS PASSWORD to your own secure password
        const ADMIN_PASSWORD = 'wedding2024';

        async function checkStatus() {
            try {
                const response = await fetch(`${API_URL}/unlock-status`);
                const data = await response.json();

                const statusDisplay = document.getElementById('status-display');
                const loginForm = document.getElementById('login-form');
                const adminControls = document.getElementById('admin-controls');

                if (data.is_unlocked) {
                    statusDisplay.className = 'status unlocked';
                    statusDisplay.textContent = 'üîì Vows are currently UNLOCKED';
                    loginForm.style.display = 'none';
                    adminControls.style.display = 'block';
                } else {
                    statusDisplay.className = 'status locked';
                    statusDisplay.textContent = 'üîí Vows are currently LOCKED';
                    loginForm.style.display = 'block';
                    adminControls.style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking status:', error);
                // Fallback for when API is not available
                const statusDisplay = document.getElementById('status-display');
                statusDisplay.className = 'status locked';
                statusDisplay.textContent = '‚ö†Ô∏è API not available - Server may need updating';
                document.getElementById('login-form').style.display = 'block';
            }
        }

        async function unlockVows() {
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('message');

            if (!password) {
                messageDiv.className = 'error';
                messageDiv.textContent = '‚úó Please enter password';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/unlock`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password }),
                });

                const data = await response.json();

                if (response.ok) {
                    messageDiv.className = 'success';
                    messageDiv.textContent = '‚úì Vows unlocked successfully!';
                    document.getElementById('password').value = '';
                    setTimeout(() => {
                        messageDiv.textContent = '';
                        checkStatus();
                    }, 1500);
                } else {
                    messageDiv.className = 'error';
                    messageDiv.textContent = `‚úó ${data.error}`;
                    setTimeout(() => {
                        messageDiv.textContent = '';
                    }, 3000);
                }
            } catch (error) {
                console.error('Error unlocking vows:', error);
                messageDiv.className = 'error';
                messageDiv.textContent = '‚úó Error connecting to server';
            }
        }

        async function lockVows() {
            if (!confirm('Are you sure you want to lock the vows again?')) {
                return;
            }

            const password = prompt('Enter admin password to lock vows:');
            if (!password) return;

            try {
                const response = await fetch(`${API_URL}/lock`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password }),
                });

                const data = await response.json();

                if (response.ok) {
                    checkStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error locking vows:', error);
                alert('Error connecting to server');
            }
        }

        // Allow Enter key to submit
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                unlockVows();
            }
        });

        // Check status on load
        checkStatus();

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            if (tabName === 'unlock') {
                document.getElementById('unlock-tab').classList.add('active');
                document.querySelector('.tab:nth-child(1)').classList.add('active');
            } else if (tabName === 'editor') {
                document.getElementById('editor-tab').classList.add('active');
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                loadVows();
            }
        }

        // Rich text editor functions
        function formatText(editorId, command) {
            const editor = document.getElementById(editorId);
            editor.focus();
            document.execCommand(command, false, null);
        }

        function changeFontSize(editorId, size) {
            if (size) {
                const editor = document.getElementById(editorId);
                editor.focus();
                document.execCommand('fontSize', false, size);
            }
        }

        function changeTextColor(editorId, color) {
            const editor = document.getElementById(editorId);
            editor.focus();
            document.execCommand('foreColor', false, color);
        }

        // Language switching function
        function switchLanguage(person, lang) {
            // Update button states
            const buttons = document.querySelectorAll(`.language-selector button`);
            const personButtons = Array.from(buttons).filter(btn =>
                btn.onclick.toString().includes(`'${person}'`)
            );

            personButtons.forEach(btn => {
                if (btn.onclick.toString().includes(`'${lang}'`)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Show/hide language-specific fields
            const enElements = document.querySelectorAll(`.${person}-lang-en`);
            const ptElements = document.querySelectorAll(`.${person}-lang-pt`);

            if (lang === 'en') {
                enElements.forEach(el => el.style.display = '');
                ptElements.forEach(el => el.style.display = 'none');
            } else {
                enElements.forEach(el => el.style.display = 'none');
                ptElements.forEach(el => el.style.display = '');
            }
        }

        // Save vows to database via API
        async function saveVows() {
            const password = prompt('Enter admin password to save vows:');
            if (!password) return;

            // Get all field values
            const groomNameEn = document.getElementById('groom-name-en').value.trim();
            const groomNamePt = document.getElementById('groom-name-pt').value.trim();
            const groomVowsEn = document.getElementById('groom-vows-editor-en').innerHTML.trim();
            const groomVowsPt = document.getElementById('groom-vows-editor-pt').innerHTML.trim();

            const brideNameEn = document.getElementById('bride-name-en').value.trim();
            const brideNamePt = document.getElementById('bride-name-pt').value.trim();
            const brideVowsEn = document.getElementById('bride-vows-editor-en').innerHTML.trim();
            const brideVowsPt = document.getElementById('bride-vows-editor-pt').innerHTML.trim();

            // Validate all fields
            if (!groomNameEn || !groomNamePt || !groomVowsEn || !groomVowsPt ||
                !brideNameEn || !brideNamePt || !brideVowsEn || !brideVowsPt) {
                showSaveMessage('Please fill in all fields for both languages', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/vows`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        password,
                        groomNameEn,
                        groomNamePt,
                        groomVowsEn,
                        groomVowsPt,
                        brideNameEn,
                        brideNamePt,
                        brideVowsEn,
                        brideVowsPt,
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    showSaveMessage('‚úì Vows saved successfully to database!', 'success');
                } else {
                    showSaveMessage(`‚úó Error: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Error saving vows:', error);
                showSaveMessage('‚úó Error connecting to server', 'error');
            }
        }

        // Load vows from database via API
        async function loadVows() {
            try {
                const response = await fetch(`${API_URL}/vows`);

                if (!response.ok) {
                    console.log('No vows found in database');
                    return;
                }

                const data = await response.json();

                // Load groom data from wedding_vows
                if (data.wedding_vows && data.wedding_vows.groom) {
                    document.getElementById('groom-name-en').value = data.wedding_vows.groom.person_name_en || '';
                    document.getElementById('groom-name-pt').value = data.wedding_vows.groom.person_name_pt || '';
                    document.getElementById('groom-vows-editor-en').innerHTML = data.wedding_vows.groom.vow_text_en || '';
                    document.getElementById('groom-vows-editor-pt').innerHTML = data.wedding_vows.groom.vow_text_pt || '';
                }

                // Load bride data from wedding_vows
                if (data.wedding_vows && data.wedding_vows.bride) {
                    document.getElementById('bride-name-en').value = data.wedding_vows.bride.person_name_en || '';
                    document.getElementById('bride-name-pt').value = data.wedding_vows.bride.person_name_pt || '';
                    document.getElementById('bride-vows-editor-en').innerHTML = data.wedding_vows.bride.vow_text_en || '';
                    document.getElementById('bride-vows-editor-pt').innerHTML = data.wedding_vows.bride.vow_text_pt || '';
                }
            } catch (error) {
                console.error('Error loading vows:', error);
                // Fallback when API is not available
                const vowsList = document.getElementById('saved-vows-list');
                if (vowsList) {
                    vowsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #e74c3c;"><h3>‚ö†Ô∏è Vows API Not Available</h3><p>The server needs to be updated with the new vows API endpoints.</p><p>Contact the administrator to deploy the updated server code.</p></div>';
                }
            }
        }

        // Show save message
        function showSaveMessage(message, type) {
            const messageDiv = document.getElementById('save-message');
            messageDiv.className = type;
            messageDiv.textContent = message;
            setTimeout(() => {
                messageDiv.textContent = '';
            }, 3000);
        }

        // Load vows on page load
        loadVows();
    </script>
</body>
</html>
