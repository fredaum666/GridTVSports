<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GridTV Sports</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0a0e1a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        #app-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0e1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .app-title {
            font-size: 48px;
            font-weight: bold;
            color: white;
            margin-bottom: 32px;
        }

        .progress-container {
            width: 300px;
            height: 8px;
            background: #1e293b;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f97316, #fb923c);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-text {
            margin-top: 16px;
            color: #94a3b8;
            font-size: 18px;
        }

        .error-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0e1a;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .error-icon {
            font-size: 64px;
            margin-bottom: 24px;
            color: #ef4444;
        }

        .error-title {
            font-size: 32px;
            color: #ef4444;
            margin-bottom: 16px;
        }

        .error-message {
            font-size: 18px;
            color: #94a3b8;
            margin-bottom: 32px;
            text-align: center;
            max-width: 500px;
        }

        .retry-btn {
            padding: 16px 48px;
            font-size: 20px;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .retry-btn:focus {
            outline: 3px solid #818cf8;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="app-title">GridTV Sports</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="loading-text" id="loading-text">Loading...</div>
    </div>

    <!-- Error Screen -->
    <div class="error-screen" id="error-screen">
        <div class="error-icon">!</div>
        <div class="error-title">Connection Error</div>
        <div class="error-message" id="error-message">Unable to connect to GridTV Sports. Please check your internet connection.</div>
        <button class="retry-btn" id="retry-btn">Retry</button>
    </div>

    <!-- Main App Frame -->
    <iframe id="app-frame" src="about:blank" allow="autoplay; fullscreen"></iframe>

    <!-- webOS TV library -->
    <script src="webOSTVjs-1.2.4/webOSTV.js"></script>
    <script src="webOSTVjs-1.2.4/webOSTV-dev.js"></script>
    <script>
        (function() {
            'use strict';

            var APP_URL = 'https://gridtvsports.com/tv-home';

            var appFrame = document.getElementById('app-frame');
            var loadingScreen = document.getElementById('loading-screen');
            var errorScreen = document.getElementById('error-screen');
            var progressBar = document.getElementById('progress-bar');
            var loadingText = document.getElementById('loading-text');
            var retryBtn = document.getElementById('retry-btn');

            var loadProgress = 0;
            var progressInterval = null;

            // Initialize webOS TV APIs
            function initWebOS() {
                try {
                    if (typeof webOS !== 'undefined') {
                        // Get device info
                        webOS.deviceInfo(function(info) {
                            console.log('webOS Device:', info.modelName, info.version);
                        });

                        // Keep screen on
                        if (webOS.platform && webOS.platform.tv) {
                            console.log('Running on webOS TV');
                        }
                    }
                    console.log('webOS API initialized');
                } catch (e) {
                    console.log('webOS API not available:', e);
                }
            }

            // Simulate loading progress
            function startProgressSimulation() {
                loadProgress = 0;
                progressInterval = setInterval(function() {
                    if (loadProgress < 90) {
                        loadProgress += Math.random() * 15;
                        if (loadProgress > 90) loadProgress = 90;
                        progressBar.style.width = loadProgress + '%';
                    }
                }, 200);
            }

            function stopProgressSimulation() {
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                progressBar.style.width = '100%';
            }

            // Show loading screen
            function showLoading() {
                loadingScreen.style.display = 'flex';
                errorScreen.style.display = 'none';
                startProgressSimulation();
            }

            // Hide loading screen
            function hideLoading() {
                stopProgressSimulation();
                loadingScreen.style.display = 'none';
            }

            // Show error screen
            function showError(message) {
                stopProgressSimulation();
                loadingScreen.style.display = 'none';
                errorScreen.style.display = 'flex';
                document.getElementById('error-message').textContent = message || 'Unable to connect to GridTV Sports.';
                retryBtn.focus();
            }

            // Load the app
            function loadApp() {
                showLoading();
                loadingText.textContent = 'Connecting to GridTV Sports...';

                // Set a timeout for connection
                var timeout = setTimeout(function() {
                    if (loadingScreen.style.display !== 'none') {
                        showError('Connection timed out. Please check your internet connection.');
                    }
                }, 30000);

                appFrame.onload = function() {
                    clearTimeout(timeout);
                    hideLoading();
                    appFrame.focus();
                };

                appFrame.onerror = function() {
                    clearTimeout(timeout);
                    showError('Failed to load the application.');
                };

                appFrame.src = APP_URL;
            }

            // Handle remote control
            document.addEventListener('keydown', function(e) {
                switch (e.keyCode) {
                    case 461: // BACK key on LG TV
                        if (errorScreen.style.display === 'flex') {
                            // Exit app if on error screen
                            try {
                                webOS.platformBack();
                            } catch (ex) {
                                window.close();
                            }
                        }
                        // Let the iframe handle back navigation otherwise
                        break;
                    case 413: // STOP key
                    case 415: // PLAY key
                    case 417: // FAST_FORWARD key
                    case 412: // REWIND key
                        // Media keys - pass to iframe
                        break;
                }
            });

            // Retry button
            retryBtn.addEventListener('click', loadApp);
            retryBtn.addEventListener('keydown', function(e) {
                if (e.keyCode === 13) { // Enter
                    loadApp();
                }
            });

            // Initialize on load
            window.onload = function() {
                initWebOS();
                loadApp();
            };

            // Handle visibility change (app resume)
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    appFrame.focus();
                }
            });

            // Handle webOS specific back behavior
            document.addEventListener('webOSRelaunch', function(e) {
                console.log('App relaunched');
                appFrame.focus();
            });
        })();
    </script>
</body>
</html>
